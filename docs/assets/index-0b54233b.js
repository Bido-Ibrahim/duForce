(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var pi=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(pi||{}),Hf=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(Hf||{}),wh=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(wh||{}),at=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(at||{}),Ke=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Ke||{}),U=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(U||{}),Oi=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(Oi||{}),nt=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(nt||{}),q=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(q||{}),dr=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(dr||{}),Or=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Or||{}),rr=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(rr||{}),fe=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(fe||{}),Ye=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(Ye||{}),Vl=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(Vl||{}),we=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(we||{}),qt=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(qt||{}),Wt=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(Wt||{}),Qe=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(Qe||{});const vy={createCanvas:(r,t)=>{const e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},K={ADAPTER:vy,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var fa=/iPhone/i,Fu=/iPod/i,Ou=/iPad/i,Uu=/\biOS-universal(?:.+)Mac\b/i,pa=/\bAndroid(?:.+)Mobile\b/i,Gu=/Android/i,xi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,fs=/Silk/i,or=/Windows Phone/i,$u=/\bWindows(?:.+)ARM\b/i,Hu=/BlackBerry/i,zu=/BB10/i,Xu=/Opera Mini/i,Vu=/\b(CriOS|Chrome)(?:.+)Mobile/i,Wu=/Mobile(?:.+)Firefox\b/i,ju=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function xy(r){return function(t){return t.test(r)}}function Yu(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=xy(e),s={apple:{phone:n(fa)&&!n(or),ipod:n(Fu),tablet:!n(fa)&&(n(Ou)||ju(t))&&!n(or),universal:n(Uu),device:(n(fa)||n(Fu)||n(Ou)||n(Uu)||ju(t))&&!n(or)},amazon:{phone:n(xi),tablet:!n(xi)&&n(fs),device:n(xi)||n(fs)},android:{phone:!n(or)&&n(xi)||!n(or)&&n(pa),tablet:!n(or)&&!n(xi)&&!n(pa)&&(n(fs)||n(Gu)),device:!n(or)&&(n(xi)||n(fs)||n(pa)||n(Gu))||n(/\bokhttp\b/i)},windows:{phone:n(or),tablet:n($u),device:n(or)||n($u)},other:{blackberry:n(Hu),blackberry10:n(zu),opera:n(Xu),firefox:n(Wu),chrome:n(Vu),device:n(Hu)||n(zu)||n(Xu)||n(Wu)||n(Vu)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const wy=Yu.default??Yu,fr=wy(globalThis.navigator);K.RETINA_PREFIX=/@([0-9\.]+)x/;K.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function by(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),e}var zf={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function s(h,l,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,c||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p},a.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},a.prototype.emit=function(l,u,c,d,f,p){var g=e?e+l:l;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,x,v;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,c),!0;case 4:return m.fn.call(m.context,u,c,d),!0;case 5:return m.fn.call(m.context,u,c,d,f),!0;case 6:return m.fn.call(m.context,u,c,d,f,p),!0}for(v=1,x=new Array(y-1);v<y;v++)x[v-1]=arguments[v];m.fn.apply(m.context,x)}else{var _=m.length,E;for(v=0;v<_;v++)switch(m[v].once&&this.removeListener(l,m[v].fn,void 0,!0),y){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,u);break;case 3:m[v].fn.call(m[v].context,u,c);break;case 4:m[v].fn.call(m[v].context,u,c,d);break;default:if(!x)for(E=1,x=new Array(y-1);E<y;E++)x[E-1]=arguments[E];m[v].fn.apply(m[v].context,x)}}return!0},a.prototype.on=function(l,u,c){return s(this,l,u,c,!1)},a.prototype.once=function(l,u,c){return s(this,l,u,c,!0)},a.prototype.removeListener=function(l,u,c,d){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!c||p.context===c)&&o(this,f);else{for(var g=0,m=[],y=p.length;g<y;g++)(p[g].fn!==u||d&&!p[g].once||c&&p[g].context!==c)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&o(this,u)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,r.exports=a})(zf);var Ey=zf.exports;const Jn=Qn(Ey);var Wl={exports:{}};Wl.exports=Vo;Wl.exports.default=Vo;function Vo(r,t,e){e=e||2;var i=t&&t.length,n=i?t[0]*e:r.length,s=Xf(r,0,n,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,h,l,u,c,d,f;if(i&&(s=Cy(r,t,s,e)),r.length>80*e){a=l=r[0],h=u=r[1];for(var p=e;p<n;p+=e)c=r[p],d=r[p+1],c<a&&(a=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return Hn(s,o,e,a,h,f,0),o}function Xf(r,t,e,i,n){var s,o;if(n===Ah(r,t,e,i)>0)for(s=t;s<e;s+=i)o=qu(s,r[s],r[s+1],o);else for(s=e-i;s>=t;s-=i)o=qu(s,r[s],r[s+1],o);return o&&Wo(o,o.next)&&(Xn(o),o=o.next),o}function hi(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(Wo(e,e.next)||Ft(e.prev,e,e.next)===0)){if(Xn(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Hn(r,t,e,i,n,s,o){if(r){!o&&s&&Dy(r,i,n,s);for(var a=r,h,l;r.prev!==r.next;){if(h=r.prev,l=r.next,s?Ty(r,i,n,s):Ay(r)){t.push(h.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),Xn(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=Sy(hi(r),t,e),Hn(r,t,e,i,n,s,2)):o===2&&Iy(r,t,e,i,n,s):Hn(hi(r),t,e,i,n,s,1);break}}}}function Ay(r){var t=r.prev,e=r,i=r.next;if(Ft(t,e,i)>=0)return!1;for(var n=t.x,s=e.x,o=i.x,a=t.y,h=e.y,l=i.y,u=n<s?n<o?n:o:s<o?s:o,c=a<h?a<l?a:l:h<l?h:l,d=n>s?n>o?n:o:s>o?s:o,f=a>h?a>l?a:l:h>l?h:l,p=i.next;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&Bi(n,a,s,h,o,l,p.x,p.y)&&Ft(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Ty(r,t,e,i){var n=r.prev,s=r,o=r.next;if(Ft(n,s,o)>=0)return!1;for(var a=n.x,h=s.x,l=o.x,u=n.y,c=s.y,d=o.y,f=a<h?a<l?a:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,g=a>h?a>l?a:l:h>l?h:l,m=u>c?u>d?u:d:c>d?c:d,y=bh(f,p,t,e,i),x=bh(g,m,t,e,i),v=r.prevZ,_=r.nextZ;v&&v.z>=y&&_&&_.z<=x;){if(v.x>=f&&v.x<=g&&v.y>=p&&v.y<=m&&v!==n&&v!==o&&Bi(a,u,h,c,l,d,v.x,v.y)&&Ft(v.prev,v,v.next)>=0||(v=v.prevZ,_.x>=f&&_.x<=g&&_.y>=p&&_.y<=m&&_!==n&&_!==o&&Bi(a,u,h,c,l,d,_.x,_.y)&&Ft(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=g&&v.y>=p&&v.y<=m&&v!==n&&v!==o&&Bi(a,u,h,c,l,d,v.x,v.y)&&Ft(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=x;){if(_.x>=f&&_.x<=g&&_.y>=p&&_.y<=m&&_!==n&&_!==o&&Bi(a,u,h,c,l,d,_.x,_.y)&&Ft(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Sy(r,t,e){var i=r;do{var n=i.prev,s=i.next.next;!Wo(n,s)&&Vf(n,i,i.next,s)&&zn(n,s)&&zn(s,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(s.i/e|0),Xn(i),Xn(i.next),i=r=s),i=i.next}while(i!==r);return hi(i)}function Iy(r,t,e,i,n,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ky(o,a)){var h=Wf(o,a);o=hi(o,o.next),h=hi(h,h.next),Hn(o,t,e,i,n,s,0),Hn(h,t,e,i,n,s,0);return}a=a.next}o=o.next}while(o!==r)}function Cy(r,t,e,i){var n=[],s,o,a,h,l;for(s=0,o=t.length;s<o;s++)a=t[s]*i,h=s<o-1?t[s+1]*i:r.length,l=Xf(r,a,h,i,!1),l===l.next&&(l.steiner=!0),n.push(By(l));for(n.sort(Ny),s=0;s<n.length;s++)e=Ry(n[s],e);return e}function Ny(r,t){return r.x-t.x}function Ry(r,t){var e=Py(r,t);if(!e)return t;var i=Wf(e,r);return hi(i,i.next),hi(e,e.next)}function Py(r,t){var e=t,i=r.x,n=r.y,s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===i))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,u=o.y,c=1/0,d;e=o;do i>=e.x&&e.x>=l&&i!==e.x&&Bi(n<u?i:s,n,l,u,n<u?s:i,n,e.x,e.y)&&(d=Math.abs(n-e.y)/(i-e.x),zn(e,r)&&(d<c||d===c&&(e.x>o.x||e.x===o.x&&My(o,e)))&&(o=e,c=d)),e=e.next;while(e!==h);return o}function My(r,t){return Ft(r.prev,r,t.prev)<0&&Ft(t.next,r,r.next)<0}function Dy(r,t,e,i){var n=r;do n.z===0&&(n.z=bh(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,Ly(n)}function Ly(r){var t,e,i,n,s,o,a,h,l=1;do{for(e=r,r=null,s=null,o=0;e;){for(o++,i=e,a=0,t=0;t<l&&(a++,i=i.nextZ,!!i);t++);for(h=l;a>0||h>0&&i;)a!==0&&(h===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,a--):(n=i,i=i.nextZ,h--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;e=i}s.nextZ=null,l*=2}while(o>1);return r}function bh(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function By(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Bi(r,t,e,i,n,s,o,a){return(n-o)*(t-a)>=(r-o)*(s-a)&&(r-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(n-o)*(i-a)}function ky(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Fy(r,t)&&(zn(r,t)&&zn(t,r)&&Oy(r,t)&&(Ft(r.prev,r,t.prev)||Ft(r,t.prev,t))||Wo(r,t)&&Ft(r.prev,r,r.next)>0&&Ft(t.prev,t,t.next)>0)}function Ft(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Wo(r,t){return r.x===t.x&&r.y===t.y}function Vf(r,t,e,i){var n=gs(Ft(r,t,e)),s=gs(Ft(r,t,i)),o=gs(Ft(e,i,r)),a=gs(Ft(e,i,t));return!!(n!==s&&o!==a||n===0&&ps(r,e,t)||s===0&&ps(r,i,t)||o===0&&ps(e,r,i)||a===0&&ps(e,t,i))}function ps(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function gs(r){return r>0?1:r<0?-1:0}function Fy(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Vf(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function zn(r,t){return Ft(r.prev,r,r.next)<0?Ft(r,t,r.next)>=0&&Ft(r,r.prev,t)>=0:Ft(r,t,r.prev)<0||Ft(r,r.next,t)<0}function Oy(r,t){var e=r,i=!1,n=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function Wf(r,t){var e=new Eh(r.i,r.x,r.y),i=new Eh(t.i,t.x,t.y),n=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function qu(r,t,e,i){var n=new Eh(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Xn(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Eh(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Vo.deviation=function(r,t,e,i){var n=t&&t.length,s=n?t[0]*e:r.length,o=Math.abs(Ah(r,0,s,e));if(n)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:r.length;o-=Math.abs(Ah(r,l,u,e))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,f=i[a+1]*e,p=i[a+2]*e;c+=Math.abs((r[d]-r[p])*(r[f+1]-r[d+1])-(r[d]-r[f])*(r[p+1]-r[d+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function Ah(r,t,e,i){for(var n=0,s=t,o=e-i;s<e;s+=i)n+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return n}Vo.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var o=0;o<t;o++)e.vertices.push(r[n][s][o]);n>0&&(i+=r[n-1].length,e.holes.push(i))}return e};var Uy=Wl.exports;const Gy=Qn(Uy);var uo={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */uo.exports;(function(r,t){(function(e){var i=t&&!t.nodeType&&t,n=r&&!r.nodeType&&r,s=typeof Bn=="object"&&Bn;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,g="-",m=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=h-l,E=Math.floor,N=String.fromCharCode,S;function T(P){throw new RangeError(v[P])}function D(P,F){for(var rt=P.length,ft=[];rt--;)ft[rt]=F(P[rt]);return ft}function B(P,F){var rt=P.split("@"),ft="";rt.length>1&&(ft=rt[0]+"@",P=rt[1]),P=P.replace(x,".");var ht=P.split("."),Et=D(ht,F).join(".");return ft+Et}function k(P){for(var F=[],rt=0,ft=P.length,ht,Et;rt<ft;)ht=P.charCodeAt(rt++),ht>=55296&&ht<=56319&&rt<ft?(Et=P.charCodeAt(rt++),(Et&64512)==56320?F.push(((ht&1023)<<10)+(Et&1023)+65536):(F.push(ht),rt--)):F.push(ht);return F}function M(P){return D(P,function(F){var rt="";return F>65535&&(F-=65536,rt+=N(F>>>10&1023|55296),F=56320|F&1023),rt+=N(F),rt}).join("")}function A(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:h}function w(P,F){return P+22+75*(P<26)-((F!=0)<<5)}function C(P,F,rt){var ft=0;for(P=rt?E(P/d):P>>1,P+=E(P/F);P>_*u>>1;ft+=h)P=E(P/_);return E(ft+(_+1)*P/(P+c))}function I(P){var F=[],rt=P.length,ft,ht=0,Et=p,ct=f,At,It,Gt,jt,Tt,Lt,$t,ge,L;for(At=P.lastIndexOf(g),At<0&&(At=0),It=0;It<At;++It)P.charCodeAt(It)>=128&&T("not-basic"),F.push(P.charCodeAt(It));for(Gt=At>0?At+1:0;Gt<rt;){for(jt=ht,Tt=1,Lt=h;Gt>=rt&&T("invalid-input"),$t=A(P.charCodeAt(Gt++)),($t>=h||$t>E((a-ht)/Tt))&&T("overflow"),ht+=$t*Tt,ge=Lt<=ct?l:Lt>=ct+u?u:Lt-ct,!($t<ge);Lt+=h)L=h-ge,Tt>E(a/L)&&T("overflow"),Tt*=L;ft=F.length+1,ct=C(ht-jt,ft,jt==0),E(ht/ft)>a-Et&&T("overflow"),Et+=E(ht/ft),ht%=ft,F.splice(ht++,0,Et)}return M(F)}function R(P){var F,rt,ft,ht,Et,ct,At,It,Gt,jt,Tt,Lt=[],$t,ge,L,G;for(P=k(P),$t=P.length,F=p,rt=0,Et=f,ct=0;ct<$t;++ct)Tt=P[ct],Tt<128&&Lt.push(N(Tt));for(ft=ht=Lt.length,ht&&Lt.push(g);ft<$t;){for(At=a,ct=0;ct<$t;++ct)Tt=P[ct],Tt>=F&&Tt<At&&(At=Tt);for(ge=ft+1,At-F>E((a-rt)/ge)&&T("overflow"),rt+=(At-F)*ge,F=At,ct=0;ct<$t;++ct)if(Tt=P[ct],Tt<F&&++rt>a&&T("overflow"),Tt==F){for(It=rt,Gt=h;jt=Gt<=Et?l:Gt>=Et+u?u:Gt-Et,!(It<jt);Gt+=h)G=It-jt,L=h-jt,Lt.push(N(w(jt+G%L,0))),It=E(G/L);Lt.push(N(w(It,0))),Et=C(rt,ge,ft==ht),rt=0,++ft}++rt,++F}return Lt.join("")}function O(P){return B(P,function(F){return m.test(F)?I(F.slice(4).toLowerCase()):F})}function z(P){return B(P,function(F){return y.test(F)?"xn--"+R(F):F})}if(o={version:"1.4.1",ucs2:{decode:k,encode:M},decode:I,encode:R,toASCII:z,toUnicode:O},i&&n)if(r.exports==i)n.exports=o;else for(S in o)o.hasOwnProperty(S)&&(i[S]=o[S]);else e.punycode=o})(Bn)})(uo,uo.exports);var $y=uo.exports,on=TypeError;const Hy={},zy=Object.freeze(Object.defineProperty({__proto__:null,default:Hy},Symbol.toStringTag,{value:"Module"})),Xy=by(zy);var jl=typeof Map=="function"&&Map.prototype,ga=Object.getOwnPropertyDescriptor&&jl?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,co=jl&&ga&&typeof ga.get=="function"?ga.get:null,Ku=jl&&Map.prototype.forEach,Yl=typeof Set=="function"&&Set.prototype,ma=Object.getOwnPropertyDescriptor&&Yl?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,fo=Yl&&ma&&typeof ma.get=="function"?ma.get:null,Zu=Yl&&Set.prototype.forEach,Vy=typeof WeakMap=="function"&&WeakMap.prototype,kn=Vy?WeakMap.prototype.has:null,Wy=typeof WeakSet=="function"&&WeakSet.prototype,Fn=Wy?WeakSet.prototype.has:null,jy=typeof WeakRef=="function"&&WeakRef.prototype,Qu=jy?WeakRef.prototype.deref:null,Yy=Boolean.prototype.valueOf,qy=Object.prototype.toString,Ky=Function.prototype.toString,Zy=String.prototype.match,ql=String.prototype.slice,Mr=String.prototype.replace,Qy=String.prototype.toUpperCase,Ju=String.prototype.toLowerCase,jf=RegExp.prototype.test,tc=Array.prototype.concat,qe=Array.prototype.join,Jy=Array.prototype.slice,ec=Math.floor,Th=typeof BigInt=="function"?BigInt.prototype.valueOf:null,ya=Object.getOwnPropertySymbols,Sh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ki=typeof Symbol=="function"&&typeof Symbol.iterator=="object",On=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ki||"symbol")?Symbol.toStringTag:null,Yf=Object.prototype.propertyIsEnumerable,rc=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function ic(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||jf.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-ec(-r):ec(r);if(i!==r){var n=String(i),s=ql.call(t,n.length+1);return Mr.call(n,e,"$&_")+"."+Mr.call(Mr.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Mr.call(t,e,"$&_")}var Ih=Xy,nc=Ih.custom,sc=Zf(nc)?nc:null,qf={__proto__:null,double:'"',single:"'"},t0={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},jo=function r(t,e,i,n){var s=e||{};if(ur(s,"quoteStyle")&&!ur(qf,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ur(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=ur(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ur(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ur(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Jf(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?ic(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?ic(t,l):l}var u=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=u&&u>0&&typeof t=="object")return Ch(t)?"[Array]":"[Object]";var c=_0(s,i);if(typeof n>"u")n=[];else if(Qf(n,t)>=0)return"[Circular]";function d(A,w,C){if(w&&(n=Jy.call(n),n.push(w)),C){var I={depth:s.depth};return ur(s,"quoteStyle")&&(I.quoteStyle=s.quoteStyle),r(A,I,i+1,n)}return r(A,s,i+1,n)}if(typeof t=="function"&&!oc(t)){var f=l0(t),p=ms(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+qe.call(p,", ")+" }":"")}if(Zf(t)){var g=Ki?Mr.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Sh.call(t);return typeof t=="object"&&!Ki?pn(g):g}if(g0(t)){for(var m="<"+Ju.call(String(t.nodeName)),y=t.attributes||[],x=0;x<y.length;x++)m+=" "+y[x].name+"="+Kf(e0(y[x].value),"double",s);return m+=">",t.childNodes&&t.childNodes.length&&(m+="..."),m+="</"+Ju.call(String(t.nodeName))+">",m}if(Ch(t)){if(t.length===0)return"[]";var v=ms(t,d);return c&&!y0(v)?"["+Nh(v,c)+"]":"[ "+qe.call(v,", ")+" ]"}if(i0(t)){var _=ms(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Yf.call(t,"cause")?"{ ["+String(t)+"] "+qe.call(tc.call("[cause]: "+d(t.cause),_),", ")+" }":_.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+qe.call(_,", ")+" }"}if(typeof t=="object"&&o){if(sc&&typeof t[sc]=="function"&&Ih)return Ih(t,{depth:u-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(u0(t)){var E=[];return Ku&&Ku.call(t,function(A,w){E.push(d(w,t,!0)+" => "+d(A,t))}),ac("Map",co.call(t),E,c)}if(f0(t)){var N=[];return Zu&&Zu.call(t,function(A){N.push(d(A,t))}),ac("Set",fo.call(t),N,c)}if(c0(t))return _a("WeakMap");if(p0(t))return _a("WeakSet");if(d0(t))return _a("WeakRef");if(s0(t))return pn(d(Number(t)));if(a0(t))return pn(d(Th.call(t)));if(o0(t))return pn(Yy.call(t));if(n0(t))return pn(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof Bn<"u"&&t===Bn)return"{ [object globalThis] }";if(!r0(t)&&!oc(t)){var S=ms(t,d),T=rc?rc(t)===Object.prototype:t instanceof Object||t.constructor===Object,D=t instanceof Object?"":"null prototype",B=!T&&On&&Object(t)===t&&On in t?ql.call($r(t),8,-1):D?"Object":"",k=T||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",M=k+(B||D?"["+qe.call(tc.call([],B||[],D||[]),": ")+"] ":"");return S.length===0?M+"{}":c?M+"{"+Nh(S,c)+"}":M+"{ "+qe.call(S,", ")+" }"}return String(t)};function Kf(r,t,e){var i=e.quoteStyle||t,n=qf[i];return n+r+n}function e0(r){return Mr.call(String(r),/"/g,"&quot;")}function gi(r){return!On||!(typeof r=="object"&&(On in r||typeof r[On]<"u"))}function Ch(r){return $r(r)==="[object Array]"&&gi(r)}function r0(r){return $r(r)==="[object Date]"&&gi(r)}function oc(r){return $r(r)==="[object RegExp]"&&gi(r)}function i0(r){return $r(r)==="[object Error]"&&gi(r)}function n0(r){return $r(r)==="[object String]"&&gi(r)}function s0(r){return $r(r)==="[object Number]"&&gi(r)}function o0(r){return $r(r)==="[object Boolean]"&&gi(r)}function Zf(r){if(Ki)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Sh)return!1;try{return Sh.call(r),!0}catch{}return!1}function a0(r){if(!r||typeof r!="object"||!Th)return!1;try{return Th.call(r),!0}catch{}return!1}var h0=Object.prototype.hasOwnProperty||function(r){return r in this};function ur(r,t){return h0.call(r,t)}function $r(r){return qy.call(r)}function l0(r){if(r.name)return r.name;var t=Zy.call(Ky.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function Qf(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function u0(r){if(!co||!r||typeof r!="object")return!1;try{co.call(r);try{fo.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function c0(r){if(!kn||!r||typeof r!="object")return!1;try{kn.call(r,kn);try{Fn.call(r,Fn)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function d0(r){if(!Qu||!r||typeof r!="object")return!1;try{return Qu.call(r),!0}catch{}return!1}function f0(r){if(!fo||!r||typeof r!="object")return!1;try{fo.call(r);try{co.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function p0(r){if(!Fn||!r||typeof r!="object")return!1;try{Fn.call(r,Fn);try{kn.call(r,kn)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function g0(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Jf(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return Jf(ql.call(r,0,t.maxStringLength),t)+i}var n=t0[t.quoteStyle||"single"];n.lastIndex=0;var s=Mr.call(Mr.call(r,n,"\\$1"),/[\x00-\x1f]/g,m0);return Kf(s,"single",t)}function m0(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Qy.call(t.toString(16))}function pn(r){return"Object("+r+")"}function _a(r){return r+" { ? }"}function ac(r,t,e,i){var n=i?Nh(e,i):qe.call(e,", ");return r+" ("+t+") {"+n+"}"}function y0(r){for(var t=0;t<r.length;t++)if(Qf(r[t],`
`)>=0)return!1;return!0}function _0(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=qe.call(Array(r.indent+1)," ");else return null;return{base:e,prev:qe.call(Array(t+1),e)}}function Nh(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+qe.call(r,","+e)+`
`+t.prev}function ms(r,t){var e=Ch(r),i=[];if(e){i.length=r.length;for(var n=0;n<r.length;n++)i[n]=ur(r,n)?t(r[n],r):""}var s=typeof ya=="function"?ya(r):[],o;if(Ki){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var h in r)ur(r,h)&&(e&&String(Number(h))===h&&h<r.length||Ki&&o["$"+h]instanceof Symbol||(jf.call(/[^\w$]/,h)?i.push(t(h,r)+": "+t(r[h],r)):i.push(h+": "+t(r[h],r))));if(typeof ya=="function")for(var l=0;l<s.length;l++)Yf.call(r,s[l])&&i.push("["+t(s[l])+"]: "+t(r[s[l]],r));return i}var v0=jo,x0=on,Yo=function(r,t,e){for(var i=r,n;(n=i.next)!=null;i=n)if(n.key===t)return i.next=n.next,e||(n.next=r.next,r.next=n),n},w0=function(r,t){if(r){var e=Yo(r,t);return e&&e.value}},b0=function(r,t,e){var i=Yo(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},E0=function(r,t){return r?!!Yo(r,t):!1},A0=function(r,t){if(r)return Yo(r,t,!0)},T0=function(){var t,e={assert:function(i){if(!e.has(i))throw new x0("Side channel does not contain "+v0(i))},delete:function(i){var n=t&&t.next,s=A0(t,i);return s&&n&&n===s&&(t=void 0),!!s},get:function(i){return w0(t,i)},has:function(i){return E0(t,i)},set:function(i,n){t||(t={next:void 0}),b0(t,i,n)}};return e},tp=Object,S0=Error,I0=EvalError,C0=RangeError,N0=ReferenceError,R0=SyntaxError,P0=URIError,M0=Math.abs,D0=Math.floor,L0=Math.max,B0=Math.min,k0=Math.pow,F0=Math.round,O0=Number.isNaN||function(t){return t!==t},U0=O0,G0=function(t){return U0(t)||t===0?t:t<0?-1:1},$0=Object.getOwnPropertyDescriptor,Ws=$0;if(Ws)try{Ws([],"length")}catch{Ws=null}var ep=Ws,js=Object.defineProperty||!1;if(js)try{js({},"a",{value:1})}catch{js=!1}var H0=js,va,hc;function z0(){return hc||(hc=1,va=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,e);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),va}var xa,lc;function X0(){if(lc)return xa;lc=1;var r=typeof Symbol<"u"&&Symbol,t=z0();return xa=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},xa}var wa,uc;function rp(){return uc||(uc=1,wa=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),wa}var ba,cc;function ip(){if(cc)return ba;cc=1;var r=tp;return ba=r.getPrototypeOf||null,ba}var V0="Function.prototype.bind called on incompatible ",W0=Object.prototype.toString,j0=Math.max,Y0="[object Function]",dc=function(t,e){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var s=0;s<e.length;s+=1)i[s+t.length]=e[s];return i},q0=function(t,e){for(var i=[],n=e||0,s=0;n<t.length;n+=1,s+=1)i[s]=t[n];return i},K0=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e},Z0=function(t){var e=this;if(typeof e!="function"||W0.apply(e)!==Y0)throw new TypeError(V0+e);for(var i=q0(arguments,1),n,s=function(){if(this instanceof n){var u=e.apply(this,dc(i,arguments));return Object(u)===u?u:this}return e.apply(t,dc(i,arguments))},o=j0(0,e.length-i.length),a=[],h=0;h<o;h++)a[h]="$"+h;if(n=Function("binder","return function ("+K0(a,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var l=function(){};l.prototype=e.prototype,n.prototype=new l,l.prototype=null}return n},Q0=Z0,qo=Function.prototype.bind||Q0,Kl=Function.prototype.call,Ea,fc;function np(){return fc||(fc=1,Ea=Function.prototype.apply),Ea}var J0=typeof Reflect<"u"&&Reflect&&Reflect.apply,t_=qo,e_=np(),r_=Kl,i_=J0,n_=i_||t_.call(r_,e_),s_=qo,o_=on,a_=Kl,h_=n_,sp=function(t){if(t.length<1||typeof t[0]!="function")throw new o_("a function is required");return h_(s_,a_,t)},Aa,pc;function l_(){if(pc)return Aa;pc=1;var r=sp,t=ep,e;try{e=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var i=!!e&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return Aa=i&&typeof i.get=="function"?r([i.get]):typeof s=="function"?function(a){return s(a==null?a:n(a))}:!1,Aa}var Ta,gc;function u_(){if(gc)return Ta;gc=1;var r=rp(),t=ip(),e=l_();return Ta=r?function(n){return r(n)}:t?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return t(n)}:e?function(n){return e(n)}:null,Ta}var Sa,mc;function c_(){if(mc)return Sa;mc=1;var r=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=qo;return Sa=e.call(r,t),Sa}var _t,d_=tp,f_=S0,p_=I0,g_=C0,m_=N0,Zi=R0,Ui=on,y_=P0,__=M0,v_=D0,x_=L0,w_=B0,b_=k0,E_=F0,A_=G0,op=Function,Ia=function(r){try{return op('"use strict"; return ('+r+").constructor;")()}catch{}},Vn=ep,T_=H0,Ca=function(){throw new Ui},S_=Vn?function(){try{return arguments.callee,Ca}catch{try{return Vn(arguments,"callee").get}catch{return Ca}}}():Ca,wi=X0()(),Qt=u_(),I_=ip(),C_=rp(),ap=np(),ts=Kl,Ci={},N_=typeof Uint8Array>"u"||!Qt?_t:Qt(Uint8Array),ni={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?_t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?_t:ArrayBuffer,"%ArrayIteratorPrototype%":wi&&Qt?Qt([][Symbol.iterator]()):_t,"%AsyncFromSyncIteratorPrototype%":_t,"%AsyncFunction%":Ci,"%AsyncGenerator%":Ci,"%AsyncGeneratorFunction%":Ci,"%AsyncIteratorPrototype%":Ci,"%Atomics%":typeof Atomics>"u"?_t:Atomics,"%BigInt%":typeof BigInt>"u"?_t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?_t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?_t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?_t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":f_,"%eval%":eval,"%EvalError%":p_,"%Float16Array%":typeof Float16Array>"u"?_t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?_t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?_t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?_t:FinalizationRegistry,"%Function%":op,"%GeneratorFunction%":Ci,"%Int8Array%":typeof Int8Array>"u"?_t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?_t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?_t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":wi&&Qt?Qt(Qt([][Symbol.iterator]())):_t,"%JSON%":typeof JSON=="object"?JSON:_t,"%Map%":typeof Map>"u"?_t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!wi||!Qt?_t:Qt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":d_,"%Object.getOwnPropertyDescriptor%":Vn,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?_t:Promise,"%Proxy%":typeof Proxy>"u"?_t:Proxy,"%RangeError%":g_,"%ReferenceError%":m_,"%Reflect%":typeof Reflect>"u"?_t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?_t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!wi||!Qt?_t:Qt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?_t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":wi&&Qt?Qt(""[Symbol.iterator]()):_t,"%Symbol%":wi?Symbol:_t,"%SyntaxError%":Zi,"%ThrowTypeError%":S_,"%TypedArray%":N_,"%TypeError%":Ui,"%Uint8Array%":typeof Uint8Array>"u"?_t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?_t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?_t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?_t:Uint32Array,"%URIError%":y_,"%WeakMap%":typeof WeakMap>"u"?_t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?_t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?_t:WeakSet,"%Function.prototype.call%":ts,"%Function.prototype.apply%":ap,"%Object.defineProperty%":T_,"%Object.getPrototypeOf%":I_,"%Math.abs%":__,"%Math.floor%":v_,"%Math.max%":x_,"%Math.min%":w_,"%Math.pow%":b_,"%Math.round%":E_,"%Math.sign%":A_,"%Reflect.getPrototypeOf%":C_};if(Qt)try{null.error}catch(r){var R_=Qt(Qt(r));ni["%Error.prototype%"]=R_}var P_=function r(t){var e;if(t==="%AsyncFunction%")e=Ia("async function () {}");else if(t==="%GeneratorFunction%")e=Ia("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Ia("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&Qt&&(e=Qt(n.prototype))}return ni[t]=e,e},yc={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},es=qo,po=c_(),M_=es.call(ts,Array.prototype.concat),D_=es.call(ap,Array.prototype.splice),_c=es.call(ts,String.prototype.replace),go=es.call(ts,String.prototype.slice),L_=es.call(ts,RegExp.prototype.exec),B_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k_=/\\(\\)?/g,F_=function(t){var e=go(t,0,1),i=go(t,-1);if(e==="%"&&i!=="%")throw new Zi("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new Zi("invalid intrinsic syntax, expected opening `%`");var n=[];return _c(t,B_,function(s,o,a,h){n[n.length]=a?_c(h,k_,"$1"):o||s}),n},O_=function(t,e){var i=t,n;if(po(yc,i)&&(n=yc[i],i="%"+n[0]+"%"),po(ni,i)){var s=ni[i];if(s===Ci&&(s=P_(i)),typeof s>"u"&&!e)throw new Ui("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new Zi("intrinsic "+t+" does not exist!")},Zl=function(t,e){if(typeof t!="string"||t.length===0)throw new Ui("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Ui('"allowMissing" argument must be a boolean');if(L_(/^%?[^%]*%?$/,t)===null)throw new Zi("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=F_(t),n=i.length>0?i[0]:"",s=O_("%"+n+"%",e),o=s.name,a=s.value,h=!1,l=s.alias;l&&(n=l[0],D_(i,M_([0,1],l)));for(var u=1,c=!0;u<i.length;u+=1){var d=i[u],f=go(d,0,1),p=go(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new Zi("property names with quotes must have matching quotes");if((d==="constructor"||!c)&&(h=!0),n+="."+d,o="%"+n+"%",po(ni,o))a=ni[o];else if(a!=null){if(!(d in a)){if(!e)throw new Ui("base intrinsic for "+t+" exists, but the property is not available.");return}if(Vn&&u+1>=i.length){var g=Vn(a,d);c=!!g,c&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[d]}else c=po(a,d),a=a[d];c&&!h&&(ni[o]=a)}}return a},hp=Zl,lp=sp,U_=lp([hp("%String.prototype.indexOf%")]),up=function(t,e){var i=hp(t,!!e);return typeof i=="function"&&U_(t,".prototype.")>-1?lp([i]):i},G_=Zl,rs=up,$_=jo,H_=on,vc=G_("%Map%",!0),z_=rs("Map.prototype.get",!0),X_=rs("Map.prototype.set",!0),V_=rs("Map.prototype.has",!0),W_=rs("Map.prototype.delete",!0),j_=rs("Map.prototype.size",!0),cp=!!vc&&function(){var t,e={assert:function(i){if(!e.has(i))throw new H_("Side channel does not contain "+$_(i))},delete:function(i){if(t){var n=W_(t,i);return j_(t)===0&&(t=void 0),n}return!1},get:function(i){if(t)return z_(t,i)},has:function(i){return t?V_(t,i):!1},set:function(i,n){t||(t=new vc),X_(t,i,n)}};return e},Y_=Zl,Ko=up,q_=jo,ys=cp,K_=on,bi=Y_("%WeakMap%",!0),Z_=Ko("WeakMap.prototype.get",!0),Q_=Ko("WeakMap.prototype.set",!0),J_=Ko("WeakMap.prototype.has",!0),tv=Ko("WeakMap.prototype.delete",!0),ev=bi?function(){var t,e,i={assert:function(n){if(!i.has(n))throw new K_("Side channel does not contain "+q_(n))},delete:function(n){if(bi&&n&&(typeof n=="object"||typeof n=="function")){if(t)return tv(t,n)}else if(ys&&e)return e.delete(n);return!1},get:function(n){return bi&&n&&(typeof n=="object"||typeof n=="function")&&t?Z_(t,n):e&&e.get(n)},has:function(n){return bi&&n&&(typeof n=="object"||typeof n=="function")&&t?J_(t,n):!!e&&e.has(n)},set:function(n,s){bi&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new bi),Q_(t,n,s)):ys&&(e||(e=ys()),e.set(n,s))}};return i}:ys,rv=on,iv=jo,nv=T0,sv=cp,ov=ev,av=ov||sv||nv,hv=function(){var t,e={assert:function(i){if(!e.has(i))throw new rv("Side channel does not contain "+iv(i))},delete:function(i){return!!t&&t.delete(i)},get:function(i){return t&&t.get(i)},has:function(i){return!!t&&t.has(i)},set:function(i,n){t||(t=av()),t.set(i,n)}};return e},lv=String.prototype.replace,uv=/%20/g,Na={RFC1738:"RFC1738",RFC3986:"RFC3986"},Ql={default:Na.RFC3986,formatters:{RFC1738:function(r){return lv.call(r,uv,"+")},RFC3986:function(r){return String(r)}},RFC1738:Na.RFC1738,RFC3986:Na.RFC3986},cv=Ql,Ra=Object.prototype.hasOwnProperty,Jr=Array.isArray,Ue=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),dv=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(Jr(i)){for(var n=[],s=0;s<i.length;++s)typeof i[s]<"u"&&n.push(i[s]);e.obj[e.prop]=n}}},dp=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(i[n]=t[n]);return i},fv=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(Jr(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!Ra.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return Jr(t)&&!Jr(e)&&(n=dp(t,i)),Jr(t)&&Jr(e)?(e.forEach(function(s,o){if(Ra.call(t,o)){var a=t[o];a&&typeof a=="object"&&s&&typeof s=="object"?t[o]=r(a,s,i):t.push(s)}else t[o]=s}),t):Object.keys(e).reduce(function(s,o){var a=e[o];return Ra.call(s,o)?s[o]=r(s[o],a,i):s[o]=a,s},n)},pv=function(t,e){return Object.keys(e).reduce(function(i,n){return i[n]=e[n],i},t)},gv=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Pa=1024,mv=function(t,e,i,n,s){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;h+=Pa){for(var l=o.length>=Pa?o.slice(h,h+Pa):o,u=[],c=0;c<l.length;++c){var d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===cv.RFC1738&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=Ue[d];continue}if(d<2048){u[u.length]=Ue[192|d>>6]+Ue[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=Ue[224|d>>12]+Ue[128|d>>6&63]+Ue[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=Ue[240|d>>18]+Ue[128|d>>12&63]+Ue[128|d>>6&63]+Ue[128|d&63]}a+=u.join("")}return a},yv=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],u=o[l];typeof u=="object"&&u!==null&&i.indexOf(u)===-1&&(e.push({obj:o,prop:l}),i.push(u))}return dv(e),t},_v=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},vv=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},xv=function(t,e){return[].concat(t,e)},wv=function(t,e){if(Jr(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i}return e(t)},fp={arrayToObject:dp,assign:pv,combine:xv,compact:yv,decode:gv,encode:mv,isBuffer:vv,isRegExp:_v,maybeMap:wv,merge:fv},pp=hv,Ys=fp,Un=Ql,bv=Object.prototype.hasOwnProperty,gp={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},je=Array.isArray,Ev=Array.prototype.push,mp=function(r,t){Ev.apply(r,je(t)?t:[t])},Av=Date.prototype.toISOString,xc=Un.default,Yt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ys.encode,encodeValuesOnly:!1,format:xc,formatter:Un.formatters[xc],indices:!1,serializeDate:function(t){return Av.call(t)},skipNulls:!1,strictNullHandling:!1},Tv=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Ma={},Sv=function r(t,e,i,n,s,o,a,h,l,u,c,d,f,p,g,m,y,x){for(var v=t,_=x,E=0,N=!1;(_=_.get(Ma))!==void 0&&!N;){var S=_.get(t);if(E+=1,typeof S<"u"){if(S===E)throw new RangeError("Cyclic object value");N=!0}typeof _.get(Ma)>"u"&&(E=0)}if(typeof u=="function"?v=u(e,v):v instanceof Date?v=f(v):i==="comma"&&je(v)&&(v=Ys.maybeMap(v,function(P){return P instanceof Date?f(P):P})),v===null){if(o)return l&&!m?l(e,Yt.encoder,y,"key",p):e;v=""}if(Tv(v)||Ys.isBuffer(v)){if(l){var T=m?e:l(e,Yt.encoder,y,"key",p);return[g(T)+"="+g(l(v,Yt.encoder,y,"value",p))]}return[g(e)+"="+g(String(v))]}var D=[];if(typeof v>"u")return D;var B;if(i==="comma"&&je(v))m&&l&&(v=Ys.maybeMap(v,l)),B=[{value:v.length>0?v.join(",")||null:void 0}];else if(je(u))B=u;else{var k=Object.keys(v);B=c?k.sort(c):k}var M=h?e.replace(/\./g,"%2E"):e,A=n&&je(v)&&v.length===1?M+"[]":M;if(s&&je(v)&&v.length===0)return A+"[]";for(var w=0;w<B.length;++w){var C=B[w],I=typeof C=="object"&&typeof C.value<"u"?C.value:v[C];if(!(a&&I===null)){var R=d&&h?C.replace(/\./g,"%2E"):C,O=je(v)?typeof i=="function"?i(A,R):A:A+(d?"."+R:"["+R+"]");x.set(t,E);var z=pp();z.set(Ma,x),mp(D,r(I,O,i,n,s,o,a,h,i==="comma"&&m&&je(v)?null:l,u,c,d,f,p,g,m,y,z))}}return D},Iv=function(t){if(!t)return Yt;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Yt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Un.default;if(typeof t.format<"u"){if(!bv.call(Un.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=Un.formatters[i],s=Yt.filter;(typeof t.filter=="function"||je(t.filter))&&(s=t.filter);var o;if(t.arrayFormat in gp?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=Yt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:Yt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Yt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Yt.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Yt.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Yt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Yt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Yt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Yt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Yt.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Yt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Yt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Yt.strictNullHandling}},Cv=function(r,t){var e=r,i=Iv(t),n,s;typeof i.filter=="function"?(s=i.filter,e=s("",e)):je(i.filter)&&(s=i.filter,n=s);var o=[];if(typeof e!="object"||e===null)return"";var a=gp[i.arrayFormat],h=a==="comma"&&i.commaRoundTrip;n||(n=Object.keys(e)),i.sort&&n.sort(i.sort);for(var l=pp(),u=0;u<n.length;++u){var c=n[u];i.skipNulls&&e[c]===null||mp(o,Sv(e[c],c,a,h,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,l))}var d=o.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),d.length>0?f+d:""},Qi=fp,Rh=Object.prototype.hasOwnProperty,Nv=Array.isArray,Ut={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Qi.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},Rv=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},yp=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},Pv="utf8=%26%2310003%3B",Mv="utf8=%E2%9C%93",Dv=function(t,e){var i={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=n.split(e.delimiter,s),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===Mv?l="utf-8":o[h]===Pv&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var u=o[h],c=u.indexOf("]="),d=c===-1?u.indexOf("="):c+1,f,p;d===-1?(f=e.decoder(u,Ut.decoder,l,"key"),p=e.strictNullHandling?null:""):(f=e.decoder(u.slice(0,d),Ut.decoder,l,"key"),p=Qi.maybeMap(yp(u.slice(d+1),e),function(m){return e.decoder(m,Ut.decoder,l,"value")})),p&&e.interpretNumericEntities&&l==="iso-8859-1"&&(p=Rv(p)),u.indexOf("[]=")>-1&&(p=Nv(p)?[p]:p);var g=Rh.call(i,f);g&&e.duplicates==="combine"?i[f]=Qi.combine(i[f],p):(!g||e.duplicates==="last")&&(i[f]=p)}return i},Lv=function(r,t,e,i){for(var n=i?t:yp(t,e),s=r.length-1;s>=0;--s){var o,a=r[s];if(a==="[]"&&e.parseArrays)o=e.allowEmptyArrays&&(n===""||e.strictNullHandling&&n===null)?[]:[].concat(n);else{o=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=e.decodeDotInKeys?h.replace(/%2E/g,"."):h,u=parseInt(l,10);!e.parseArrays&&l===""?o={0:n}:!isNaN(u)&&a!==l&&String(u)===l&&u>=0&&e.parseArrays&&u<=e.arrayLimit?(o=[],o[u]=n):l!=="__proto__"&&(o[l]=n)}n=o}return n},Bv=function(t,e,i,n){if(t){var s=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=i.depth>0&&o.exec(s),l=h?s.slice(0,h.index):s,u=[];if(l){if(!i.plainObjects&&Rh.call(Object.prototype,l)&&!i.allowPrototypes)return;u.push(l)}for(var c=0;i.depth>0&&(h=a.exec(s))!==null&&c<i.depth;){if(c+=1,!i.plainObjects&&Rh.call(Object.prototype,h[1].slice(1,-1))&&!i.allowPrototypes)return;u.push(h[1])}if(h){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");u.push("["+s.slice(h.index)+"]")}return Lv(u,e,i,n)}},kv=function(t){if(!t)return Ut;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Ut.charset:t.charset,i=typeof t.duplicates>"u"?Ut.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:Ut.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Ut.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Ut.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Ut.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Ut.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Ut.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Ut.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:Ut.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:Ut.decoder,delimiter:typeof t.delimiter=="string"||Qi.isRegExp(t.delimiter)?t.delimiter:Ut.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Ut.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Ut.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Ut.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Ut.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:Ut.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Ut.strictNullHandling}},Fv=function(r,t){var e=kv(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?Dv(r,e):r,n=e.plainObjects?Object.create(null):{},s=Object.keys(i),o=0;o<s.length;++o){var a=s[o],h=Bv(a,i[a],e,typeof r=="string");n=Qi.merge(n,h,e)}return e.allowSparse===!0?n:Qi.compact(n)},Ov=Cv,Uv=Fv,Gv=Ql,$v={formats:Gv,parse:Uv,stringify:Ov},Hv=$y;function yr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var zv=/^([a-z0-9.+-]+:)/i,Xv=/:[0-9]*$/,Vv=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Wv=["<",">",'"',"`"," ","\r",`
`,"	"],jv=["{","}","|","\\","^","`"].concat(Wv),Ph=["'"].concat(jv),wc=["%","/","?",";","#"].concat(Ph),bc=["/","?","#"],Yv=255,Ec=/^[+a-z0-9A-Z_-]{0,63}$/,qv=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Kv={javascript:!0,"javascript:":!0},Mh={javascript:!0,"javascript:":!0},Gi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Dh=$v;function Zv(r,t,e){if(r&&typeof r=="object"&&r instanceof yr)return r;var i=new yr;return i.parse(r,t,e),i}yr.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),r=s.join(n);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var h=Vv.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Dh.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=zv.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&Mh[l])&&(a=a.substr(2),this.slashes=!0)}if(!Mh[l]&&(c||l&&!Gi[l])){for(var d=-1,f=0;f<bc.length;f++){var p=a.indexOf(bc[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var g,m;d===-1?m=a.lastIndexOf("@"):m=a.lastIndexOf("@",d),m!==-1&&(g=a.slice(0,m),a=a.slice(m+1),this.auth=decodeURIComponent(g)),d=-1;for(var f=0;f<wc.length;f++){var p=a.indexOf(wc[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var x=this.hostname.split(/\./),f=0,v=x.length;f<v;f++){var _=x[f];if(_&&!_.match(Ec)){for(var E="",N=0,S=_.length;N<S;N++)_.charCodeAt(N)>127?E+="x":E+=_[N];if(!E.match(Ec)){var T=x.slice(0,f),D=x.slice(f+1),B=_.match(qv);B&&(T.push(B[1]),D.unshift(B[2])),D.length&&(a="/"+D.join(".")+a),this.hostname=T.join(".");break}}}this.hostname.length>Yv?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Hv.toASCII(this.hostname));var k=this.port?":"+this.port:"",M=this.hostname||"";this.host=M+k,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!Kv[u])for(var f=0,v=Ph.length;f<v;f++){var A=Ph[f];if(a.indexOf(A)!==-1){var w=encodeURIComponent(A);w===A&&(w=escape(A)),a=a.split(A).join(w)}}var C=a.indexOf("#");C!==-1&&(this.hash=a.substr(C),a=a.slice(0,C));var I=a.indexOf("?");if(I!==-1?(this.search=a.substr(I),this.query=a.substr(I+1),t&&(this.query=Dh.parse(this.query)),a=a.slice(0,I)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Gi[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var k=this.pathname||"",R=this.search||"";this.path=k+R}return this.href=this.format(),this};yr.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Dh.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Gi[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+i};yr.prototype.resolve=function(r){return this.resolveObject(Zv(r,!1,!0)).format()};yr.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new yr;t.parse(r,!1,!0),r=t}for(var e=new yr,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];e[s]=this[s]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=r[h])}return Gi[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Gi[r.protocol]){for(var l=Object.keys(r),u=0;u<l.length;u++){var c=l[u];e[c]=r[c]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!Mh[r.protocol]){for(var v=(r.pathname||"").split("/");v.length&&!(r.host=v.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),v[0]!==""&&v.unshift(""),v.length<2&&v.unshift(""),e.pathname=v.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",g=r.host||r.pathname&&r.pathname.charAt(0)==="/",m=g||p||e.host&&r.pathname,y=m,x=e.pathname&&e.pathname.split("/")||[],v=r.pathname&&r.pathname.split("/")||[],_=e.protocol&&!Gi[e.protocol];if(_&&(e.hostname="",e.port=null,e.host&&(x[0]===""?x[0]=e.host:x.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(v[0]===""?v[0]=r.host:v.unshift(r.host)),r.host=null),m=m&&(v[0]===""||x[0]==="")),g)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,x=v;else if(v.length)x||(x=[]),x.pop(),x=x.concat(v),e.search=r.search,e.query=r.query;else if(r.search!=null){if(_){e.host=x.shift(),e.hostname=e.host;var E=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;E&&(e.auth=E.shift(),e.hostname=E.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!x.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var N=x.slice(-1)[0],S=(e.host||r.host||x.length>1)&&(N==="."||N==="..")||N==="",T=0,D=x.length;D>=0;D--)N=x[D],N==="."?x.splice(D,1):N===".."?(x.splice(D,1),T++):T&&(x.splice(D,1),T--);if(!m&&!y)for(;T--;T)x.unshift("..");m&&x[0]!==""&&(!x[0]||x[0].charAt(0)!=="/")&&x.unshift(""),S&&x.join("/").substr(-1)!=="/"&&x.push("");var B=x[0]===""||x[0]&&x[0].charAt(0)==="/";if(_){e.hostname=B?"":x.length?x.shift():"",e.host=e.hostname;var E=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;E&&(e.auth=E.shift(),e.hostname=E.shift(),e.host=e.hostname)}return m=m||e.host&&x.length,m&&!B&&x.unshift(""),x.length>0?e.pathname=x.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};yr.prototype.parseHost=function(){var r=this.host,t=Xv.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};const Ac={};function vt(r,t,e=3){if(Ac[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),Ac[t]=!0}function Te(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function gn(r){return r.split("?")[0].split("#")[0]}function Qv(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Jv(r,t,e){return r.replace(new RegExp(Qv(t),"g"),e)}function tx(r,t){let e="",i=0,n=-1,s=0,o=-1;for(let a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),n=a,s=0;continue}}else if(e.length===2||e.length===1){e="",i=0,n=a,s=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(n+1,a)}`:e=r.slice(n+1,a),i=a-n-1;n=a,s=0}else o===46&&s!==-1?++s:s=-1}return e}const te={toPosix(r){return Jv(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){Te(r),r=this.toPosix(r);const t=/^file:\/\/\//.exec(r);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(Te(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=gn(this.toPosix(t??K.ADAPTER.getBaseUrl())),n=gn(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?te.join(n,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(Te(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="";const e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));const i=r.endsWith("/");return r=tx(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return Te(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){const i=r[e];if(Te(i),i.length>0)if(t===void 0)t=i;else{const n=r[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(Te(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0);const e=t===47;let i=-1,n=!0;const s=this.getProtocol(r),o=r;r=r.slice(s.length);for(let a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!n){i=a;break}}else n=!1;return i===-1?e?"/":this.isUrl(o)?s+r:s:e&&i===1?"//":s+r.slice(0,i)},rootname(r){Te(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){const e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){Te(r),t&&Te(t),r=gn(this.toPosix(r));let e=0,i=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let o=t.length-1,a=-1;for(s=r.length-1;s>=0;--s){const h=r.charCodeAt(s);if(h===47){if(!n){e=s+1;break}}else a===-1&&(n=!1,a=s+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(i=s):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i)}for(s=r.length-1;s>=0;--s)if(r.charCodeAt(s)===47){if(!n){e=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":r.slice(e,i)},extname(r){Te(r),r=gn(this.toPosix(r));let t=-1,e=0,i=-1,n=!0,s=0;for(let o=r.length-1;o>=0;--o){const a=r.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}i===-1&&(n=!1,i=o+1),a===46?t===-1?t=o:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){Te(r);const t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=gn(this.toPosix(r));let e=r.charCodeAt(0);const i=this.isAbsolute(r);let n;t.root=this.rootname(r),i||this.hasProtocol(r)?n=1:n=0;let s=-1,o=0,a=-1,h=!0,l=r.length-1,u=0;for(;l>=n;--l){if(e=r.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?s===-1?s=l:u!==1&&(u=1):s!==-1&&(u=-1)}return s===-1||a===-1||u===0||u===1&&s===a-1&&s===o+1?a!==-1&&(o===0&&i?t.base=t.name=r.slice(1,a):t.base=t.name=r.slice(o,a)):(o===0&&i?(t.name=r.slice(1,s),t.base=r.slice(1,a)):(t.name=r.slice(o,s),t.base=r.slice(o,a)),t.ext=r.slice(s,a)),t.dir=this.dirname(r),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let Da;async function ex(){return Da??(Da=(async()=>{var s;const r=document.createElement("canvas").getContext("webgl");if(!r)return fe.UNPACK;const t=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return fe.UNPACK;const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);const i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,n),r.deleteFramebuffer(i),r.deleteTexture(e),(s=r.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?fe.PMA:fe.UNPACK})()),Da}let La;function rx(){return typeof La>"u"&&(La=function(){var t;const r={stencil:!0,failIfMajorPerformanceCaveat:K.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!K.ADAPTER.getWebGLRenderingContext())return!1;const e=K.ADAPTER.createCanvas();let i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);const n=!!((t=i==null?void 0:i.getContextAttributes())!=null&&t.stencil);if(i){const s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),La}var ix={grad:.9,turn:360,rad:360/(2*Math.PI)},ar=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Jt=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},be=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},_p=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},Tc=function(r){return{r:be(r.r,0,255),g:be(r.g,0,255),b:be(r.b,0,255),a:be(r.a)}},Ba=function(r){return{r:Jt(r.r),g:Jt(r.g),b:Jt(r.b),a:Jt(r.a,3)}},nx=/^#([0-9a-f]{3,8})$/i,_s=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},vp=function(r){var t=r.r,e=r.g,i=r.b,n=r.a,s=Math.max(t,e,i),o=s-Math.min(t,e,i),a=o?s===t?(e-i)/o:s===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},xp=function(r){var t=r.h,e=r.s,i=r.v,n=r.a;t=t/360*6,e/=100,i/=100;var s=Math.floor(t),o=i*(1-e),a=i*(1-(t-s)*e),h=i*(1-(1-t+s)*e),l=s%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:n}},Sc=function(r){return{h:_p(r.h),s:be(r.s,0,100),l:be(r.l,0,100),a:be(r.a)}},Ic=function(r){return{h:Jt(r.h),s:Jt(r.s),l:Jt(r.l),a:Jt(r.a,3)}},Cc=function(r){return xp((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Gn=function(r){return{h:(t=vp(r)).h,s:(n=(200-(e=t.s))*(i=t.v)/100)>0&&n<200?e*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,i,n},sx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ox=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ax=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,hx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lh={string:[[function(r){var t=nx.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Jt(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Jt(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=ax.exec(r)||hx.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:Tc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=sx.exec(r)||ox.exec(r);if(!t)return null;var e,i,n=Sc({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(ix[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Cc(n)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,n=r.a,s=n===void 0?1:n;return ar(t)&&ar(e)&&ar(i)?Tc({r:Number(t),g:Number(e),b:Number(i),a:Number(s)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,n=r.a,s=n===void 0?1:n;if(!ar(t)||!ar(e)||!ar(i))return null;var o=Sc({h:Number(t),s:Number(e),l:Number(i),a:Number(s)});return Cc(o)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,n=r.a,s=n===void 0?1:n;if(!ar(t)||!ar(e)||!ar(i))return null;var o=function(a){return{h:_p(a.h),s:be(a.s,0,100),v:be(a.v,0,100),a:be(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(s)});return xp(o)},"hsv"]]},Nc=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},lx=function(r){return typeof r=="string"?Nc(r.trim(),Lh.string):typeof r=="object"&&r!==null?Nc(r,Lh.object):[null,void 0]},ka=function(r,t){var e=Gn(r);return{h:e.h,s:be(e.s+100*t,0,100),l:e.l,a:e.a}},Fa=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},Rc=function(r,t){var e=Gn(r);return{h:e.h,s:e.s,l:be(e.l+100*t,0,100),a:e.a}},Bh=function(){function r(t){this.parsed=lx(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Jt(Fa(this.rgba),2)},r.prototype.isDark=function(){return Fa(this.rgba)<.5},r.prototype.isLight=function(){return Fa(this.rgba)>=.5},r.prototype.toHex=function(){return t=Ba(this.rgba),e=t.r,i=t.g,n=t.b,o=(s=t.a)<1?_s(Jt(255*s)):"","#"+_s(e)+_s(i)+_s(n)+o;var t,e,i,n,s,o},r.prototype.toRgb=function(){return Ba(this.rgba)},r.prototype.toRgbString=function(){return t=Ba(this.rgba),e=t.r,i=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+i+", "+n+", "+s+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,s},r.prototype.toHsl=function(){return Ic(Gn(this.rgba))},r.prototype.toHslString=function(){return t=Ic(Gn(this.rgba)),e=t.h,i=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+s+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,s},r.prototype.toHsv=function(){return t=vp(this.rgba),{h:Jt(t.h),s:Jt(t.s),v:Jt(t.v),a:Jt(t.a,3)};var t},r.prototype.invert=function(){return $e({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),$e(ka(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),$e(ka(this.rgba,-t))},r.prototype.grayscale=function(){return $e(ka(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),$e(Rc(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),$e(Rc(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?$e({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Jt(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=Gn(this.rgba);return typeof t=="number"?$e({h:t,s:e.s,l:e.l,a:e.a}):Jt(e.h)},r.prototype.isEqual=function(t){return this.toHex()===$e(t).toHex()},r}(),$e=function(r){return r instanceof Bh?r:new Bh(r)},Pc=[],ux=function(r){r.forEach(function(t){Pc.indexOf(t)<0&&(t(Bh,Lh),Pc.push(t))})};function cx(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in e)i[e[n]]=n;var s={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(o!=null&&o.closest){var u=this.toRgb(),c=1/0,d="black";if(!s.length)for(var f in e)s[f]=new r(e[f]).toRgb();for(var p in e){var g=(a=u,h=s[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));g<c&&(c=g,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new r(h).toRgb():null},"name"])}ux([cx]);const Ni=class qs{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof qs)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,s)=>n===e[s]);if(t!==null&&e!==null){const n=Object.keys(t),s=Object.keys(e);return n.length!==s.length?!1:n.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(n*255),t}toRgbArray(t){t=t??[];const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,n,s]=qs.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,n,s]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t}normalize(t){let e,i,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,n=(o&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,n,s=255]=t,e/=255,i/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=qs.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=$e(t);o.isValid()&&({r:e,g:i,b:n,a:s}=o.rgba,e/=255,i/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),i)}),t)}};Ni.shared=new Ni,Ni.temp=new Ni,Ni.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Pt=Ni;function dx(r){return vt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Pt.shared.setValue(r).toHex()}function fx(r){return vt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Pt.shared.setValue(r).toNumber()}function px(){const r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[at.NORMAL_NPM]=at.NORMAL,r[at.ADD_NPM]=at.ADD,r[at.SCREEN_NPM]=at.SCREEN,t[at.NORMAL]=at.NORMAL_NPM,t[at.ADD]=at.ADD_NPM,t[at.SCREEN]=at.SCREEN_NPM;const e=[];return e.push(t),e.push(r),e}const wp=px();function bp(r,t){return wp[t?1:0][r]}function gx(r,t=null){const e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,n=0;i<e;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function Ep(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function mo(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Mc(r){return!(r&r-1)&&!!r}function Dc(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function $i(r,t,e){const i=r.length;let n;if(t>=i||e===0)return;e=t+e>i?i-t:e;const s=i-e;for(n=t;n<s;++n)r[n]=r[n+e];r.length=s}function Dr(r){return r===0?0:r<0?-1:1}let mx=0;function li(){return++mx}const kh=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};kh.EMPTY=new kh(0,0,0,0);let Lc=kh;const Bc={},He=Object.create(null),Tr=Object.create(null);class yx{constructor(t,e,i){this._canvas=K.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||K.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function kc(r,t,e){for(let i=0,n=4*e*t;i<t;++i,n+=4)if(r[n+3]!==0)return!1;return!0}function Fc(r,t,e,i,n){const s=4*t;for(let o=i,a=i*s+4*e;o<=n;++o,a+=s)if(r[a+3]!==0)return!1;return!0}function _x(r){const{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,t,e).data;let s=0,o=0,a=t-1,h=e-1;for(;o<e&&kc(n,t,o);)++o;if(o===e)return Lc.EMPTY;for(;kc(n,t,h);)--h;for(;Fc(n,t,s,o,h);)++s;for(;Fc(n,t,a,o,h);)--a;return++a,++h,new Lc(s,o,a,h)}function vx(r){const t=_x(r),{width:e,height:i}=t;let n=null;if(!t.isEmpty()){const s=r.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:n}}function xx(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function xr(r,t=1){var i;const e=(i=K.RETINA_PREFIX)==null?void 0:i.exec(r);return e?parseFloat(e[1]):t}var W=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(W||{});const Fh=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},Oc=(r,t)=>Fh(r).priority??t,et={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(Fh).forEach(t=>{t.type.forEach(e=>{var i,n;return(n=(i=this._removeHandlers)[e])==null?void 0:n.call(i,t)})}),this},add(...r){return r.map(Fh).forEach(t=>{t.type.forEach(e=>{var s,o;const i=this._addHandlers,n=this._queue;i[e]?(s=i[e])==null||s.call(i,t):(n[e]=n[e]||[],(o=n[e])==null||o.push(t))})}),this},handle(r,t,e){var o;const i=this._addHandlers,n=this._removeHandlers;if(i[r]||n[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,n[r]=e;const s=this._queue;return s[r]&&((o=s[r])==null||o.forEach(a=>t(a)),delete s[r]),this},handleByMap(r,t){return this.handle(r,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,s)=>Oc(s,e)-Oc(n,e)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})}};class Oh{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const wx=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function bx(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Ex(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=wx.replace(/%forloop%/gi,bx(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}const Oa=0,Ua=1,Ga=2,$a=3,Ha=4,za=5;class nr{constructor(){this.data=0,this.blendMode=at.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Oa)}set blend(t){!!(this.data&1<<Oa)!==t&&(this.data^=1<<Oa)}get offsets(){return!!(this.data&1<<Ua)}set offsets(t){!!(this.data&1<<Ua)!==t&&(this.data^=1<<Ua)}get culling(){return!!(this.data&1<<Ga)}set culling(t){!!(this.data&1<<Ga)!==t&&(this.data^=1<<Ga)}get depthTest(){return!!(this.data&1<<$a)}set depthTest(t){!!(this.data&1<<$a)!==t&&(this.data^=1<<$a)}get depthMask(){return!!(this.data&1<<za)}set depthMask(t){!!(this.data&1<<za)!==t&&(this.data^=1<<za)}get clockwiseFrontFace(){return!!(this.data&1<<Ha)}set clockwiseFrontFace(t){!!(this.data&1<<Ha)!==t&&(this.data^=1<<Ha)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==at.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new nr;return t.depthTest=!1,t.blend=!0,t}}nr.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Uh=[];function Ap(r,t){if(!r)return null;let e="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=Uh.length-1;i>=0;--i){const n=Uh[i];if(n.test&&n.test(r,e))return new n(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Le{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,n,s,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,i,n,s,o,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Le.prototype,{dispatch:{value:Le.prototype.emit},run:{value:Le.prototype.emit}});class Wn{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Le("setRealSize"),this.onUpdate=new Le("update"),this.onError=new Le("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Zo extends Wn{constructor(t,e){const{width:i,height:n}=e||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fe.UNPACK);const s=e.realWidth,o=e.realHeight;return i.width===s&&i.height===o?n.texSubImage2D(e.target,0,0,0,s,o,e.format,i.type,this.data):(i.width=s,i.height=o,n.texImage2D(e.target,0,i.internalFormat,s,o,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const Ax={scaleMode:dr.NEAREST,alphaMode:fe.NPM},Gh=class Ri extends Jn{constructor(t=null,e=null){super(),e=Object.assign({},Ri.defaultOptions,e);const{alphaMode:i,mipmap:n,anisotropicLevel:s,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Wn)&&(t=Ap(t,p),t.internal=!0),this.resolution=f||K.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=li(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Mc(this.realWidth)&&Mc(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Tr[this.cacheId],delete He[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ri.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=K.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${li()}`}s=t._pixiId}let o=Tr[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new Ri(t,e),o.cacheId=s,Ri.addToCache(o,s)),o}static fromBuffer(t,e,i,n){t=t||new Float32Array(e*i*4);const s=new Zo(t,{width:e,height:i,...n==null?void 0:n.resourceOptions});let o,a;return t instanceof Float32Array?(o=U.RGBA,a=nt.FLOAT):t instanceof Int32Array?(o=U.RGBA_INTEGER,a=nt.INT):t instanceof Uint32Array?(o=U.RGBA_INTEGER,a=nt.UNSIGNED_INT):t instanceof Int16Array?(o=U.RGBA_INTEGER,a=nt.SHORT):t instanceof Uint16Array?(o=U.RGBA_INTEGER,a=nt.UNSIGNED_SHORT):t instanceof Int8Array?(o=U.RGBA,a=nt.BYTE):(o=U.RGBA,a=nt.UNSIGNED_BYTE),s.internal=!0,new Ri(s,Object.assign({},Ax,{type:a,format:o},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Tr[e]&&Tr[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Tr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Tr[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Tr[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Tr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Gh.defaultOptions={mipmap:rr.POW2,anisotropicLevel:0,scaleMode:dr.LINEAR,wrapMode:Or.CLAMP,alphaMode:fe.UNPACK,target:Oi.TEXTURE_2D,format:U.RGBA,type:nt.UNSIGNED_BYTE},Gh._globalBatch=0;let dt=Gh;class $h{constructor(){this.texArray=null,this.blend=0,this.type=Ke.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Tx=0;class zt{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Tx++,this.disposeRunner=new Le("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Qe.ELEMENT_ARRAY_BUFFER:Qe.ARRAY_BUFFER}get index(){return this.type===Qe.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new zt(t)}}class yo{constructor(t,e=0,i=!1,n=nt.FLOAT,s,o,a,h=1){this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,i,n,s){return new yo(t,e,i,n,s)}}const Sx={Float32Array,Uint32Array,Int32Array,Uint8Array};function Ix(r,t){let e=0,i=0;const n={};for(let h=0;h<r.length;h++)i+=t[h],e+=r[h].length;const s=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<r.length;h++){const l=t[h],u=r[h],c=Ep(u);n[c]||(n[c]=new Sx[c](s)),o=n[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*i+a,p=d%l;o[f+p]=u[d]}a+=l}return new Float32Array(s)}const Uc={5126:4,5123:2,5121:1};let Cx=0;const Nx={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ur{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Cx++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Le("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,n=!1,s,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof zt||(e instanceof Array&&(e=new Float32Array(e)),e=new zt(e));const l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,i,n,s);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new yo(u,i,n,s,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof zt||(t instanceof Array&&(t=new Uint16Array(t)),t=new zt(t)),t.type=Qe.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new zt;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*Uc[s.type]/4),s.buffer=0}for(i.data=Ix(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ur;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new zt(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new yo(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Qe.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ur,i=[],n=[],s=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)n[h]=n[h]||0,n[h]+=o.buffers[h].data.length,s[h]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new Nx[Ep(o.buffers[a].data)](n[a]),e.buffers[a]=new zt(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)i[h].set(o.buffers[h].data,s[h]),s[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=Qe.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<o.buffers.length;c++)if(o.buffers[c]!==o.indexBuffer){u=c;break}for(const c in o.attributes){const d=o.attributes[c];(d.buffer|0)===u&&(h+=d.size*Uc[d.type]/4)}for(let c=0;c<t.length;c++){const d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}}class Tp extends Ur{constructor(t=!1){super(),this._buffer=new zt(null,t,!1),this._indexBuffer=new zt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,nt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,nt.FLOAT).addAttribute("aColor",this._buffer,4,!0,nt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,nt.FLOAT).addIndex(this._indexBuffer)}}const _o=Math.PI*2,Rx=180/Math.PI,Px=Math.PI/180;var ie=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(ie||{});class bt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new bt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}bt.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const vs=[new bt,new bt,new bt,new bt];class gt{constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=ie.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new gt(0,0,0,0)}clone(){return new gt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const T=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=T)return!1;const D=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>D}const i=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=i||o<=s)return!1;const a=vs[0].set(t.left,t.top),h=vs[1].set(t.left,t.bottom),l=vs[2].set(t.right,t.top),u=vs[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=i||Math.min(a.x,h.x,l.x,u.x)>=n||Math.max(a.y,h.y,l.y,u.y)<=s||Math.min(a.y,h.y,l.y,u.y)>=o))return!1;const d=c*(h.y-a.y),f=c*(a.x-h.x),p=d*i+f*s,g=d*n+f*s,m=d*i+f*o,y=d*n+f*o;if(Math.max(p,g,m,y)<=d*a.x+f*a.y||Math.min(p,g,m,y)>=d*u.x+f*u.y)return!1;const x=c*(a.y-l.y),v=c*(l.x-a.x),_=x*i+v*s,E=x*n+v*s,N=x*i+v*o,S=x*n+v*o;return!(Math.max(_,E,N,S)<=x*a.x+v*a.y||Math.min(_,E,N,S)>=x*u.x+v*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this}}gt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Qo{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=ie.CIRC}clone(){return new Qo(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=i}getBounds(){return new gt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Qo.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Jo{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=ie.ELIP}clone(){return new Jo(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new gt(this.x-this.width,this.y-this.height,this.width,this.height)}}Jo.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class si{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let n=0,s=e.length;n<s;n++)i.push(e[n].x,e[n].y);e=i}this.points=e,this.type=ie.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new si(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const a=this.points[s*2],h=this.points[s*2+1],l=this.points[o*2],u=this.points[o*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(i=!i)}return i}}si.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};class ta{constructor(t=0,e=0,i=0,n=0,s=20){this.x=t,this.y=e,this.width=i,this.height=n,this.radius=s,this.type=ie.RREC}clone(){return new ta(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),s=e-(this.y+i);const o=i*i;if(n*n+s*s<=o||(n=t-(this.x+this.width-i),n*n+s*s<=o)||(s=e-(this.y+this.height-i),n*n+s*s<=o)||(n=t-(this.x+i),n*n+s*s<=o))return!0}return!1}}ta.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Mt{constructor(t=1,e=0,i=0,n=1,s=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,s,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new bt;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new bt;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,e,i,n,s,o,a,h,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(_o-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*s),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Mt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Mt}static get TEMP_MATRIX(){return new Mt}}Mt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const jr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Yr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],qr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Kr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Hh=[],Sp=[],xs=Math.sign;function Mx(){for(let r=0;r<16;r++){const t=[];Hh.push(t);for(let e=0;e<16;e++){const i=xs(jr[r]*jr[e]+qr[r]*Yr[e]),n=xs(Yr[r]*jr[e]+Kr[r]*Yr[e]),s=xs(jr[r]*qr[e]+qr[r]*Kr[e]),o=xs(Yr[r]*qr[e]+Kr[r]*Kr[e]);for(let a=0;a<16;a++)if(jr[a]===i&&Yr[a]===n&&qr[a]===s&&Kr[a]===o){t.push(a);break}}}for(let r=0;r<16;r++){const t=new Mt;t.set(jr[r],Yr[r],qr[r],Kr[r],0,0),Sp.push(t)}}Mx();const kt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>jr[r],uY:r=>Yr[r],vX:r=>qr[r],vY:r=>Kr[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>Hh[r][t],sub:(r,t)=>Hh[r][kt.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?kt.S:kt.N:Math.abs(t)*2<=Math.abs(r)?r>0?kt.E:kt.W:t>0?r>0?kt.SE:kt.SW:r>0?kt.NE:kt.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{const n=Sp[kt.inv(t)];n.tx=e,n.ty=i,r.append(n)}};class pr{constructor(t,e,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new pr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}pr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const zh=class{constructor(){this.worldTransform=new Mt,this.localTransform=new Mt,this.position=new pr(this.onChange,this,0,0),this.scale=new pr(this.onChange,this,1,1),this.pivot=new pr(this.onChange,this,0,0),this.skew=new pr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};zh.IDENTITY=new zh;let Jl=zh;Jl.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Dx=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Lx=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Gc(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function Xa(r){const t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Ip(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Xa(2*t);case"bvec3":return Xa(3*t);case"bvec4":return Xa(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Hi=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],Bx={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},kx={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Fx(r,t){var i;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in r.uniforms){const s=t[n];if(!s){((i=r.uniforms[n])==null?void 0:i.group)===!0&&(r.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=r.uniforms[n];let a=!1;for(let h=0;h<Hi.length;h++)if(Hi[h].test(s,o)){e.push(Hi[h].code(n,o)),a=!0;break}if(!a){const h=(s.size===1&&!s.isArray?Bx:kx)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const Cp={};let Ei=Cp;function Ox(){if(Ei===Cp||Ei!=null&&Ei.isContextLost()){const r=K.ADAPTER.createCanvas();let t;K.PREFER_ENV>=pi.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ei=t}return Ei}let ws;function Ux(){if(!ws){ws=we.MEDIUM;const r=Ox();if(r&&r.getShaderPrecisionFormat){const t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);t&&(ws=t.precision?we.HIGH:we.MEDIUM)}}return ws}function $c(r,t){const e=r.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),i=r.getShaderInfoLog(t),n=i.split(`
`),s={},o=n.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!s[l]?(s[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Gx(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||$c(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||$c(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}const $x={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Np(r){return $x[r]}let bs=null;const Hc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Rp(r,t){if(!bs){const e=Object.keys(Hc);bs={};for(let i=0;i<e.length;++i){const n=e[i];bs[r[n]]=Hc[n]}}return bs[t]}function zc(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===we.HIGH&&e!==we.HIGH&&(i=we.MEDIUM),`precision ${i} float;
${r}`}else if(e!==we.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let mn;function Hx(){if(typeof mn=="boolean")return mn;try{mn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{mn=!1}return mn}let zx=0;const Es={},Xh=class Pi{constructor(t,e,i="pixi-shader",n={}){this.extra={},this.id=zx++,this.vertexSrc=t||Pi.defaultVertexSrc,this.fragmentSrc=e||Pi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Es[i]?(Es[i]++,i+=`-${Es[i]}`):Es[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=zc(this.vertexSrc,Pi.defaultVertexPrecision,we.HIGH),this.fragmentSrc=zc(this.fragmentSrc,Pi.defaultFragmentPrecision,Ux())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Lx}static get defaultFragmentSrc(){return Dx}static from(t,e,i){const n=t+e;let s=Bc[n];return s||(Bc[n]=s=new Pi(t,e,i)),s}};Xh.defaultVertexPrecision=we.HIGH,Xh.defaultFragmentPrecision=fr.apple.device?we.HIGH:we.MEDIUM;let gr=Xh,Xx=0;class Be{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Xx++,this.static=!!e,this.ubo=!!i,t instanceof zt?(this.buffer=t,this.buffer.type=Qe.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new zt(new Float32Array(1)),this.buffer.type=Qe.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new Be(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new Be(t,e,i)}static uboFrom(t,e){return new Be(t,e??!0,!0)}}class Je{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Be?this.uniformGroup=e:this.uniformGroup=new Be(e):this.uniformGroup=new Be({}),this.disposeRunner=new Le("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const n=e.uniforms[i];if(n.group===!0&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const n=gr.from(t,e);return new Je(n,i)}}class Vx{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let s=0;s<t;s++)i[s]=s;this.defaultGroupCache[t]=Be.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new gr(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Mt,default:this.defaultGroupCache[t]};return new Je(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Vh{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Wx(){return!fr.apple.device}function jx(r){let t=!0;const e=K.ADAPTER.getNavigator();if(fr.tablet||fr.phone){if(fr.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(fr.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}class ea{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Yx=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,qx=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const An=class Ne extends ea{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Tp,this.vertexSize=6,this.state=nr.for2d(),this.size=Ne.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??jx(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Wx(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return vt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return qx}static get defaultFragmentTemplate(){return Yx}setShaderGenerator({vertex:t=Ne.defaultVertexSrc,fragment:e=Ne.defaultFragmentTemplate}={}){this.shaderGenerator=new Vx(t,e)}contextChange(){const t=this.renderer.gl;K.PREFER_ENV===pi.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Ne.defaultMaxTextures),this.maxTextures=Ex(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Ne,i=this.size/4,n=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new $h);for(;e.length<n;)e.push(new Vh);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=Ne._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++dt._globalBatch,h=0,l=i[0],u=0;n.copyBoundTextures(s,e);for(let c=0;c<this._bufferSize;++c){const d=t[c];t[c]=null,d._batchEnabled!==a&&(l.count>=e&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,c),u=c,l=i[++h],++a),d._batchEnabled=a,d.touched=o,l.elements[l.count++]=d)}l.count>0&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let c=0;c<s.length;c++)s[c]=null;dt._globalBatch=a}buildDrawCalls(t,e,i){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:o,vertexSize:a}=this,h=Ne._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<i;++f){const p=n[f],g=p._texture.baseTexture,m=wp[g.alphaMode?1:0][p.blendMode];n[f]=null,e<f&&d.blend!==m&&(d.size=c-d.start,e=f,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(p,s,o,u,c),u+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=m}e<i&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Ne.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,n=Ne._drawCallPool;let s=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:u,blend:c}=n[o];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ne.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=mo(Math.ceil(t/8)),i=Dc(e),n=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new Oh(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=mo(Math.ceil(t/12)),i=Dc(e),n=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,i,n,s){const{uint32View:o,float32View:a}=e,h=n/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=Pt.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let g=0;g<c.length;g+=2)a[n++]=c[g],a[n++]=c[g+1],a[n++]=l[g],a[n++]=l[g+1],o[n++]=p,a[n++]=d;for(let g=0;g<u.length;g++)i[s++]=h+u[g]}};An.defaultBatchSize=4096,An.extension={name:"batch",type:W.RendererPlugin},An._drawCallPool=[],An._textureArrayPool=[];let Zr=An;et.add(Zr);var Kx=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Zx=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Wh=class Tn extends Je{constructor(t,e,i){const n=gr.from(t||Tn.defaultVertexSrc,e||Tn.defaultFragmentSrc);super(n,i),this.padding=0,this.resolution=Tn.defaultResolution,this.multisample=Tn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new nr}apply(t,e,i,n,s){t.applyFilter(this,e,i,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Zx}static get defaultFragmentSrc(){return Kx}};Wh.defaultResolution=1,Wh.defaultMultisample=Wt.NONE;let le=Wh;class vo{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Pt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:n}=t,s=i??e;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}vo.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},vo.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"background"};et.add(vo);class Pp{constructor(t){this.renderer=t,this.emptyRenderer=new ea(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,i,n){const{elements:s,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const u=s[l],c=u._batchLocation;if(c>=0&&c<n&&e[c]===u){o[l]=c;continue}for(;h<n;){const d=e[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}o[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}Pp.extension={type:W.RendererSystem,name:"batch"};et.add(Pp);let Xc=0;class xo{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Xc++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Xc++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(K.PREFER_ENV>=pi.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}xo.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},xo.extension={type:W.RendererSystem,name:"context"};et.add(xo);class jh{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Le("disposeFramebuffer"),this.multisample=Wt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new dt(null,{scaleMode:dr.NEAREST,resolution:1,mipmap:rr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new dt(null,{scaleMode:dr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:rr.OFF,format:U.DEPTH_COMPONENT,type:nt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Mp extends dt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:i,scaleMode:n,resolution:s}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Wt.NONE),super(null,t),this.mipmap=rr.OFF,this.valid=!0,this._clear=new Pt([0,0,0,0]),this.framebuffer=new jh(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class wr extends Wn{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,n=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=xx(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,n){const s=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fe.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&i.width===o&&i.height===a?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,i.type,n):(i.width=o,i.height=a,s.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Dp extends wr{constructor(t,e){if(e=e||{},typeof t=="string"){const i=new Image;wr.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??K.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===fe.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const o in s){const a=s[o];if(a!==i&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class tu{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const n=e.width,s=e.height;if(i){const o=t.width/2/n,a=t.height/2/s,h=t.x/n+o,l=t.y/s+a;i=kt.add(i,kt.NW),this.x0=h+o*kt.uX(i),this.y0=l+a*kt.uY(i),i=kt.add(i,2),this.x1=h+o*kt.uX(i),this.y1=l+a*kt.uY(i),i=kt.add(i,2),this.x2=h+o*kt.uX(i),this.y2=l+a*kt.uY(i),i=kt.add(i,2),this.x3=h+o*kt.uX(i),this.y3=l+a*kt.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}tu.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Vc=new tu;function As(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class tt extends Jn{constructor(t,e,i,n,s,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new gt(0,0,1,1)),t instanceof tt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=Vc,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new bt(o.x,o.y):new bt(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&He[e.url]&&tt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,tt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new tt(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Vc&&(this._uvs=new tu),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=K.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof dt){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${li()}`,dt.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${li()}`}s=t._pixiId}let o=He[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(t instanceof dt)?(e.resolution||(e.resolution=xr(t)),o=new tt(new dt(t,e)),o.baseTexture.cacheId=s,dt.addToCache(o.baseTexture,s),tt.addToCache(o,s)):!o&&t instanceof dt&&(o=new tt(t),tt.addToCache(o,s)),o}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=tt.from(t,Object.assign({resourceOptions:i},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,i,n){return new tt(dt.fromBuffer(t,e,i,n))}static fromLoader(t,e,i,n){const s=new dt(t,Object.assign({scaleMode:dt.defaultOptions.scaleMode,resolution:xr(e)},n)),{resource:o}=s;o instanceof Dp&&(o.url=e);const a=new tt(s);return i||(i=e),dt.addToCache(a.baseTexture,i),tt.addToCache(a,i),i!==e&&(dt.addToCache(a.baseTexture,e),tt.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),He[e]&&He[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),He[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=He[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete He[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)He[t.textureCacheIds[e]]===t&&delete He[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:n,height:s}=t,o=e+n>this.baseTexture.width,a=i+s>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,u=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return tt._EMPTY||(tt._EMPTY=new tt(new dt),As(tt._EMPTY),As(tt._EMPTY.baseTexture)),tt._EMPTY}static get WHITE(){if(!tt._WHITE){const t=K.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),tt._WHITE=new tt(dt.from(t)),As(tt._WHITE),As(tt._WHITE.baseTexture)}return tt._WHITE}}class mi extends tt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new mi(new Mp(t))}}class Lp{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=Wt.NONE){const n=new Mp(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new mi(n)}getOptimalTexture(t,e,i=1,n=Wt.NONE){let s;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=mo(t),e=mo(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(i),o}getFilterTexture(t,e,i){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||Wt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Lp.SCREEN_KEY=-1;let Qx=class extends Ur{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};class Bp extends Ur{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new zt(this.vertices),this.uvBuffer=new zt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Jx{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Wt.NONE,this.sourceFrame=new gt,this.destinationFrame=new gt,this.bindingSourceFrame=new gt,this.bindingDestinationFrame=new gt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ts=[new bt,new bt,new bt,new bt],Va=new Mt;class kp{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Lp,this.statePool=[],this.quad=new Qx,this.quadUv=new Bp,this.tempRect=new gt,this.activeState={},this.globalUniforms=new Be({outputFrame:new gt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new Jx,o=i.renderTexture;let a,h;if(o.current){const m=o.current;a=m.resolution,h=m.multisample}else a=i.resolution,h=i.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let m=1;m<e.length;m++){const y=e[m];l=Math.min(l,y.resolution||a),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,d=d&&y.autoFit,f=f||(y.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=l,s.multisample=u,s.legacy=f,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(c);const p=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(Va.copyFrom(i.projection.transform).invert(),p),d?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,u),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=s.sourceFrame.width,g.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,g),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){const l=n.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,Ye.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<i.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),i[c].apply(this,l,u,Ye.CLEAR,e);const d=l;l=u,u=d}i[c].apply(this,l,h.renderTexture,Ye.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Ye.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===Ye.CLEAR||e===Ye.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Ke.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Ke.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=e._texture,o=t.set(n.width,0,0,n.height,i.x,i.y),a=e.worldTransform.copyTo(Mt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,n=Wt.NONE){return this.texturePool.getOptimalTexture(t,e,i,n)}getFilterTexture(t,e,i){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||Wt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Ts[0],n=Ts[1],s=Ts[2],o=Ts[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(o,o);const a=Math.min(i.x,n.x,s.x,o.x),h=Math.min(i.y,n.y,s.y,o.y),l=Math.max(i.x,n.x,s.x,o.x),u=Math.max(i.y,n.y,s.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a:o,b:a,c:h,d:l}=s;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?Va.copyFrom(s):Va.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}kp.extension={type:W.RendererSystem,name:"filter"};et.add(kp);class t1{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Wt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const e1=new gt;class Fp{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new jh(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new gt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;K.PREFER_ENV===pi.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>i,a=e.height>>i,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>i,a=t.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,n,s=wh.COLOR|wh.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,n),o.clear(s)}initFramebuffer(t){const{gl:e}=this,i=new t1(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=n[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=s[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+h))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):t.depth&&t.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):t.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,l,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,l,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,n.stencil)}else n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=Wt.NONE;if(t<=1||e===null)return i;for(let n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return i===1&&(i=Wt.NONE),i}blit(t,e,i){const{current:n,renderer:s,gl:o,CONTEXT_UID:a}=this;if(s.context.webGLVersion!==2||!n)return;const h=n.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=n.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new jh(n.width,n.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=e1,e.width=n.width,e.height=n.height),i||(i=e);const l=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,n=t.height,s=this.gl,o=e.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH_STENCIL):t.depth?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH24_STENCIL8):(a=s.STENCIL_ATTACHMENT,h=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,h,i,n):s.renderbufferStorage(s.RENDERBUFFER,h,i,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,a,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new gt}destroy(){this.renderer=null}}Fp.extension={type:W.RendererSystem,name:"framebuffer"};et.add(Fp);const Wa={5126:4,5123:2,5121:1};class Op{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;K.PREFER_ENV===pi.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,o,a,h)=>i.drawElementsInstancedANGLE(n,s,o,a,h),t.drawArraysInstanced=(n,s,o,a)=>i.drawArraysInstancedANGLE(n,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];e.update(n)}}checkCompatibility(t,e){const i=t.attributes,n=e.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const i=t.attributes,n=e.attributeData,s=["g",t.id];for(const o in i)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(t,e,i=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[a.id]=u,u;const c=t.buffers,d=t.attributes,f={},p={};for(const g in c)f[g]=0,p[g]=0;for(const g in d)!d[g].size&&a.attributeData[g]?d[g].size=a.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[g].buffer]+=d[g].size*Wa[d[g].type];for(const g in d){const m=d[g],y=m.size;m.stride===void 0&&(f[m.buffer]===y*Wa[m.type]?m.stride=0:m.stride=f[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=y*Wa[m.type])}u=n.createVertexArray(),n.bindVertexArray(u);for(let g=0;g<c.length;g++){const m=c[g];o.bind(m),i&&m._glBuffers[s].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,n.bindVertexArray(null),o.unbind(Qe.ARRAY_BUFFER),u}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let h=0;h<s.length;h++){const l=s[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(s[h],e))}if(!e){for(const h in i)if(h[0]==="g"){const l=i[h];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let h=null;for(const l in a){const u=a[l],c=o[u.buffer],d=c._glBuffers[n];if(e.attributeData[l]){h!==d&&(s.bind(c),h=d);const f=e.attributeData[l].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(i||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,h,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,i,e||o.getSize(),n||1):s.drawArrays(t,i,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Op.extension={type:W.RendererSystem,name:"geometry"};et.add(Op);const Wc=new Mt;class Up{constructor(t,e){this._texture=t,this.mapCoord=new Mt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],o=t[n+1];e[n]=s*i.a+o*i.c+i.tx,e[n+1]=s*i.b+o*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=e.orig,s=e.trim;s&&(Wc.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Wc));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var r1=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,i1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class n1 extends le{constructor(t,e,i){let n=null;typeof t!="string"&&e===void 0&&i===void 0&&(n=t,t=void 0,e=void 0,i=void 0),super(t||i1,e||r1,i),this.maskSprite=n,this.maskMatrix=new Mt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Up(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}class s1{constructor(t=null){this.type=qt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=le.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=qt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Gp{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const s=this.maskDataPool.pop()||new s1;s.pooled=!0,s.maskObject=e,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==qt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case qt.SCISSOR:this.renderer.scissor.push(i);break;case qt.STENCIL:this.renderer.stencil.push(i);break;case qt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case qt.COLOR:this.pushColorMask(i);break}i.type===qt.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case qt.SCISSOR:this.renderer.scissor.pop(e);break;case qt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case qt.SPRITE:this.popSpriteMask(e);break;case qt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===qt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=qt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=qt.SCISSOR:t.type=qt.STENCIL:t.type=qt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new n1])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,n),i.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Gp.extension={type:W.RendererSystem,name:"mask"};et.add(Gp);class $p{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const jc=new Mt,Yc=[],Hp=class Ks extends $p{constructor(t){super(t),this.glConst=K.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:n}=this,s=n.renderTexture,o=i.getBounds(!0,Yc.pop()??new gt);this.roundFrameToPixels(o,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:n,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Ks.isMatrixRotated(e.worldTransform)||Ks.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,n,s){Ks.isMatrixRotated(s)||(s=s?jc.copyFrom(s):jc.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Yc.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Hp.extension={type:W.RendererSystem,name:"scissor"};let o1=Hp;et.add(o1);class zp extends $p{constructor(t){super(t),this.glConst=K.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}zp.extension={type:W.RendererSystem,name:"stencil"};et.add(zp);class Xp{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return vt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return vt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return vt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Xp.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_plugin"};et.add(Xp);class Vp{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Mt,this.transform=null}update(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,i,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}Vp.extension={type:W.RendererSystem,name:"projection"};et.add(Vp);const a1=new Jl,qc=new gt;class Wp{constructor(t){this.renderer=t,this._tempMatrix=new Mt}generateTexture(t,e){const{region:i,...n}=e||{},s=(i==null?void 0:i.copyTo(qc))||t.getLocalBounds(qc,!0),o=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/o),s.height=Math.max(s.height,1/o),n.width=s.width,n.height=s.height,n.resolution=o,n.multisample??(n.multisample=this.renderer.multisample);const a=mi.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const h=t.transform;return t.transform=a1,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}Wp.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"textureGenerator"};et.add(Wp);const Vr=new gt,yn=new gt;class jp{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new gt,this.destinationFrame=new gt,this.viewportFrame=new gt}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const n=this.renderer;this.current=t;let s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(Vr.width=t.frame.width,Vr.height=t.frame.height,e=Vr),i||(yn.x=t.frame.x,yn.y=t.frame.y,yn.width=e.width,yn.height=e.height,i=yn),o=s.framebuffer):(a=n.resolution,e||(Vr.width=n._view.screen.width,Vr.height=n._view.screen.height,e=Vr),i||(i=Vr,i.width=e.width,i.height=e.height));const h=this.viewportFrame;h.x=i.x*a,h.y=i.y*a,h.width=i.width*a,h.height=i.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=Pt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}jp.extension={type:W.RendererSystem,name:"renderTexture"};et.add(jp);class h1{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function l1(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=t.getActiveAttrib(r,n);if(s.name.startsWith("gl_"))continue;const o=Rp(t,s.type),a={type:o,name:s.name,size:Np(o),location:t.getAttribLocation(r,s.name)};e[s.name]=a}return e}function u1(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=t.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),h=Rp(t,s.type);e[o]={name:o,index:n,type:h,size:s.size,isArray:a,value:Ip(h,s.size)}}return e}function c1(r,t){var a;const e=Gc(r,r.VERTEX_SHADER,t.vertexSrc),i=Gc(r,r.FRAGMENT_SHADER,t.fragmentSrc),n=r.createProgram();r.attachShader(n,e),r.attachShader(n,i);const s=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(s&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||Gx(r,n,e,i),t.attributeData=l1(n,r),t.uniformData=u1(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,r.bindAttribLocation(n,l,h[l]);r.linkProgram(n)}r.deleteShader(e),r.deleteShader(i);const o={};for(const h in t.uniformData){const l=t.uniformData[h];o[h]={location:r.getUniformLocation(n,h),value:Ip(l.type,l.size)}}return new h1(n,o)}function d1(r,t,e,i,n){e.buffer.update(n)}const f1={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Yp={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function p1(r){const t=r.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,i=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(e=Yp[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){const a=i%e%16;i+=a,n+=a}i+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,i=e):(o.offset=n,i+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function g1(r,t){const e=[];for(const i in r)t[i]&&e.push(t[i]);return e.sort((i,n)=>i.index-n.index),e}function m1(r,t){if(!r.autoManage)return{size:0,syncFunc:d1};const e=g1(r.uniforms,t),{uboElements:i,size:n}=p1(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const a=i[o],h=r.uniforms[a.data.name],l=a.data.name;let u=!1;for(let c=0;c<Hi.length;c++){const d=Hi[c];if(d.codeUbo&&d.test(a.data,h)){s.push(`offset = ${a.offset/4};`,Hi[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){const c=Np(a.data.type),d=Math.max(Yp[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=f1[a.data.type];s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let y1=0;const Ss={textureCount:0,uboCount:0};class qp{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=y1++}systemCheck(){if(!Hx())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(Ss.textureCount=0,Ss.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ss)),n}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Fx(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Ss,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=m1(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const n=t.uniforms,s=[`${i}-`];for(const o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,n=c1(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}qp.extension={type:W.RendererSystem,name:"shader"};et.add(qp);class wo{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.3 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}wo.defaultOptions={hello:!1},wo.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"startup"};et.add(wo);function _1(r,t=[]){return t[at.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.ADD]=[r.ONE,r.ONE],t[at.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.NONE]=[0,0],t[at.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[at.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[at.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[at.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[at.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[at.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[at.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[at.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[at.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[at.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}const v1=0,x1=1,w1=2,b1=3,E1=4,A1=5,Kp=class Yh{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=at.NONE,this._blendEq=!1,this.map=[],this.map[v1]=this.setBlend,this.map[x1]=this.setOffset,this.map[w1]=this.setCullFace,this.map[b1]=this.setDepthTest,this.map[E1]=this.setFrontFace,this.map[A1]=this.setDepthMask,this.checks=[],this.defaultState=new nr,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=_1(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Yh.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Yh.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Kp.extension={type:W.RendererSystem,name:"state"};let T1=Kp;et.add(T1);class S1 extends Jn{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),i=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Le(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=i.find(o=>this._systemsHash[o]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Sn=class Zs{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Zs.defaultMaxIdle,this.checkCountMax=Zs.defaultCheckCountMax,this.mode=Zs.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Vl.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};Sn.defaultMode=Vl.AUTO,Sn.defaultMaxIdle=60*60,Sn.defaultCheckCountMax=60*10,Sn.extension={type:W.RendererSystem,name:"textureGC"};let Qr=Sn;et.add(Qr);class ja{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=nt.UNSIGNED_BYTE,this.internalFormat=U.RGBA,this.samplerType=0}}function I1(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:q.FLOAT,[r.RGBA]:q.FLOAT,[r.ALPHA]:q.FLOAT,[r.LUMINANCE]:q.FLOAT,[r.LUMINANCE_ALPHA]:q.FLOAT,[r.R8]:q.FLOAT,[r.R8_SNORM]:q.FLOAT,[r.RG8]:q.FLOAT,[r.RG8_SNORM]:q.FLOAT,[r.RGB8]:q.FLOAT,[r.RGB8_SNORM]:q.FLOAT,[r.RGB565]:q.FLOAT,[r.RGBA4]:q.FLOAT,[r.RGB5_A1]:q.FLOAT,[r.RGBA8]:q.FLOAT,[r.RGBA8_SNORM]:q.FLOAT,[r.RGB10_A2]:q.FLOAT,[r.RGB10_A2UI]:q.FLOAT,[r.SRGB8]:q.FLOAT,[r.SRGB8_ALPHA8]:q.FLOAT,[r.R16F]:q.FLOAT,[r.RG16F]:q.FLOAT,[r.RGB16F]:q.FLOAT,[r.RGBA16F]:q.FLOAT,[r.R32F]:q.FLOAT,[r.RG32F]:q.FLOAT,[r.RGB32F]:q.FLOAT,[r.RGBA32F]:q.FLOAT,[r.R11F_G11F_B10F]:q.FLOAT,[r.RGB9_E5]:q.FLOAT,[r.R8I]:q.INT,[r.R8UI]:q.UINT,[r.R16I]:q.INT,[r.R16UI]:q.UINT,[r.R32I]:q.INT,[r.R32UI]:q.UINT,[r.RG8I]:q.INT,[r.RG8UI]:q.UINT,[r.RG16I]:q.INT,[r.RG16UI]:q.UINT,[r.RG32I]:q.INT,[r.RG32UI]:q.UINT,[r.RGB8I]:q.INT,[r.RGB8UI]:q.UINT,[r.RGB16I]:q.INT,[r.RGB16UI]:q.UINT,[r.RGB32I]:q.INT,[r.RGB32UI]:q.UINT,[r.RGBA8I]:q.INT,[r.RGBA8UI]:q.UINT,[r.RGBA16I]:q.INT,[r.RGBA16UI]:q.UINT,[r.RGBA32I]:q.INT,[r.RGBA32UI]:q.UINT,[r.DEPTH_COMPONENT16]:q.FLOAT,[r.DEPTH_COMPONENT24]:q.FLOAT,[r.DEPTH_COMPONENT32F]:q.FLOAT,[r.DEPTH_STENCIL]:q.FLOAT,[r.DEPTH24_STENCIL8]:q.FLOAT,[r.DEPTH32F_STENCIL8]:q.FLOAT}:t={[r.RGB]:q.FLOAT,[r.RGBA]:q.FLOAT,[r.ALPHA]:q.FLOAT,[r.LUMINANCE]:q.FLOAT,[r.LUMINANCE_ALPHA]:q.FLOAT,[r.DEPTH_STENCIL]:q.FLOAT},t}function C1(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[nt.UNSIGNED_BYTE]:{[U.RGBA]:r.RGBA8,[U.RGB]:r.RGB8,[U.RG]:r.RG8,[U.RED]:r.R8,[U.RGBA_INTEGER]:r.RGBA8UI,[U.RGB_INTEGER]:r.RGB8UI,[U.RG_INTEGER]:r.RG8UI,[U.RED_INTEGER]:r.R8UI,[U.ALPHA]:r.ALPHA,[U.LUMINANCE]:r.LUMINANCE,[U.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[nt.BYTE]:{[U.RGBA]:r.RGBA8_SNORM,[U.RGB]:r.RGB8_SNORM,[U.RG]:r.RG8_SNORM,[U.RED]:r.R8_SNORM,[U.RGBA_INTEGER]:r.RGBA8I,[U.RGB_INTEGER]:r.RGB8I,[U.RG_INTEGER]:r.RG8I,[U.RED_INTEGER]:r.R8I},[nt.UNSIGNED_SHORT]:{[U.RGBA_INTEGER]:r.RGBA16UI,[U.RGB_INTEGER]:r.RGB16UI,[U.RG_INTEGER]:r.RG16UI,[U.RED_INTEGER]:r.R16UI,[U.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[nt.SHORT]:{[U.RGBA_INTEGER]:r.RGBA16I,[U.RGB_INTEGER]:r.RGB16I,[U.RG_INTEGER]:r.RG16I,[U.RED_INTEGER]:r.R16I},[nt.UNSIGNED_INT]:{[U.RGBA_INTEGER]:r.RGBA32UI,[U.RGB_INTEGER]:r.RGB32UI,[U.RG_INTEGER]:r.RG32UI,[U.RED_INTEGER]:r.R32UI,[U.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[nt.INT]:{[U.RGBA_INTEGER]:r.RGBA32I,[U.RGB_INTEGER]:r.RGB32I,[U.RG_INTEGER]:r.RG32I,[U.RED_INTEGER]:r.R32I},[nt.FLOAT]:{[U.RGBA]:r.RGBA32F,[U.RGB]:r.RGB32F,[U.RG]:r.RG32F,[U.RED]:r.R32F,[U.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[nt.HALF_FLOAT]:{[U.RGBA]:r.RGBA16F,[U.RGB]:r.RGB16F,[U.RG]:r.RG16F,[U.RED]:r.R16F},[nt.UNSIGNED_SHORT_5_6_5]:{[U.RGB]:r.RGB565},[nt.UNSIGNED_SHORT_4_4_4_4]:{[U.RGBA]:r.RGBA4},[nt.UNSIGNED_SHORT_5_5_5_1]:{[U.RGBA]:r.RGB5_A1},[nt.UNSIGNED_INT_2_10_10_10_REV]:{[U.RGBA]:r.RGB10_A2,[U.RGBA_INTEGER]:r.RGB10_A2UI},[nt.UNSIGNED_INT_10F_11F_11F_REV]:{[U.RGB]:r.R11F_G11F_B10F},[nt.UNSIGNED_INT_5_9_9_9_REV]:{[U.RGB]:r.RGB9_E5},[nt.UNSIGNED_INT_24_8]:{[U.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[nt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[U.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[nt.UNSIGNED_BYTE]:{[U.RGBA]:r.RGBA,[U.RGB]:r.RGB,[U.ALPHA]:r.ALPHA,[U.LUMINANCE]:r.LUMINANCE,[U.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[nt.UNSIGNED_SHORT_5_6_5]:{[U.RGB]:r.RGB},[nt.UNSIGNED_SHORT_4_4_4_4]:{[U.RGBA]:r.RGBA},[nt.UNSIGNED_SHORT_5_5_5_1]:{[U.RGBA]:r.RGBA}},t}class Zp{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new dt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=C1(t),this.samplerTypes=I1(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new ja(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new ja(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let s=t-1;s>=0;--s){const o=e[s];o&&o._glTextures[n].samplerType!==q.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new ja(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var i;e.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??q.FLOAT,this.webGLVersion===2&&t.type===nt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),(n=t.resource)==null?void 0:n.upload(i,t,e))e.samplerType!==q.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,o=t.realHeight,a=i.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,a.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&$i(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===rr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Or.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==rr.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===dr.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===dr.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===dr.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===dr.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Zp.extension={type:W.RendererSystem,name:"texture"};et.add(Zp);class Qp{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:n}=this;e&&n.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&s.dispose(a,e))}i&&(e||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Qp.extension={type:W.RendererSystem,name:"transformFeedback"};et.add(Qp);class bo{constructor(t){this.renderer=t}init(t){this.screen=new gt(0,0,t.width,t.height),this.element=t.view||K.ADAPTER.createCanvas(),this.resolution=t.resolution||K.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}bo.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},bo.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_view"};et.add(bo);K.PREFER_ENV=pi.WEBGL2;K.STRICT_TEXTURE_CACHE=!1;K.RENDER_OPTIONS={...xo.defaultOptions,...vo.defaultOptions,...bo.defaultOptions,...wo.defaultOptions};Object.defineProperties(K,{WRAP_MODE:{get(){return dt.defaultOptions.wrapMode},set(r){vt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),dt.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return dt.defaultOptions.scaleMode},set(r){vt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),dt.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return dt.defaultOptions.mipmap},set(r){vt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),dt.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return dt.defaultOptions.anisotropicLevel},set(r){vt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),dt.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return vt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),le.defaultResolution},set(r){le.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return vt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),le.defaultMultisample},set(r){le.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return Zr.defaultMaxTextures},set(r){vt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Zr.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return Zr.defaultBatchSize},set(r){vt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Zr.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return Zr.canUploadSameBuffer},set(r){vt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Zr.canUploadSameBuffer=r}},GC_MODE:{get(){return Qr.defaultMode},set(r){vt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Qr.defaultMode=r}},GC_MAX_IDLE:{get(){return Qr.defaultMaxIdle},set(r){vt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Qr.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return Qr.defaultCheckCountMax},set(r){vt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Qr.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return gr.defaultVertexPrecision},set(r){vt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),gr.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return gr.defaultFragmentPrecision},set(r){vt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),gr.defaultFragmentPrecision=r}}});var ui=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(ui||{});let Ya=class{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}};const Jp=class me{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Ya(null,null,1/0),this.deltaMS=1/me.targetFPMS,this.elapsedMS=1/me.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=ui.NORMAL){return this._addListener(new Ya(t,e,i))}addOnce(t,e,i=ui.NORMAL){return this._addListener(new Ya(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*me.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,me.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!me._shared){const t=me._shared=new me;t.autoStart=!0,t._protected=!0}return me._shared}static get system(){if(!me._system){const t=me._system=new me;t.autoStart=!0,t._protected=!0}return me._system}};Jp.targetFPMS=.06;let _e=Jp;Object.defineProperties(K,{TARGET_FPMS:{get(){return _e.targetFPMS},set(r){vt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),_e.targetFPMS=r}}});class tg{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ui.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?_e.shared:new _e,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}tg.extension=W.Application;et.add(tg);const eg=[];et.handleByList(W.Renderer,eg);function N1(r){for(const t of eg)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var R1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,P1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const M1=R1,rg=P1;class ig{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=Wt.HIGH?this.multisample=Wt.HIGH:e>=Wt.MEDIUM?this.multisample=Wt.MEDIUM:e>=Wt.LOW?this.multisample=Wt.LOW:this.multisample=Wt.NONE}destroy(){}}ig.extension={type:W.RendererSystem,name:"_multisample"};et.add(ig);class D1{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class ng{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const o=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new D1(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}ng.extension={type:W.RendererSystem,name:"buffer"};et.add(ng);class sg{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let n,s,o,a;if(e&&(n=e.renderTexture,s=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(n||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(e.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}sg.extension={type:W.RendererSystem,name:"objectRenderer"};et.add(sg);const Qs=class qh extends S1{constructor(t){super(),this.type=Hf.WEBGL,t=Object.assign({},K.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Be({projectionMatrix:new Mt},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:qh.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(vt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=qh.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:rx()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return vt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return vt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return vt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return vt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){vt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return vt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){vt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return vt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Qs.extension={type:W.Renderer,priority:1},Qs.__plugins={},Qs.__systems={};let eu=Qs;et.handleByMap(W.RendererPlugin,eu.__plugins);et.handleByMap(W.RendererSystem,eu.__systems);et.add(eu);class og extends Wn{constructor(t,e){const{width:i,height:n}=e||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const o=new dt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Wn?this.addResourceAt(t[i],i):this.addResourceAt(Ap(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}}class L1 extends og{constructor(t,e){const{width:i,height:n}=e||{};let s,o;Array.isArray(t)?(s=t,o=t.length):o=t,super(o,{width:i,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Oi.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:n,itemDirtyIds:s,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(let h=0;h<n;h++){const l=o[h];s[h]<l.dirtyId&&(s[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0}}class B1 extends wr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const ag=class In extends og{constructor(t,e){const{width:i,height:n,autoLoad:s,linkBaseTexture:o}=e||{};if(t&&t.length!==In.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:n});for(let a=0;a<In.SIDES;a++)this.items[a].target=Oi.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=Oi.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Oi.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const n=this.itemDirtyIds;for(let s=0;s<In.SIDES;s++){const o=this.items[s];(n[s]<o.dirtyId||i.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,i),n[s]=o.dirtyId):n[s]<-1&&(t.gl.texImage2D(o.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===In.SIDES}};ag.SIDES=6;let k1=ag;class ki extends wr{constructor(t,e){e=e||{};let i,n,s;typeof t=="string"?(i=ki.EMPTY,n=t,s=!0):(i=t,n=null,s=!1),super(i),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await K.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===fe.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return ki._EMPTY=ki._EMPTY??K.ADAPTER.createCanvas(0,0),ki._EMPTY}}const Kh=class Js extends wr{constructor(t,e){e=e||{},super(K.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Js.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;wr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),n=Math.round(n),s=Math.round(s);const o=this.source;o.width=n,o.height=s,o._pixiId=`canvas_${li()}`,o.getContext("2d").drawImage(t,0,0,e,i,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(t){const e=Js.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Js.SVG_XML.test(t)}};Kh.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Kh.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Zh=Kh;class F1 extends wr{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const Qh=class Jh extends wr{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const n=t[0].src||t[0];wr.crossOrigin(i,n,e.crossorigin);for(let s=0;s<t.length;++s){const o=document.createElement("source");let{src:a,mime:h}=t[s];if(a=a||t[s],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Jh.MIME_TYPES[u]||`video/${u}`}o.src=a,h&&(o.type=h),i.appendChild(o)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=_e.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(_e.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(_e.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(_e.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Jh.TYPES.includes(e)}};Qh.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Qh.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let hg=Qh;Uh.push(ki,Dp,B1,hg,F1,Zh,Zo,k1,L1);class Eo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?gt.EMPTY:(t=t||new gt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:n,c:s,d:o,tx:a,ty:h}=t,l=i*e.x+s*e.y+a,u=n*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s}addFrame(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)}addFrameMatrix(t,e,i,n,s){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,g=this.maxY,m=o*e+h*i+u,y=a*e+l*i+c;d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*n+h*i+u,y=a*n+l*i+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*e+h*s+u,y=a*e+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*n+h*s+u,y=a*n+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,this.minX=d,this.minY=f,this.maxX=p,this.maxY=g}addVertexData(t,e,i){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<i;h+=2){const l=t[h],u=t[h+1];n=l<n?l:n,s=u<s?u:s,o=l>o?l:o,a=u>a?u:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}addVertices(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)}addVerticesMatrix(t,e,i,n,s=0,o=s){const a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty;let f=this.minX,p=this.minY,g=this.maxX,m=this.maxY;for(let y=i;y<n;y+=2){const x=e[y],v=e[y+1],_=a*x+l*v+c,E=u*v+h*x+d;f=Math.min(f,_-s),g=Math.max(g,_+s),p=Math.min(p,E-o),m=Math.max(m,E+o)}this.minX=f,this.minY=p,this.maxX=g,this.maxY=m}addBounds(t){const e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,n,s,o){t-=s,e-=o,i+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Ot extends Jn{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Jl,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Eo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(Ot.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new gt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new gt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Eo);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(i==null?void 0:i.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,i=1,n=1,s=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new O1),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Rx}set angle(t){this.transform.rotation=t*Px}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class O1 extends Ot{constructor(){super(...arguments),this.sortDirty=null}}Ot.prototype.displayObjectUpdateTransform=Ot.prototype.updateTransform;const U1=new Mt;function G1(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}const lg=class tl extends Ot{constructor(){super(),this.children=[],this.sortableChildren=tl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);$i(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,$i(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,$i(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,n=e,s=n-i;let o;if(s>0&&s<=n){o=this.children.splice(i,s);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(G1),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const o=this.children[n];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,n;this.cullArea?(i=this.cullArea,n=this.worldTransform):this._render!==tl.prototype._render&&(i=this.getBounds(!0));const s=t.projection.transform;if(s&&(n?(n=U1.copyFrom(n),n.prepend(s)):n=s),i&&e.intersects(i,n))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,n=this.children.length;i<n;++i)this.children[i].render(t)}}renderAdvanced(t){var s,o,a;const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==qt.NONE));if(n&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}n&&t.batch.flush(),i&&t.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<i.length;++n)i[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};lg.defaultSortableChildren=!1;let ke=lg;ke.prototype.containerUpdateTransform=ke.prototype.updateTransform;Object.defineProperties(K,{SORTABLE_CHILDREN:{get(){return ke.defaultSortableChildren},set(r){vt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ke.defaultSortableChildren=r}}});const _n=new bt,$1=new Uint16Array([0,1,2,0,2,3]);class an extends ke{constructor(t){super(),this._anchor=new pr(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Pt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=at.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||tt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=$1,this.pluginName="batch",this.isSprite=!0,this._roundPixels=K.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Dr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Dr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor;let f=0,p=0,g=0,m=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,m=u.y-d._y*c.height,g=m+u.height):(p=-d._x*c.width,f=p+c.width,m=-d._y*c.height,g=m+c.height),l[0]=i*p+s*m+a,l[1]=o*m+n*p+h,l[2]=i*f+s*m+a,l[3]=o*m+n*f+h,l[4]=i*f+s*g+a,l[5]=o*g+n*f+h,l[6]=i*p+s*g+a,l[7]=o*g+n*p+h,this._roundPixels){const y=K.RESOLUTION;for(let x=0;x<l.length;++x)l[x]=Math.round(l[x]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,u=s.tx,c=s.ty,d=-n._x*i.width,f=d+i.width,p=-n._y*i.height,g=p+i.height;if(e[0]=o*d+h*p+u,e[1]=l*p+a*d+c,e[2]=o*f+h*p+u,e[3]=l*p+a*f+c,e[4]=o*f+h*g+u,e[5]=l*g+a*f+c,e[6]=o*d+h*g+u,e[7]=l*g+a*d+c,this._roundPixels){const m=K.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*m)/m}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Eo),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new gt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,_n);const e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return _n.x>=n&&_n.x<n+e&&(s=-i*this.anchor.y,_n.y>=s&&_n.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof tt?t:tt.from(t,e);return new an(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Dr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Dr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||tt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const ug=new Mt;Ot.prototype._cacheAsBitmap=!1;Ot.prototype._cacheData=null;Ot.prototype._cacheAsBitmapResolution=null;Ot.prototype._cacheAsBitmapMultisample=null;class H1{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Ot.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new H1),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Ot.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};Ot.prototype._initCachedDisplayObject=function(r){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const t=this.alpha;this.alpha=1,r.batch.flush();const e=this.getLocalBounds(new gt,!0);if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;e.pad(p)}const i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const n=r.renderTexture.current,s=r.renderTexture.sourceFrame.clone(),o=r.renderTexture.destinationFrame.clone(),a=r.projection.transform,h=mi.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),l=`cacheAsBitmap_${li()}`;this._cacheData.textureCacheId=l,dt.addToCache(h.baseTexture,l),tt.addToCache(h,l);const u=this.transform.localTransform.copyTo(ug).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=a,r.renderTexture.bind(n,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new an(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};Ot.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};Ot.prototype._initCachedDisplayObjectCanvas=function(r){var u;if((u=this._cacheData)!=null&&u.sprite)return;const t=this.getLocalBounds(new gt,!0),e=this.alpha;this.alpha=1;const i=r.canvasContext.activeContext,n=r._projTransform,s=this.cacheAsBitmapResolution||r.resolution;t.ceil(s),t.width=Math.max(t.width,1/s),t.height=Math.max(t.height,1/s);const o=mi.create({width:t.width,height:t.height,resolution:s}),a=`cacheAsBitmap_${li()}`;this._cacheData.textureCacheId=a,dt.addToCache(o.baseTexture,a),tt.addToCache(o,a);const h=ug;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new an(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};Ot.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Ot.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Ot.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,dt.removeFromCache(this._cacheData.textureCacheId),tt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Ot.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};Ot.prototype.name=null;ke.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){const n=this.children[e];if(!n.getChildByName)continue;const s=n.getChildByName(r,!0);if(s)return s}return null};Ot.prototype.getGlobalPosition=function(r=new bt,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var z1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class X1 extends le{constructor(t=1){super(M1,z1,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const V1={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},W1=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function j1(r){const t=V1[r],e=t.length;let i=W1,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<r;a++){let h=s.replace("%index%",a.toString());o=a,a>=e&&(o=r-a-1),h=h.replace("%value%",t[o].toString()),n+=h,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}const Y1=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function q1(r,t){const e=Math.ceil(r/2);let i=Y1,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<r;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),n+=a,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}class el extends le{constructor(t,e=8,i=4,n=le.defaultResolution,s=5){const o=q1(s,t),a=j1(s);super(o,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,n);else{const s=t.getFilterTexture(),o=t.renderer;let a=e,h=s;this.state.blend=!1,t.applyFilter(this,a,h,Ye.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,Ye.BLIT),this.uniforms.uSampler=h;const u=h;h=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,i,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class K1 extends le{constructor(t=8,e=4,i=le.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new el(!0,t,e,i,n),this.blurYFilter=new el(!1,t,e,i,n),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Ye.CLEAR),this.blurYFilter.apply(t,a,i,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,i,n):this.blurXFilter.apply(t,e,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var Z1=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class rl extends le{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(rg,Z1,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,n,s]=Pt.shared.setValue(t).toArray(),o=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),s=Math.sqrt,o=1/3,a=s(o),h=i+(1-i)*o,l=o*(1-i)-a*n,u=o*(1-i)+a*n,c=o*(1-i)+a*n,d=i+o*(1-i),f=o*(1-i)-a*n,p=o*(1-i)-a*n,g=o*(1-i)+a*n,m=i+o*(1-i),y=[h,l,u,0,0,c,d,f,0,0,p,g,m,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const i=(t||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const i=t*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,n,s){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;const o=Pt.shared,[a,h,l]=o.setValue(i).toArray(),[u,c,d]=o.setValue(n).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,u,c,d,e,0,a-u,h-c,l-d,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}rl.prototype.grayscale=rl.prototype.greyscale;var Q1=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,J1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class tw extends le{constructor(t,e){const i=new Mt;t.renderable=!1,super(J1,Q1,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new bt(e,e)}apply(t,e,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),t.applyFilter(this,e,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var ew=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,rw=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class iw extends le{constructor(){super(rw,ew)}}var nw=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class sw extends le{constructor(t=.5,e=Math.random()){super(rg,nw,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Kc={AlphaFilter:X1,BlurFilter:K1,BlurFilterPass:el,ColorMatrixFilter:rl,DisplacementFilter:tw,FXAAFilter:iw,NoiseFilter:sw};Object.entries(Kc).forEach(([r,t])=>{Object.defineProperty(Kc,r,{get(){return vt("7.1.0",`filters.${r} has moved to ${r}`),t}})});class ow{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(_e.system.add(this.tickerUpdate,this,ui.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(_e.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Pr=new ow;class is{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=is.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new bt,this.page=new bt,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Ao extends is{constructor(){super(...arguments),this.client=new bt,this.movement=new bt,this.offset=new bt,this.global=new bt,this.screen=new bt}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,o,a,h,l,u,c,d,f,p,g){throw new Error("Method not implemented.")}}class Re extends Ao{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class zi extends Ao{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}zi.DOM_DELTA_PIXEL=0,zi.DOM_DELTA_LINE=1,zi.DOM_DELTA_PAGE=2;const aw=2048,hw=new bt,qa=new bt;class lw{constructor(t){this.dispatch=new Jn,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Pr.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[i](this.rootTarget,this.rootTarget.eventMode,hw.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let s=i.length-1;s>=0;s--)n.forEach(o=>{t.currentTarget=i[s],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let i=0;i<aw&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,n,s,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Pr.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,n,s,o||s(t,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!s(t,i)&&n(t,i)?l?[t]:[]:null}hitTestRecursive(t,e,i,n,s){if(this._interactivePrune(t)||s(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Pr.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,i,n,s);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&n(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var i;if(t.hitArea&&(t.worldTransform.applyInverse(e,qa),!t.hitArea.contains(qa.x,qa.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var s,o;e=e??t.type;const i=`on${e}`;(o=(s=t.currentTarget)[i])==null||o.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Re)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var h,l;if(!(t instanceof Re)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((h=n.overTargets)==null?void 0:h.length)>0&&s!==e.target){const u=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,u,s);if(this.dispatchEvent(c,"pointerout"),i&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}if(s!==e.target){const u=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(e,u);this.dispatchEvent(c,"pointerover"),i&&this.dispatchEvent(c,"mouseover");let d=s==null?void 0:s.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(e,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==s&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),i&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Re)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Re)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Re)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=s;if(s&&!i.composedPath().includes(s)){let a=s;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=n.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Re)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof zi)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(Re);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(zi);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Re);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Re&&e instanceof Re&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Ao&&e instanceof Ao&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,s=i.length;n<s&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(e,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const uw=1,cw={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},il=class nl{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new lw(null),Pr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Re(null),this.rootWheelEvent=new zi(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...nl.defaultEventFeatures},{set:(e,i,n)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[i]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,nl._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,n=e.length;i<n;i++){const s=e[i],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Pr.pointerMoved();const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,o=n.length;s<o;s++){const a=this.bootstrapEvent(this.rootPointerEvent,n[s]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Pr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Pr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Pr.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(i-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const s=t.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=uw),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=cw[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};il.extension={name:"events",type:[W.RendererSystem,W.CanvasRendererSystem]},il.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let sl=il;et.add(sl);function Zc(r){return r==="dynamic"||r==="static"}const dw={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Zc(sl.defaultEventMode)},set interactive(r){vt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??sl.defaultEventMode},set eventMode(r){this._internalInteractive=Zc(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof e=="object"?e.signal:void 0,s=typeof e=="object"?e.once===!0:!1,o=typeof t=="function"?void 0:t;r=i?`${r}capture`:r;const a=typeof t=="function"?t:t.handleEvent,h=this;n&&n.addEventListener("abort",()=>{h.off(r,a,o)}),s?h.once(r,a,o):h.on(r,a,o)},removeEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,n)},dispatchEvent(r){if(!(r instanceof is))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};Ot.mixin(dw);const fw={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ot.mixin(fw);const pw=9,Is=100,gw=0,mw=0,Qc=2,Jc=1,yw=-1e3,_w=-1e3,vw=2;class cg{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(fr.tablet||fr.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Is}px`,e.style.height=`${Is}px`,e.style.position="absolute",e.style.top=`${gw}px`,e.style.left=`${mw}px`,e.style.zIndex=Qc.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Jc}px`,t.style.height=`${Jc}px`,t.style.position="absolute",t.style.top=`${yw}px`,t.style.left=`${_w}px`,t.style.zIndex=vw.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(fr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=n/o*h,u=s/a*h;let c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${o}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,$i(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const g=f.worldTransform;f.hitArea?(c.style.left=`${(g.tx+p.x*g.a)*l}px`,c.style.top=`${(g.ty+p.y*g.d)*u}px`,c.style.width=`${p.width*g.a*l}px`,c.style.height=`${p.height*g.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*l}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*l}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Is}px`,e.style.height=`${Is}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Qc.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new is(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(s,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===pw&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}cg.extension={name:"accessibility",type:[W.RendererPlugin,W.CanvasRendererPlugin]};et.add(cg);const dg=class ol{constructor(t){this.stage=new ke,t=Object.assign({forceCanvas:!1},t),this.renderer=N1(t),ol._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const i=ol._plugins.slice(0);i.reverse(),i.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};dg._plugins=[];let xw=dg;et.handleByList(W.Application,xw._plugins);class fg{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,i=s}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}fg.extension=W.Application;et.add(fg);const td={loader:W.LoadParser,resolver:W.ResolveParser,cache:W.CacheParser,detection:W.DetectionParser};et.handle(W.Asset,r=>{const t=r.ref;Object.entries(td).filter(([e])=>!!t[e]).forEach(([e,i])=>et.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{const t=r.ref;Object.keys(td).filter(e=>!!t[e]).forEach(e=>et.remove(t[e]))});class ww{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function hn(r,t){if(Array.isArray(t)){for(const e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function Hr(r,t){const e=r.split("?")[0],i=te.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Me=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r),al=(r,t)=>{const e=t.split("?")[1];return e&&(r+=`?${e}`),r};function pg(r,t,e,i,n){const s=t[e];for(let o=0;o<s.length;o++){const a=s[o];e<t.length-1?pg(r.replace(i[e],a),t,e+1,i,n):n.push(r.replace(i[e],a))}}function bw(r){const t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){const n=[];e.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),pg(r,n,0,e,i)}else i.push(r);return i}const To=r=>!Array.isArray(r);class Ew{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Me(t);let n;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){n=h.getCacheableAssets(i,e);break}}n||(n={},i.forEach(a=>{n[a]=e}));const s=Object.keys(n),o={cacheKeys:s,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{const h=n?n[a]:e;this._cache.has(a)&&this._cache.get(a)!==h&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof tt){const a=e;i.forEach(h=>{a.baseTexture!==tt.EMPTY.baseTexture&&dt.addToCache(a.baseTexture,h),tt.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const ti=new Ew;class Aw{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((o=l.test)!=null&&o.call(l,t,e,this))){s=l;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),i.parser=s;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,n,e,this))&&(n=await l.parse(n,e,this)||n,i.parser=l)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},s=To(t),o=Me(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{const u=te.toAbsolute(l.src);if(!n[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),n[l.src]=await this.promiseCache[u].promise,e&&e(++i/a)}catch(c){throw delete this.promiseCache[u],delete n[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),s?n[o[0].src]:n}async unload(t){const e=Me(t,i=>({alias:[i],src:i})).map(async i=>{var o,a;const n=te.toAbsolute(i.src),s=this.promiseCache[n];if(s){const h=await s.promise;delete this.promiseCache[n],(a=(o=s.parser)==null?void 0:o.unload)==null||a.call(o,h,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Fe=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(Fe||{});const Tw=".json",Sw="application/json",Iw={extension:{type:W.LoadParser,priority:Fe.Low},name:"loadJson",test(r){return hn(r,Sw)||Hr(r,Tw)},async load(r){return await(await K.ADAPTER.fetch(r)).json()}};et.add(Iw);const Cw=".txt",Nw="text/plain",Rw={name:"loadTxt",extension:{type:W.LoadParser,priority:Fe.Low},test(r){return hn(r,Nw)||Hr(r,Cw)},async load(r){return await(await K.ADAPTER.fetch(r)).text()}};et.add(Rw);const Pw=["normal","bold","100","200","300","400","500","600","700","800","900"],Mw=[".ttf",".otf",".woff",".woff2"],Dw=["font/ttf","font/otf","font/woff","font/woff2"],Lw=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Bw(r){const t=te.extname(r),e=te.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let i=e.length>0;for(const s of e)if(!s.match(Lw)){i=!1;break}let n=e.join(" ");return i||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const kw=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Fw(r){return kw.test(r)?r:encodeURI(r)}const Ow={extension:{type:W.LoadParser,priority:Fe.Low},name:"loadWebFont",test(r){return hn(r,Dw)||Hr(r,Mw)},async load(r,t){var i,n,s;const e=K.ADAPTER.getFontFaceSet();if(e){const o=[],a=((i=t.data)==null?void 0:i.family)??Bw(r),h=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(u=>Pw.includes(u)))??["normal"],l=t.data??{};for(let u=0;u<h.length;u++){const c=h[u],d=new FontFace(a,`url(${Fw(r)})`,{...l,weight:c});await d.load(),e.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>K.ADAPTER.getFontFaceSet().delete(t))}};et.add(Ow);const Uw=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let Xi=null,hl=class{constructor(){Xi||(Xi=URL.createObjectURL(new Blob([Uw],{type:"application/javascript"}))),this.worker=new Worker(Xi)}};hl.revokeObjectURL=function(){Xi&&(URL.revokeObjectURL(Xi),Xi=null)};const Gw=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let Vi=null;class gg{constructor(){Vi||(Vi=URL.createObjectURL(new Blob([Gw],{type:"application/javascript"}))),this.worker=new Worker(Vi)}}gg.revokeObjectURL=function(){Vi&&(URL.revokeObjectURL(Vi),Vi=null)};let ed=0,Ka;class $w{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new hl;e.addEventListener("message",i=>{e.terminate(),hl.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Ka===void 0&&(Ka=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Ka&&(this._createdWorkers++,t=new gg().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[ed]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:ed++,id:i})}}const rd=new $w;function ns(r,t,e){r.resource.internal=!0;const i=new tt(r),n=()=>{delete t.promiseCache[e],ti.has(e)&&ti.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),i}const Hw=[".jpeg",".jpg",".png",".webp",".avif"],zw=["image/jpeg","image/png","image/webp","image/avif"];async function Xw(r){const t=await K.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ra={name:"loadTextures",extension:{type:W.LoadParser,priority:Fe.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return hn(r,zw)||Hr(r,Hw)},async load(r,t,e){var a;const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;i?this.config.preferWorkers&&await rd.isImageBitmapSupported()?n=await rd.loadImageBitmap(r):n=await Xw(r):n=await new Promise((h,l)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=r,u.complete?h(u):(u.onload=()=>h(u),u.onerror=c=>l(c))});const s={...t.data};s.resolution??(s.resolution=xr(r)),i&&((a=s.resourceOptions)==null?void 0:a.ownsImageBitmap)===void 0&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const o=new dt(n,s);return o.resource.src=r,ns(o,e,r)},unload(r){r.destroy(!0)}};et.add(ra);const Vw=".svg",Ww="image/svg+xml",jw={extension:{type:W.LoadParser,priority:Fe.High},name:"loadSVG",test(r){return hn(r,Ww)||Hr(r,Vw)},async testParse(r){return Zh.test(r)},async parse(r,t,e){var s;const i=new Zh(r,(s=t==null?void 0:t.data)==null?void 0:s.resourceOptions);await i.load();const n=new dt(i,{resolution:xr(r),...t==null?void 0:t.data});return n.resource.src=t.src,ns(n,e,t.src)},async load(r,t){return(await K.ADAPTER.fetch(r)).text()},unload:ra.unload};et.add(jw);const Yw=[".mp4",".m4v",".webm",".ogv"],qw=["video/mp4","video/webm","video/ogg"],Kw={name:"loadVideo",extension:{type:W.LoadParser,priority:Fe.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(r){return hn(r,qw)||Hr(r,Yw)},async load(r,t,e){var o;let i;const n=await(await K.ADAPTER.fetch(r)).blob(),s=URL.createObjectURL(n);try{const a={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions,autoLoad:!0},h=new hg(s,a);await h.load();const l=new dt(h,{alphaMode:await ex(),resolution:xr(r),...t==null?void 0:t.data});l.resource.src=r,i=ns(l,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(s)})}catch(a){throw URL.revokeObjectURL(s),a}return i},unload(r){r.destroy(!0)}};et.add(Kw);class Zw{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,name:i,src:n,srcs:s}=t;return Me(e||i||n||s,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>(a==null?void 0:a.src)??(a==null?void 0:a.srcs)??a):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(n=>{const s=n.src??n.srcs,o=n.alias??n.name;let a;if(typeof o=="string"){const h=this._createBundleAssetId(t,o);i.push(h),a=[o,h]}else{const h=o.map(l=>this._createBundleAssetId(t,l));i.push(...h),a=[...o,...h]}this.add({...n,alias:a,src:s})}):Object.keys(e).forEach(n=>{const s=[n,this._createBundleAssetId(t,n)];if(typeof e[n]=="string")this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const o=e[n],a=o.src??o.srcs;this.add({...o,alias:s,src:Array.isArray(a)?a:[a]})}i.push(...s)}),this._bundles[t]=i}add(t,e,i,n,s){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(vt("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:i,format:n,loadParser:s})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Me(o).forEach(h=>{const{src:l,srcs:u}=h;let{data:c,format:d,loadParser:f}=h;const p=Me(l||u).map(y=>typeof y=="string"?bw(y):Array.isArray(y)?y:[y]),g=this.getAlias(h);Array.isArray(g)?g.forEach(a):a(g);const m=[];p.forEach(y=>{y.forEach(x=>{let v={};if(typeof x!="object"){v.src=x;for(let _=0;_<this._parsers.length;_++){const E=this._parsers[_];if(E.test(x)){v=E.parse(x);break}}}else c=x.data??c,d=x.format??d,f=x.loadParser??f,v={...v,...x};if(!g)throw new Error(`[Resolver] alias is undefined for this asset: ${v.src}`);v=this.buildResolvedAsset(v,{aliases:g,data:c,format:d,loadParser:f}),m.push(v)})}),g.forEach(y=>{this._assetMap[y]=m})})}resolveBundle(t){const e=To(t);t=Me(t);const i={};return t.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(n,h)]=l}i[n]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const n in e)i[n]=e[n].src;return i}return e.src}resolve(t){const e=To(t);t=Me(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=s[0],a=this._getPreferredOrder(s);a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const u=s.filter(c=>c[h]?c[h]===l:!1);u.length&&(s=u)})}),this._resolverHash[n]=s[0]??o}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});i[n]=this._resolverHash[n]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:n,loadParser:s,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=te.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=o??t.format??te.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class Qw{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Zw,this.loader=new Aw,this.cache=ti,this._backgroundLoader=new ww(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((s=t.texturePreference)==null?void 0:s.resolution)??1,i=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,n,s){this.resolver.add(t,e,i,n,s)}async load(t,e){this._initialized||await this.init();const i=To(t),n=Me(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,e);return i?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},o=Object.keys(n);let a=0,h=0;const l=()=>{e==null||e(++a/h)},u=o.map(c=>{const d=n[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{s[c]=f})});return await Promise.all(u),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ti.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=ti.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,e);this._backgroundLoader.active=!0;const o={};return i.forEach((a,h)=>{const l=s[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[n[h]]=l,ti.set(u,l)}),o}async unload(t){this._initialized||await this.init();const e=Me(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Me(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{ti.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,n)=>e.indexOf(i)===n),e}get detections(){return this._detections}get preferWorkers(){return ra.config.preferWorkers}set preferWorkers(t){vt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Cs=new Qw;et.handleByList(W.LoadParser,Cs.loader.parsers).handleByList(W.ResolveParser,Cs.resolver.parsers).handleByList(W.CacheParser,Cs.cache.parsers).handleByList(W.DetectionParser,Cs.detections);const Jw={extension:W.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof tt),getCacheableAssets:(r,t)=>{const e={};return r.forEach(i=>{t.forEach((n,s)=>{e[i+(s===0?"":s+1)]=n})}),e}};et.add(Jw);async function mg(r){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(r)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const tb={extension:{type:W.DetectionParser,priority:1},test:async()=>mg("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};et.add(tb);const eb={extension:{type:W.DetectionParser,priority:0},test:async()=>mg("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};et.add(eb);const id=["png","jpg","jpeg"],rb={extension:{type:W.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...id],remove:async r=>r.filter(t=>!id.includes(t))};et.add(rb);const ib="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ru(r){return ib?!1:document.createElement("video").canPlayType(r)!==""}const nb={extension:{type:W.DetectionParser,priority:0},test:async()=>ru("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};et.add(nb);const sb={extension:{type:W.DetectionParser,priority:0},test:async()=>ru("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};et.add(sb);const ob={extension:{type:W.DetectionParser,priority:0},test:async()=>ru("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};et.add(ob);const ab={extension:W.ResolveParser,test:ra.test,parse:r=>{var t;return{resolution:parseFloat(((t=K.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:te.extname(r).slice(1),src:r}}};et.add(ab);var re=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r))(re||{});const So={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let ze,Mi;function nd(){Mi={bptc:ze.getExtension("EXT_texture_compression_bptc"),astc:ze.getExtension("WEBGL_compressed_texture_astc"),etc:ze.getExtension("WEBGL_compressed_texture_etc"),s3tc:ze.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ze.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:ze.getExtension("WEBGL_compressed_texture_pvrtc")||ze.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:ze.getExtension("WEBGL_compressed_texture_etc1"),atc:ze.getExtension("WEBGL_compressed_texture_atc")}}const hb={extension:{type:W.DetectionParser,priority:2},test:async()=>{const r=K.ADAPTER.createCanvas().getContext("webgl");return r?(ze=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{Mi||nd();const t=[];for(const e in Mi)Mi[e]&&t.push(e);return[...t,...r]},remove:async r=>(Mi||nd(),r.filter(t=>!(t in Mi)))};et.add(hb);class lb extends Zo{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,e),this.origin=i,this.buffer=n?new Oh(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Oh(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class oi extends lb{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=oi._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||oi._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,o=this.levels;s<o;s++){const{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=oi._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,i,n,s,o,a){const h=new Array(i);let l=t.byteOffset,u=o,c=a,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*So[e];for(let g=0;g<i;g++)h[g]={levelID:g,levelWidth:i>1?u:d,levelHeight:i>1?c:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,c=c>>1||1,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*So[e];return h}}const Za=4,Ns=124,ub=32,sd=20,cb=542327876,Rs={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},db={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Ps={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},fb=1,pb=2,gb=4,mb=64,yb=512,_b=131072,vb=827611204,xb=861165636,wb=894720068,bb=808540228,Eb=4,Ab={[vb]:re.COMPRESSED_RGBA_S3TC_DXT1_EXT,[xb]:re.COMPRESSED_RGBA_S3TC_DXT3_EXT,[wb]:re.COMPRESSED_RGBA_S3TC_DXT5_EXT},Tb={70:re.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:re.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:re.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:re.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:re.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:re.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:re.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:re.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:re.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:re.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:re.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:re.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:re.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Sb(r){const t=new Uint32Array(r);if(t[0]!==cb)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(r,0,Ns/Uint32Array.BYTES_PER_ELEMENT),i=e[Rs.HEIGHT],n=e[Rs.WIDTH],s=e[Rs.MIPMAP_COUNT],o=new Uint32Array(r,Rs.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,ub/Uint32Array.BYTES_PER_ELEMENT),a=o[fb];if(a&gb){const h=o[db.FOURCC];if(h!==bb){const x=Ab[h],v=Za+Ns,_=new Uint8Array(r,v);return[new oi(_,{format:x,width:n,height:i,levels:s})]}const l=Za+Ns,u=new Uint32Array(t.buffer,l,sd/Uint32Array.BYTES_PER_ELEMENT),c=u[Ps.DXGI_FORMAT],d=u[Ps.RESOURCE_DIMENSION],f=u[Ps.MISC_FLAG],p=u[Ps.ARRAY_SIZE],g=Tb[c];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===Eb)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const m=new Array,y=Za+Ns+sd;if(p===1)m.push(new Uint8Array(r,y));else{const x=So[g];let v=0,_=n,E=i;for(let S=0;S<s;S++){const T=Math.max(1,_+3&-4),D=Math.max(1,E+3&-4),B=T*D*x;v+=B,_=_>>>1,E=E>>>1}let N=y;for(let S=0;S<p;S++)m.push(new Uint8Array(r,N,v)),N+=v}return m.map(x=>new oi(x,{format:g,width:n,height:i,levels:s}))}throw a&mb?new Error("DDSParser does not support uncompressed texture data."):a&yb?new Error("DDSParser does not supported YUV uncompressed texture data."):a&_b?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&pb?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const od=[171,75,84,88,32,49,49,187,13,10,26,10],Ib=67305985,Se={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},ll=64,ad={[nt.UNSIGNED_BYTE]:1,[nt.UNSIGNED_SHORT]:2,[nt.INT]:4,[nt.UNSIGNED_INT]:4,[nt.FLOAT]:4,[nt.HALF_FLOAT]:8},Cb={[U.RGBA]:4,[U.RGB]:3,[U.RG]:2,[U.RED]:1,[U.LUMINANCE]:1,[U.LUMINANCE_ALPHA]:2,[U.ALPHA]:1},Nb={[nt.UNSIGNED_SHORT_4_4_4_4]:2,[nt.UNSIGNED_SHORT_5_5_5_1]:2,[nt.UNSIGNED_SHORT_5_6_5]:2};function Rb(r,t,e=!1){const i=new DataView(t);if(!Pb(r,i))return null;const n=i.getUint32(Se.ENDIANNESS,!0)===Ib,s=i.getUint32(Se.GL_TYPE,n),o=i.getUint32(Se.GL_FORMAT,n),a=i.getUint32(Se.GL_INTERNAL_FORMAT,n),h=i.getUint32(Se.PIXEL_WIDTH,n),l=i.getUint32(Se.PIXEL_HEIGHT,n)||1,u=i.getUint32(Se.PIXEL_DEPTH,n)||1,c=i.getUint32(Se.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=i.getUint32(Se.NUMBER_OF_FACES,n),f=i.getUint32(Se.NUMBER_OF_MIPMAP_LEVELS,n),p=i.getUint32(Se.BYTES_OF_KEY_VALUE_DATA,n);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");const g=4,m=4,y=h+3&-4,x=l+3&-4,v=new Array(c);let _=h*l;s===0&&(_=y*x);let E;if(s!==0?ad[s]?E=ad[s]*Cb[o]:E=Nb[s]:E=So[a],E===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const N=e?Db(i,p,n):null;let S=_*E,T=h,D=l,B=y,k=x,M=ll+p;for(let A=0;A<f;A++){const w=i.getUint32(M,n);let C=M+4;for(let I=0;I<c;I++){let R=v[I];R||(R=v[I]=new Array(f)),R[A]={levelID:A,levelWidth:f>1||s!==0?T:B,levelHeight:f>1||s!==0?D:k,levelBuffer:new Uint8Array(t,C,S)},C+=S}M+=w+4,M=M%4!==0?M+4-M%4:M,T=T>>1||1,D=D>>1||1,B=T+g-1&~(g-1),k=D+m-1&~(m-1),S=B*k*E}return s!==0?{uncompressed:v.map(A=>{let w=A[0].levelBuffer,C=!1;return s===nt.FLOAT?w=new Float32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4):s===nt.UNSIGNED_INT?(C=!0,w=new Uint32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4)):s===nt.INT&&(C=!0,w=new Int32Array(A[0].levelBuffer.buffer,A[0].levelBuffer.byteOffset,A[0].levelBuffer.byteLength/4)),{resource:new Zo(w,{width:A[0].levelWidth,height:A[0].levelHeight}),type:s,format:C?Mb(o):o}}),kvData:N}:{compressed:v.map(A=>new oi(null,{format:a,width:h,height:l,levels:f,levelBuffers:A})),kvData:N}}function Pb(r,t){for(let e=0;e<od.length;e++)if(t.getUint8(e)!==od[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function Mb(r){switch(r){case U.RGBA:return U.RGBA_INTEGER;case U.RGB:return U.RGB_INTEGER;case U.RG:return U.RG_INTEGER;case U.RED:return U.RED_INTEGER;default:return r}}function Db(r,t,e){const i=new Map;let n=0;for(;n<t;){const s=r.getUint32(ll+n,e),o=ll+n+4,a=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&r.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(r.buffer,o,h)),u=new DataView(r.buffer,o+h+1,s-h-1);i.set(l,u),n+=4+s+a}return i}const Lb={extension:{type:W.LoadParser,priority:Fe.High},name:"loadDDS",test(r){return Hr(r,".dds")},async load(r,t,e){const i=await(await K.ADAPTER.fetch(r)).arrayBuffer(),n=Sb(i).map(s=>{const o=new dt(s,{mipmap:rr.OFF,alphaMode:fe.NO_PREMULTIPLIED_ALPHA,resolution:xr(r),...t.data});return ns(o,e,r)});return n.length===1?n[0]:n},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};et.add(Lb);const Bb={extension:{type:W.LoadParser,priority:Fe.High},name:"loadKTX",test(r){return Hr(r,".ktx")},async load(r,t,e){const i=await(await K.ADAPTER.fetch(r)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:o}=Rb(r,i),a=n??s,h={mipmap:rr.OFF,alphaMode:fe.NO_PREMULTIPLIED_ALPHA,resolution:xr(r),...t.data},l=a.map(u=>{a===s&&Object.assign(h,{type:u.type,format:u.format});const c=u.resource??u,d=new dt(c,h);return d.ktxKeyValueData=o,ns(d,e,r)});return l.length===1?l[0]:l},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};et.add(Bb);const kb=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Fb={extension:W.ResolveParser,test:r=>{const t=te.extname(r).slice(1);return["basis","ktx","dds"].includes(t)},parse:r=>{var i,n;const t=r.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const s=t.pop();if(kb.includes(s))return{resolution:parseFloat(((i=K.RETINA_PREFIX.exec(r))==null?void 0:i[1])??"1"),format:s,src:r}}return{resolution:parseFloat(((n=K.RETINA_PREFIX.exec(r))==null?void 0:n[1])??"1"),format:e,src:r}}};et.add(Fb);const Ms=new gt,Ob=4,yg=class Cn{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,n){const s=new Image;return s.src=await this.base64(t,e,i,n),s}async base64(t,e,i,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((o,a)=>{s.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(h)},e,i)});if(s.toDataURL!==void 0)return s.toDataURL(e,i);if(s.convertToBlob!==void 0){const o=await s.convertToBlob({type:e,quality:i});return new Promise((a,h)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&Cn._flipY(i,n,s),a&&Cn._unpremultiplyAlpha(i);const h=new yx(n,s,1),l=new ImageData(new Uint8ClampedArray(i.buffer),n,s);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:i,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&Cn._flipY(i,n,s),a&&Cn._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let n,s=!1,o=!1,a,h=!1;t&&(t instanceof mi?a=t:(a=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),h=!0,e&&(Ms.width=e.width,Ms.height=e.height,e=Ms)));const l=i.gl;if(a){if(n=a.baseTexture.resolution,e=e??a.frame,s=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===U.RGBA,!h){i.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[i.CONTEXT_UID];f.blitFramebuffer&&i.framebuffer.bind(f.blitFramebuffer)}}else n=i.resolution,e||(e=Ms,e.width=i.width/n,e.height=i.height/n),s=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const u=Math.max(Math.round(e.width*n),1),c=Math.max(Math.round(e.height*n),1),d=new Uint8Array(Ob*u*c);return l.readPixels(Math.round(e.x*n),Math.round(e.y*n),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:c,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,i){const n=e<<2,s=i>>1,o=new Uint8Array(n);for(let a=0;a<s;a++){const h=a*n,l=(i-a-1)*n;o.set(t.subarray(h,h+n)),t.copyWithin(h,l,l+n),t.set(o,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const n=t[i+3];if(n!==0){const s=255.001/n;t[i]=t[i]*s+.5,t[i+1]=t[i+1]*s+.5,t[i+2]=t[i+2]*s+.5}}}};yg.extension={name:"extract",type:W.RendererSystem};let Ub=yg;et.add(Ub);const Io={build(r){const t=r.points;let e,i,n,s,o,a;if(r.type===ie.CIRC){const p=r.shape;e=p.x,i=p.y,o=a=p.radius,n=s=0}else if(r.type===ie.ELIP){const p=r.shape;e=p.x,i=p.y,o=p.width,a=p.height,n=s=0}else{const p=r.shape,g=p.width/2,m=p.height/2;e=p.x+g,i=p.y+m,o=a=Math.max(0,Math.min(p.radius,Math.min(g,m))),n=g-o,s=m-a}if(!(o>=0&&a>=0&&n>=0&&s>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(n?4:0)+(s?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=i+s,t[2]=t[4]=e-n,t[5]=t[7]=i-s;return}let u=0,c=h*4+(n?2:0)+2,d=c,f=l;{const p=n+o,g=s,m=e+p,y=e-p,x=i+g;if(t[u++]=m,t[u++]=x,t[--c]=x,t[--c]=y,s){const v=i-g;t[d++]=y,t[d++]=v,t[--f]=v,t[--f]=m}}for(let p=1;p<h;p++){const g=Math.PI/2*(p/h),m=n+Math.cos(g)*o,y=s+Math.sin(g)*a,x=e+m,v=e-m,_=i+y,E=i-y;t[u++]=x,t[u++]=_,t[--c]=_,t[--c]=v,t[d++]=v,t[d++]=E,t[--f]=E,t[--f]=x}{const p=n,g=s+a,m=e+p,y=e-p,x=i+g,v=i-g;t[u++]=m,t[u++]=x,t[--f]=v,t[--f]=m,n&&(t[u++]=y,t[u++]=x,t[--f]=v,t[--f]=y)}},triangulate(r,t){const e=r.points,i=t.points,n=t.indices;if(e.length===0)return;let s=i.length/2;const o=s;let a,h;if(r.type!==ie.RREC){const u=r.shape;a=u.x,h=u.y}else{const u=r.shape;a=u.x+u.width/2,h=u.y+u.height/2}const l=r.matrix;i.push(r.matrix?l.a*a+l.c*h+l.tx:a,r.matrix?l.b*a+l.d*h+l.ty:h),s++,i.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)i.push(e[u],e[u+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function hd(r,t=!1){const e=r.length;if(e<6)return;let i=0;for(let n=0,s=r[e-2],o=r[e-1];n<e;n+=2){const a=r[n],h=r[n+1];i+=(a-s)*(h+o),s=a,o=h}if(!t&&i>0||t&&i<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const o=e-s-2,a=e-s-1,h=s,l=s+1;[r[o],r[h]]=[r[h],r[o]],[r[a],r[l]]=[r[l],r[a]]}}}const _g={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points;const i=r.holes,n=t.points,s=t.indices;if(e.length>=6){hd(e,!1);const o=[];for(let l=0;l<i.length;l++){const u=i[l];hd(u.points,!0),o.push(e.length/2),e=e.concat(u.points)}const a=Gy(e,o,2);if(!a)return;const h=n.length/2;for(let l=0;l<a.length;l+=3)s.push(a[l]+h),s.push(a[l+1]+h),s.push(a[l+2]+h);for(let l=0;l<e.length;l++)n.push(e[l])}}},Gb={build(r){const t=r.shape,e=t.x,i=t.y,n=t.width,s=t.height,o=r.points;o.length=0,n>=0&&s>=0&&o.push(e,i,e+n,i,e+n,i+s,e,i+s)},triangulate(r,t){const e=r.points,i=t.points;if(e.length===0)return;const n=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},$b={build(r){Io.build(r)},triangulate(r,t){Io.triangulate(r,t)}};var xe=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(xe||{}),Lr=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(Lr||{});const Ji={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class ld{static curveTo(t,e,i,n,s,o){const a=o[o.length-2],h=o[o.length-1]-e,l=a-t,u=n-e,c=i-t,d=Math.abs(h*c-l*u);if(d<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=h*h+l*l,p=u*u+c*c,g=h*u+l*c,m=s*Math.sqrt(f)/d,y=s*Math.sqrt(p)/d,x=m*g/f,v=y*g/p,_=m*c+y*l,E=m*u+y*h,N=l*(y+x),S=h*(y+x),T=c*(m+v),D=u*(m+v),B=Math.atan2(S-E,N-_),k=Math.atan2(D-E,T-_);return{cx:_+t,cy:E+e,radius:s,startAngle:B,endAngle:k,anticlockwise:l*u>c*h}}static arc(t,e,i,n,s,o,a,h,l){const u=a-o,c=Ji._segmentsCount(Math.abs(u)*s,Math.ceil(Math.abs(u)/_o)*40),d=u/(c*2),f=d*2,p=Math.cos(d),g=Math.sin(d),m=c-1,y=m%1/m;for(let x=0;x<=m;++x){const v=x+y*x,_=d+o+f*v,E=Math.cos(_),N=-Math.sin(_);l.push((p*E+g*N)*s+i,(p*-N+g*E)*s+n)}}}class Hb{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class iu{static curveLength(t,e,i,n,s,o,a,h){let l=0,u=0,c=0,d=0,f=0,p=0,g=0,m=0,y=0,x=0,v=0,_=t,E=e;for(let N=1;N<=10;++N)u=N/10,c=u*u,d=c*u,f=1-u,p=f*f,g=p*f,m=g*t+3*p*u*i+3*f*c*s+d*a,y=g*e+3*p*u*n+3*f*c*o+d*h,x=_-m,v=E-y,_=m,E=y,l+=Math.sqrt(x*x+v*v);return l}static curveTo(t,e,i,n,s,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const u=Ji._segmentsCount(iu.curveLength(h,l,t,e,i,n,s,o));let c=0,d=0,f=0,p=0,g=0;a.push(h,l);for(let m=1,y=0;m<=u;++m)y=m/u,c=1-y,d=c*c,f=d*c,p=y*y,g=p*y,a.push(f*h+3*d*y*t+3*c*p*i+g*s,f*l+3*d*y*e+3*c*p*n+g*o)}}function ud(r,t,e,i,n,s,o,a){const h=r-e*n,l=t-i*n,u=r+e*s,c=t+i*s;let d,f;o?(d=i,f=-e):(d=-i,f=e);const p=h+d,g=l+f,m=u+d,y=c+f;return a.push(p,g,m,y),2}function Wr(r,t,e,i,n,s,o,a){const h=e-r,l=i-t;let u=Math.atan2(h,l),c=Math.atan2(n-r,s-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),g=Math.sqrt(h*h+l*l),m=(15*p*Math.sqrt(g)/Math.PI>>0)+1,y=f/m;if(d+=y,a){o.push(r,t,e,i);for(let x=1,v=d;x<m;x++,v+=y)o.push(r,t,r+Math.sin(v)*g,t+Math.cos(v)*g);o.push(r,t,n,s)}else{o.push(e,i,r,t);for(let x=1,v=d;x<m;x++,v+=y)o.push(r+Math.sin(v)*g,t+Math.cos(v)*g,r,t);o.push(n,s,r,t)}return m*2}function zb(r,t){const e=r.shape;let i=r.points||e.points.slice();const n=t.closePointEps;if(i.length===0)return;const s=r.lineStyle,o=new bt(i[0],i[1]),a=new bt(i[i.length-2],i[i.length-1]),h=e.type!==ie.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const R=(o.x+a.x)*.5,O=(a.y+o.y)*.5;i.unshift(R,O),i.push(R,O)}const u=t.points,c=i.length/2;let d=i.length;const f=u.length/2,p=s.width/2,g=p*p,m=s.miterLimit*s.miterLimit;let y=i[0],x=i[1],v=i[2],_=i[3],E=0,N=0,S=-(x-_),T=y-v,D=0,B=0,k=Math.sqrt(S*S+T*T);S/=k,T/=k,S*=p,T*=p;const M=s.alignment,A=(1-M)*2,w=M*2;h||(s.cap===Lr.ROUND?d+=Wr(y-S*(A-w)*.5,x-T*(A-w)*.5,y-S*A,x-T*A,y+S*w,x+T*w,u,!0)+2:s.cap===Lr.SQUARE&&(d+=ud(y,x,S,T,A,w,!0,u))),u.push(y-S*A,x-T*A,y+S*w,x+T*w);for(let R=1;R<c-1;++R){y=i[(R-1)*2],x=i[(R-1)*2+1],v=i[R*2],_=i[R*2+1],E=i[(R+1)*2],N=i[(R+1)*2+1],S=-(x-_),T=y-v,k=Math.sqrt(S*S+T*T),S/=k,T/=k,S*=p,T*=p,D=-(_-N),B=v-E,k=Math.sqrt(D*D+B*B),D/=k,B/=k,D*=p,B*=p;const O=v-y,z=x-_,P=v-E,F=N-_,rt=O*P+z*F,ft=z*P-F*O,ht=ft<0;if(Math.abs(ft)<.001*Math.abs(rt)){u.push(v-S*A,_-T*A,v+S*w,_+T*w),rt>=0&&(s.join===xe.ROUND?d+=Wr(v,_,v-S*A,_-T*A,v-D*A,_-B*A,u,!1)+4:d+=2,u.push(v-D*w,_-B*w,v+D*A,_+B*A));continue}const Et=(-S+y)*(-T+_)-(-S+v)*(-T+x),ct=(-D+E)*(-B+_)-(-D+v)*(-B+N),At=(O*ct-P*Et)/ft,It=(F*Et-z*ct)/ft,Gt=(At-v)*(At-v)+(It-_)*(It-_),jt=v+(At-v)*A,Tt=_+(It-_)*A,Lt=v-(At-v)*w,$t=_-(It-_)*w,ge=Math.min(O*O+z*z,P*P+F*F),L=ht?A:w,G=ge+L*L*g,j=Gt<=G;let X=s.join;if(X===xe.MITER&&Gt/g>m&&(X=xe.BEVEL),j)switch(X){case xe.MITER:{u.push(jt,Tt,Lt,$t);break}case xe.BEVEL:{ht?u.push(jt,Tt,v+S*w,_+T*w,jt,Tt,v+D*w,_+B*w):u.push(v-S*A,_-T*A,Lt,$t,v-D*A,_-B*A,Lt,$t),d+=2;break}case xe.ROUND:{ht?(u.push(jt,Tt,v+S*w,_+T*w),d+=Wr(v,_,v+S*w,_+T*w,v+D*w,_+B*w,u,!0)+4,u.push(jt,Tt,v+D*w,_+B*w)):(u.push(v-S*A,_-T*A,Lt,$t),d+=Wr(v,_,v-S*A,_-T*A,v-D*A,_-B*A,u,!1)+4,u.push(v-D*A,_-B*A,Lt,$t));break}}else{switch(u.push(v-S*A,_-T*A,v+S*w,_+T*w),X){case xe.MITER:{ht?u.push(Lt,$t,Lt,$t):u.push(jt,Tt,jt,Tt),d+=2;break}case xe.ROUND:{ht?d+=Wr(v,_,v+S*w,_+T*w,v+D*w,_+B*w,u,!0)+2:d+=Wr(v,_,v-S*A,_-T*A,v-D*A,_-B*A,u,!1)+2;break}}u.push(v-D*A,_-B*A,v+D*w,_+B*w),d+=2}}y=i[(c-2)*2],x=i[(c-2)*2+1],v=i[(c-1)*2],_=i[(c-1)*2+1],S=-(x-_),T=y-v,k=Math.sqrt(S*S+T*T),S/=k,T/=k,S*=p,T*=p,u.push(v-S*A,_-T*A,v+S*w,_+T*w),h||(s.cap===Lr.ROUND?d+=Wr(v-S*(A-w)*.5,_-T*(A-w)*.5,v-S*A,_-T*A,v+S*w,_+T*w,u,!1)+2:s.cap===Lr.SQUARE&&(d+=ud(v,_,S,T,A,w,!1,u)));const C=t.indices,I=Ji.epsilon*Ji.epsilon;for(let R=f;R<d+f-2;++R)y=u[R*2],x=u[R*2+1],v=u[(R+1)*2],_=u[(R+1)*2+1],E=u[(R+2)*2],N=u[(R+2)*2+1],!(Math.abs(y*(_-N)+v*(N-x)+E*(x-_))<I)&&C.push(R,R+1,R+2)}function Xb(r,t){let e=0;const i=r.shape,n=r.points||i.points,s=i.type!==ie.POLY||i.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,h=n.length/2,l=o.length/2;let u=l;for(o.push(n[0],n[1]),e=1;e<h;e++)o.push(n[e*2],n[e*2+1]),a.push(u,u+1),u++;s&&a.push(u,l)}function cd(r,t){r.lineStyle.native?Xb(r,t):zb(r,t)}class nu{static curveLength(t,e,i,n,s,o){const a=t-2*i+s,h=e-2*n+o,l=2*i-2*t,u=2*n-2*e,c=4*(a*a+h*h),d=4*(a*l+h*u),f=l*l+u*u,p=2*Math.sqrt(c+d+f),g=Math.sqrt(c),m=2*c*g,y=2*Math.sqrt(f),x=d/g;return(m*p+g*d*(p-y)+(4*f*c-d*d)*Math.log((2*g+x+p)/(x+y)))/(4*m)}static curveTo(t,e,i,n,s){const o=s[s.length-2],a=s[s.length-1],h=Ji._segmentsCount(nu.curveLength(o,a,t,e,i,n));let l=0,u=0;for(let c=1;c<=h;++c){const d=c/h;l=o+(t-o)*d,u=a+(e-a)*d,s.push(l+(t+(i-t)*d-l)*d,u+(e+(n-e)*d-u)*d)}}}const Qa={[ie.POLY]:_g,[ie.CIRC]:Io,[ie.ELIP]:Io,[ie.RECT]:Gb,[ie.RREC]:$b},dd=[],Ds=[];class Co{constructor(t,e=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Co(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ai=new bt,vg=class xg extends Tp{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Eo,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ds.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),dd.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,n=null){const s=new Co(t,e,i,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new Co(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const n=e[i];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Ai):Ai.copyFrom(t),n.shape.contains(Ai.x,Ai.y))){let s=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(Ai.x,Ai.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,n=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],n=i.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],u=l.fillStyle,c=l.lineStyle;Qa[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,g=this.indices.length,m=this.points.length/2;p.wrapMode=Or.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-m;y!==0&&(i&&!this._compareStyles(n,f)&&(i.end(g,m),i=null),i||(i=dd.pop()||new Hb,i.begin(f,g,m),this.batches.push(i),n=f),this.addUvs(this.points,t,f.texture,m,y,f.matrix))}}const s=this.indices.length,o=this.points.length/2;if(i&&i.end(s,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const i=this.graphicsData[t],n=i.fillStyle,s=i.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const n=t[e];for(let s=0;s<n.size;s++){const o=n.start+s;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<xg.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++dt._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Ds.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let n=Ds.pop();n||(n=new $h,n.texArray=new Vh),n.texArray.count=0,n.start=0,n.size=0,n.type=Ke.TRIANGLES;let s=0,o=null,a=0,h=!1,l=Ke.TRIANGLES,u=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,g=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?Ke.LINES:Ke.TRIANGLES,o=null,s=f,t++),o!==g&&(o=g,g._batchEnabled!==t&&(s===f&&(t++,s=0,n.size>0&&(n=Ds.pop(),n||(n=new $h,n.texArray=new Vh),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=l),g.touched=1,g._batchEnabled=t,g._batchLocation=s,g.wrapMode=Or.REPEAT,n.texArray.elements[n.texArray.count++]=g,s++)),n.size+=d.size,u+=d.size,a=g._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}dt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,n=this.textureIds,s=new ArrayBuffer(t.length*3*4),o=new Float32Array(s),a=new Uint32Array(s);let h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=i[l],o[h++]=n[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?_g.triangulate(t,this):Qa[t.type].triangulate(t,this)}processLine(t){cd(t,this);for(let e=0;e<t.holes.length;e++)cd(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];Qa[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const n=t[i*2],s=t[i*2+1];t[i*2]=e.a*n+e.c*s+e.tx,t[i*2+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,i,n,s=0){const o=Pt.shared.setValue(e).toLittleEndianNumber(),a=Pt.shared.setValue(o).toPremultiplied(i);t.length=Math.max(t.length,s+n);for(let h=0;h<n;h++)t[s+h]=a}addTextureIds(t,e,i,n=0){t.length=Math.max(t.length,n+i);for(let s=0;s<i;s++)t[n+s]=e}addUvs(t,e,i,n,s,o=null){let a=0;const h=e.length,l=i.frame;for(;a<s;){let c=t[(n+a)*2],d=t[(n+a)*2+1];if(o){const f=o.a*c+o.c*d+o.tx;d=o.b*c+o.d*d+o.ty,c=f}a++,e.push(c/l.width,d/l.height)}const u=i.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,i,h,s)}adjustUvs(t,e,i,n){const s=e.baseTexture,o=1e-6,a=i+n*2,h=e.frame,l=h.width/s.width,u=h.height/s.height;let c=h.x/h.width,d=h.y/h.height,f=Math.floor(t[i]+o),p=Math.floor(t[i+1]+o);for(let g=i+2;g<a;g+=2)f=Math.min(f,Math.floor(t[g]+o)),p=Math.min(p,Math.floor(t[g+1]+o));c-=f,d-=p;for(let g=i;g<a;g+=2)t[g]=(t[g]+c)*l,t[g+1]=(t[g+1]+d)*u}};vg.BATCHABLE_SIZE=100;let Vb=vg;class ia{constructor(){this.color=16777215,this.alpha=1,this.texture=tt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new ia;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=tt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class su extends ia{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Lr.BUTT,this.join=xe.MITER,this.miterLimit=10}clone(){const t=new su;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Lr.BUTT,this.join=xe.MITER,this.miterLimit=10}}const Ja={},ul=class to extends ke{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new ia,this._lineStyle=new su,this._matrix=null,this._holeMode=!1,this.state=nr.for2d(),this._geometry=t||new Vb,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Pt(16777215),this.blendMode=at.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new to(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,n=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:tt.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Lr.BUTT,join:xe.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new si,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new si,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],s=i[i.length-1];return(n!==t||s!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),nu.curveTo(t,e,i,n,s),this}bezierCurveTo(t,e,i,n,s,o){return this._initCurve(),iu.curveTo(t,e,i,n,s,o,this.currentPath.points),this}arcTo(t,e,i,n,s){this._initCurve(t,e);const o=this.currentPath.points,a=ld.curveTo(t,e,i,n,s,o);if(a){const{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=a;this.arc(h,l,u,c,d,f)}return this}arc(t,e,i,n,s,o=!1){if(n===s)return this;if(!o&&s<=n?s+=_o:o&&n<=s&&(n+=_o),s-n===0)return this;const a=t+Math.cos(n)*i,h=e+Math.sin(n)*i,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return ld.arc(a,h,t,e,i,n,s,o,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:tt.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Pt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:tt.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,n){return this.drawShape(new gt(t,e,i,n))}drawRoundedRect(t,e,i,n,s){return this.drawShape(new ta(t,e,i,n,s))}drawCircle(t,e,i){return this.drawShape(new Qo(t,e,i))}drawEllipse(t,e,i,n){return this.drawShape(new Jo(t,e,i,n))}drawPolygon(...t){let e,i=!0;const n=t[0];n.points?(i=n.closeStroke,e=n.points):Array.isArray(t[0])?e=t[0]:e=t;const s=new si(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===ie.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let n=0;n<i;n++){const s=t.batches[n],o=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:Pt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,n=this.worldAlpha,s=e.uniforms,o=i.drawCalls;s.translationMatrix=this.transform.worldTransform,Pt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,i.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:i,type:n,size:s,start:o}=e,a=i.count;for(let h=0;h<a;h++)t.texture.bind(i.elements[h],h);t.geometry.draw(n,s,o)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!Ja[i]){const{maxTextures:n}=t.plugins[i],s=new Int32Array(n);for(let h=0;h<n;h++)s[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Mt,default:Be.from({uSamplers:s},!0)},a=t.plugins[i]._shader.program;Ja[i]=new Je(a,o)}e=Ja[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,n,s)}containsPoint(t){return this.worldTransform.applyInverse(t,to._TEMP_POINT),this._geometry.containsPoint(to._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Pt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<l.length;d+=2){const f=l[d],p=l[d+1];u[c++]=i*f+s*p+a,u[c++]=o*p+n*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};ul.curves=Ji,ul._TEMP_POINT=new bt;let wg=ul;class Wb{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const th=new bt,fd=new si,bg=class Eg extends ke{constructor(t,e,i,n=Ke.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||nr.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=K.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Ke.TRIANGLES&&e.length<Eg.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,u=n.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=e[d*2],p=e[d*2+1];c[d*2]=s*f+a*p+l,c[d*2+1]=o*f+h*p+u}if(this._roundPixels){const d=K.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Wb(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,th);const e=this.geometry.getBuffer("aVertexPosition").data,i=fd.points,n=this.geometry.getIndex().data,s=n.length,o=this.drawMode===4?3:1;for(let a=0;a+2<s;a+=o){const h=n[a]*2,l=n[a+1]*2,u=n[a+2]*2;if(i[0]=e[h],i[1]=e[h+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[u],i[5]=e[u+1],fd.contains(th.x,th.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};bg.BATCHABLE_SIZE=100;let pd=bg;class jb extends Ur{constructor(t,e,i){super();const n=new zt(t),s=new zt(e,!0),o=new zt(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,nt.FLOAT).addAttribute("aTextureCoord",s,2,!1,nt.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Yb=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,qb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class gd extends Je{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:Mt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||gr.from(qb,Yb),i),this._colorDirty=!1,this.uvMatrix=new Up(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Pt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Pt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class md{constructor(t,e,i){this.geometry=new Ur,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||nt.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new zt(gx(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new zt(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new zt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===nt.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===nt.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,i,s.type===nt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,i,s.type===nt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Kb=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Zb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Ag extends ea{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Mt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:nt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Je.from(Zb,Kb,{}),this.state=nr.for2d()}render(t){const e=t.children,i=t._maxSize,n=t._batchSize,s=this.renderer;let o=e.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=bp(t.blendMode,l),s.state.set(this.state);const u=s.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Pt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=n,p+=1){let g=o-f;g>n&&(g=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const m=a[p];m.uploadDynamic(e,f,g);const y=t._bufferUpdateIDs[p]||0;d=d||m._updateID<y,d&&(m._updateID=t._updateID,m.uploadStatic(e,f,g)),s.geometry.bind(m.geometry),u.drawElements(u.TRIANGLES,g*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,n=t._batchSize,s=t._properties;for(let o=0;o<i;o+=n)e.push(new md(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new md(this.properties,i,e)}uploadVertices(t,e,i,n,s,o){let a=0,h=0,l=0,u=0;for(let c=0;c<i;++c){const d=t[e+c],f=d._texture,p=d.scale.x,g=d.scale.y,m=f.trim,y=f.orig;m?(h=m.x-d.anchor.x*y.width,a=h+m.width,u=m.y-d.anchor.y*y.height,l=u+m.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),n[o]=h*p,n[o+1]=u*g,n[o+s]=a*p,n[o+s+1]=u*g,n[o+s*2]=a*p,n[o+s*2+1]=l*g,n[o+s*3]=h*p,n[o+s*3+1]=l*g,o+=s*4}}uploadPosition(t,e,i,n,s,o){for(let a=0;a<i;a++){const h=t[e+a].position;n[o]=h.x,n[o+1]=h.y,n[o+s]=h.x,n[o+s+1]=h.y,n[o+s*2]=h.x,n[o+s*2+1]=h.y,n[o+s*3]=h.x,n[o+s*3+1]=h.y,o+=s*4}}uploadRotation(t,e,i,n,s,o){for(let a=0;a<i;a++){const h=t[e+a].rotation;n[o]=h,n[o+s]=h,n[o+s*2]=h,n[o+s*3]=h,o+=s*4}}uploadUvs(t,e,i,n,s,o){for(let a=0;a<i;++a){const h=t[e+a]._texture._uvs;h?(n[o]=h.x0,n[o+1]=h.y0,n[o+s]=h.x1,n[o+s+1]=h.y1,n[o+s*2]=h.x2,n[o+s*2+1]=h.y2,n[o+s*3]=h.x3,n[o+s*3+1]=h.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(t,e,i,n,s,o){for(let a=0;a<i;++a){const h=t[e+a],l=Pt.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);n[o]=l,n[o+s]=l,n[o+s*2]=l,n[o+s*3]=l,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Ag.extension={name:"particle",type:W.RendererPlugin};et.add(Ag);var na=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(na||{});const Ls={willReadFrequently:!0},Xe=class it{static get experimentalLetterSpacingSupported(){let t=it._experimentalLetterSpacingSupported;if(t!==void 0){const e=K.ADAPTER.getCanvasRenderingContext2D().prototype;t=it._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,n,s,o,a,h,l){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,i,n=it._canvas){i=i??e.wordWrap;const s=e.toFontString(),o=it.measureFont(s);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=n.getContext("2d",Ls);a.font=s;const h=(i?it.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let u=0;for(let p=0;p<h.length;p++){const g=it._measureText(h[p],e.letterSpacing,a);l[p]=g,u=Math.max(u,g)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const d=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new it(t,e,c,f,h,l,d+e.leading,u,o)}static _measureText(t,e,i){let n=!1;it.experimentalLetterSpacingSupported&&(it.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(t).width;return s>0&&(n?s-=e:s+=(it.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,i=it._canvas){const n=i.getContext("2d",Ls);let s=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=it.collapseSpaces(u),d=it.collapseNewlines(u);let f=!c;const p=e.wordWrapWidth+l,g=it.tokenize(t);for(let m=0;m<g.length;m++){let y=g[m];if(it.isNewline(y)){if(!d){a+=it.addLine(o),f=!c,o="",s=0;continue}y=" "}if(c){const v=it.isBreakingSpace(y),_=it.isBreakingSpace(o[o.length-1]);if(v&&_)continue}const x=it.getFromCache(y,l,h,n);if(x>p)if(o!==""&&(a+=it.addLine(o),o="",s=0),it.canBreakWords(y,e.breakWords)){const v=it.wordWrapSplit(y);for(let _=0;_<v.length;_++){let E=v[_],N=E,S=1;for(;v[_+S];){const D=v[_+S];if(!it.canBreakChars(N,D,y,_,e.breakWords))E+=D;else break;N=D,S++}_+=S-1;const T=it.getFromCache(E,l,h,n);T+s>p&&(a+=it.addLine(o),f=!1,o="",s=0),o+=E,s+=T}}else{o.length>0&&(a+=it.addLine(o),o="",s=0);const v=m===g.length-1;a+=it.addLine(y,!v),f=!1,o="",s=0}else x+s>p&&(f=!1,a+=it.addLine(o),o="",s=0),(o.length>0||!it.isBreakingSpace(y)||f)&&(o+=y,s+=x)}return a+=it.addLine(o,!1),a}static addLine(t,e=!0){return t=it.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,n){let s=i[t];return typeof s!="number"&&(s=it._measureText(t,e,n)+e,i[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!it.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:it._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:it._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],o=t[n+1];if(it.isBreakingSpace(s,o)||it.isNewline(s)){i!==""&&(e.push(i),i=""),e.push(s);continue}i+=s}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,s){return!0}static wordWrapSplit(t){return it.graphemeSegmenter(t)}static measureFont(t){if(it._fonts[t])return it._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=it._canvas,n=it._context;n.font=t;const s=it.METRICS_STRING+it.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width);let a=Math.ceil(n.measureText(it.BASELINE_SYMBOL).width);const h=Math.ceil(it.HEIGHT_MULTIPLIER*a);if(a=a*it.BASELINE_MULTIPLIER|0,o===0||h===0)return it._fonts[t]=e,e;i.width=o,i.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);const l=n.getImageData(0,0,o,h).data,u=l.length,c=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let g=0;g<c;g+=4)if(l[f+g]!==255){p=!0;break}if(!p)f+=c;else break}for(e.ascent=a-d,f=u-c,p=!1,d=h;d>a;--d){for(let g=0;g<c;g+=4)if(l[f+g]!==255){p=!0;break}if(!p)f-=c;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,it._fonts[t]=e,e}static clearMetrics(t=""){t?delete it._fonts[t]:it._fonts={}}static get _canvas(){var t;if(!it.__canvas){let e;try{const i=new OffscreenCanvas(0,0);if((t=i.getContext("2d",Ls))!=null&&t.measureText)return it.__canvas=i,i;e=K.ADAPTER.createCanvas()}catch{e=K.ADAPTER.createCanvas()}e.width=e.height=10,it.__canvas=e}return it.__canvas}static get _context(){return it.__context||(it.__context=it._canvas.getContext("2d",Ls)),it.__context}};Xe.METRICS_STRING="|q",Xe.BASELINE_SYMBOL="M",Xe.BASELINE_MULTIPLIER=1.4,Xe.HEIGHT_MULTIPLIER=2,Xe.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),Xe.experimentalLetterSpacing=!1,Xe._fonts={},Xe._newlines=[10,13],Xe._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Rr=Xe;const Qb=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Tg=class Nn{constructor(t){this.styleID=0,this.reset(),rh(this,t,t)}clone(){const t={};return rh(t,this,Nn.defaultStyle),new Nn(t)}reset(){rh(this,Nn.defaultStyle,Nn.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=eh(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=eh(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){Jb(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=eh(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Qb.includes(n)&&(n=`"${n}"`),e[i]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Tg.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:na.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Gr=Tg;function eh(r){const t=Pt.shared,e=i=>{const n=t.setValue(i);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function Jb(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function rh(r,t,e){for(const i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}const tE={texture:!0,children:!1,baseTexture:!0},Sg=class cl extends an{constructor(t,e,i){let n=!1;i||(i=K.ADAPTER.createCanvas(),n=!0),i.width=3,i.height=3;const s=tt.from(i);s.orig=new gt,s.trim=new gt,super(s),this._ownCanvas=n,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=cl.defaultResolution??K.RESOLUTION,this._autoResolution=cl.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Rr.experimentalLetterSpacing}static set experimentalLetterSpacing(t){vt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Rr.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,n=Rr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,o=n.height,a=n.lines,h=n.lineHeight,l=n.lineWidths,u=n.maxLineWidth,c=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let g=0;g<p;++g){const m=e.dropShadow&&g===0,y=m?Math.ceil(Math.max(1,o)+e.padding*2):0,x=y*this._resolution;if(m){i.fillStyle="black",i.strokeStyle="black";const _=e.dropShadowColor,E=e.dropShadowBlur*this._resolution,N=e.dropShadowDistance*this._resolution;i.shadowColor=Pt.shared.setValue(_).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=E,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*N,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*N+x}else i.fillStyle=this._generateFillStyle(e,a,n),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let v=(h-c.fontSize)/2;h-c.fontSize<0&&(v=0);for(let _=0;_<a.length;_++)d=e.strokeThickness/2,f=e.strokeThickness/2+_*h+c.ascent+v,e.align==="right"?d+=u-l[_]:e.align==="center"&&(d+=(u-l[_])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[_],d+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[_],d+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,i,n=!1){const s=this._style.letterSpacing;let o=!1;if(Rr.experimentalLetterSpacingSupported&&(Rr.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){n?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e;const h=Rr.graphemeSegmenter(t);let l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){const d=h[c];n?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let f="";for(let p=c+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,a+=l-u+s,l=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=vx(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,i=this._style,n=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const n=t.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,u=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(n[0]),c.unshift(0),u.push(n[n.length-1]),c.push(1),t.fillGradientType===na.LINEAR_VERTICAL){s=this.context.createLinearGradient(h/2,a,h/2,l+a);const d=i.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=i.lineHeight*(f-1)+d,g=i.lineHeight*f;let m=g;f>0&&p>g&&(m=(g+p)/2);const y=g+d,x=i.lineHeight*(f+1);let v=y;f+1<e.length&&x<y&&(v=(y+x)/2);const _=(v-m)/l;for(let E=0;E<u.length;E++){let N=0;typeof c[E]=="number"?N=c[E]:N=E/u.length;let S=Math.min(1,Math.max(0,m/l+N*_));S=Number(S.toFixed(5)),s.addColorStop(S,u[E])}}}else{s=this.context.createLinearGradient(a,l/2,h+a,l/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let g;typeof c[p]=="number"?g=c[p]:g=f/d,s.addColorStop(g,u[p]),f++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},tE,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Dr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Dr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Gr?this._style=t:this._style=new Gr(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Sg.defaultAutoResolution=!0;let Ig=Sg;class eE{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function rE(r,t){var i;let e=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(let n=0;n<r._textures.length;n++)if(r._textures[n]instanceof tt){const s=r._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function iE(r,t){if(r.baseTexture instanceof dt){const e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function nE(r,t){if(r._texture&&r._texture instanceof tt){const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function sE(r,t){return t instanceof Ig?(t.updateText(!0),!0):!1}function oE(r,t){if(t instanceof Gr){const e=t.toFontString();return Rr.measureFont(e),!0}return!1}function aE(r,t){if(r instanceof Ig){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function hE(r,t){return r instanceof Gr?(t.includes(r)||t.push(r),!0):!1}const Cg=class Ng{constructor(t){this.limiter=new eE(Ng.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(aE),this.registerFindHook(hE),this.registerFindHook(rE),this.registerFindHook(iE),this.registerFindHook(nE),this.registerUploadHook(sE),this.registerUploadHook(oE)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,_e.system.addOnce(this.tick,this,ui.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)_e.system.addOnce(this.tick,this,ui.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ke)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&_e.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Cg.uploadsPerFrame=4;let dl=Cg;Object.defineProperties(K,{UPLOADS_PER_FRAME:{get(){return dl.uploadsPerFrame},set(r){vt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),dl.uploadsPerFrame=r}}});function Rg(r,t){return t instanceof dt?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function lE(r,t){if(!(t instanceof wg))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&Rg(r,s.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function uE(r,t){return r instanceof wg?(t.push(r),!0):!1}class Pg extends dl{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(uE),this.registerUploadHook(Rg),this.registerUploadHook(lE)}}Pg.extension={name:"prepare",type:W.RendererSystem};et.add(Pg);var cE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,dE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,fE=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,yd=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,pE=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Bs=new Mt;class Mg extends ea{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Bp,this.state=nr.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Je.from(yd,pE,e),this.shader=t.context.webGLVersion>1?Je.from(dE,cE,e):Je.from(yd,fE,e)}render(t){const e=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,i.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==Or.CLAMP:h.wrapMode===Or.CLAMP&&(h.wrapMode=Or.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,g=a.height,m=t._width,y=t._height;Bs.set(u.a*p/m,u.b*p/y,u.c*g/m,u.d*g/y,u.tx/m,u.ty/y),Bs.invert(),d?Bs.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=Bs.toArray(!0),f.uniforms.uColor=Pt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(i),this.state.blendMode=bp(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Mg.extension={name:"tilingSprite",type:W.RendererPlugin};et.add(Mg);const Dg=class Rn{constructor(t,e,i){this.linkedSheets=[],(t instanceof dt||t instanceof tt)&&(t={texture:t,data:e,resolutionFilename:i});const{texture:n,data:s,resolutionFilename:o=null,cachePrefix:a=""}=t;this.cachePrefix=a,this._texture=n instanceof tt?n:null,this.baseTexture=n instanceof dt?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=s;const h=this.baseTexture.resource;this.resolution=this._updateResolution(o||(h?h.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=xr(t,null);return i===null&&(i=typeof e=="number"?e:parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Rn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=Rn.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],o=s.frame;if(o){let a=null,h=null;const l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,u=new gt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?a=new gt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new gt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(h=new gt(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new tt(this.baseTexture,a,u,h,s.rotated?2:0,s.anchor,s.borders),tt.addToCache(this.textures[n],this.cachePrefix+n.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Rn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Rn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Dg.BATCH_SIZE=1e3;let _d=Dg;const gE=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Lg(r,t,e){const i={};if(r.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=te.dirname(r[0]);t.linkedSheets.forEach((s,o)=>{Object.assign(i,Lg([`${n}/${t.data.meta.related_multi_packs[o]}`],s,!0))})}return i}const mE={extension:W.Asset,cache:{test:r=>r instanceof _d,getCacheableAssets:(r,t)=>Lg(r,t,!1)},resolver:{test:r=>{const t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&gE.includes(i)},parse:r=>{var e;const t=r.split(".");return{resolution:parseFloat(((e=K.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:W.LoadParser,priority:Fe.Normal},async testParse(r,t){return te.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){var u,c;const{texture:i,imageFilename:n,cachePrefix:s}=(t==null?void 0:t.data)??{};let o=te.dirname(t.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let a;if(i&&i.baseTexture)a=i;else{const d=al(o+(n??r.meta.image),t.src);a=(await e.load([d]))[d]}const h=new _d({texture:a.baseTexture,data:r,resolutionFilename:t.src,cachePrefix:s});await h.parse();const l=(u=r==null?void 0:r.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(l)){const d=[];for(const p of l){if(typeof p!="string")continue;let g=o+p;(c=t.data)!=null&&c.ignoreMultiPack||(g=al(g,t.src),d.push(e.load({src:g,data:{ignoreMultiPack:!0}})))}const f=await Promise.all(d);h.linkedSheets=f,f.forEach(p=>{p.linkedSheets=[h].concat(h.linkedSheets.filter(g=>g!==p))})}return h},unload(r){r.destroy(!0)}}};et.add(mE);class No{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class eo{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const o=e[s].match(/^[a-z]+/gm)[0],a=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const u=a[l].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[c]=p}i[o].push(h)}const n=new No;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class fl{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new No,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<i.length;l++)e.info.push({face:i[l].getAttribute("face"),size:parseInt(i[l].getAttribute("size"),10)});for(let l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(let l=0;l<s.length;l++)e.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(let l=0;l<o.length;l++){const u=o[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}}class pl{static test(t){return typeof t=="string"&&t.includes("<font>")?fl.test(K.ADAPTER.parseXML(t)):!1}static parse(t){return fl.parse(K.ADAPTER.parseXML(t))}}const ih=[eo,fl,pl];function yE(r){for(let t=0;t<ih.length;t++)if(ih[t].test(r))return ih[t];return null}function _E(r,t,e,i,n,s){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=r.width/i-h-l*2,c=r.height/i-h-l*2,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let g=1;g<p;++g)f.push(g/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===na.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,c+l);let p=0;const g=(s.fontProperties.fontSize+e.strokeThickness)/c;for(let m=0;m<n.length;m++){const y=s.lineHeight*m;for(let x=0;x<d.length;x++){let v=0;typeof f[x]=="number"?v=f[x]:v=x/d.length;const _=y/c+v*g;let E=Math.max(p,_);E=Math.min(E,1),a.addColorStop(E,d[x]),p=E}}}else{a=t.createLinearGradient(l,c/2,u+l,c/2);const p=d.length+1;let g=1;for(let m=0;m<d.length;m++){let y;typeof f[m]=="number"?y=f[m]:y=g/p,a.addColorStop(y,d[m]),g++}}return a}function vE(r,t,e,i,n,s,o){const a=e.text,h=e.fontProperties;t.translate(i,n),t.scale(s,s);const l=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=_E(r,t,o,s,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const c=o.dropShadowColor,d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;t.shadowColor=Pt.shared.setValue(c).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),o.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function ro(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function Bg(r){return Array.from?Array.from(r):r.split("")}function xE(r){typeof r=="string"&&(r=[r]);const t=[];for(let e=0,i=r.length;e<i;e++){const n=r[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Bg(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Sr=class Ve{constructor(t,e,i){var u;const[n]=t.info,[s]=t.common,[o]=t.page,[a]=t.distanceField,h=xr(o.file),l={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/h,this.chars={},this.pageTextures=l;for(let c=0;c<t.page.length;c++){const{id:d,file:f}=t.page[c];l[d]=e instanceof Array?e[c]:e[f],a!=null&&a.fieldType&&a.fieldType!=="none"&&(l[d].baseTexture.alphaMode=fe.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=rr.OFF)}for(let c=0;c<t.char.length;c++){const{id:d,page:f}=t.char[c];let{x:p,y:g,width:m,height:y,xoffset:x,yoffset:v,xadvance:_}=t.char[c];p/=h,g/=h,m/=h,y/=h,x/=h,v/=h,_/=h;const E=new gt(p+l[f].frame.x/h,g+l[f].frame.y/h,m,y);this.chars[d]={xOffset:x,yOffset:v,xAdvance:_,kerning:{},texture:new tt(l[f].baseTexture,E),page:f}}for(let c=0;c<t.kerning.length;c++){let{first:d,second:f,amount:p}=t.kerning[c];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let n;if(t instanceof No)n=t;else{const o=yE(t);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(t)}e instanceof tt&&(e=[e]);const s=new Ve(n,e,i);return Ve.available[s.font]=s,s}static uninstall(t){const e=Ve.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Ve.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},Ve.defaultOptions,i),u=xE(n),c=e instanceof Gr?e:new Gr(e),d=a,f=new No;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,g=0,m,y,x,v=0;const _=[];for(let N=0;N<u.length;N++){m||(m=K.ADAPTER.createCanvas(),m.width=a,m.height=h,y=m.getContext("2d"),x=new dt(m,{resolution:o,...l}),_.push(new tt(x)),f.page.push({id:_.length-1,file:""}));const S=u[N],T=Rr.measureText(S,c,!1,m),D=T.width,B=Math.ceil(T.height),k=Math.ceil((c.fontStyle==="italic"?2:1)*D);if(g>=h-B*o){if(g===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${S}')`);--N,m=null,y=null,x=null,g=0,p=0,v=0;continue}if(v=Math.max(B+T.fontProperties.descent,v),k*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${S}')`);--N,g+=v*o,g=Math.ceil(g),p=0,v=0;continue}vE(m,y,T,p,g,o,c);const M=ro(T.text);f.char.push({id:M,page:_.length-1,x:p/o,y:g/o,width:k,height:B,xoffset:0,yoffset:0,xadvance:D-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(k+2*s)*o,p=Math.ceil(p)}if(!(i!=null&&i.skipKerning))for(let N=0,S=u.length;N<S;N++){const T=u[N];for(let D=0;D<S;D++){const B=u[D],k=y.measureText(T).width,M=y.measureText(B).width,A=y.measureText(T+B).width-(k+M);A&&f.kerning.push({first:ro(T),second:ro(B),amount:A})}}const E=new Ve(f,_,!0);return Ve.available[t]!==void 0&&Ve.uninstall(t),Ve.available[t]=E,E}};Sr.ALPHA=[["a","z"],["A","Z"]," "],Sr.NUMERIC=[["0","9"]],Sr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Sr.ASCII=[[" ","~"]],Sr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Sr.ALPHANUMERIC},Sr.available={};let Ir=Sr;var wE=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,bE=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const vd=[],xd=[],wd=[],EE=class kg extends ke{constructor(t,e={}){super();const{align:i,tint:n,maxWidth:s,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},kg.styleDefaults,e);if(!Ir.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Pt(n),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new pr(()=>{this.dirty=!0},this,0,0),this._roundPixels=K.ROUND_PIXELS,this.dirty=!0,this._resolution=K.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var k;const t=Ir.available[this._fontName],e=this.fontSize,i=e/t.size,n=new bt,s=[],o=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Bg(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?vd:xd;let d=null,f=0,p=0,g=0,m=-1,y=0,x=0,v=0,_=0;for(let M=0;M<l.length;M++){const A=l[M],w=ro(A);if(/(?:\s)/.test(A)&&(m=M,y=f,_++),A==="\r"||A===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++g,++x,n.x=0,n.y+=t.lineHeight,d=null,_=0;continue}const C=t.chars[w];if(!C)continue;d&&C.kerning[d]&&(n.x+=C.kerning[d]);const I=wd.pop()||{texture:tt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new bt};I.texture=C.texture,I.line=g,I.charCode=w,I.position.x=Math.round(n.x+C.xOffset+this._letterSpacing/2),I.position.y=Math.round(n.y+C.yOffset),I.prevSpaces=_,s.push(I),f=I.position.x+Math.max(C.xAdvance-C.xOffset,C.texture.orig.width),n.x+=C.xAdvance+this._letterSpacing,v=Math.max(v,C.yOffset+C.texture.height),d=w,m!==-1&&u>0&&n.x>u&&(++x,$i(s,1+m-x,1+M-m),M=m,m=-1,o.push(y),a.push(s.length>0?s[s.length-1].prevSpaces:0),p=Math.max(p,y),g++,n.x=0,n.y+=t.lineHeight,d=null,_=0)}const E=l[l.length-1];E!=="\r"&&E!==`
`&&(/(?:\s)/.test(E)&&(f=y),o.push(f),p=Math.max(p,f),a.push(-1));const N=[];for(let M=0;M<=g;M++){let A=0;this._align==="right"?A=p-o[M]:this._align==="center"?A=(p-o[M])/2:this._align==="justify"&&(A=a[M]<0?0:(p-o[M])/a[M]),N.push(A)}const S=s.length,T={},D=[],B=this._activePagesMeshData;c.push(...B);for(let M=0;M<S;M++){const A=s[M].texture,w=A.baseTexture.uid;if(!T[w]){let C=c.pop();if(!C){const R=new jb;let O,z;t.distanceFieldType==="none"?(O=new gd(tt.EMPTY),z=at.NORMAL):(O=new gd(tt.EMPTY,{program:gr.from(bE,wE),uniforms:{uFWidth:0}}),z=at.NORMAL_NPM);const P=new pd(R,O);P.blendMode=z,C={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:P,vertices:null,uvs:null,indices:null}}C.index=0,C.indexCount=0,C.vertexCount=0,C.uvsCount=0,C.total=0;const{_textureCache:I}=this;I[w]=I[w]||new tt(A.baseTexture),C.mesh.texture=I[w],C.mesh.tint=this._tintColor.value,D.push(C),T[w]=C}T[w].total++}for(let M=0;M<B.length;M++)D.includes(B[M])||this.removeChild(B[M].mesh);for(let M=0;M<D.length;M++)D[M].mesh.parent!==this&&this.addChild(D[M].mesh);this._activePagesMeshData=D;for(const M in T){const A=T[M],w=A.total;if(!(((k=A.indices)==null?void 0:k.length)>6*w)||A.vertices.length<pd.BATCHABLE_SIZE*2)A.vertices=new Float32Array(4*2*w),A.uvs=new Float32Array(4*2*w),A.indices=new Uint16Array(6*w);else{const C=A.total,I=A.vertices;for(let R=C*4*2;R<I.length;R++)I[R]=0}A.mesh.size=6*w}for(let M=0;M<S;M++){const A=s[M];let w=A.position.x+N[A.line]*(this._align==="justify"?A.prevSpaces:1);this._roundPixels&&(w=Math.round(w));const C=w*i,I=A.position.y*i,R=A.texture,O=T[R.baseTexture.uid],z=R.frame,P=R._uvs,F=O.index++;O.indices[F*6+0]=0+F*4,O.indices[F*6+1]=1+F*4,O.indices[F*6+2]=2+F*4,O.indices[F*6+3]=0+F*4,O.indices[F*6+4]=2+F*4,O.indices[F*6+5]=3+F*4,O.vertices[F*8+0]=C,O.vertices[F*8+1]=I,O.vertices[F*8+2]=C+z.width*i,O.vertices[F*8+3]=I,O.vertices[F*8+4]=C+z.width*i,O.vertices[F*8+5]=I+z.height*i,O.vertices[F*8+6]=C,O.vertices[F*8+7]=I+z.height*i,O.uvs[F*8+0]=P.x0,O.uvs[F*8+1]=P.y0,O.uvs[F*8+2]=P.x1,O.uvs[F*8+3]=P.y1,O.uvs[F*8+4]=P.x2,O.uvs[F*8+5]=P.y2,O.uvs[F*8+6]=P.x3,O.uvs[F*8+7]=P.y3}this._textWidth=p*i,this._textHeight=(n.y+t.lineHeight)*i;for(const M in T){const A=T[M];if(this.anchor.x!==0||this.anchor.y!==0){let R=0;const O=this._textWidth*this.anchor.x,z=this._textHeight*this.anchor.y;for(let P=0;P<A.total;P++)A.vertices[R++]-=O,A.vertices[R++]-=z,A.vertices[R++]-=O,A.vertices[R++]-=z,A.vertices[R++]-=O,A.vertices[R++]-=z,A.vertices[R++]-=O,A.vertices[R++]-=z}this._maxLineHeight=v*i;const w=A.mesh.geometry.getBuffer("aVertexPosition"),C=A.mesh.geometry.getBuffer("aTextureCoord"),I=A.mesh.geometry.getIndex();w.data=A.vertices,C.data=A.uvs,I.data=A.indices,w.update(),C.update(),I.update()}for(let M=0;M<s.length;M++)wd.push(s[M]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:n}=Ir.available[this._fontName];if(i!=="none"){const{a:s,b:o,c:a,d:h}=this.worldTransform,l=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/n,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Ir.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Ir.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Ir.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i=Ir.available[this._fontName].distanceFieldType==="none"?vd:xd;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=tt.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};EE.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const AE=[".xml",".fnt"],TE={extension:{type:W.LoadParser,priority:Fe.Normal},name:"loadBitmapFont",test(r){return AE.includes(te.extname(r).toLowerCase())},async testParse(r){return eo.test(r)||pl.test(r)},async parse(r,t,e){const i=eo.test(r)?eo.parse(r):pl.parse(r),{src:n}=t,{page:s}=i,o=[];for(let l=0;l<s.length;++l){const u=s[l].file;let c=te.join(te.dirname(n),u);c=al(c,n),o.push(c)}const a=await e.load(o),h=o.map(l=>a[l]);return Ir.install(i,h,!0)},async load(r,t){return(await K.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};et.add(TE);const gl=class Di extends Gr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Di(Object.keys(Di.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Di.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=Di;if(i[t]){const n=i[t];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return K.ADAPTER.fetch(t).then(n=>n.blob()).then(async n=>new Promise((s,o)=>{const a=URL.createObjectURL(n),h=new FileReader;h.onload=()=>s([a,h.result]),h.onerror=o,h.readAsDataURL(n)})).then(async([n,s])=>{const o=Object.assign({family:te.basename(t,te.extname(t)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);i[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=fx(t)),typeof t=="number"?dx(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const s=`${i}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,Di.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=K.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};gl.availableFonts={},gl.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let nh=gl;const ks=class Li extends an{constructor(t="",e={}){super(tt.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,n=tt.from(i,{scaleMode:K.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new gt,n.trim=new gt,this.texture=n;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(s,"svg"),h=document.createElementNS(s,"foreignObject"),l=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=Li.defaultMaxWidth,this.maxHeight=Li.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=Li.defaultAutoResolution,this._resolution=Li.defaultResolution??K.RESOLUTION,this.text=t,this.style=e}measureText(t){var u,c;const{text:e,style:i,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(n)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:a}=s;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const h=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(u=this._style)==null?void 0:u.toCSS(n)}),this._styleElement.textContent=(c=this._style)==null?void 0:c.toGlobalCSS()),{width:h+i.padding*2,height:l+i.padding*2}}async updateText(t=!0){const{style:e,_image:i,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:o}=this.measureText();i.width=n.width=Math.ceil(Math.max(1,s)),i.height=n.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(h=>{n.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),i.src=n.src,n.onload=null,n.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:n}=this,{padding:s}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=i.width/n,e.trim.height=e._frame.height=i.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var i,n,s,o,a;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Li.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=e,(n=this._svgRoot)==null||n.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Dr(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Dr(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof nh?(this.ownsStyle=!1,this._style=t):t instanceof Gr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=nh.from(t)):(this.ownsStyle=!0,this._style=new nh(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};ks.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},ks.defaultMaxWidth=2024,ks.defaultMaxHeight=2024,ks.defaultAutoResolution=!0;/*!
 * @pixi/constants - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var bd;(function(r){r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2"})(bd||(bd={}));var Ed;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS"})(Ed||(Ed={}));var Ad;(function(r){r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL"})(Ad||(Ad={}));var Td;(function(r){r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR"})(Td||(Td={}));var Sd;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Sd||(Sd={}));var Id;(function(r){r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(Id||(Id={}));var Cd;(function(r){r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(Cd||(Cd={}));var Nd;(function(r){r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT"})(Nd||(Nd={}));var Rd;(function(r){r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT"})(Rd||(Rd={}));var ml;(function(r){r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR"})(ml||(ml={}));var yl;(function(r){r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(yl||(yl={}));var _l;(function(r){r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL"})(_l||(_l={}));var Pd;(function(r){r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(Pd||(Pd={}));var Md;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT"})(Md||(Md={}));var vl;(function(r){r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL"})(vl||(vl={}));var $n;(function(r){r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp"})($n||($n={}));var Dd;(function(r){r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR"})(Dd||(Dd={}));var Ld;(function(r){r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA"})(Ld||(Ld={}));var xl;(function(r){r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH"})(xl||(xl={}));var Bd;(function(r){r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(Bd||(Bd={}));/*!
 * @pixi/settings - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var SE={createCanvas:function(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var r;return(r=document.baseURI)!==null&&r!==void 0?r:window.location.href},fetch:function(r,t){return fetch(r,t)}},sh=/iPhone/i,kd=/iPod/i,Fd=/iPad/i,Od=/\biOS-universal(?:.+)Mac\b/i,oh=/\bAndroid(?:.+)Mobile\b/i,Ud=/Android/i,Ti=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Fs=/Silk/i,hr=/Windows Phone/i,Gd=/\bWindows(?:.+)ARM\b/i,$d=/BlackBerry/i,Hd=/BB10/i,zd=/Opera Mini/i,Xd=/\b(CriOS|Chrome)(?:.+)Mobile/i,Vd=/Mobile(?:.+)Firefox\b/i,Wd=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function IE(r){return function(t){return t.test(r)}}function CE(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=IE(e),s={apple:{phone:n(sh)&&!n(hr),ipod:n(kd),tablet:!n(sh)&&(n(Fd)||Wd(t))&&!n(hr),universal:n(Od),device:(n(sh)||n(kd)||n(Fd)||n(Od)||Wd(t))&&!n(hr)},amazon:{phone:n(Ti),tablet:!n(Ti)&&n(Fs),device:n(Ti)||n(Fs)},android:{phone:!n(hr)&&n(Ti)||!n(hr)&&n(oh),tablet:!n(hr)&&!n(Ti)&&!n(oh)&&(n(Fs)||n(Ud)),device:!n(hr)&&(n(Ti)||n(Fs)||n(oh)||n(Ud))||n(/\bokhttp\b/i)},windows:{phone:n(hr),tablet:n(Gd),device:n(hr)||n(Gd)},other:{blackberry:n($d),blackberry10:n(Hd),opera:n(zd),firefox:n(Vd),chrome:n(Xd),device:n($d)||n(Hd)||n(zd)||n(Vd)||n(Xd)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var Fi=CE(globalThis.navigator);function NE(){return!Fi.apple.device}function RE(r){var t=!0;if(Fi.tablet||Fi.phone){if(Fi.apple.device){var e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(e){var i=parseInt(e[1],10);i<11&&(t=!1)}}if(Fi.android.device){var e=navigator.userAgent.match(/Android\s([0-9.]*)/);if(e){var i=parseInt(e[1],10);i<7&&(t=!1)}}}return t?r:4}var Pn={ADAPTER:SE,MIPMAP_TEXTURES:_l.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:xl.NONE,SPRITE_MAX_TEXTURES:RE(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:vl.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:yl.CLAMP,SCALE_MODE:ml.LINEAR,PRECISION_VERTEX:$n.HIGH,PRECISION_FRAGMENT:Fi.apple.device?$n.HIGH:$n.MEDIUM,CAN_UPLOAD_SAME_BUFFER:NE(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};/*!
 * @pixi/extensions - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wl;(function(r){r.Application="application",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Loader="loader",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser"})(wl||(wl={}));/*!
 * @pixi/ticker - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Pn.TARGET_FPMS=.06;var jn;(function(r){r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY"})(jn||(jn={}));var ah=function(){function r(t,e,i,n){e===void 0&&(e=null),i===void 0&&(i=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}return r.prototype.match=function(t,e){return e===void 0&&(e=null),this.fn===t&&this.context===e},r.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},r.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},r.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},r}(),bl=function(){function r(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ah(null,null,1/0),this.deltaMS=1/Pn.TARGET_FPMS,this.elapsedMS=1/Pn.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return r.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},r.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},r.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},r.prototype.add=function(t,e,i){return i===void 0&&(i=jn.NORMAL),this._addListener(new ah(t,e,i))},r.prototype.addOnce=function(t,e,i){return i===void 0&&(i=jn.NORMAL),this._addListener(new ah(t,e,i,!0))},r.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this},r.prototype.remove=function(t,e){for(var i=this._head.next;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(r.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),r.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},r.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},r.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},r.prototype.update=function(t){t===void 0&&(t=performance.now());var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Pn.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(r.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Pn.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(r,"shared",{get:function(){if(!r._shared){var t=r._shared=new r;t.autoStart=!0,t._protected=!0}return r._shared},enumerable:!1,configurable:!0}),Object.defineProperty(r,"system",{get:function(){if(!r._system){var t=r._system=new r;t.autoStart=!0,t._protected=!0}return r._system},enumerable:!1,configurable:!0}),r}();(function(){function r(){}return r.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,jn.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?bl.shared:new bl,t.autoStart&&this.start()},r.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},r.extension=wl.Application,r})();var PE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ME(r,t,e){return e={path:t,exports:{},require:function(i,n){return DE(i,n??e.path)}},r(e,e.exports),e.exports}function DE(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}ME(function(r,t){(function(){var e,i;i=function(n){return r.exports=n},e={linear:function(n,s,o,a){return o*n/a+s},easeInQuad:function(n,s,o,a){return o*(n/=a)*n+s},easeOutQuad:function(n,s,o,a){return-o*(n/=a)*(n-2)+s},easeInOutQuad:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n+s:-o/2*(--n*(n-2)-1)+s},easeInCubic:function(n,s,o,a){return o*(n/=a)*n*n+s},easeOutCubic:function(n,s,o,a){return o*((n=n/a-1)*n*n+1)+s},easeInOutCubic:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n+s:o/2*((n-=2)*n*n+2)+s},easeInQuart:function(n,s,o,a){return o*(n/=a)*n*n*n+s},easeOutQuart:function(n,s,o,a){return-o*((n=n/a-1)*n*n*n-1)+s},easeInOutQuart:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n*n+s:-o/2*((n-=2)*n*n*n-2)+s},easeInQuint:function(n,s,o,a){return o*(n/=a)*n*n*n*n+s},easeOutQuint:function(n,s,o,a){return o*((n=n/a-1)*n*n*n*n+1)+s},easeInOutQuint:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n*n*n+s:o/2*((n-=2)*n*n*n*n+2)+s},easeInSine:function(n,s,o,a){return-o*Math.cos(n/a*(Math.PI/2))+o+s},easeOutSine:function(n,s,o,a){return o*Math.sin(n/a*(Math.PI/2))+s},easeInOutSine:function(n,s,o,a){return-o/2*(Math.cos(Math.PI*n/a)-1)+s},easeInExpo:function(n,s,o,a){return n===0?s:o*Math.pow(2,10*(n/a-1))+s},easeOutExpo:function(n,s,o,a){return n===a?s+o:o*(-Math.pow(2,-10*n/a)+1)+s},easeInOutExpo:function(n,s,o,a){return(n/=a/2)<1?o/2*Math.pow(2,10*(n-1))+s:o/2*(-Math.pow(2,-10*--n)+2)+s},easeInCirc:function(n,s,o,a){return-o*(Math.sqrt(1-(n/=a)*n)-1)+s},easeOutCirc:function(n,s,o,a){return o*Math.sqrt(1-(n=n/a-1)*n)+s},easeInOutCirc:function(n,s,o,a){return(n/=a/2)<1?-o/2*(Math.sqrt(1-n*n)-1)+s:o/2*(Math.sqrt(1-(n-=2)*n)+1)+s},easeInElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),-(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+s},easeOutElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),h*Math.pow(2,-10*n)*Math.sin((n*a-u)*(2*Math.PI)/l)+o+s},easeInOutElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a/2),l||(l=a*(.3*1.5)),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),n<1?-.5*(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+s:h*Math.pow(2,-10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l)*.5+o+s},easeInBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),o*(n/=a)*n*((h+1)*n-h)+s},easeOutBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),o*((n=n/a-1)*n*((h+1)*n+h)+1)+s},easeInOutBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),(n/=a/2)<1?o/2*(n*n*(((h*=1.525)+1)*n-h))+s:o/2*((n-=2)*n*(((h*=1.525)+1)*n+h)+2)+s},easeInBounce:function(n,s,o,a){var h;return h=e.easeOutBounce(a-n,0,o,a),o-h+s},easeOutBounce:function(n,s,o,a){return(n/=a)<1/2.75?o*(7.5625*n*n)+s:n<2/2.75?o*(7.5625*(n-=1.5/2.75)*n+.75)+s:n<2.5/2.75?o*(7.5625*(n-=2.25/2.75)*n+.9375)+s:o*(7.5625*(n-=2.625/2.75)*n+.984375)+s},easeInOutBounce:function(n,s,o,a){var h;return n<a/2?(h=e.easeInBounce(n*2,0,o,a),h*.5+s):(h=e.easeOutBounce(n*2-a,0,o,a),h*.5+o*.5+s)}},i(e)}).call(PE)});window.innerWidth,window.innerHeight,bl.shared;function _r(r,t){return r==null||t==null?NaN:r<t?-1:r>t?1:r>=t?0:NaN}function LE(r,t){return r==null||t==null?NaN:t<r?-1:t>r?1:t>=r?0:NaN}function Fg(r){let t,e,i;r.length!==2?(t=_r,e=(a,h)=>_r(r(a),h),i=(a,h)=>r(a)-h):(t=r===_r||r===LE?r:BE,e=r,i=r);function n(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<0?l=c+1:u=c}while(l<u)}return l}function s(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<=0?l=c+1:u=c}while(l<u)}return l}function o(a,h,l=0,u=a.length){const c=n(a,h,l,u-1);return c>l&&i(a[c-1],h)>-i(a[c],h)?c-1:c}return{left:n,center:o,right:s}}function BE(){return 0}function kE(r){return r===null?NaN:+r}const FE=Fg(_r),OE=FE.right;Fg(kE).center;const UE=OE;function hh(r,t){let e,i;if(t===void 0)for(const n of r)n!=null&&(e===void 0?n>=n&&(e=i=n):(e>n&&(e=n),i<n&&(i=n)));else{let n=-1;for(let s of r)(s=t(s,++n,r))!=null&&(e===void 0?s>=s&&(e=i=s):(e>s&&(e=s),i<s&&(i=s)))}return[e,i]}class El extends Map{constructor(t,e=HE){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[i,n]of t)this.set(i,n)}get(t){return super.get(jd(this,t))}has(t){return super.has(jd(this,t))}set(t,e){return super.set(GE(this,t),e)}delete(t){return super.delete($E(this,t))}}function jd({_intern:r,_key:t},e){const i=t(e);return r.has(i)?r.get(i):e}function GE({_intern:r,_key:t},e){const i=t(e);return r.has(i)?r.get(i):(r.set(i,e),e)}function $E({_intern:r,_key:t},e){const i=t(e);return r.has(i)&&(e=r.get(i),r.delete(i)),e}function HE(r){return r!==null&&typeof r=="object"?r.valueOf():r}function Al(r){return r}function zE(r,...t){return Og(r,Al,Al,t)}function XE(r,t,...e){return Og(r,Al,t,e)}function Og(r,t,e,i){return function n(s,o){if(o>=i.length)return e(s);const a=new El,h=i[o++];let l=-1;for(const u of s){const c=h(u,++l,s),d=a.get(c);d?d.push(u):a.set(c,[u])}for(const[u,c]of a)a.set(u,n(c,o));return t(a)}(r,0)}const VE=Math.sqrt(50),WE=Math.sqrt(10),jE=Math.sqrt(2);function Ro(r,t,e){const i=(t-r)/Math.max(0,e),n=Math.floor(Math.log10(i)),s=i/Math.pow(10,n),o=s>=VE?10:s>=WE?5:s>=jE?2:1;let a,h,l;return n<0?(l=Math.pow(10,-n)/o,a=Math.round(r*l),h=Math.round(t*l),a/l<r&&++a,h/l>t&&--h,l=-l):(l=Math.pow(10,n)*o,a=Math.round(r/l),h=Math.round(t/l),a*l<r&&++a,h*l>t&&--h),h<a&&.5<=e&&e<2?Ro(r,t,e*2):[a,h,l]}function YE(r,t,e){if(t=+t,r=+r,e=+e,!(e>0))return[];if(r===t)return[r];const i=t<r,[n,s,o]=i?Ro(t,r,e):Ro(r,t,e);if(!(s>=n))return[];const a=s-n+1,h=new Array(a);if(i)if(o<0)for(let l=0;l<a;++l)h[l]=(s-l)/-o;else for(let l=0;l<a;++l)h[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)h[l]=(n+l)/-o;else for(let l=0;l<a;++l)h[l]=(n+l)*o;return h}function Tl(r,t,e){return t=+t,r=+r,e=+e,Ro(r,t,e)[2]}function qE(r,t,e){t=+t,r=+r,e=+e;const i=t<r,n=i?Tl(t,r,e):Tl(r,t,e);return(i?-1:1)*(n<0?1/-n:n)}function vn(r,t){let e;if(t===void 0)for(const i of r)i!=null&&(e<i||e===void 0&&i>=i)&&(e=i);else{let i=-1;for(let n of r)(n=t(n,++i,r))!=null&&(e<n||e===void 0&&n>=n)&&(e=n)}return e}function Ug(r,t){let e=0;if(t===void 0)for(let i of r)(i=+i)&&(e+=i);else{let i=-1;for(let n of r)(n=+t(n,++i,r))&&(e+=n)}return e}var KE={value:()=>{}};function ss(){for(var r=0,t=arguments.length,e={},i;r<t;++r){if(!(i=arguments[r]+"")||i in e||/[\s.]/.test(i))throw new Error("illegal type: "+i);e[i]=[]}return new io(e)}function io(r){this._=r}function ZE(r,t){return r.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:i}})}io.prototype=ss.prototype={constructor:io,on:function(r,t){var e=this._,i=ZE(r+"",e),n,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(r=i[s]).type)&&(n=QE(e[n],r.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(r=i[s]).type)e[n]=Yd(e[n],r.name,t);else if(t==null)for(n in e)e[n]=Yd(e[n],r.name,null);return this},copy:function(){var r={},t=this._;for(var e in t)r[e]=t[e].slice();return new io(r)},call:function(r,t){if((n=arguments.length-2)>0)for(var e=new Array(n),i=0,n,s;i<n;++i)e[i]=arguments[i+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(s=this._[r],i=0,n=s.length;i<n;++i)s[i].value.apply(t,e)},apply:function(r,t,e){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var i=this._[r],n=0,s=i.length;n<s;++n)i[n].value.apply(t,e)}};function QE(r,t){for(var e=0,i=r.length,n;e<i;++e)if((n=r[e]).name===t)return n.value}function Yd(r,t,e){for(var i=0,n=r.length;i<n;++i)if(r[i].name===t){r[i]=KE,r=r.slice(0,i).concat(r.slice(i+1));break}return e!=null&&r.push({name:t,value:e}),r}var Sl="http://www.w3.org/1999/xhtml";const qd={svg:"http://www.w3.org/2000/svg",xhtml:Sl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function sa(r){var t=r+="",e=t.indexOf(":");return e>=0&&(t=r.slice(0,e))!=="xmlns"&&(r=r.slice(e+1)),qd.hasOwnProperty(t)?{space:qd[t],local:r}:r}function JE(r){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Sl&&t.documentElement.namespaceURI===Sl?t.createElement(r):t.createElementNS(e,r)}}function tA(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Gg(r){var t=sa(r);return(t.local?tA:JE)(t)}function eA(){}function ou(r){return r==null?eA:function(){return this.querySelector(r)}}function rA(r){typeof r!="function"&&(r=ou(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=new Array(o),h,l,u=0;u<o;++u)(h=s[u])&&(l=r.call(h,h.__data__,u,s))&&("__data__"in h&&(l.__data__=h.__data__),a[u]=l);return new ce(i,this._parents)}function $g(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function iA(){return[]}function Hg(r){return r==null?iA:function(){return this.querySelectorAll(r)}}function nA(r){return function(){return $g(r.apply(this,arguments))}}function sA(r){typeof r=="function"?r=nA(r):r=Hg(r);for(var t=this._groups,e=t.length,i=[],n=[],s=0;s<e;++s)for(var o=t[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&(i.push(r.call(h,h.__data__,l,o)),n.push(h));return new ce(i,n)}function zg(r){return function(){return this.matches(r)}}function Xg(r){return function(t){return t.matches(r)}}var oA=Array.prototype.find;function aA(r){return function(){return oA.call(this.children,r)}}function hA(){return this.firstElementChild}function lA(r){return this.select(r==null?hA:aA(typeof r=="function"?r:Xg(r)))}var uA=Array.prototype.filter;function cA(){return Array.from(this.children)}function dA(r){return function(){return uA.call(this.children,r)}}function fA(r){return this.selectAll(r==null?cA:dA(typeof r=="function"?r:Xg(r)))}function pA(r){typeof r!="function"&&(r=zg(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=[],h,l=0;l<o;++l)(h=s[l])&&r.call(h,h.__data__,l,s)&&a.push(h);return new ce(i,this._parents)}function Vg(r){return new Array(r.length)}function gA(){return new ce(this._enter||this._groups.map(Vg),this._parents)}function Po(r,t){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=t}Po.prototype={constructor:Po,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,t){return this._parent.insertBefore(r,t)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function mA(r){return function(){return r}}function yA(r,t,e,i,n,s){for(var o=0,a,h=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):e[o]=new Po(r,s[o]);for(;o<h;++o)(a=t[o])&&(n[o]=a)}function _A(r,t,e,i,n,s,o){var a,h,l=new Map,u=t.length,c=s.length,d=new Array(u),f;for(a=0;a<u;++a)(h=t[a])&&(d[a]=f=o.call(h,h.__data__,a,t)+"",l.has(f)?n[a]=h:l.set(f,h));for(a=0;a<c;++a)f=o.call(r,s[a],a,s)+"",(h=l.get(f))?(i[a]=h,h.__data__=s[a],l.delete(f)):e[a]=new Po(r,s[a]);for(a=0;a<u;++a)(h=t[a])&&l.get(d[a])===h&&(n[a]=h)}function vA(r){return r.__data__}function xA(r,t){if(!arguments.length)return Array.from(this,vA);var e=t?_A:yA,i=this._parents,n=this._groups;typeof r!="function"&&(r=mA(r));for(var s=n.length,o=new Array(s),a=new Array(s),h=new Array(s),l=0;l<s;++l){var u=i[l],c=n[l],d=c.length,f=wA(r.call(u,u&&u.__data__,l,i)),p=f.length,g=a[l]=new Array(p),m=o[l]=new Array(p),y=h[l]=new Array(d);e(u,c,g,m,y,f,t);for(var x=0,v=0,_,E;x<p;++x)if(_=g[x]){for(x>=v&&(v=x+1);!(E=m[v])&&++v<p;);_._next=E||null}}return o=new ce(o,i),o._enter=a,o._exit=h,o}function wA(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function bA(){return new ce(this._exit||this._groups.map(Vg),this._parents)}function EA(r,t,e){var i=this.enter(),n=this,s=this.exit();return typeof r=="function"?(i=r(i),i&&(i=i.selection())):i=i.append(r+""),t!=null&&(n=t(n),n&&(n=n.selection())),e==null?s.remove():e(s),i&&n?i.merge(n).order():n}function AA(r){for(var t=r.selection?r.selection():r,e=this._groups,i=t._groups,n=e.length,s=i.length,o=Math.min(n,s),a=new Array(n),h=0;h<o;++h)for(var l=e[h],u=i[h],c=l.length,d=a[h]=new Array(c),f,p=0;p<c;++p)(f=l[p]||u[p])&&(d[p]=f);for(;h<n;++h)a[h]=e[h];return new ce(a,this._parents)}function TA(){for(var r=this._groups,t=-1,e=r.length;++t<e;)for(var i=r[t],n=i.length-1,s=i[n],o;--n>=0;)(o=i[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function SA(r){r||(r=IA);function t(c,d){return c&&d?r(c.__data__,d.__data__):!c-!d}for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s){for(var o=e[s],a=o.length,h=n[s]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(h[u]=l);h.sort(t)}return new ce(n,this._parents).order()}function IA(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function CA(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function NA(){return Array.from(this)}function RA(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var i=r[t],n=0,s=i.length;n<s;++n){var o=i[n];if(o)return o}return null}function PA(){let r=0;for(const t of this)++r;return r}function MA(){return!this.node()}function DA(r){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],s=0,o=n.length,a;s<o;++s)(a=n[s])&&r.call(a,a.__data__,s,n);return this}function LA(r){return function(){this.removeAttribute(r)}}function BA(r){return function(){this.removeAttributeNS(r.space,r.local)}}function kA(r,t){return function(){this.setAttribute(r,t)}}function FA(r,t){return function(){this.setAttributeNS(r.space,r.local,t)}}function OA(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(r):this.setAttribute(r,e)}}function UA(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,e)}}function GA(r,t){var e=sa(r);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((t==null?e.local?BA:LA:typeof t=="function"?e.local?UA:OA:e.local?FA:kA)(e,t))}function Wg(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function $A(r){return function(){this.style.removeProperty(r)}}function HA(r,t,e){return function(){this.style.setProperty(r,t,e)}}function zA(r,t,e){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(r):this.style.setProperty(r,i,e)}}function XA(r,t,e){return arguments.length>1?this.each((t==null?$A:typeof t=="function"?zA:HA)(r,t,e??"")):tn(this.node(),r)}function tn(r,t){return r.style.getPropertyValue(t)||Wg(r).getComputedStyle(r,null).getPropertyValue(t)}function VA(r){return function(){delete this[r]}}function WA(r,t){return function(){this[r]=t}}function jA(r,t){return function(){var e=t.apply(this,arguments);e==null?delete this[r]:this[r]=e}}function YA(r,t){return arguments.length>1?this.each((t==null?VA:typeof t=="function"?jA:WA)(r,t)):this.node()[r]}function jg(r){return r.trim().split(/^|\s+/)}function au(r){return r.classList||new Yg(r)}function Yg(r){this._node=r,this._names=jg(r.getAttribute("class")||"")}Yg.prototype={add:function(r){var t=this._names.indexOf(r);t<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var t=this._names.indexOf(r);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function qg(r,t){for(var e=au(r),i=-1,n=t.length;++i<n;)e.add(t[i])}function Kg(r,t){for(var e=au(r),i=-1,n=t.length;++i<n;)e.remove(t[i])}function qA(r){return function(){qg(this,r)}}function KA(r){return function(){Kg(this,r)}}function ZA(r,t){return function(){(t.apply(this,arguments)?qg:Kg)(this,r)}}function QA(r,t){var e=jg(r+"");if(arguments.length<2){for(var i=au(this.node()),n=-1,s=e.length;++n<s;)if(!i.contains(e[n]))return!1;return!0}return this.each((typeof t=="function"?ZA:t?qA:KA)(e,t))}function JA(){this.textContent=""}function tT(r){return function(){this.textContent=r}}function eT(r){return function(){var t=r.apply(this,arguments);this.textContent=t??""}}function rT(r){return arguments.length?this.each(r==null?JA:(typeof r=="function"?eT:tT)(r)):this.node().textContent}function iT(){this.innerHTML=""}function nT(r){return function(){this.innerHTML=r}}function sT(r){return function(){var t=r.apply(this,arguments);this.innerHTML=t??""}}function oT(r){return arguments.length?this.each(r==null?iT:(typeof r=="function"?sT:nT)(r)):this.node().innerHTML}function aT(){this.nextSibling&&this.parentNode.appendChild(this)}function hT(){return this.each(aT)}function lT(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uT(){return this.each(lT)}function cT(r){var t=typeof r=="function"?r:Gg(r);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function dT(){return null}function fT(r,t){var e=typeof r=="function"?r:Gg(r),i=t==null?dT:typeof t=="function"?t:ou(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})}function pT(){var r=this.parentNode;r&&r.removeChild(this)}function gT(){return this.each(pT)}function mT(){var r=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function yT(){var r=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function _T(r){return this.select(r?yT:mT)}function vT(r){return arguments.length?this.property("__data__",r):this.node().__data__}function xT(r){return function(t){r.call(this,t,this.__data__)}}function wT(r){return r.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}function bT(r){return function(){var t=this.__on;if(t){for(var e=0,i=-1,n=t.length,s;e<n;++e)s=t[e],(!r.type||s.type===r.type)&&s.name===r.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function ET(r,t,e){return function(){var i=this.__on,n,s=xT(t);if(i){for(var o=0,a=i.length;o<a;++o)if((n=i[o]).type===r.type&&n.name===r.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=e),n.value=t;return}}this.addEventListener(r.type,s,e),n={type:r.type,name:r.name,value:t,listener:s,options:e},i?i.push(n):this.__on=[n]}}function AT(r,t,e){var i=wT(r+""),n,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,l=a.length,u;h<l;++h)for(n=0,u=a[h];n<s;++n)if((o=i[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?ET:bT,n=0;n<s;++n)this.each(a(i[n],t,e));return this}function Zg(r,t,e){var i=Wg(r),n=i.CustomEvent;typeof n=="function"?n=new n(t,e):(n=i.document.createEvent("Event"),e?(n.initEvent(t,e.bubbles,e.cancelable),n.detail=e.detail):n.initEvent(t,!1,!1)),r.dispatchEvent(n)}function TT(r,t){return function(){return Zg(this,r,t)}}function ST(r,t){return function(){return Zg(this,r,t.apply(this,arguments))}}function IT(r,t){return this.each((typeof t=="function"?ST:TT)(r,t))}function*CT(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var i=r[t],n=0,s=i.length,o;n<s;++n)(o=i[n])&&(yield o)}var hu=[null];function ce(r,t){this._groups=r,this._parents=t}function os(){return new ce([[document.documentElement]],hu)}function NT(){return this}ce.prototype=os.prototype={constructor:ce,select:rA,selectAll:sA,selectChild:lA,selectChildren:fA,filter:pA,data:xA,enter:gA,exit:bA,join:EA,merge:AA,selection:NT,order:TA,sort:SA,call:CA,nodes:NA,node:RA,size:PA,empty:MA,each:DA,attr:GA,style:XA,property:YA,classed:QA,text:rT,html:oT,raise:hT,lower:uT,append:cT,insert:fT,remove:gT,clone:_T,datum:vT,on:AT,dispatch:IT,[Symbol.iterator]:CT};function V(r){return typeof r=="string"?new ce([[document.querySelector(r)]],[document.documentElement]):new ce([[r]],hu)}function RT(r){let t;for(;t=r.sourceEvent;)r=t;return r}function cr(r,t){if(r=RT(r),t===void 0&&(t=r.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=r.clientX,i.y=r.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var n=t.getBoundingClientRect();return[r.clientX-n.left-t.clientLeft,r.clientY-n.top-t.clientTop]}}return[r.pageX,r.pageY]}function ee(r){return typeof r=="string"?new ce([document.querySelectorAll(r)],[document.documentElement]):new ce([$g(r)],hu)}const PT={passive:!1},Yn={capture:!0,passive:!1};function lh(r){r.stopImmediatePropagation()}function Wi(r){r.preventDefault(),r.stopImmediatePropagation()}function Qg(r){var t=r.document.documentElement,e=V(r).on("dragstart.drag",Wi,Yn);"onselectstart"in t?e.on("selectstart.drag",Wi,Yn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Jg(r,t){var e=r.document.documentElement,i=V(r).on("dragstart.drag",null);t&&(i.on("click.drag",Wi,Yn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}const Os=r=>()=>r;function Il(r,{sourceEvent:t,subject:e,target:i,identifier:n,active:s,x:o,y:a,dx:h,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:n,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}Il.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function MT(r){return!r.ctrlKey&&!r.button}function DT(){return this.parentNode}function LT(r,t){return t??{x:r.x,y:r.y}}function BT(){return navigator.maxTouchPoints||"ontouchstart"in this}function kT(){var r=MT,t=DT,e=LT,i=BT,n={},s=ss("start","drag","end"),o=0,a,h,l,u,c=0;function d(_){_.on("mousedown.drag",f).filter(i).on("touchstart.drag",m).on("touchmove.drag",y,PT).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(_,E){if(!(u||!r.call(this,_,E))){var N=v(this,t.call(this,_,E),_,E,"mouse");N&&(V(_.view).on("mousemove.drag",p,Yn).on("mouseup.drag",g,Yn),Qg(_.view),lh(_),l=!1,a=_.clientX,h=_.clientY,N("start",_))}}function p(_){if(Wi(_),!l){var E=_.clientX-a,N=_.clientY-h;l=E*E+N*N>c}n.mouse("drag",_)}function g(_){V(_.view).on("mousemove.drag mouseup.drag",null),Jg(_.view,l),Wi(_),n.mouse("end",_)}function m(_,E){if(r.call(this,_,E)){var N=_.changedTouches,S=t.call(this,_,E),T=N.length,D,B;for(D=0;D<T;++D)(B=v(this,S,_,E,N[D].identifier,N[D]))&&(lh(_),B("start",_,N[D]))}}function y(_){var E=_.changedTouches,N=E.length,S,T;for(S=0;S<N;++S)(T=n[E[S].identifier])&&(Wi(_),T("drag",_,E[S]))}function x(_){var E=_.changedTouches,N=E.length,S,T;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),S=0;S<N;++S)(T=n[E[S].identifier])&&(lh(_),T("end",_,E[S]))}function v(_,E,N,S,T,D){var B=s.copy(),k=cr(D||N,E),M,A,w;if((w=e.call(_,new Il("beforestart",{sourceEvent:N,target:d,identifier:T,active:o,x:k[0],y:k[1],dx:0,dy:0,dispatch:B}),S))!=null)return M=w.x-k[0]||0,A=w.y-k[1]||0,function C(I,R,O){var z=k,P;switch(I){case"start":n[T]=C,P=o++;break;case"end":delete n[T],--o;case"drag":k=cr(O||R,E),P=o;break}B.call(I,_,new Il(I,{sourceEvent:R,subject:w,target:d,identifier:T,active:P,x:k[0]+M,y:k[1]+A,dx:k[0]-z[0],dy:k[1]-z[1],dispatch:B}),S)}}return d.filter=function(_){return arguments.length?(r=typeof _=="function"?_:Os(!!_),d):r},d.container=function(_){return arguments.length?(t=typeof _=="function"?_:Os(_),d):t},d.subject=function(_){return arguments.length?(e=typeof _=="function"?_:Os(_),d):e},d.touchable=function(_){return arguments.length?(i=typeof _=="function"?_:Os(!!_),d):i},d.on=function(){var _=s.on.apply(s,arguments);return _===s?d:_},d.clickDistance=function(_){return arguments.length?(c=(_=+_)*_,d):Math.sqrt(c)},d}function lu(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function tm(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function as(){}var qn=.7,Mo=1/qn,ji="\\s*([+-]?\\d+)\\s*",Kn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",tr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",FT=/^#([0-9a-f]{3,8})$/,OT=new RegExp(`^rgb\\(${ji},${ji},${ji}\\)$`),UT=new RegExp(`^rgb\\(${tr},${tr},${tr}\\)$`),GT=new RegExp(`^rgba\\(${ji},${ji},${ji},${Kn}\\)$`),$T=new RegExp(`^rgba\\(${tr},${tr},${tr},${Kn}\\)$`),HT=new RegExp(`^hsl\\(${Kn},${tr},${tr}\\)$`),zT=new RegExp(`^hsla\\(${Kn},${tr},${tr},${Kn}\\)$`),Kd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};lu(as,ci,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:Zd,formatHex:Zd,formatHex8:XT,formatHsl:VT,formatRgb:Qd,toString:Qd});function Zd(){return this.rgb().formatHex()}function XT(){return this.rgb().formatHex8()}function VT(){return em(this).formatHsl()}function Qd(){return this.rgb().formatRgb()}function ci(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=FT.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?Jd(t):e===3?new pe(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Us(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Us(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=OT.exec(r))?new pe(t[1],t[2],t[3],1):(t=UT.exec(r))?new pe(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=GT.exec(r))?Us(t[1],t[2],t[3],t[4]):(t=$T.exec(r))?Us(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=HT.exec(r))?rf(t[1],t[2]/100,t[3]/100,1):(t=zT.exec(r))?rf(t[1],t[2]/100,t[3]/100,t[4]):Kd.hasOwnProperty(r)?Jd(Kd[r]):r==="transparent"?new pe(NaN,NaN,NaN,0):null}function Jd(r){return new pe(r>>16&255,r>>8&255,r&255,1)}function Us(r,t,e,i){return i<=0&&(r=t=e=NaN),new pe(r,t,e,i)}function WT(r){return r instanceof as||(r=ci(r)),r?(r=r.rgb(),new pe(r.r,r.g,r.b,r.opacity)):new pe}function Cl(r,t,e,i){return arguments.length===1?WT(r):new pe(r,t,e,i??1)}function pe(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}lu(pe,Cl,tm(as,{brighter(r){return r=r==null?Mo:Math.pow(Mo,r),new pe(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?qn:Math.pow(qn,r),new pe(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new pe(ai(this.r),ai(this.g),ai(this.b),Do(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tf,formatHex:tf,formatHex8:jT,formatRgb:ef,toString:ef}));function tf(){return`#${ri(this.r)}${ri(this.g)}${ri(this.b)}`}function jT(){return`#${ri(this.r)}${ri(this.g)}${ri(this.b)}${ri((isNaN(this.opacity)?1:this.opacity)*255)}`}function ef(){const r=Do(this.opacity);return`${r===1?"rgb(":"rgba("}${ai(this.r)}, ${ai(this.g)}, ${ai(this.b)}${r===1?")":`, ${r})`}`}function Do(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function ai(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function ri(r){return r=ai(r),(r<16?"0":"")+r.toString(16)}function rf(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new De(r,t,e,i)}function em(r){if(r instanceof De)return new De(r.h,r.s,r.l,r.opacity);if(r instanceof as||(r=ci(r)),!r)return new De;if(r instanceof De)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),s=Math.max(t,e,i),o=NaN,a=s-n,h=(s+n)/2;return a?(t===s?o=(e-i)/a+(e<i)*6:e===s?o=(i-t)/a+2:o=(t-e)/a+4,a/=h<.5?s+n:2-s-n,o*=60):a=h>0&&h<1?0:o,new De(o,a,h,r.opacity)}function YT(r,t,e,i){return arguments.length===1?em(r):new De(r,t,e,i??1)}function De(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}lu(De,YT,tm(as,{brighter(r){return r=r==null?Mo:Math.pow(Mo,r),new De(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?qn:Math.pow(qn,r),new De(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new pe(uh(r>=240?r-240:r+120,n,i),uh(r,n,i),uh(r<120?r+240:r-120,n,i),this.opacity)},clamp(){return new De(nf(this.h),Gs(this.s),Gs(this.l),Do(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=Do(this.opacity);return`${r===1?"hsl(":"hsla("}${nf(this.h)}, ${Gs(this.s)*100}%, ${Gs(this.l)*100}%${r===1?")":`, ${r})`}`}}));function nf(r){return r=(r||0)%360,r<0?r+360:r}function Gs(r){return Math.max(0,Math.min(1,r||0))}function uh(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}const uu=r=>()=>r;function qT(r,t){return function(e){return r+e*t}}function KT(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function ZT(r){return(r=+r)==1?rm:function(t,e){return e-t?KT(t,e,r):uu(isNaN(t)?e:t)}}function rm(r,t){var e=t-r;return e?qT(r,e):uu(isNaN(r)?t:r)}const Lo=function r(t){var e=ZT(t);function i(n,s){var o=e((n=Cl(n)).r,(s=Cl(s)).r),a=e(n.g,s.g),h=e(n.b,s.b),l=rm(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=h(u),n.opacity=l(u),n+""}}return i.gamma=r,i}(1);function QT(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(s){for(n=0;n<e;++n)i[n]=r[n]*(1-s)+t[n]*s;return i}}function JT(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function tS(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),s=new Array(e),o;for(o=0;o<i;++o)n[o]=cu(r[o],t[o]);for(;o<e;++o)s[o]=t[o];return function(a){for(o=0;o<i;++o)s[o]=n[o](a);return s}}function eS(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function Pe(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function rS(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=cu(r[n],t[n]):i[n]=t[n];return function(s){for(n in e)i[n]=e[n](s);return i}}var Nl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ch=new RegExp(Nl.source,"g");function iS(r){return function(){return r}}function nS(r){return function(t){return r(t)+""}}function im(r,t){var e=Nl.lastIndex=ch.lastIndex=0,i,n,s,o=-1,a=[],h=[];for(r=r+"",t=t+"";(i=Nl.exec(r))&&(n=ch.exec(t));)(s=n.index)>e&&(s=t.slice(e,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,h.push({i:o,x:Pe(i,n)})),e=ch.lastIndex;return e<t.length&&(s=t.slice(e),a[o]?a[o]+=s:a[++o]=s),a.length<2?h[0]?nS(h[0].x):iS(t):(t=h.length,function(l){for(var u=0,c;u<t;++u)a[(c=h[u]).i]=c.x(l);return a.join("")})}function cu(r,t){var e=typeof t,i;return t==null||e==="boolean"?uu(t):(e==="number"?Pe:e==="string"?(i=ci(t))?(t=i,Lo):im:t instanceof ci?Lo:t instanceof Date?eS:JT(t)?QT:Array.isArray(t)?tS:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?rS:Pe)(r,t)}function sS(r,t){return r=+r,t=+t,function(e){return Math.round(r*(1-e)+t*e)}}var sf=180/Math.PI,Rl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function nm(r,t,e,i,n,s){var o,a,h;return(o=Math.sqrt(r*r+t*t))&&(r/=o,t/=o),(h=r*e+t*i)&&(e-=r*h,i-=t*h),(a=Math.sqrt(e*e+i*i))&&(e/=a,i/=a,h/=a),r*i<t*e&&(r=-r,t=-t,h=-h,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(t,r)*sf,skewX:Math.atan(h)*sf,scaleX:o,scaleY:a}}var $s;function oS(r){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return t.isIdentity?Rl:nm(t.a,t.b,t.c,t.d,t.e,t.f)}function aS(r){return r==null||($s||($s=document.createElementNS("http://www.w3.org/2000/svg","g")),$s.setAttribute("transform",r),!(r=$s.transform.baseVal.consolidate()))?Rl:(r=r.matrix,nm(r.a,r.b,r.c,r.d,r.e,r.f))}function sm(r,t,e,i){function n(l){return l.length?l.pop()+" ":""}function s(l,u,c,d,f,p){if(l!==c||u!==d){var g=f.push("translate(",null,t,null,e);p.push({i:g-4,x:Pe(l,c)},{i:g-2,x:Pe(u,d)})}else(c||d)&&f.push("translate("+c+t+d+e)}function o(l,u,c,d){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),d.push({i:c.push(n(c)+"rotate(",null,i)-2,x:Pe(l,u)})):u&&c.push(n(c)+"rotate("+u+i)}function a(l,u,c,d){l!==u?d.push({i:c.push(n(c)+"skewX(",null,i)-2,x:Pe(l,u)}):u&&c.push(n(c)+"skewX("+u+i)}function h(l,u,c,d,f,p){if(l!==c||u!==d){var g=f.push(n(f)+"scale(",null,",",null,")");p.push({i:g-4,x:Pe(l,c)},{i:g-2,x:Pe(u,d)})}else(c!==1||d!==1)&&f.push(n(f)+"scale("+c+","+d+")")}return function(l,u){var c=[],d=[];return l=r(l),u=r(u),s(l.translateX,l.translateY,u.translateX,u.translateY,c,d),o(l.rotate,u.rotate,c,d),a(l.skewX,u.skewX,c,d),h(l.scaleX,l.scaleY,u.scaleX,u.scaleY,c,d),l=u=null,function(f){for(var p=-1,g=d.length,m;++p<g;)c[(m=d[p]).i]=m.x(f);return c.join("")}}}var hS=sm(oS,"px, ","px)","deg)"),lS=sm(aS,", ",")",")"),uS=1e-12;function of(r){return((r=Math.exp(r))+1/r)/2}function cS(r){return((r=Math.exp(r))-1/r)/2}function dS(r){return((r=Math.exp(2*r))-1)/(r+1)}const fS=function r(t,e,i){function n(s,o){var a=s[0],h=s[1],l=s[2],u=o[0],c=o[1],d=o[2],f=u-a,p=c-h,g=f*f+p*p,m,y;if(g<uS)y=Math.log(d/l)/t,m=function(S){return[a+S*f,h+S*p,l*Math.exp(t*S*y)]};else{var x=Math.sqrt(g),v=(d*d-l*l+i*g)/(2*l*e*x),_=(d*d-l*l-i*g)/(2*d*e*x),E=Math.log(Math.sqrt(v*v+1)-v),N=Math.log(Math.sqrt(_*_+1)-_);y=(N-E)/t,m=function(S){var T=S*y,D=of(E),B=l/(e*x)*(D*dS(t*T+E)-cS(E));return[a+B*f,h+B*p,l*D/of(t*T+E)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return n.rho=function(s){var o=Math.max(.001,+s),a=o*o,h=a*a;return r(o,a,h)},n}(Math.SQRT2,2,4);var en=0,Mn=0,xn=0,om=1e3,Bo,Dn,ko=0,di=0,oa=0,Zn=typeof performance=="object"&&performance.now?performance:Date,am=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function du(){return di||(am(pS),di=Zn.now()+oa)}function pS(){di=0}function Fo(){this._call=this._time=this._next=null}Fo.prototype=fu.prototype={constructor:Fo,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?du():+e)+(t==null?0:+t),!this._next&&Dn!==this&&(Dn?Dn._next=this:Bo=this,Dn=this),this._call=r,this._time=e,Pl()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pl())}};function fu(r,t,e){var i=new Fo;return i.restart(r,t,e),i}function gS(){du(),++en;for(var r=Bo,t;r;)(t=di-r._time)>=0&&r._call.call(void 0,t),r=r._next;--en}function af(){di=(ko=Zn.now())+oa,en=Mn=0;try{gS()}finally{en=0,yS(),di=0}}function mS(){var r=Zn.now(),t=r-ko;t>om&&(oa-=t,ko=r)}function yS(){for(var r,t=Bo,e,i=1/0;t;)t._call?(i>t._time&&(i=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:Bo=e);Dn=r,Pl(i)}function Pl(r){if(!en){Mn&&(Mn=clearTimeout(Mn));var t=r-di;t>24?(r<1/0&&(Mn=setTimeout(af,r-Zn.now()-oa)),xn&&(xn=clearInterval(xn))):(xn||(ko=Zn.now(),xn=setInterval(mS,om)),en=1,am(af))}}function hf(r,t,e){var i=new Fo;return t=t==null?0:+t,i.restart(n=>{i.stop(),r(n+t)},t,e),i}var _S=ss("start","end","cancel","interrupt"),vS=[],hm=0,lf=1,Ml=2,no=3,uf=4,Dl=5,so=6;function aa(r,t,e,i,n,s){var o=r.__transition;if(!o)r.__transition={};else if(e in o)return;xS(r,e,{name:t,index:i,group:n,on:_S,tween:vS,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:hm})}function pu(r,t){var e=Oe(r,t);if(e.state>hm)throw new Error("too late; already scheduled");return e}function sr(r,t){var e=Oe(r,t);if(e.state>no)throw new Error("too late; already running");return e}function Oe(r,t){var e=r.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function xS(r,t,e){var i=r.__transition,n;i[t]=e,e.timer=fu(s,0,e.time);function s(l){e.state=lf,e.timer.restart(o,e.delay,e.time),e.delay<=l&&o(l-e.delay)}function o(l){var u,c,d,f;if(e.state!==lf)return h();for(u in i)if(f=i[u],f.name===e.name){if(f.state===no)return hf(o);f.state===uf?(f.state=so,f.timer.stop(),f.on.call("interrupt",r,r.__data__,f.index,f.group),delete i[u]):+u<t&&(f.state=so,f.timer.stop(),f.on.call("cancel",r,r.__data__,f.index,f.group),delete i[u])}if(hf(function(){e.state===no&&(e.state=uf,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=Ml,e.on.call("start",r,r.__data__,e.index,e.group),e.state===Ml){for(e.state=no,n=new Array(d=e.tween.length),u=0,c=-1;u<d;++u)(f=e.tween[u].value.call(r,r.__data__,e.index,e.group))&&(n[++c]=f);n.length=c+1}}function a(l){for(var u=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(h),e.state=Dl,1),c=-1,d=n.length;++c<d;)n[c].call(r,u);e.state===Dl&&(e.on.call("end",r,r.__data__,e.index,e.group),h())}function h(){e.state=so,e.timer.stop(),delete i[t];for(var l in i)return;delete r.__transition}}function oo(r,t){var e=r.__transition,i,n,s=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((i=e[o]).name!==t){s=!1;continue}n=i.state>Ml&&i.state<Dl,i.state=so,i.timer.stop(),i.on.call(n?"interrupt":"cancel",r,r.__data__,i.index,i.group),delete e[o]}s&&delete r.__transition}}function wS(r){return this.each(function(){oo(this,r)})}function bS(r,t){var e,i;return function(){var n=sr(this,r),s=n.tween;if(s!==e){i=e=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}n.tween=i}}function ES(r,t,e){var i,n;if(typeof e!="function")throw new Error;return function(){var s=sr(this,r),o=s.tween;if(o!==i){n=(i=o).slice();for(var a={name:t,value:e},h=0,l=n.length;h<l;++h)if(n[h].name===t){n[h]=a;break}h===l&&n.push(a)}s.tween=n}}function AS(r,t){var e=this._id;if(r+="",arguments.length<2){for(var i=Oe(this.node(),e).tween,n=0,s=i.length,o;n<s;++n)if((o=i[n]).name===r)return o.value;return null}return this.each((t==null?bS:ES)(e,r,t))}function gu(r,t,e){var i=r._id;return r.each(function(){var n=sr(this,i);(n.value||(n.value={}))[t]=e.apply(this,arguments)}),function(n){return Oe(n,i).value[t]}}function lm(r,t){var e;return(typeof t=="number"?Pe:t instanceof ci?Lo:(e=ci(t))?(t=e,Lo):im)(r,t)}function TS(r){return function(){this.removeAttribute(r)}}function SS(r){return function(){this.removeAttributeNS(r.space,r.local)}}function IS(r,t,e){var i,n=e+"",s;return function(){var o=this.getAttribute(r);return o===n?null:o===i?s:s=t(i=o,e)}}function CS(r,t,e){var i,n=e+"",s;return function(){var o=this.getAttributeNS(r.space,r.local);return o===n?null:o===i?s:s=t(i=o,e)}}function NS(r,t,e){var i,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(r):(o=this.getAttribute(r),h=a+"",o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a)))}}function RS(r,t,e){var i,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(r.space,r.local):(o=this.getAttributeNS(r.space,r.local),h=a+"",o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a)))}}function PS(r,t){var e=sa(r),i=e==="transform"?lS:lm;return this.attrTween(r,typeof t=="function"?(e.local?RS:NS)(e,i,gu(this,"attr."+r,t)):t==null?(e.local?SS:TS)(e):(e.local?CS:IS)(e,i,t))}function MS(r,t){return function(e){this.setAttribute(r,t.call(this,e))}}function DS(r,t){return function(e){this.setAttributeNS(r.space,r.local,t.call(this,e))}}function LS(r,t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&DS(r,s)),e}return n._value=t,n}function BS(r,t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&MS(r,s)),e}return n._value=t,n}function kS(r,t){var e="attr."+r;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var i=sa(r);return this.tween(e,(i.local?LS:BS)(i,t))}function FS(r,t){return function(){pu(this,r).delay=+t.apply(this,arguments)}}function OS(r,t){return t=+t,function(){pu(this,r).delay=t}}function US(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?FS:OS)(t,r)):Oe(this.node(),t).delay}function GS(r,t){return function(){sr(this,r).duration=+t.apply(this,arguments)}}function $S(r,t){return t=+t,function(){sr(this,r).duration=t}}function HS(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?GS:$S)(t,r)):Oe(this.node(),t).duration}function zS(r,t){if(typeof t!="function")throw new Error;return function(){sr(this,r).ease=t}}function XS(r){var t=this._id;return arguments.length?this.each(zS(t,r)):Oe(this.node(),t).ease}function VS(r,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;sr(this,r).ease=e}}function WS(r){if(typeof r!="function")throw new Error;return this.each(VS(this._id,r))}function jS(r){typeof r!="function"&&(r=zg(r));for(var t=this._groups,e=t.length,i=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=i[n]=[],h,l=0;l<o;++l)(h=s[l])&&r.call(h,h.__data__,l,s)&&a.push(h);return new br(i,this._parents,this._name,this._id)}function YS(r){if(r._id!==this._id)throw new Error;for(var t=this._groups,e=r._groups,i=t.length,n=e.length,s=Math.min(i,n),o=new Array(i),a=0;a<s;++a)for(var h=t[a],l=e[a],u=h.length,c=o[a]=new Array(u),d,f=0;f<u;++f)(d=h[f]||l[f])&&(c[f]=d);for(;a<i;++a)o[a]=t[a];return new br(o,this._parents,this._name,this._id)}function qS(r){return(r+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function KS(r,t,e){var i,n,s=qS(t)?pu:sr;return function(){var o=s(this,r),a=o.on;a!==i&&(n=(i=a).copy()).on(t,e),o.on=n}}function ZS(r,t){var e=this._id;return arguments.length<2?Oe(this.node(),e).on.on(r):this.each(KS(e,r,t))}function QS(r){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==r)return;t&&t.removeChild(this)}}function JS(){return this.on("end.remove",QS(this._id))}function tI(r){var t=this._name,e=this._id;typeof r!="function"&&(r=ou(r));for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o)for(var a=i[o],h=a.length,l=s[o]=new Array(h),u,c,d=0;d<h;++d)(u=a[d])&&(c=r.call(u,u.__data__,d,a))&&("__data__"in u&&(c.__data__=u.__data__),l[d]=c,aa(l[d],t,e,d,l,Oe(u,e)));return new br(s,this._parents,t,e)}function eI(r){var t=this._name,e=this._id;typeof r!="function"&&(r=Hg(r));for(var i=this._groups,n=i.length,s=[],o=[],a=0;a<n;++a)for(var h=i[a],l=h.length,u,c=0;c<l;++c)if(u=h[c]){for(var d=r.call(u,u.__data__,c,h),f,p=Oe(u,e),g=0,m=d.length;g<m;++g)(f=d[g])&&aa(f,t,e,g,d,p);s.push(d),o.push(u)}return new br(s,o,t,e)}var rI=os.prototype.constructor;function iI(){return new rI(this._groups,this._parents)}function nI(r,t){var e,i,n;return function(){var s=tn(this,r),o=(this.style.removeProperty(r),tn(this,r));return s===o?null:s===e&&o===i?n:n=t(e=s,i=o)}}function um(r){return function(){this.style.removeProperty(r)}}function sI(r,t,e){var i,n=e+"",s;return function(){var o=tn(this,r);return o===n?null:o===i?s:s=t(i=o,e)}}function oI(r,t,e){var i,n,s;return function(){var o=tn(this,r),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(r),tn(this,r))),o===h?null:o===i&&h===n?s:(n=h,s=t(i=o,a))}}function aI(r,t){var e,i,n,s="style."+t,o="end."+s,a;return function(){var h=sr(this,r),l=h.on,u=h.value[s]==null?a||(a=um(t)):void 0;(l!==e||n!==u)&&(i=(e=l).copy()).on(o,n=u),h.on=i}}function hI(r,t,e){var i=(r+="")=="transform"?hS:lm;return t==null?this.styleTween(r,nI(r,i)).on("end.style."+r,um(r)):typeof t=="function"?this.styleTween(r,oI(r,i,gu(this,"style."+r,t))).each(aI(this._id,r)):this.styleTween(r,sI(r,i,t),e).on("end.style."+r,null)}function lI(r,t,e){return function(i){this.style.setProperty(r,t.call(this,i),e)}}function uI(r,t,e){var i,n;function s(){var o=t.apply(this,arguments);return o!==n&&(i=(n=o)&&lI(r,o,e)),i}return s._value=t,s}function cI(r,t,e){var i="style."+(r+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,uI(r,t,e??""))}function dI(r){return function(){this.textContent=r}}function fI(r){return function(){var t=r(this);this.textContent=t??""}}function pI(r){return this.tween("text",typeof r=="function"?fI(gu(this,"text",r)):dI(r==null?"":r+""))}function gI(r){return function(t){this.textContent=r.call(this,t)}}function mI(r){var t,e;function i(){var n=r.apply(this,arguments);return n!==e&&(t=(e=n)&&gI(n)),t}return i._value=r,i}function yI(r){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(r==null)return this.tween(t,null);if(typeof r!="function")throw new Error;return this.tween(t,mI(r))}function _I(){for(var r=this._name,t=this._id,e=cm(),i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,h,l=0;l<a;++l)if(h=o[l]){var u=Oe(h,t);aa(h,r,e,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new br(i,this._parents,r,e)}function vI(){var r,t,e=this,i=e._id,n=e.size();return new Promise(function(s,o){var a={value:o},h={value:function(){--n===0&&s()}};e.each(function(){var l=sr(this,i),u=l.on;u!==r&&(t=(r=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),l.on=t}),n===0&&s()})}var xI=0;function br(r,t,e,i){this._groups=r,this._parents=t,this._name=e,this._id=i}function cm(){return++xI}var lr=os.prototype;br.prototype={constructor:br,select:tI,selectAll:eI,selectChild:lr.selectChild,selectChildren:lr.selectChildren,filter:jS,merge:YS,selection:iI,transition:_I,call:lr.call,nodes:lr.nodes,node:lr.node,size:lr.size,empty:lr.empty,each:lr.each,on:ZS,attr:PS,attrTween:kS,style:hI,styleTween:cI,text:pI,textTween:yI,remove:JS,tween:AS,delay:US,duration:HS,ease:XS,easeVarying:WS,end:vI,[Symbol.iterator]:lr[Symbol.iterator]};function wI(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var bI={time:null,delay:0,duration:250,ease:wI};function EI(r,t){for(var e;!(e=r.__transition)||!(e=e[t]);)if(!(r=r.parentNode))throw new Error(`transition ${t} not found`);return e}function AI(r){var t,e;r instanceof br?(t=r._id,r=r._name):(t=cm(),(e=bI).time=du(),r=r==null?null:r+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&aa(h,r,t,l,o,e||EI(h,t));return new br(i,this._parents,r,t)}os.prototype.interrupt=wS;os.prototype.transition=AI;function TI(r){const t=+this._x.call(null,r),e=+this._y.call(null,r);return dm(this.cover(t,e),t,e,r)}function dm(r,t,e,i){if(isNaN(t)||isNaN(e))return r;var n,s=r._root,o={data:i},a=r._x0,h=r._y0,l=r._x1,u=r._y1,c,d,f,p,g,m,y,x;if(!s)return r._root=o,r;for(;s.length;)if((g=t>=(c=(a+l)/2))?a=c:l=c,(m=e>=(d=(h+u)/2))?h=d:u=d,n=s,!(s=s[y=m<<1|g]))return n[y]=o,r;if(f=+r._x.call(null,s.data),p=+r._y.call(null,s.data),t===f&&e===p)return o.next=s,n?n[y]=o:r._root=o,r;do n=n?n[y]=new Array(4):r._root=new Array(4),(g=t>=(c=(a+l)/2))?a=c:l=c,(m=e>=(d=(h+u)/2))?h=d:u=d;while((y=m<<1|g)===(x=(p>=d)<<1|f>=c));return n[x]=s,n[y]=o,r}function SI(r){var t,e,i=r.length,n,s,o=new Array(i),a=new Array(i),h=1/0,l=1/0,u=-1/0,c=-1/0;for(e=0;e<i;++e)isNaN(n=+this._x.call(null,t=r[e]))||isNaN(s=+this._y.call(null,t))||(o[e]=n,a[e]=s,n<h&&(h=n),n>u&&(u=n),s<l&&(l=s),s>c&&(c=s));if(h>u||l>c)return this;for(this.cover(h,l).cover(u,c),e=0;e<i;++e)dm(this,o[e],a[e],r[e]);return this}function II(r,t){if(isNaN(r=+r)||isNaN(t=+t))return this;var e=this._x0,i=this._y0,n=this._x1,s=this._y1;if(isNaN(e))n=(e=Math.floor(r))+1,s=(i=Math.floor(t))+1;else{for(var o=n-e||1,a=this._root,h,l;e>r||r>=n||i>t||t>=s;)switch(l=(t<i)<<1|r<e,h=new Array(4),h[l]=a,a=h,o*=2,l){case 0:n=e+o,s=i+o;break;case 1:e=n-o,s=i+o;break;case 2:n=e+o,i=s-o;break;case 3:e=n-o,i=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=i,this._x1=n,this._y1=s,this}function CI(){var r=[];return this.visit(function(t){if(!t.length)do r.push(t.data);while(t=t.next)}),r}function NI(r){return arguments.length?this.cover(+r[0][0],+r[0][1]).cover(+r[1][0],+r[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function he(r,t,e,i,n){this.node=r,this.x0=t,this.y0=e,this.x1=i,this.y1=n}function RI(r,t,e){var i,n=this._x0,s=this._y0,o,a,h,l,u=this._x1,c=this._y1,d=[],f=this._root,p,g;for(f&&d.push(new he(f,n,s,u,c)),e==null?e=1/0:(n=r-e,s=t-e,u=r+e,c=t+e,e*=e);p=d.pop();)if(!(!(f=p.node)||(o=p.x0)>u||(a=p.y0)>c||(h=p.x1)<n||(l=p.y1)<s))if(f.length){var m=(o+h)/2,y=(a+l)/2;d.push(new he(f[3],m,y,h,l),new he(f[2],o,y,m,l),new he(f[1],m,a,h,y),new he(f[0],o,a,m,y)),(g=(t>=y)<<1|r>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var x=r-+this._x.call(null,f.data),v=t-+this._y.call(null,f.data),_=x*x+v*v;if(_<e){var E=Math.sqrt(e=_);n=r-E,s=t-E,u=r+E,c=t+E,i=f.data}}return i}function PI(r){if(isNaN(u=+this._x.call(null,r))||isNaN(c=+this._y.call(null,r)))return this;var t,e=this._root,i,n,s,o=this._x0,a=this._y0,h=this._x1,l=this._y1,u,c,d,f,p,g,m,y;if(!e)return this;if(e.length)for(;;){if((p=u>=(d=(o+h)/2))?o=d:h=d,(g=c>=(f=(a+l)/2))?a=f:l=f,t=e,!(e=e[m=g<<1|p]))return this;if(!e.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;e.data!==r;)if(n=e,!(e=e.next))return this;return(s=e.next)&&delete e.next,n?(s?n.next=s:delete n.next,this):t?(s?t[m]=s:delete t[m],(e=t[0]||t[1]||t[2]||t[3])&&e===(t[3]||t[2]||t[1]||t[0])&&!e.length&&(i?i[y]=e:this._root=e),this):(this._root=s,this)}function MI(r){for(var t=0,e=r.length;t<e;++t)this.remove(r[t]);return this}function DI(){return this._root}function LI(){var r=0;return this.visit(function(t){if(!t.length)do++r;while(t=t.next)}),r}function BI(r){var t=[],e,i=this._root,n,s,o,a,h;for(i&&t.push(new he(i,this._x0,this._y0,this._x1,this._y1));e=t.pop();)if(!r(i=e.node,s=e.x0,o=e.y0,a=e.x1,h=e.y1)&&i.length){var l=(s+a)/2,u=(o+h)/2;(n=i[3])&&t.push(new he(n,l,u,a,h)),(n=i[2])&&t.push(new he(n,s,u,l,h)),(n=i[1])&&t.push(new he(n,l,o,a,u)),(n=i[0])&&t.push(new he(n,s,o,l,u))}return this}function kI(r){var t=[],e=[],i;for(this._root&&t.push(new he(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var n=i.node;if(n.length){var s,o=i.x0,a=i.y0,h=i.x1,l=i.y1,u=(o+h)/2,c=(a+l)/2;(s=n[0])&&t.push(new he(s,o,a,u,c)),(s=n[1])&&t.push(new he(s,u,a,h,c)),(s=n[2])&&t.push(new he(s,o,c,u,l)),(s=n[3])&&t.push(new he(s,u,c,h,l))}e.push(i)}for(;i=e.pop();)r(i.node,i.x0,i.y0,i.x1,i.y1);return this}function FI(r){return r[0]}function OI(r){return arguments.length?(this._x=r,this):this._x}function UI(r){return r[1]}function GI(r){return arguments.length?(this._y=r,this):this._y}function mu(r,t,e){var i=new yu(t??FI,e??UI,NaN,NaN,NaN,NaN);return r==null?i:i.addAll(r)}function yu(r,t,e,i,n,s){this._x=r,this._y=t,this._x0=e,this._y0=i,this._x1=n,this._y1=s,this._root=void 0}function cf(r){for(var t={data:r.data},e=t;r=r.next;)e=e.next={data:r.data};return t}var de=mu.prototype=yu.prototype;de.copy=function(){var r=new yu(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,e,i;if(!t)return r;if(!t.length)return r._root=cf(t),r;for(e=[{source:t,target:r._root=new Array(4)}];t=e.pop();)for(var n=0;n<4;++n)(i=t.source[n])&&(i.length?e.push({source:i,target:t.target[n]=new Array(4)}):t.target[n]=cf(i));return r};de.add=TI;de.addAll=SI;de.cover=II;de.data=CI;de.extent=NI;de.find=RI;de.remove=PI;de.removeAll=MI;de.root=DI;de.size=LI;de.visit=BI;de.visitAfter=kI;de.x=OI;de.y=GI;function ue(r){return function(){return r}}function Br(r){return(r()-.5)*1e-6}function $I(r){return r.x+r.vx}function HI(r){return r.y+r.vy}function df(r){var t,e,i,n=1,s=1;typeof r!="function"&&(r=ue(r==null?1:+r));function o(){for(var l,u=t.length,c,d,f,p,g,m,y=0;y<s;++y)for(c=mu(t,$I,HI).visitAfter(a),l=0;l<u;++l)d=t[l],g=e[d.index],m=g*g,f=d.x+d.vx,p=d.y+d.vy,c.visit(x);function x(v,_,E,N,S){var T=v.data,D=v.r,B=g+D;if(T){if(T.index>d.index){var k=f-T.x-T.vx,M=p-T.y-T.vy,A=k*k+M*M;A<B*B&&(k===0&&(k=Br(i),A+=k*k),M===0&&(M=Br(i),A+=M*M),A=(B-(A=Math.sqrt(A)))/A*n,d.vx+=(k*=A)*(B=(D*=D)/(m+D)),d.vy+=(M*=A)*B,T.vx-=k*(B=1-B),T.vy-=M*B)}return}return _>f+B||N<f-B||E>p+B||S<p-B}}function a(l){if(l.data)return l.r=e[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function h(){if(t){var l,u=t.length,c;for(e=new Array(u),l=0;l<u;++l)c=t[l],e[c.index]=+r(c,l,t)}}return o.initialize=function(l,u){t=l,i=u,h()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(n=+l,o):n},o.radius=function(l){return arguments.length?(r=typeof l=="function"?l:ue(+l),h(),o):r},o}function zI(r){return r.index}function ff(r,t){var e=r.get(t);if(!e)throw new Error("node not found: "+t);return e}function XI(r){var t=zI,e=c,i,n=ue(30),s,o,a,h,l,u=1;r==null&&(r=[]);function c(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,x=r.length;y<u;++y)for(var v=0,_,E,N,S,T,D,B;v<x;++v)_=r[v],E=_.source,N=_.target,S=N.x+N.vx-E.x-E.vx||Br(l),T=N.y+N.vy-E.y-E.vy||Br(l),D=Math.sqrt(S*S+T*T),D=(D-s[v])/D*m*i[v],S*=D,T*=D,N.vx-=S*(B=h[v]),N.vy-=T*B,E.vx+=S*(B=1-B),E.vy+=T*B}function f(){if(o){var m,y=o.length,x=r.length,v=new Map(o.map((E,N)=>[t(E,N,o),E])),_;for(m=0,a=new Array(y);m<x;++m)_=r[m],_.index=m,typeof _.source!="object"&&(_.source=ff(v,_.source)),typeof _.target!="object"&&(_.target=ff(v,_.target)),a[_.source.index]=(a[_.source.index]||0)+1,a[_.target.index]=(a[_.target.index]||0)+1;for(m=0,h=new Array(x);m<x;++m)_=r[m],h[m]=a[_.source.index]/(a[_.source.index]+a[_.target.index]);i=new Array(x),p(),s=new Array(x),g()}}function p(){if(o)for(var m=0,y=r.length;m<y;++m)i[m]=+e(r[m],m,r)}function g(){if(o)for(var m=0,y=r.length;m<y;++m)s[m]=+n(r[m],m,r)}return d.initialize=function(m,y){o=m,l=y,f()},d.links=function(m){return arguments.length?(r=m,f(),d):r},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(u=+m,d):u},d.strength=function(m){return arguments.length?(e=typeof m=="function"?m:ue(+m),p(),d):e},d.distance=function(m){return arguments.length?(n=typeof m=="function"?m:ue(+m),g(),d):n},d}const VI=1664525,WI=1013904223,pf=4294967296;function jI(){let r=1;return()=>(r=(VI*r+WI)%pf)/pf}function YI(r){return r.x}function qI(r){return r.y}var KI=10,ZI=Math.PI*(3-Math.sqrt(5));function gf(r){var t,e=1,i=.001,n=1-Math.pow(i,1/300),s=0,o=.6,a=new Map,h=fu(c),l=ss("tick","end"),u=jI();r==null&&(r=[]);function c(){d(),l.call("tick",t),e<i&&(h.stop(),l.call("end",t))}function d(g){var m,y=r.length,x;g===void 0&&(g=1);for(var v=0;v<g;++v)for(e+=(s-e)*n,a.forEach(function(_){_(e)}),m=0;m<y;++m)x=r[m],x.fx==null?x.x+=x.vx*=o:(x.x=x.fx,x.vx=0),x.fy==null?x.y+=x.vy*=o:(x.y=x.fy,x.vy=0);return t}function f(){for(var g=0,m=r.length,y;g<m;++g){if(y=r[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var x=KI*Math.sqrt(.5+g),v=g*ZI;y.x=x*Math.cos(v),y.y=x*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(r,u),g}return f(),t={tick:d,restart:function(){return h.restart(c),t},stop:function(){return h.stop(),t},nodes:function(g){return arguments.length?(r=g,f(),a.forEach(p),t):r},alpha:function(g){return arguments.length?(e=+g,t):e},alphaMin:function(g){return arguments.length?(i=+g,t):i},alphaDecay:function(g){return arguments.length?(n=+g,t):+n},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(o=1-g,t):1-o},randomSource:function(g){return arguments.length?(u=g,a.forEach(p),t):u},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),t):a.get(g)},find:function(g,m,y){var x=0,v=r.length,_,E,N,S,T;for(y==null?y=1/0:y*=y,x=0;x<v;++x)S=r[x],_=g-S.x,E=m-S.y,N=_*_+E*E,N<y&&(T=S,y=N);return T},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function QI(){var r,t,e,i,n=ue(-30),s,o=1,a=1/0,h=.81;function l(f){var p,g=r.length,m=mu(r,YI,qI).visitAfter(c);for(i=f,p=0;p<g;++p)t=r[p],m.visit(d)}function u(){if(r){var f,p=r.length,g;for(s=new Array(p),f=0;f<p;++f)g=r[f],s[g.index]=+n(g,f,r)}}function c(f){var p=0,g,m,y=0,x,v,_;if(f.length){for(x=v=_=0;_<4;++_)(g=f[_])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,x+=m*g.x,v+=m*g.y);f.x=x/y,f.y=v/y}else{g=f,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}f.value=p}function d(f,p,g,m){if(!f.value)return!0;var y=f.x-t.x,x=f.y-t.y,v=m-p,_=y*y+x*x;if(v*v/h<_)return _<a&&(y===0&&(y=Br(e),_+=y*y),x===0&&(x=Br(e),_+=x*x),_<o&&(_=Math.sqrt(o*_)),t.vx+=y*f.value*i/_,t.vy+=x*f.value*i/_),!0;if(f.length||_>=a)return;(f.data!==t||f.next)&&(y===0&&(y=Br(e),_+=y*y),x===0&&(x=Br(e),_+=x*x),_<o&&(_=Math.sqrt(o*_)));do f.data!==t&&(v=s[f.data.index]*i/_,t.vx+=y*v,t.vy+=x*v);while(f=f.next)}return l.initialize=function(f,p){r=f,e=p,u()},l.strength=function(f){return arguments.length?(n=typeof f=="function"?f:ue(+f),u(),l):n},l.distanceMin=function(f){return arguments.length?(o=f*f,l):Math.sqrt(o)},l.distanceMax=function(f){return arguments.length?(a=f*f,l):Math.sqrt(a)},l.theta=function(f){return arguments.length?(h=f*f,l):Math.sqrt(h)},l}function mf(r){var t=ue(.1),e,i,n;typeof r!="function"&&(r=ue(r==null?0:+r));function s(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vx+=(n[h]-u.x)*i[h]*a}function o(){if(e){var a,h=e.length;for(i=new Array(h),n=new Array(h),a=0;a<h;++a)i[a]=isNaN(n[a]=+r(e[a],a,e))?0:+t(e[a],a,e)}}return s.initialize=function(a){e=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:ue(+a),o(),s):t},s.x=function(a){return arguments.length?(r=typeof a=="function"?a:ue(+a),o(),s):r},s}function yf(r){var t=ue(.1),e,i,n;typeof r!="function"&&(r=ue(r==null?0:+r));function s(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vy+=(n[h]-u.y)*i[h]*a}function o(){if(e){var a,h=e.length;for(i=new Array(h),n=new Array(h),a=0;a<h;++a)i[a]=isNaN(n[a]=+r(e[a],a,e))?0:+t(e[a],a,e)}}return s.initialize=function(a){e=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:ue(+a),o(),s):t},s.y=function(a){return arguments.length?(r=typeof a=="function"?a:ue(+a),o(),s):r},s}function JI(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function Oo(r,t){if((e=(r=t?r.toExponential(t-1):r.toExponential()).indexOf("e"))<0)return null;var e,i=r.slice(0,e);return[i.length>1?i[0]+i.slice(2):i,+r.slice(e+1)]}function rn(r){return r=Oo(Math.abs(r)),r?r[1]:NaN}function tC(r,t){return function(e,i){for(var n=e.length,s=[],o=0,a=r[0],h=0;n>0&&a>0&&(h+a+1>i&&(a=Math.max(1,i-h)),s.push(e.substring(n-=a,n+a)),!((h+=a+1)>i));)a=r[o=(o+1)%r.length];return s.reverse().join(t)}}function eC(r){return function(t){return t.replace(/[0-9]/g,function(e){return r[+e]})}}var rC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Uo(r){if(!(t=rC.exec(r)))throw new Error("invalid format: "+r);var t;return new _u({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Uo.prototype=_u.prototype;function _u(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}_u.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function iC(r){t:for(var t=r.length,e=1,i=-1,n;e<t;++e)switch(r[e]){case".":i=n=e;break;case"0":i===0&&(i=e),n=e;break;default:if(!+r[e])break t;i>0&&(i=0);break}return i>0?r.slice(0,i)+r.slice(n+1):r}var fm;function nC(r,t){var e=Oo(r,t);if(!e)return r+"";var i=e[0],n=e[1],s=n-(fm=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Oo(r,Math.max(0,t+s-1))[0]}function _f(r,t){var e=Oo(r,t);if(!e)return r+"";var i=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}const vf={"%":(r,t)=>(r*100).toFixed(t),b:r=>Math.round(r).toString(2),c:r=>r+"",d:JI,e:(r,t)=>r.toExponential(t),f:(r,t)=>r.toFixed(t),g:(r,t)=>r.toPrecision(t),o:r=>Math.round(r).toString(8),p:(r,t)=>_f(r*100,t),r:_f,s:nC,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function xf(r){return r}var wf=Array.prototype.map,bf=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function sC(r){var t=r.grouping===void 0||r.thousands===void 0?xf:tC(wf.call(r.grouping,Number),r.thousands+""),e=r.currency===void 0?"":r.currency[0]+"",i=r.currency===void 0?"":r.currency[1]+"",n=r.decimal===void 0?".":r.decimal+"",s=r.numerals===void 0?xf:eC(wf.call(r.numerals,String)),o=r.percent===void 0?"%":r.percent+"",a=r.minus===void 0?"":r.minus+"",h=r.nan===void 0?"NaN":r.nan+"";function l(c){c=Uo(c);var d=c.fill,f=c.align,p=c.sign,g=c.symbol,m=c.zero,y=c.width,x=c.comma,v=c.precision,_=c.trim,E=c.type;E==="n"?(x=!0,E="g"):vf[E]||(v===void 0&&(v=12),_=!0,E="g"),(m||d==="0"&&f==="=")&&(m=!0,d="0",f="=");var N=g==="$"?e:g==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",S=g==="$"?i:/[%p]/.test(E)?o:"",T=vf[E],D=/[defgprs%]/.test(E);v=v===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function B(k){var M=N,A=S,w,C,I;if(E==="c")A=T(k)+A,k="";else{k=+k;var R=k<0||1/k<0;if(k=isNaN(k)?h:T(Math.abs(k),v),_&&(k=iC(k)),R&&+k==0&&p!=="+"&&(R=!1),M=(R?p==="("?p:a:p==="-"||p==="("?"":p)+M,A=(E==="s"?bf[8+fm/3]:"")+A+(R&&p==="("?")":""),D){for(w=-1,C=k.length;++w<C;)if(I=k.charCodeAt(w),48>I||I>57){A=(I===46?n+k.slice(w+1):k.slice(w))+A,k=k.slice(0,w);break}}}x&&!m&&(k=t(k,1/0));var O=M.length+k.length+A.length,z=O<y?new Array(y-O+1).join(d):"";switch(x&&m&&(k=t(z+k,z.length?y-A.length:1/0),z=""),f){case"<":k=M+k+A+z;break;case"=":k=M+z+k+A;break;case"^":k=z.slice(0,O=z.length>>1)+M+k+A+z.slice(O);break;default:k=z+M+k+A;break}return s(k)}return B.toString=function(){return c+""},B}function u(c,d){var f=l((c=Uo(c),c.type="f",c)),p=Math.max(-8,Math.min(8,Math.floor(rn(d)/3)))*3,g=Math.pow(10,-p),m=bf[8+p/3];return function(y){return f(g*y)+m}}return{format:l,formatPrefix:u}}var Hs,pm,gm;oC({thousands:",",grouping:[3],currency:["$",""]});function oC(r){return Hs=sC(r),pm=Hs.format,gm=Hs.formatPrefix,Hs}function aC(r){return Math.max(0,-rn(Math.abs(r)))}function hC(r,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(rn(t)/3)))*3-rn(Math.abs(r)))}function lC(r,t){return r=Math.abs(r),t=Math.abs(t)-r,Math.max(0,rn(t)-rn(r))+1}function uC(r){var t=0,e=r.children,i=e&&e.length;if(!i)t=1;else for(;--i>=0;)t+=e[i].value;r.value=t}function cC(){return this.eachAfter(uC)}function dC(r,t){let e=-1;for(const i of this)r.call(t,i,++e,this);return this}function fC(r,t){for(var e=this,i=[e],n,s,o=-1;e=i.pop();)if(r.call(t,e,++o,this),n=e.children)for(s=n.length-1;s>=0;--s)i.push(n[s]);return this}function pC(r,t){for(var e=this,i=[e],n=[],s,o,a,h=-1;e=i.pop();)if(n.push(e),s=e.children)for(o=0,a=s.length;o<a;++o)i.push(s[o]);for(;e=n.pop();)r.call(t,e,++h,this);return this}function gC(r,t){let e=-1;for(const i of this)if(r.call(t,i,++e,this))return i}function mC(r){return this.eachAfter(function(t){for(var e=+r(t.data)||0,i=t.children,n=i&&i.length;--n>=0;)e+=i[n].value;t.value=e})}function yC(r){return this.eachBefore(function(t){t.children&&t.children.sort(r)})}function _C(r){for(var t=this,e=vC(t,r),i=[t];t!==e;)t=t.parent,i.push(t);for(var n=i.length;r!==e;)i.splice(n,0,r),r=r.parent;return i}function vC(r,t){if(r===t)return r;var e=r.ancestors(),i=t.ancestors(),n=null;for(r=e.pop(),t=i.pop();r===t;)n=r,r=e.pop(),t=i.pop();return n}function xC(){for(var r=this,t=[r];r=r.parent;)t.push(r);return t}function wC(){return Array.from(this)}function bC(){var r=[];return this.eachBefore(function(t){t.children||r.push(t)}),r}function EC(){var r=this,t=[];return r.each(function(e){e!==r&&t.push({source:e.parent,target:e})}),t}function*AC(){var r=this,t,e=[r],i,n,s;do for(t=e.reverse(),e=[];r=t.pop();)if(yield r,i=r.children)for(n=0,s=i.length;n<s;++n)e.push(i[n]);while(e.length)}function mm(r,t){r instanceof Map?(r=[void 0,r],t===void 0&&(t=IC)):t===void 0&&(t=SC);for(var e=new nn(r),i,n=[e],s,o,a,h;i=n.pop();)if((o=t(i.data))&&(h=(o=Array.from(o)).length))for(i.children=o,a=h-1;a>=0;--a)n.push(s=o[a]=new nn(o[a])),s.parent=i,s.depth=i.depth+1;return e.eachBefore(ym)}function TC(){return mm(this).eachBefore(CC)}function SC(r){return r.children}function IC(r){return Array.isArray(r)?r[1]:null}function CC(r){r.data.value!==void 0&&(r.value=r.data.value),r.data=r.data.data}function ym(r){var t=0;do r.height=t;while((r=r.parent)&&r.height<++t)}function nn(r){this.data=r,this.depth=this.height=0,this.parent=null}nn.prototype=mm.prototype={constructor:nn,count:cC,each:dC,eachAfter:pC,eachBefore:fC,find:gC,sum:mC,sort:yC,path:_C,ancestors:xC,descendants:wC,leaves:bC,links:EC,copy:TC,[Symbol.iterator]:AC};function dh(r){return r==null?null:NC(r)}function NC(r){if(typeof r!="function")throw new Error;return r}var RC={depth:-1},Ef={},fh={};function PC(r){return r.id}function MC(r){return r.parentId}function _m(){var r=PC,t=MC,e;function i(n){var s=Array.from(n),o=r,a=t,h,l,u,c,d,f,p,g,m=new Map;if(e!=null){const y=s.map((_,E)=>DC(e(_,E,n))),x=y.map(Af),v=new Set(y).add("");for(const _ of x)v.has(_)||(v.add(_),y.push(_),x.push(Af(_)),s.push(fh));o=(_,E)=>y[E],a=(_,E)=>x[E]}for(u=0,h=s.length;u<h;++u)l=s[u],f=s[u]=new nn(l),(p=o(l,u,n))!=null&&(p+="")&&(g=f.id=p,m.set(g,m.has(g)?Ef:f)),(p=a(l,u,n))!=null&&(p+="")&&(f.parent=p);for(u=0;u<h;++u)if(f=s[u],p=f.parent){if(d=m.get(p),!d)throw new Error("missing: "+p);if(d===Ef)throw new Error("ambiguous: "+p);d.children?d.children.push(f):d.children=[f],f.parent=d}else{if(c)throw new Error("multiple roots");c=f}if(!c)throw new Error("no root");if(e!=null){for(;c.data===fh&&c.children.length===1;)c=c.children[0],--h;for(let y=s.length-1;y>=0&&(f=s[y],f.data===fh);--y)f.data=null}if(c.parent=RC,c.eachBefore(function(y){y.depth=y.parent.depth+1,--h}).eachBefore(ym),c.parent=null,h>0)throw new Error("cycle");return c}return i.id=function(n){return arguments.length?(r=dh(n),i):r},i.parentId=function(n){return arguments.length?(t=dh(n),i):t},i.path=function(n){return arguments.length?(e=dh(n),i):e},i}function DC(r){r=`${r}`;let t=r.length;return Ll(r,t-1)&&!Ll(r,t-2)&&(r=r.slice(0,-1)),r[0]==="/"?r:`/${r}`}function Af(r){let t=r.length;if(t<2)return"";for(;--t>1&&!Ll(r,t););return r.slice(0,t)}function Ll(r,t){if(r[t]==="/"){let e=0;for(;t>0&&r[--t]==="\\";)++e;if(!(e&1))return!0}return!1}function LC(r,t){return r.parent===t.parent?1:2}function ph(r){var t=r.children;return t?t[0]:r.t}function gh(r){var t=r.children;return t?t[t.length-1]:r.t}function BC(r,t,e){var i=e/(t.i-r.i);t.c-=i,t.s+=e,r.c+=i,t.z+=e,t.m+=e}function kC(r){for(var t=0,e=0,i=r.children,n=i.length,s;--n>=0;)s=i[n],s.z+=t,s.m+=t,t+=s.s+(e+=s.c)}function FC(r,t,e){return r.a.parent===t.parent?r.a:e}function ao(r,t){this._=r,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}ao.prototype=Object.create(nn.prototype);function OC(r){for(var t=new ao(r,0),e,i=[t],n,s,o,a;e=i.pop();)if(s=e._.children)for(e.children=new Array(a=s.length),o=a-1;o>=0;--o)i.push(n=e.children[o]=new ao(s[o],o)),n.parent=e;return(t.parent=new ao(null,0)).children=[t],t}function UC(){var r=LC,t=1,e=1,i=null;function n(l){var u=OC(l);if(u.eachAfter(s),u.parent.m=-u.z,u.eachBefore(o),i)l.eachBefore(h);else{var c=l,d=l,f=l;l.eachBefore(function(x){x.x<c.x&&(c=x),x.x>d.x&&(d=x),x.depth>f.depth&&(f=x)});var p=c===d?1:r(c,d)/2,g=p-c.x,m=t/(d.x+p+g),y=e/(f.depth||1);l.eachBefore(function(x){x.x=(x.x+g)*m,x.y=x.depth*y})}return l}function s(l){var u=l.children,c=l.parent.children,d=l.i?c[l.i-1]:null;if(u){kC(l);var f=(u[0].z+u[u.length-1].z)/2;d?(l.z=d.z+r(l._,d._),l.m=l.z-f):l.z=f}else d&&(l.z=d.z+r(l._,d._));l.parent.A=a(l,d,l.parent.A||c[0])}function o(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,u,c){if(u){for(var d=l,f=l,p=u,g=d.parent.children[0],m=d.m,y=f.m,x=p.m,v=g.m,_;p=gh(p),d=ph(d),p&&d;)g=ph(g),f=gh(f),f.a=l,_=p.z+x-d.z-m+r(p._,d._),_>0&&(BC(FC(p,l,c),l,_),m+=_,y+=_),x+=p.m,m+=d.m,v+=g.m,y+=f.m;p&&!gh(f)&&(f.t=p,f.m+=x-y),d&&!ph(g)&&(g.t=d,g.m+=m-v,c=l)}return c}function h(l){l.x*=t,l.y=l.depth*e}return n.separation=function(l){return arguments.length?(r=l,n):r},n.size=function(l){return arguments.length?(i=!1,t=+l[0],e=+l[1],n):i?null:[t,e]},n.nodeSize=function(l){return arguments.length?(i=!0,t=+l[0],e=+l[1],n):i?[t,e]:null},n}function vm(r,t){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(t).domain(r);break}return this}const Tf=Symbol("implicit");function xm(){var r=new El,t=[],e=[],i=Tf;function n(s){let o=r.get(s);if(o===void 0){if(i!==Tf)return i;r.set(s,o=t.push(s)-1)}return e[o%e.length]}return n.domain=function(s){if(!arguments.length)return t.slice();t=[],r=new El;for(const o of s)r.has(o)||r.set(o,t.push(o)-1);return n},n.range=function(s){return arguments.length?(e=Array.from(s),n):e.slice()},n.unknown=function(s){return arguments.length?(i=s,n):i},n.copy=function(){return xm(t,e).unknown(i)},vm.apply(n,arguments),n}function GC(r){return function(){return r}}function $C(r){return+r}var Sf=[0,1];function kr(r){return r}function Bl(r,t){return(t-=r=+r)?function(e){return(e-r)/t}:GC(isNaN(t)?NaN:.5)}function HC(r,t){var e;return r>t&&(e=r,r=t,t=e),function(i){return Math.max(r,Math.min(t,i))}}function zC(r,t,e){var i=r[0],n=r[1],s=t[0],o=t[1];return n<i?(i=Bl(n,i),s=e(o,s)):(i=Bl(i,n),s=e(s,o)),function(a){return s(i(a))}}function XC(r,t,e){var i=Math.min(r.length,t.length)-1,n=new Array(i),s=new Array(i),o=-1;for(r[i]<r[0]&&(r=r.slice().reverse(),t=t.slice().reverse());++o<i;)n[o]=Bl(r[o],r[o+1]),s[o]=e(t[o],t[o+1]);return function(a){var h=UE(r,a,1,i)-1;return s[h](n[h](a))}}function VC(r,t){return t.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function WC(){var r=Sf,t=Sf,e=cu,i,n,s,o=kr,a,h,l;function u(){var d=Math.min(r.length,t.length);return o!==kr&&(o=HC(r[0],r[d-1])),a=d>2?XC:zC,h=l=null,c}function c(d){return d==null||isNaN(d=+d)?s:(h||(h=a(r.map(i),t,e)))(i(o(d)))}return c.invert=function(d){return o(n((l||(l=a(t,r.map(i),Pe)))(d)))},c.domain=function(d){return arguments.length?(r=Array.from(d,$C),u()):r.slice()},c.range=function(d){return arguments.length?(t=Array.from(d),u()):t.slice()},c.rangeRound=function(d){return t=Array.from(d),e=sS,u()},c.clamp=function(d){return arguments.length?(o=d?!0:kr,u()):o!==kr},c.interpolate=function(d){return arguments.length?(e=d,u()):e},c.unknown=function(d){return arguments.length?(s=d,c):s},function(d,f){return i=d,n=f,u()}}function jC(r,t,e,i){var n=qE(r,t,e),s;switch(i=Uo(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(r),Math.abs(t));return i.precision==null&&!isNaN(s=hC(n,o))&&(i.precision=s),gm(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=lC(n,Math.max(Math.abs(r),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=aC(n))&&(i.precision=s-(i.type==="%")*2);break}}return pm(i)}function YC(r){var t=r.domain;return r.ticks=function(e){var i=t();return YE(i[0],i[i.length-1],e??10)},r.tickFormat=function(e,i){var n=t();return jC(n[0],n[n.length-1],e??10,i)},r.nice=function(e){e==null&&(e=10);var i=t(),n=0,s=i.length-1,o=i[n],a=i[s],h,l,u=10;for(a<o&&(l=o,o=a,a=l,l=n,n=s,s=l);u-- >0;){if(l=Tl(o,a,e),l===h)return i[n]=o,i[s]=a,t(i);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;h=l}return r},r}function If(r){return function(t){return t<0?-Math.pow(-t,r):Math.pow(t,r)}}function qC(r){return r<0?-Math.sqrt(-r):Math.sqrt(r)}function KC(r){return r<0?-r*r:r*r}function ZC(r){var t=r(kr,kr),e=1;function i(){return e===1?r(kr,kr):e===.5?r(qC,KC):r(If(e),If(1/e))}return t.exponent=function(n){return arguments.length?(e=+n,i()):e},YC(t)}function wm(){var r=ZC(WC());return r.copy=function(){return VC(r,wm()).exponent(r.exponent())},vm.apply(r,arguments),r}function QC(){return wm.apply(null,arguments).exponent(.5)}const zs=r=>()=>r;function JC(r,{sourceEvent:t,target:e,transform:i,dispatch:n}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:n}})}function mr(r,t,e){this.k=r,this.x=t,this.y=e}mr.prototype={constructor:mr,scale:function(r){return r===1?this:new mr(this.k*r,this.x,this.y)},translate:function(r,t){return r===0&t===0?this:new mr(this.k,this.x+this.k*r,this.y+this.k*t)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var vu=new mr(1,0,0);mr.prototype;function mh(r){r.stopImmediatePropagation()}function wn(r){r.preventDefault(),r.stopImmediatePropagation()}function tN(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function eN(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function Cf(){return this.__zoom||vu}function rN(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function iN(){return navigator.maxTouchPoints||"ontouchstart"in this}function nN(r,t,e){var i=r.invertX(t[0][0])-e[0][0],n=r.invertX(t[1][0])-e[1][0],s=r.invertY(t[0][1])-e[0][1],o=r.invertY(t[1][1])-e[1][1];return r.translate(n>i?(i+n)/2:Math.min(0,i)||Math.max(0,n),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function sN(){var r=tN,t=eN,e=nN,i=rN,n=iN,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,h=fS,l=ss("start","zoom","end"),u,c,d,f=500,p=150,g=0,m=10;function y(w){w.property("__zoom",Cf).on("wheel.zoom",T,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",B).filter(n).on("touchstart.zoom",k).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(w,C,I,R){var O=w.selection?w.selection():w;O.property("__zoom",Cf),w!==O?E(w,C,I,R):O.interrupt().each(function(){N(this,arguments).event(R).start().zoom(null,typeof C=="function"?C.apply(this,arguments):C).end()})},y.scaleBy=function(w,C,I,R){y.scaleTo(w,function(){var O=this.__zoom.k,z=typeof C=="function"?C.apply(this,arguments):C;return O*z},I,R)},y.scaleTo=function(w,C,I,R){y.transform(w,function(){var O=t.apply(this,arguments),z=this.__zoom,P=I==null?_(O):typeof I=="function"?I.apply(this,arguments):I,F=z.invert(P),rt=typeof C=="function"?C.apply(this,arguments):C;return e(v(x(z,rt),P,F),O,o)},I,R)},y.translateBy=function(w,C,I,R){y.transform(w,function(){return e(this.__zoom.translate(typeof C=="function"?C.apply(this,arguments):C,typeof I=="function"?I.apply(this,arguments):I),t.apply(this,arguments),o)},null,R)},y.translateTo=function(w,C,I,R,O){y.transform(w,function(){var z=t.apply(this,arguments),P=this.__zoom,F=R==null?_(z):typeof R=="function"?R.apply(this,arguments):R;return e(vu.translate(F[0],F[1]).scale(P.k).translate(typeof C=="function"?-C.apply(this,arguments):-C,typeof I=="function"?-I.apply(this,arguments):-I),z,o)},R,O)};function x(w,C){return C=Math.max(s[0],Math.min(s[1],C)),C===w.k?w:new mr(C,w.x,w.y)}function v(w,C,I){var R=C[0]-I[0]*w.k,O=C[1]-I[1]*w.k;return R===w.x&&O===w.y?w:new mr(w.k,R,O)}function _(w){return[(+w[0][0]+ +w[1][0])/2,(+w[0][1]+ +w[1][1])/2]}function E(w,C,I,R){w.on("start.zoom",function(){N(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){N(this,arguments).event(R).end()}).tween("zoom",function(){var O=this,z=arguments,P=N(O,z).event(R),F=t.apply(O,z),rt=I==null?_(F):typeof I=="function"?I.apply(O,z):I,ft=Math.max(F[1][0]-F[0][0],F[1][1]-F[0][1]),ht=O.__zoom,Et=typeof C=="function"?C.apply(O,z):C,ct=h(ht.invert(rt).concat(ft/ht.k),Et.invert(rt).concat(ft/Et.k));return function(At){if(At===1)At=Et;else{var It=ct(At),Gt=ft/It[2];At=new mr(Gt,rt[0]-It[0]*Gt,rt[1]-It[1]*Gt)}P.zoom(null,At)}})}function N(w,C,I){return!I&&w.__zooming||new S(w,C)}function S(w,C){this.that=w,this.args=C,this.active=0,this.sourceEvent=null,this.extent=t.apply(w,C),this.taps=0}S.prototype={event:function(w){return w&&(this.sourceEvent=w),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(w,C){return this.mouse&&w!=="mouse"&&(this.mouse[1]=C.invert(this.mouse[0])),this.touch0&&w!=="touch"&&(this.touch0[1]=C.invert(this.touch0[0])),this.touch1&&w!=="touch"&&(this.touch1[1]=C.invert(this.touch1[0])),this.that.__zoom=C,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(w){var C=V(this.that).datum();l.call(w,this.that,new JC(w,{sourceEvent:this.sourceEvent,target:y,type:w,transform:this.that.__zoom,dispatch:l}),C)}};function T(w,...C){if(!r.apply(this,arguments))return;var I=N(this,C).event(w),R=this.__zoom,O=Math.max(s[0],Math.min(s[1],R.k*Math.pow(2,i.apply(this,arguments)))),z=cr(w);if(I.wheel)(I.mouse[0][0]!==z[0]||I.mouse[0][1]!==z[1])&&(I.mouse[1]=R.invert(I.mouse[0]=z)),clearTimeout(I.wheel);else{if(R.k===O)return;I.mouse=[z,R.invert(z)],oo(this),I.start()}wn(w),I.wheel=setTimeout(P,p),I.zoom("mouse",e(v(x(R,O),I.mouse[0],I.mouse[1]),I.extent,o));function P(){I.wheel=null,I.end()}}function D(w,...C){if(d||!r.apply(this,arguments))return;var I=w.currentTarget,R=N(this,C,!0).event(w),O=V(w.view).on("mousemove.zoom",rt,!0).on("mouseup.zoom",ft,!0),z=cr(w,I),P=w.clientX,F=w.clientY;Qg(w.view),mh(w),R.mouse=[z,this.__zoom.invert(z)],oo(this),R.start();function rt(ht){if(wn(ht),!R.moved){var Et=ht.clientX-P,ct=ht.clientY-F;R.moved=Et*Et+ct*ct>g}R.event(ht).zoom("mouse",e(v(R.that.__zoom,R.mouse[0]=cr(ht,I),R.mouse[1]),R.extent,o))}function ft(ht){O.on("mousemove.zoom mouseup.zoom",null),Jg(ht.view,R.moved),wn(ht),R.event(ht).end()}}function B(w,...C){if(r.apply(this,arguments)){var I=this.__zoom,R=cr(w.changedTouches?w.changedTouches[0]:w,this),O=I.invert(R),z=I.k*(w.shiftKey?.5:2),P=e(v(x(I,z),R,O),t.apply(this,C),o);wn(w),a>0?V(this).transition().duration(a).call(E,P,R,w):V(this).call(y.transform,P,R,w)}}function k(w,...C){if(r.apply(this,arguments)){var I=w.touches,R=I.length,O=N(this,C,w.changedTouches.length===R).event(w),z,P,F,rt;for(mh(w),P=0;P<R;++P)F=I[P],rt=cr(F,this),rt=[rt,this.__zoom.invert(rt),F.identifier],O.touch0?!O.touch1&&O.touch0[2]!==rt[2]&&(O.touch1=rt,O.taps=0):(O.touch0=rt,z=!0,O.taps=1+!!u);u&&(u=clearTimeout(u)),z&&(O.taps<2&&(c=rt[0],u=setTimeout(function(){u=null},f)),oo(this),O.start())}}function M(w,...C){if(this.__zooming){var I=N(this,C).event(w),R=w.changedTouches,O=R.length,z,P,F,rt;for(wn(w),z=0;z<O;++z)P=R[z],F=cr(P,this),I.touch0&&I.touch0[2]===P.identifier?I.touch0[0]=F:I.touch1&&I.touch1[2]===P.identifier&&(I.touch1[0]=F);if(P=I.that.__zoom,I.touch1){var ft=I.touch0[0],ht=I.touch0[1],Et=I.touch1[0],ct=I.touch1[1],At=(At=Et[0]-ft[0])*At+(At=Et[1]-ft[1])*At,It=(It=ct[0]-ht[0])*It+(It=ct[1]-ht[1])*It;P=x(P,Math.sqrt(At/It)),F=[(ft[0]+Et[0])/2,(ft[1]+Et[1])/2],rt=[(ht[0]+ct[0])/2,(ht[1]+ct[1])/2]}else if(I.touch0)F=I.touch0[0],rt=I.touch0[1];else return;I.zoom("touch",e(v(P,F,rt),I.extent,o))}}function A(w,...C){if(this.__zooming){var I=N(this,C).event(w),R=w.changedTouches,O=R.length,z,P;for(mh(w),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),z=0;z<O;++z)P=R[z],I.touch0&&I.touch0[2]===P.identifier?delete I.touch0:I.touch1&&I.touch1[2]===P.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(P=cr(P,this),Math.hypot(c[0]-P[0],c[1]-P[1])<m)){var F=V(this).on("dblclick.zoom");F&&F.apply(this,arguments)}}}return y.wheelDelta=function(w){return arguments.length?(i=typeof w=="function"?w:zs(+w),y):i},y.filter=function(w){return arguments.length?(r=typeof w=="function"?w:zs(!!w),y):r},y.touchable=function(w){return arguments.length?(n=typeof w=="function"?w:zs(!!w),y):n},y.extent=function(w){return arguments.length?(t=typeof w=="function"?w:zs([[+w[0][0],+w[0][1]],[+w[1][0],+w[1][1]]]),y):t},y.scaleExtent=function(w){return arguments.length?(s[0]=+w[0],s[1]=+w[1],y):[s[0],s[1]]},y.translateExtent=function(w){return arguments.length?(o[0][0]=+w[0][0],o[1][0]=+w[1][0],o[0][1]=+w[0][1],o[1][1]=+w[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(w){return arguments.length?(e=w,y):e},y.duration=function(w){return arguments.length?(a=+w,y):a},y.interpolate=function(w){return arguments.length?(h=w,y):h},y.on=function(){var w=l.on.apply(l,arguments);return w===l?y:w},y.clickDistance=function(w){return arguments.length?(g=(w=+w)*w,y):Math.sqrt(g)},y.tapDistance=function(w){return arguments.length?(m=+w,y):m},y}var xu=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"},ln={},ha={};ha.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";ha.SYMBOL_SUPPORT=typeof Symbol<"u";var bm=ha,oN=bm.ARRAY_BUFFER_SUPPORT,aN=bm.SYMBOL_SUPPORT,wu=function(t,e){var i,n,s,o,a;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||oN&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(s=0,o=t.length;s<o;s++)e(t[s],s);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(aN&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(i=t,s=0;a=i.next(),a.done!==!0;)e(a.value,s),s++;return}for(n in t)t.hasOwnProperty(n)&&e(t[n],n)},Em={};(function(r){var t=Math.pow(2,8)-1,e=Math.pow(2,16)-1,i=Math.pow(2,32)-1,n=Math.pow(2,7)-1,s=Math.pow(2,15)-1,o=Math.pow(2,31)-1;r.getPointerArray=function(h){var l=h-1;if(l<=t)return Uint8Array;if(l<=e)return Uint16Array;if(l<=i)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},r.getSignedPointerArray=function(h){var l=h-1;return l<=n?Int8Array:l<=s?Int16Array:l<=o?Int32Array:Float64Array},r.getNumberType=function(h){return h===(h|0)?Math.sign(h)===-1?h<=127&&h>=-128?Int8Array:h<=32767&&h>=-32768?Int16Array:Int32Array:h<=255?Uint8Array:h<=65535?Uint16Array:Uint32Array:Float64Array};var a={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};r.getMinimalRepresentation=function(h,l){var u=null,c=0,d,f,p,g,m;for(g=0,m=h.length;g<m;g++)p=l?l(h[g]):h[g],f=r.getNumberType(p),d=a[f.name],d>c&&(c=d,u=f);return u},r.isTypedArray=function(h){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(h)},r.concat=function(){var h=0,l,u,c;for(l=0,c=arguments.length;l<c;l++)h+=arguments[l].length;var d=new arguments[0].constructor(h);for(l=0,u=0;l<c;l++)d.set(arguments[l],u),u+=arguments[l].length;return d},r.indices=function(h){for(var l=r.getPointerArray(h),u=new l(h),c=0;c<h;c++)u[c]=c;return u}})(Em);var Am=wu,Tm=Em;function hN(r){return Array.isArray(r)||Tm.isTypedArray(r)}function bu(r){if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size}function lN(r){var t=bu(r),e=typeof t=="number"?new Array(t):[],i=0;return Am(r,function(n){e[i++]=n}),e}function uN(r){var t=bu(r),e=typeof t=="number"?Tm.getPointerArray(t):Array,i=typeof t=="number"?new Array(t):[],n=typeof t=="number"?new e(t):[],s=0;return Am(r,function(o){i[s]=o,n[s]=s++}),[i,n]}ln.isArrayLike=hN;ln.guessLength=bu;ln.toArray=lN;ln.toArrayWithIndices=uN;function ir(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol<"u"&&(ir.prototype[Symbol.iterator]=function(){return this});ir.of=function(){var r=arguments,t=r.length,e=0;return new ir(function(){return e>=t?{done:!0}:{done:!1,value:r[e++]}})};ir.empty=function(){var r=new ir(function(){return{done:!0}});return r};ir.fromSequence=function(r){var t=0,e=r.length;return new ir(function(){return t>=e?{done:!0}:{done:!1,value:r[t++]}})};ir.is=function(r){return r instanceof ir?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};var hs=ir;const Ae=Qn(hs);var yh=ln,Sm=hs;function Xt(r,t){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=t,this.items=new r(this.capacity),this.clear()}Xt.prototype.clear=function(){this.start=0,this.size=0};Xt.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var t=this.start+this.size;return t>=this.capacity&&(t-=this.capacity),this.items[t]=r,++this.size};Xt.prototype.unshift=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=r,this.start=t,++this.size};Xt.prototype.pop=function(){if(this.size!==0){this.size--;var r=this.start+this.size;return r>=this.capacity&&(r-=this.capacity),this.items[r]}};Xt.prototype.shift=function(){if(this.size!==0){var r=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[r]}};Xt.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};Xt.prototype.peekLast=function(){if(this.size!==0){var r=this.start+this.size-1;return r>=this.capacity&&(r-=this.capacity),this.items[r]}};Xt.prototype.get=function(r){if(!(this.size===0||r>=this.capacity))return r=this.start+r,r>=this.capacity&&(r-=this.capacity),this.items[r]};Xt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.capacity,i=this.size,n=this.start,s=0;s<i;)r.call(t,this.items[n],s,this),n++,s++,n===e&&(n=0)};Xt.prototype.toArray=function(){var r=this.start+this.size;if(r<this.capacity)return this.items.slice(this.start,r);for(var t=new this.ArrayClass(this.size),e=this.capacity,i=this.size,n=this.start,s=0;s<i;)t[s]=this.items[n],n++,s++,n===e&&(n=0);return t};Xt.prototype.values=function(){var r=this.items,t=this.capacity,e=this.size,i=this.start,n=0;return new Sm(function(){if(n>=e)return{done:!0};var s=r[i];return i++,n++,i===t&&(i=0),{value:s,done:!1}})};Xt.prototype.entries=function(){var r=this.items,t=this.capacity,e=this.size,i=this.start,n=0;return new Sm(function(){if(n>=e)return{done:!0};var s=r[i];return i++,i===t&&(i=0),{value:[n++,s],done:!1}})};typeof Symbol<"u"&&(Xt.prototype[Symbol.iterator]=Xt.prototype.values);Xt.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:Xt,enumerable:!1}),r};typeof Symbol<"u"&&(Xt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Xt.prototype.inspect);Xt.from=function(r,t,e){if(arguments.length<3&&(e=yh.guessLength(r),typeof e!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new Xt(t,e);if(yh.isArrayLike(r)){var n,s;for(n=0,s=r.length;n<s;n++)i.items[n]=r[n];return i.size=s,i}return yh.forEach(r,function(o){i.push(o)}),i};var cN=Xt,dN=cN;function yi(r){this.graph=r,this.queue=new dN(Array,r.order),this.seen=new Set,this.size=0}yi.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};yi.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};yi.prototype.forEachNodeYetUnseen=function(r){var t=this.seen,e=this.graph;e.someNode(function(i,n){if(t.size===e.order)return!0;if(t.has(i))return!1;var s=r(i,n);return!!s})};yi.prototype.has=function(r){return this.seen.has(r)};yi.prototype.push=function(r){var t=this.seen.size;return this.seen.add(r),t===this.seen.size?!1:(this.queue.push(r),this.size++,!0)};yi.prototype.pushWith=function(r,t){var e=this.seen.size;return this.seen.add(r),e===this.seen.size?!1:(this.queue.push(t),this.size++,!0)};yi.prototype.shift=function(){var r=this.queue.shift();return this.size=this.queue.size,r};function _i(r){this.graph=r,this.stack=new Array(r.order),this.seen=new Set,this.size=0}_i.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};_i.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};_i.prototype.forEachNodeYetUnseen=function(r){var t=this.seen,e=this.graph;e.someNode(function(i,n){if(t.size===e.order)return!0;if(t.has(i))return!1;var s=r(i,n);return!!s})};_i.prototype.has=function(r){return this.seen.has(r)};_i.prototype.push=function(r){var t=this.seen.size;return this.seen.add(r),t===this.seen.size?!1:(this.stack[this.size++]=r,!0)};_i.prototype.pushWith=function(r,t){var e=this.seen.size;return this.seen.add(r),e===this.seen.size?!1:(this.stack[this.size++]=t,!0)};_i.prototype.pop=function(){if(this.size!==0)return this.stack[--this.size]};var Eu={exports:{}},Yi=typeof Reflect=="object"?Reflect:null,Nf=Yi&&typeof Yi.apply=="function"?Yi.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},ho;Yi&&typeof Yi.ownKeys=="function"?ho=Yi.ownKeys:Object.getOwnPropertySymbols?ho=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ho=function(t){return Object.getOwnPropertyNames(t)};function fN(r){console&&console.warn&&console.warn(r)}var Im=Number.isNaN||function(t){return t!==t};function Ct(){Ct.init.call(this)}Eu.exports=Ct;Eu.exports.once=yN;Ct.EventEmitter=Ct;Ct.prototype._events=void 0;Ct.prototype._eventsCount=0;Ct.prototype._maxListeners=void 0;var Rf=10;function la(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Ct,"defaultMaxListeners",{enumerable:!0,get:function(){return Rf},set:function(r){if(typeof r!="number"||r<0||Im(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Rf=r}});Ct.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ct.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Im(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Cm(r){return r._maxListeners===void 0?Ct.defaultMaxListeners:r._maxListeners}Ct.prototype.getMaxListeners=function(){return Cm(this)};Ct.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n=t==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=s[t];if(h===void 0)return!1;if(typeof h=="function")Nf(h,this,e);else for(var l=h.length,u=Dm(h,l),i=0;i<l;++i)Nf(u[i],this,e);return!0};function Nm(r,t,e,i){var n,s,o;if(la(e),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),s=r._events),o=s[t]),o===void 0)o=s[t]=e,++r._eventsCount;else if(typeof o=="function"?o=s[t]=i?[e,o]:[o,e]:i?o.unshift(e):o.push(e),n=Cm(r),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=t,a.count=o.length,fN(a)}return r}Ct.prototype.addListener=function(t,e){return Nm(this,t,e,!1)};Ct.prototype.on=Ct.prototype.addListener;Ct.prototype.prependListener=function(t,e){return Nm(this,t,e,!0)};function pN(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Rm(r,t,e){var i={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},n=pN.bind(i);return n.listener=e,i.wrapFn=n,n}Ct.prototype.once=function(t,e){return la(e),this.on(t,Rm(this,t,e)),this};Ct.prototype.prependOnceListener=function(t,e){return la(e),this.prependListener(t,Rm(this,t,e)),this};Ct.prototype.removeListener=function(t,e){var i,n,s,o,a;if(la(e),n=this._events,n===void 0)return this;if(i=n[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():gN(i,s),i.length===1&&(n[t]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};Ct.prototype.off=Ct.prototype.removeListener;Ct.prototype.removeAllListeners=function(t){var e,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var s=Object.keys(i),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this};function Pm(r,t,e){var i=r._events;if(i===void 0)return[];var n=i[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?mN(n):Dm(n,n.length)}Ct.prototype.listeners=function(t){return Pm(this,t,!0)};Ct.prototype.rawListeners=function(t){return Pm(this,t,!1)};Ct.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):Mm.call(r,t)};Ct.prototype.listenerCount=Mm;function Mm(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Ct.prototype.eventNames=function(){return this._eventsCount>0?ho(this._events):[]};function Dm(r,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=r[i];return e}function gN(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function mN(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function yN(r,t){return new Promise(function(e,i){function n(o){r.removeListener(t,s),i(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",n),e([].slice.call(arguments))}Lm(r,t,s,{once:!0}),t!=="error"&&_N(r,n,{once:!0})})}function _N(r,t,e){typeof r.on=="function"&&Lm(r,"error",t,e)}function Lm(r,t,e,i){if(typeof r.on=="function")i.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function n(s){i.once&&r.removeEventListener(t,n),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var vN=Eu.exports,xN=hs,Bm=ha,wN=Bm.ARRAY_BUFFER_SUPPORT,bN=Bm.SYMBOL_SUPPORT;function EN(r){return typeof r=="string"||Array.isArray(r)||wN&&ArrayBuffer.isView(r)?xN.fromSequence(r):typeof r!="object"||r===null?null:bN&&typeof r[Symbol.iterator]=="function"?r[Symbol.iterator]():typeof r.next=="function"?r:null}var km=function(t){var e=EN(t);if(!e)throw new Error("obliterator: target is not iterable nor a valid iterator.");return e},AN=km,TN=function(t,e){for(var i=arguments.length>1?e:1/0,n=i!==1/0?new Array(i):[],s,o=0,a=AN(t);;){if(o===i)return n;if(s=a.next(),s.done)return o!==e&&(n.length=o),n;n[o++]=s.value}};const Fm=Qn(TN);var SN=hs,IN=km,CN=function(){var t=arguments,e=null,i=-1;return new SN(function(){var s=null;do{if(e===null){if(i++,i>=t.length)return{done:!0};e=IN(t[i])}if(s=e.next(),s.done===!0){e=null;continue}break}while(!0);return s})};const vr=Qn(CN);function NN(){const r=arguments[0];for(let t=1,e=arguments.length;t<e;t++)if(arguments[t])for(const i in arguments[t])r[i]=arguments[t][i];return r}let Kt=NN;typeof Object.assign=="function"&&(Kt=Object.assign);function Ee(r,t,e,i){const n=r._nodes.get(t);let s=null;return n&&(i==="mixed"?s=n.out&&n.out[e]||n.undirected&&n.undirected[e]:i==="directed"?s=n.out&&n.out[e]:s=n.undirected&&n.undirected[e]),s}function ne(r){return typeof r=="object"&&r!==null}function Om(r){let t;for(t in r)return!1;return!0}function ve(r,t,e){Object.defineProperty(r,t,{enumerable:!1,configurable:!1,writable:!0,value:e})}function Ie(r,t,e){const i={enumerable:!0,configurable:!0};typeof e=="function"?i.get=e:(i.value=e,i.writable=!1),Object.defineProperty(r,t,i)}function Pf(r){return!(!ne(r)||r.attributes&&!Array.isArray(r.attributes))}function RN(){let r=Math.floor(Math.random()*256)&255;return()=>r++}class Au extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class Y extends Au{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Y.prototype.constructor)}}class $ extends Au{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$.prototype.constructor)}}class ot extends Au{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ot.prototype.constructor)}}function Um(r,t){this.key=r,this.attributes=t,this.clear()}Um.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Gm(r,t){this.key=r,this.attributes=t,this.clear()}Gm.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function $m(r,t){this.key=r,this.attributes=t,this.clear()}$m.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function un(r,t,e,i,n){this.key=t,this.attributes=n,this.undirected=r,this.source=e,this.target=i}un.prototype.attach=function(){let r="out",t="in";this.undirected&&(r=t="undirected");const e=this.source.key,i=this.target.key;this.source[r][i]=this,!(this.undirected&&e===i)&&(this.target[t][e]=this)};un.prototype.attachMulti=function(){let r="out",t="in";const e=this.source.key,i=this.target.key;this.undirected&&(r=t="undirected");const n=this.source[r],s=n[i];if(typeof s>"u"){n[i]=this,this.undirected&&e===i||(this.target[t][e]=this);return}s.previous=this,this.next=s,n[i]=this,this.target[t][e]=this};un.prototype.detach=function(){const r=this.source.key,t=this.target.key;let e="out",i="in";this.undirected&&(e=i="undirected"),delete this.source[e][t],delete this.target[i][r]};un.prototype.detachMulti=function(){const r=this.source.key,t=this.target.key;let e="out",i="in";this.undirected&&(e=i="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[e][t],delete this.target[i][r]):(this.next.previous=void 0,this.source[e][t]=this.next,this.target[i][r]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Hm=0,zm=1,PN=2,Xm=3;function Ar(r,t,e,i,n,s,o){let a,h,l,u;if(i=""+i,e===Hm){if(a=r._nodes.get(i),!a)throw new $(`Graph.${t}: could not find the "${i}" node in the graph.`);l=n,u=s}else if(e===Xm){if(n=""+n,h=r._edges.get(n),!h)throw new $(`Graph.${t}: could not find the "${n}" edge in the graph.`);const c=h.source.key,d=h.target.key;if(i===c)a=h.target;else if(i===d)a=h.source;else throw new $(`Graph.${t}: the "${i}" node is not attached to the "${n}" edge (${c}, ${d}).`);l=s,u=o}else{if(h=r._edges.get(i),!h)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`);e===zm?a=h.source:a=h.target,l=n,u=s}return[a,l,u]}function MN(r,t,e){r.prototype[t]=function(i,n,s){const[o,a]=Ar(this,t,e,i,n,s);return o.attributes[a]}}function DN(r,t,e){r.prototype[t]=function(i,n){const[s]=Ar(this,t,e,i,n);return s.attributes}}function LN(r,t,e){r.prototype[t]=function(i,n,s){const[o,a]=Ar(this,t,e,i,n,s);return o.attributes.hasOwnProperty(a)}}function BN(r,t,e){r.prototype[t]=function(i,n,s,o){const[a,h,l]=Ar(this,t,e,i,n,s,o);return a.attributes[h]=l,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function kN(r,t,e){r.prototype[t]=function(i,n,s,o){const[a,h,l]=Ar(this,t,e,i,n,s,o);if(typeof l!="function")throw new Y(`Graph.${t}: updater should be a function.`);const u=a.attributes,c=l(u[h]);return u[h]=c,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function FN(r,t,e){r.prototype[t]=function(i,n,s){const[o,a]=Ar(this,t,e,i,n,s);return delete o.attributes[a],this.emit("nodeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:a}),this}}function ON(r,t,e){r.prototype[t]=function(i,n,s){const[o,a]=Ar(this,t,e,i,n,s);if(!ne(a))throw new Y(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=a,this.emit("nodeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function UN(r,t,e){r.prototype[t]=function(i,n,s){const[o,a]=Ar(this,t,e,i,n,s);if(!ne(a))throw new Y(`Graph.${t}: provided attributes are not a plain object.`);return Kt(o.attributes,a),this.emit("nodeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:a}),this}}function GN(r,t,e){r.prototype[t]=function(i,n,s){const[o,a]=Ar(this,t,e,i,n,s);if(typeof a!="function")throw new Y(`Graph.${t}: provided updater is not a function.`);return o.attributes=a(o.attributes),this.emit("nodeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const $N=[{name:r=>`get${r}Attribute`,attacher:MN},{name:r=>`get${r}Attributes`,attacher:DN},{name:r=>`has${r}Attribute`,attacher:LN},{name:r=>`set${r}Attribute`,attacher:BN},{name:r=>`update${r}Attribute`,attacher:kN},{name:r=>`remove${r}Attribute`,attacher:FN},{name:r=>`replace${r}Attributes`,attacher:ON},{name:r=>`merge${r}Attributes`,attacher:UN},{name:r=>`update${r}Attributes`,attacher:GN}];function HN(r){$N.forEach(function({name:t,attacher:e}){e(r,t("Node"),Hm),e(r,t("Source"),zm),e(r,t("Target"),PN),e(r,t("Opposite"),Xm)})}function zN(r,t,e){r.prototype[t]=function(i,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+n;if(n=arguments[2],s=Ee(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,s=this._edges.get(i),!s)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return s.attributes[n]}}function XN(r,t,e){r.prototype[t]=function(i){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,o=""+arguments[1];if(n=Ee(this,s,o,e),!n)throw new $(`Graph.${t}: could not find an edge for the given path ("${s}" - "${o}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,n=this._edges.get(i),!n)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return n.attributes}}function VN(r,t,e){r.prototype[t]=function(i,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+n;if(n=arguments[2],s=Ee(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,s=this._edges.get(i),!s)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return s.attributes.hasOwnProperty(n)}}function WN(r,t,e){r.prototype[t]=function(i,n,s){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,h=""+n;if(n=arguments[2],s=arguments[3],o=Ee(this,a,h,e),!o)throw new $(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes[n]=s,this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:n}),this}}function jN(r,t,e){r.prototype[t]=function(i,n,s){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,h=""+n;if(n=arguments[2],s=arguments[3],o=Ee(this,a,h,e),!o)throw new $(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof s!="function")throw new Y(`Graph.${t}: updater should be a function.`);return o.attributes[n]=s(o.attributes[n]),this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:n}),this}}function YN(r,t,e){r.prototype[t]=function(i,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+n;if(n=arguments[2],s=Ee(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,s=this._edges.get(i),!s)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return delete s.attributes[n],this.emit("edgeAttributesUpdated",{key:s.key,type:"remove",attributes:s.attributes,name:n}),this}}function qN(r,t,e){r.prototype[t]=function(i,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+n;if(n=arguments[2],s=Ee(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,s=this._edges.get(i),!s)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!ne(n))throw new Y(`Graph.${t}: provided attributes are not a plain object.`);return s.attributes=n,this.emit("edgeAttributesUpdated",{key:s.key,type:"replace",attributes:s.attributes}),this}}function KN(r,t,e){r.prototype[t]=function(i,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+n;if(n=arguments[2],s=Ee(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,s=this._edges.get(i),!s)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!ne(n))throw new Y(`Graph.${t}: provided attributes are not a plain object.`);return Kt(s.attributes,n),this.emit("edgeAttributesUpdated",{key:s.key,type:"merge",attributes:s.attributes,data:n}),this}}function ZN(r,t,e){r.prototype[t]=function(i,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ot(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ot(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+n;if(n=arguments[2],s=Ee(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ot(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,s=this._edges.get(i),!s)throw new $(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof n!="function")throw new Y(`Graph.${t}: provided updater is not a function.`);return s.attributes=n(s.attributes),this.emit("edgeAttributesUpdated",{key:s.key,type:"update",attributes:s.attributes}),this}}const QN=[{name:r=>`get${r}Attribute`,attacher:zN},{name:r=>`get${r}Attributes`,attacher:XN},{name:r=>`has${r}Attribute`,attacher:VN},{name:r=>`set${r}Attribute`,attacher:WN},{name:r=>`update${r}Attribute`,attacher:jN},{name:r=>`remove${r}Attribute`,attacher:YN},{name:r=>`replace${r}Attributes`,attacher:qN},{name:r=>`merge${r}Attributes`,attacher:KN},{name:r=>`update${r}Attributes`,attacher:ZN}];function JN(r){QN.forEach(function({name:t,attacher:e}){e(r,t("Edge"),"mixed"),e(r,t("DirectedEdge"),"directed"),e(r,t("UndirectedEdge"),"undirected")})}const tR=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function eR(r,t,e,i){let n=!1;for(const s in t){if(s===i)continue;const o=t[s];if(n=e(o.key,o.attributes,o.source.key,o.target.key,o.source.attributes,o.target.attributes,o.undirected),r&&n)return o.key}}function rR(r,t,e,i){let n,s,o,a=!1;for(const h in t)if(h!==i){n=t[h];do{if(s=n.source,o=n.target,a=e(n.key,n.attributes,s.key,o.key,s.attributes,o.attributes,n.undirected),r&&a)return n.key;n=n.next}while(n!==void 0)}}function _h(r,t){const e=Object.keys(r),i=e.length;let n,s=0;return new Ae(function(){do if(n)n=n.next;else{if(s>=i)return{done:!0};const a=e[s++];if(a===t){n=void 0;continue}n=r[a]}while(!n);return{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}}})}function iR(r,t,e,i){const n=t[e];if(!n)return;const s=n.source,o=n.target;if(i(n.key,n.attributes,s.key,o.key,s.attributes,o.attributes,n.undirected)&&r)return n.key}function nR(r,t,e,i){let n=t[e];if(!n)return;let s=!1;do{if(s=i(n.key,n.attributes,n.source.key,n.target.key,n.source.attributes,n.target.attributes,n.undirected),r&&s)return n.key;n=n.next}while(n!==void 0)}function vh(r,t){let e=r[t];return e.next!==void 0?new Ae(function(){if(!e)return{done:!0};const i={edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected};return e=e.next,{done:!1,value:i}}):Ae.of({edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected})}function sR(r,t){if(r.size===0)return[];if(t==="mixed"||t===r.type)return typeof Array.from=="function"?Array.from(r._edges.keys()):Fm(r._edges.keys(),r._edges.size);const e=t==="undirected"?r.undirectedSize:r.directedSize,i=new Array(e),n=t==="undirected",s=r._edges.values();let o=0,a,h;for(;a=s.next(),a.done!==!0;)h=a.value,h.undirected===n&&(i[o++]=h.key);return i}function Vm(r,t,e,i){if(t.size===0)return;const n=e!=="mixed"&&e!==t.type,s=e==="undirected";let o,a,h=!1;const l=t._edges.values();for(;o=l.next(),o.done!==!0;){if(a=o.value,n&&a.undirected!==s)continue;const{key:u,attributes:c,source:d,target:f}=a;if(h=i(u,c,d.key,f.key,d.attributes,f.attributes,a.undirected),r&&h)return u}}function oR(r,t){if(r.size===0)return Ae.empty();const e=t!=="mixed"&&t!==r.type,i=t==="undirected",n=r._edges.values();return new Ae(function(){let o,a;for(;;){if(o=n.next(),o.done)return o;if(a=o.value,!(e&&a.undirected!==i))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}})}function Tu(r,t,e,i,n,s){const o=t?rR:eR;let a;if(e!=="undirected"&&(i!=="out"&&(a=o(r,n.in,s),r&&a)||i!=="in"&&(a=o(r,n.out,s,i?void 0:n.key),r&&a))||e!=="directed"&&(a=o(r,n.undirected,s),r&&a))return a}function aR(r,t,e,i){const n=[];return Tu(!1,r,t,e,i,function(s){n.push(s)}),n}function hR(r,t,e){let i=Ae.empty();return r!=="undirected"&&(t!=="out"&&typeof e.in<"u"&&(i=vr(i,_h(e.in))),t!=="in"&&typeof e.out<"u"&&(i=vr(i,_h(e.out,t?void 0:e.key)))),r!=="directed"&&typeof e.undirected<"u"&&(i=vr(i,_h(e.undirected))),i}function Su(r,t,e,i,n,s,o){const a=e?nR:iR;let h;if(t!=="undirected"&&(typeof n.in<"u"&&i!=="out"&&(h=a(r,n.in,s,o),r&&h)||typeof n.out<"u"&&i!=="in"&&(i||n.key!==s)&&(h=a(r,n.out,s,o),r&&h))||t!=="directed"&&typeof n.undirected<"u"&&(h=a(r,n.undirected,s,o),r&&h))return h}function lR(r,t,e,i,n){const s=[];return Su(!1,r,t,e,i,n,function(o){s.push(o)}),s}function uR(r,t,e,i){let n=Ae.empty();return r!=="undirected"&&(typeof e.in<"u"&&t!=="out"&&i in e.in&&(n=vr(n,vh(e.in,i))),typeof e.out<"u"&&t!=="in"&&i in e.out&&(t||e.key!==i)&&(n=vr(n,vh(e.out,i)))),r!=="directed"&&typeof e.undirected<"u"&&i in e.undirected&&(n=vr(n,vh(e.undirected,i))),n}function cR(r,t){const{name:e,type:i,direction:n}=t;r.prototype[e]=function(s,o){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];if(!arguments.length)return sR(this,i);if(arguments.length===1){s=""+s;const a=this._nodes.get(s);if(typeof a>"u")throw new $(`Graph.${e}: could not find the "${s}" node in the graph.`);return aR(this.multi,i==="mixed"?this.type:i,n,a)}if(arguments.length===2){s=""+s,o=""+o;const a=this._nodes.get(s);if(!a)throw new $(`Graph.${e}:  could not find the "${s}" source node in the graph.`);if(!this._nodes.has(o))throw new $(`Graph.${e}:  could not find the "${o}" target node in the graph.`);return lR(i,this.multi,n,a,o)}throw new Y(`Graph.${e}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function dR(r,t){const{name:e,type:i,direction:n}=t,s="forEach"+e[0].toUpperCase()+e.slice(1,-1);r.prototype[s]=function(l,u,c){if(!(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)){if(arguments.length===1)return c=l,Vm(!1,this,i,c);if(arguments.length===2){l=""+l,c=u;const d=this._nodes.get(l);if(typeof d>"u")throw new $(`Graph.${s}: could not find the "${l}" node in the graph.`);return Tu(!1,this.multi,i==="mixed"?this.type:i,n,d,c)}if(arguments.length===3){l=""+l,u=""+u;const d=this._nodes.get(l);if(!d)throw new $(`Graph.${s}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(u))throw new $(`Graph.${s}:  could not find the "${u}" target node in the graph.`);return Su(!1,i,this.multi,n,d,u,c)}throw new Y(`Graph.${s}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const o="map"+e[0].toUpperCase()+e.slice(1);r.prototype[o]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop();let c;if(l.length===0){let d=0;i!=="directed"&&(d+=this.undirectedSize),i!=="undirected"&&(d+=this.directedSize),c=new Array(d);let f=0;l.push((p,g,m,y,x,v,_)=>{c[f++]=u(p,g,m,y,x,v,_)})}else c=[],l.push((d,f,p,g,m,y,x)=>{c.push(u(d,f,p,g,m,y,x))});return this[s].apply(this,l),c};const a="filter"+e[0].toUpperCase()+e.slice(1);r.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop(),c=[];return l.push((d,f,p,g,m,y,x)=>{u(d,f,p,g,m,y,x)&&c.push(d)}),this[s].apply(this,l),c};const h="reduce"+e[0].toUpperCase()+e.slice(1);r.prototype[h]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new Y(`Graph.${h}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new Y(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let u,c;l.length===2?(u=l[0],c=l[1],l=[]):l.length===3?(u=l[1],c=l[2],l=[l[0]]):l.length===4&&(u=l[2],c=l[3],l=[l[0],l[1]]);let d=c;return l.push((f,p,g,m,y,x,v)=>{d=u(d,f,p,g,m,y,x,v)}),this[s].apply(this,l),d}}function fR(r,t){const{name:e,type:i,direction:n}=t,s="find"+e[0].toUpperCase()+e.slice(1,-1);r.prototype[s]=function(h,l,u){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return!1;if(arguments.length===1)return u=h,Vm(!0,this,i,u);if(arguments.length===2){h=""+h,u=l;const c=this._nodes.get(h);if(typeof c>"u")throw new $(`Graph.${s}: could not find the "${h}" node in the graph.`);return Tu(!0,this.multi,i==="mixed"?this.type:i,n,c,u)}if(arguments.length===3){h=""+h,l=""+l;const c=this._nodes.get(h);if(!c)throw new $(`Graph.${s}:  could not find the "${h}" source node in the graph.`);if(!this._nodes.has(l))throw new $(`Graph.${s}:  could not find the "${l}" target node in the graph.`);return Su(!0,i,this.multi,n,c,l,u)}throw new Y(`Graph.${s}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const o="some"+e[0].toUpperCase()+e.slice(1,-1);r.prototype[o]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((c,d,f,p,g,m,y)=>l(c,d,f,p,g,m,y)),!!this[s].apply(this,h)};const a="every"+e[0].toUpperCase()+e.slice(1,-1);r.prototype[a]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((c,d,f,p,g,m,y)=>!l(c,d,f,p,g,m,y)),!this[s].apply(this,h)}}function pR(r,t){const{name:e,type:i,direction:n}=t,s=e.slice(0,-1)+"Entries";r.prototype[s]=function(o,a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return Ae.empty();if(!arguments.length)return oR(this,i);if(arguments.length===1){o=""+o;const h=this._nodes.get(o);if(!h)throw new $(`Graph.${s}: could not find the "${o}" node in the graph.`);return hR(i,n,h)}if(arguments.length===2){o=""+o,a=""+a;const h=this._nodes.get(o);if(!h)throw new $(`Graph.${s}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new $(`Graph.${s}:  could not find the "${a}" target node in the graph.`);return uR(i,n,h,a)}throw new Y(`Graph.${s}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function gR(r){tR.forEach(t=>{cR(r,t),dR(r,t),fR(r,t),pR(r,t)})}const mR=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function ua(){this.A=null,this.B=null}ua.prototype.wrap=function(r){this.A===null?this.A=r:this.B===null&&(this.B=r)};ua.prototype.has=function(r){return this.A!==null&&r in this.A||this.B!==null&&r in this.B};function bn(r,t,e,i,n){for(const s in i){const o=i[s],a=o.source,h=o.target,l=a===e?h:a;if(t&&t.has(l.key))continue;const u=n(l.key,l.attributes);if(r&&u)return l.key}}function Iu(r,t,e,i,n){if(t!=="mixed"){if(t==="undirected")return bn(r,null,i,i.undirected,n);if(typeof e=="string")return bn(r,null,i,i[e],n)}const s=new ua;let o;if(t!=="undirected"){if(e!=="out"){if(o=bn(r,null,i,i.in,n),r&&o)return o;s.wrap(i.in)}if(e!=="in"){if(o=bn(r,s,i,i.out,n),r&&o)return o;s.wrap(i.out)}}if(t!=="directed"&&(o=bn(r,s,i,i.undirected,n),r&&o))return o}function yR(r,t,e){if(r!=="mixed"){if(r==="undirected")return Object.keys(e.undirected);if(typeof t=="string")return Object.keys(e[t])}const i=[];return Iu(!1,r,t,e,function(n){i.push(n)}),i}function En(r,t,e){const i=Object.keys(e),n=i.length;let s=0;return new Ae(function(){let a=null;do{if(s>=n)return r&&r.wrap(e),{done:!0};const h=e[i[s++]],l=h.source,u=h.target;if(a=l===t?u:l,r&&r.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}})}function _R(r,t,e){if(r!=="mixed"){if(r==="undirected")return En(null,e,e.undirected);if(typeof t=="string")return En(null,e,e[t])}let i=Ae.empty();const n=new ua;return r!=="undirected"&&(t!=="out"&&(i=vr(i,En(n,e,e.in))),t!=="in"&&(i=vr(i,En(n,e,e.out)))),r!=="directed"&&(i=vr(i,En(n,e,e.undirected))),i}function vR(r,t){const{name:e,type:i,direction:n}=t;r.prototype[e]=function(s){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];s=""+s;const o=this._nodes.get(s);if(typeof o>"u")throw new $(`Graph.${e}: could not find the "${s}" node in the graph.`);return yR(i==="mixed"?this.type:i,n,o)}}function xR(r,t){const{name:e,type:i,direction:n}=t,s="forEach"+e[0].toUpperCase()+e.slice(1,-1);r.prototype[s]=function(l,u){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const c=this._nodes.get(l);if(typeof c>"u")throw new $(`Graph.${s}: could not find the "${l}" node in the graph.`);Iu(!1,i==="mixed"?this.type:i,n,c,u)};const o="map"+e[0].toUpperCase()+e.slice(1);r.prototype[o]=function(l,u){const c=[];return this[s](l,(d,f)=>{c.push(u(d,f))}),c};const a="filter"+e[0].toUpperCase()+e.slice(1);r.prototype[a]=function(l,u){const c=[];return this[s](l,(d,f)=>{u(d,f)&&c.push(d)}),c};const h="reduce"+e[0].toUpperCase()+e.slice(1);r.prototype[h]=function(l,u,c){if(arguments.length<3)throw new Y(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let d=c;return this[s](l,(f,p)=>{d=u(d,f,p)}),d}}function wR(r,t){const{name:e,type:i,direction:n}=t,s=e[0].toUpperCase()+e.slice(1,-1),o="find"+s;r.prototype[o]=function(l,u){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const c=this._nodes.get(l);if(typeof c>"u")throw new $(`Graph.${o}: could not find the "${l}" node in the graph.`);return Iu(!0,i==="mixed"?this.type:i,n,c,u)};const a="some"+s;r.prototype[a]=function(l,u){return!!this[o](l,u)};const h="every"+s;r.prototype[h]=function(l,u){return!this[o](l,(d,f)=>!u(d,f))}}function bR(r,t){const{name:e,type:i,direction:n}=t,s=e.slice(0,-1)+"Entries";r.prototype[s]=function(o){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return Ae.empty();o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new $(`Graph.${s}: could not find the "${o}" node in the graph.`);return _R(i==="mixed"?this.type:i,n,a)}}function ER(r){mR.forEach(t=>{vR(r,t),xR(r,t),wR(r,t),bR(r,t)})}function Xs(r,t,e,i,n){const s=i._nodes.values(),o=i.type;let a,h,l,u,c,d,f;for(;a=s.next(),a.done!==!0;){let p=!1;if(h=a.value,o!=="undirected"){u=h.out;for(l in u){c=u[l];do{if(d=c.target,p=!0,f=n(h.key,d.key,h.attributes,d.attributes,c.key,c.attributes,c.undirected),r&&f)return c;c=c.next}while(c)}}if(o!=="directed"){u=h.undirected;for(l in u)if(!(t&&h.key>l)){c=u[l];do{if(d=c.target,d.key!==l&&(d=c.source),p=!0,f=n(h.key,d.key,h.attributes,d.attributes,c.key,c.attributes,c.undirected),r&&f)return c;c=c.next}while(c)}}if(e&&!p&&(f=n(h.key,null,h.attributes,null,null,null,null),r&&f))return null}}function AR(r,t){const e={key:r};return Om(t.attributes)||(e.attributes=Kt({},t.attributes)),e}function TR(r,t,e){const i={key:t,source:e.source.key,target:e.target.key};return Om(e.attributes)||(i.attributes=Kt({},e.attributes)),r==="mixed"&&e.undirected&&(i.undirected=!0),i}function SR(r){if(!ne(r))throw new Y('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in r))throw new Y("Graph.import: serialized node is missing its key.");if("attributes"in r&&(!ne(r.attributes)||r.attributes===null))throw new Y("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function IR(r){if(!ne(r))throw new Y('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in r))throw new Y("Graph.import: serialized edge is missing its source.");if(!("target"in r))throw new Y("Graph.import: serialized edge is missing its target.");if("attributes"in r&&(!ne(r.attributes)||r.attributes===null))throw new Y("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in r&&typeof r.undirected!="boolean")throw new Y("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const CR=RN(),NR=new Set(["directed","undirected","mixed"]),Mf=new Set(["domain","_events","_eventsCount","_maxListeners"]),RR=[{name:r=>`${r}Edge`,generateKey:!0},{name:r=>`${r}DirectedEdge`,generateKey:!0,type:"directed"},{name:r=>`${r}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:r=>`${r}EdgeWithKey`},{name:r=>`${r}DirectedEdgeWithKey`,type:"directed"},{name:r=>`${r}UndirectedEdgeWithKey`,type:"undirected"}],PR={allowSelfLoops:!0,multi:!1,type:"mixed"};function MR(r,t,e){if(e&&!ne(e))throw new Y(`Graph.addNode: invalid attributes. Expecting an object but got "${e}"`);if(t=""+t,e=e||{},r._nodes.has(t))throw new ot(`Graph.addNode: the "${t}" node already exist in the graph.`);const i=new r.NodeDataClass(t,e);return r._nodes.set(t,i),r.emit("nodeAdded",{key:t,attributes:e}),i}function Df(r,t,e){const i=new r.NodeDataClass(t,e);return r._nodes.set(t,i),r.emit("nodeAdded",{key:t,attributes:e}),i}function Wm(r,t,e,i,n,s,o,a){if(!i&&r.type==="undirected")throw new ot(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(i&&r.type==="directed")throw new ot(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!ne(a))throw new Y(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`);if(s=""+s,o=""+o,a=a||{},!r.allowSelfLoops&&s===o)throw new ot(`Graph.${t}: source & target are the same ("${s}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const h=r._nodes.get(s),l=r._nodes.get(o);if(!h)throw new $(`Graph.${t}: source node "${s}" not found.`);if(!l)throw new $(`Graph.${t}: target node "${o}" not found.`);const u={key:null,undirected:i,source:s,target:o,attributes:a};if(e)n=r._edgeKeyGenerator();else if(n=""+n,r._edges.has(n))throw new ot(`Graph.${t}: the "${n}" edge already exists in the graph.`);if(!r.multi&&(i?typeof h.undirected[o]<"u":typeof h.out[o]<"u"))throw new ot(`Graph.${t}: an edge linking "${s}" to "${o}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const c=new un(i,n,h,l,a);r._edges.set(n,c);const d=s===o;return i?(h.undirectedDegree++,l.undirectedDegree++,d&&(h.undirectedLoops++,r._undirectedSelfLoopCount++)):(h.outDegree++,l.inDegree++,d&&(h.directedLoops++,r._directedSelfLoopCount++)),r.multi?c.attachMulti():c.attach(),i?r._undirectedSize++:r._directedSize++,u.key=n,r.emit("edgeAdded",u),n}function DR(r,t,e,i,n,s,o,a,h){if(!i&&r.type==="undirected")throw new ot(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(i&&r.type==="directed")throw new ot(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(h){if(typeof a!="function")throw new Y(`Graph.${t}: invalid updater function. Expecting a function but got "${a}"`)}else if(!ne(a))throw new Y(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`)}s=""+s,o=""+o;let l;if(h&&(l=a,a=void 0),!r.allowSelfLoops&&s===o)throw new ot(`Graph.${t}: source & target are the same ("${s}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let u=r._nodes.get(s),c=r._nodes.get(o),d,f;if(!e&&(d=r._edges.get(n),d)){if((d.source.key!==s||d.target.key!==o)&&(!i||d.source.key!==o||d.target.key!==s))throw new ot(`Graph.${t}: inconsistency detected when attempting to merge the "${n}" edge with "${s}" source & "${o}" target vs. ("${d.source.key}", "${d.target.key}").`);f=d}if(!f&&!r.multi&&u&&(f=i?u.undirected[o]:u.out[o]),f){const x=[f.key,!1,!1,!1];if(h?!l:!a)return x;if(h){const v=f.attributes;f.attributes=l(v),r.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else Kt(f.attributes,a),r.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:a});return x}a=a||{},h&&l&&(a=l(a));const p={key:null,undirected:i,source:s,target:o,attributes:a};if(e)n=r._edgeKeyGenerator();else if(n=""+n,r._edges.has(n))throw new ot(`Graph.${t}: the "${n}" edge already exists in the graph.`);let g=!1,m=!1;u||(u=Df(r,s,{}),g=!0,s===o&&(c=u,m=!0)),c||(c=Df(r,o,{}),m=!0),d=new un(i,n,u,c,a),r._edges.set(n,d);const y=s===o;return i?(u.undirectedDegree++,c.undirectedDegree++,y&&(u.undirectedLoops++,r._undirectedSelfLoopCount++)):(u.outDegree++,c.inDegree++,y&&(u.directedLoops++,r._directedSelfLoopCount++)),r.multi?d.attachMulti():d.attach(),i?r._undirectedSize++:r._directedSize++,p.key=n,r.emit("edgeAdded",p),[n,!0,g,m]}function Si(r,t){r._edges.delete(t.key);const{source:e,target:i,attributes:n}=t,s=t.undirected,o=e===i;s?(e.undirectedDegree--,i.undirectedDegree--,o&&(e.undirectedLoops--,r._undirectedSelfLoopCount--)):(e.outDegree--,i.inDegree--,o&&(e.directedLoops--,r._directedSelfLoopCount--)),r.multi?t.detachMulti():t.detach(),s?r._undirectedSize--:r._directedSize--,r.emit("edgeDropped",{key:t.key,attributes:n,source:e.key,target:i.key,undirected:s})}class Nt extends vN.EventEmitter{constructor(t){if(super(),t=Kt({},PR,t),typeof t.multi!="boolean")throw new Y(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!NR.has(t.type))throw new Y(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new Y(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const e=t.type==="mixed"?Um:t.type==="directed"?Gm:$m;ve(this,"NodeDataClass",e);const i="geid_"+CR()+"_";let n=0;const s=()=>{let o;do o=i+n++;while(this._edges.has(o));return o};ve(this,"_attributes",{}),ve(this,"_nodes",new Map),ve(this,"_edges",new Map),ve(this,"_directedSize",0),ve(this,"_undirectedSize",0),ve(this,"_directedSelfLoopCount",0),ve(this,"_undirectedSelfLoopCount",0),ve(this,"_edgeKeyGenerator",s),ve(this,"_options",t),Mf.forEach(o=>ve(this,o,this[o])),Ie(this,"order",()=>this._nodes.size),Ie(this,"size",()=>this._edges.size),Ie(this,"directedSize",()=>this._directedSize),Ie(this,"undirectedSize",()=>this._undirectedSize),Ie(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Ie(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Ie(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Ie(this,"multi",this._options.multi),Ie(this,"type",this._options.type),Ie(this,"allowSelfLoops",this._options.allowSelfLoops),Ie(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,e){if(this.type==="undirected")return!1;if(arguments.length===1){const i=""+t,n=this._edges.get(i);return!!n&&!n.undirected}else if(arguments.length===2){t=""+t,e=""+e;const i=this._nodes.get(t);return i?i.out.hasOwnProperty(e):!1}throw new Y(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,e){if(this.type==="directed")return!1;if(arguments.length===1){const i=""+t,n=this._edges.get(i);return!!n&&n.undirected}else if(arguments.length===2){t=""+t,e=""+e;const i=this._nodes.get(t);return i?i.undirected.hasOwnProperty(e):!1}throw new Y(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,e){if(arguments.length===1){const i=""+t;return this._edges.has(i)}else if(arguments.length===2){t=""+t,e=""+e;const i=this._nodes.get(t);return i?typeof i.out<"u"&&i.out.hasOwnProperty(e)||typeof i.undirected<"u"&&i.undirected.hasOwnProperty(e):!1}throw new Y(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,e){if(this.type==="undirected")return;if(t=""+t,e=""+e,this.multi)throw new ot("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const i=this._nodes.get(t);if(!i)throw new $(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.directedEdge: could not find the "${e}" target node in the graph.`);const n=i.out&&i.out[e]||void 0;if(n)return n.key}undirectedEdge(t,e){if(this.type==="directed")return;if(t=""+t,e=""+e,this.multi)throw new ot("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const i=this._nodes.get(t);if(!i)throw new $(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.undirectedEdge: could not find the "${e}" target node in the graph.`);const n=i.undirected&&i.undirected[e]||void 0;if(n)return n.key}edge(t,e){if(this.multi)throw new ot("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.edge: could not find the "${e}" target node in the graph.`);const n=i.out&&i.out[e]||i.undirected&&i.undirected[e]||void 0;if(n)return n.key}areDirectedNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in i.in||e in i.out}areOutNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in i.out}areInNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in i.in}areUndirectedNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:e in i.undirected}areNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(e in i.in||e in i.out)||this.type!=="directed"&&e in i.undirected}areInboundNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in i.in||this.type!=="directed"&&e in i.undirected}areOutboundNeighbors(t,e){t=""+t,e=""+e;const i=this._nodes.get(t);if(!i)throw new $(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in i.out||this.type!=="directed"&&e in i.undirected}inDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree}outDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree}directedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree}undirectedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree}inboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=e.undirectedDegree),this.type!=="undirected"&&(i+=e.inDegree),i}outboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=e.undirectedDegree),this.type!=="undirected"&&(i+=e.outDegree),i}degree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.degree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=e.undirectedDegree),this.type!=="undirected"&&(i+=e.inDegree+e.outDegree),i}inDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree-e.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree-e.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree-e.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree-e.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,n=0;return this.type!=="directed"&&(i+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(i+=e.inDegree,n+=e.directedLoops),i-n}outboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,n=0;return this.type!=="directed"&&(i+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(i+=e.outDegree,n+=e.directedLoops),i-n}degreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,n=0;return this.type!=="directed"&&(i+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(i+=e.inDegree+e.outDegree,n+=e.directedLoops*2),i-n}source(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.source: could not find the "${t}" edge in the graph.`);return e.source.key}target(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.target: could not find the "${t}" edge in the graph.`);return e.target.key}extremities(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[e.source.key,e.target.key]}opposite(t,e){t=""+t,e=""+e;const i=this._edges.get(e);if(!i)throw new $(`Graph.opposite: could not find the "${e}" edge in the graph.`);const n=i.source.key,s=i.target.key;if(t===n)return s;if(t===s)return n;throw new $(`Graph.opposite: the "${t}" node is not attached to the "${e}" edge (${n}, ${s}).`)}hasExtremity(t,e){t=""+t,e=""+e;const i=this._edges.get(t);if(!i)throw new $(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return i.source.key===e||i.target.key===e}isUndirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return e.undirected}isDirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!e.undirected}isSelfLoop(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return e.source===e.target}addNode(t,e){return MR(this,t,e).key}mergeNode(t,e){if(e&&!ne(e))throw new Y(`Graph.mergeNode: invalid attributes. Expecting an object but got "${e}"`);t=""+t,e=e||{};let i=this._nodes.get(t);return i?(e&&(Kt(i.attributes,e),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:i.attributes,data:e})),[t,!1]):(i=new this.NodeDataClass(t,e),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:e}),[t,!0])}updateNode(t,e){if(e&&typeof e!="function")throw new Y(`Graph.updateNode: invalid updater function. Expecting a function but got "${e}"`);t=""+t;let i=this._nodes.get(t);if(i){if(e){const s=i.attributes;i.attributes=e(s),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:i.attributes})}return[t,!1]}const n=e?e({}):{};return i=new this.NodeDataClass(t,n),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0]}dropNode(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.dropNode: could not find the "${t}" node in the graph.`);let i;if(this.type!=="undirected"){for(const n in e.out){i=e.out[n];do Si(this,i),i=i.next;while(i)}for(const n in e.in){i=e.in[n];do Si(this,i),i=i.next;while(i)}}if(this.type!=="directed")for(const n in e.undirected){i=e.undirected[n];do Si(this,i),i=i.next;while(i)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:e.attributes})}dropEdge(t){let e;if(arguments.length>1){const i=""+arguments[0],n=""+arguments[1];if(e=Ee(this,i,n,this.type),!e)throw new $(`Graph.dropEdge: could not find the "${i}" -> "${n}" edge in the graph.`)}else if(t=""+t,e=this._edges.get(t),!e)throw new $(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return Si(this,e),this}dropDirectedEdge(t,e){if(arguments.length<2)throw new ot("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ot("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,e=""+e;const i=Ee(this,t,e,"directed");if(!i)throw new $(`Graph.dropDirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Si(this,i),this}dropUndirectedEdge(t,e){if(arguments.length<2)throw new ot("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ot("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const i=Ee(this,t,e,"undirected");if(!i)throw new $(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Si(this,i),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let e;for(;e=t.next(),e.done!==!0;)e.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,e){return this._attributes[t]=e,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,e){if(typeof e!="function")throw new Y("Graph.updateAttribute: updater should be a function.");const i=this._attributes[t];return this._attributes[t]=e(i),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!ne(t))throw new Y("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!ne(t))throw new Y("Graph.mergeAttributes: provided attributes are not a plain object.");return Kt(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new Y("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,e){if(typeof t!="function")throw new Y("Graph.updateEachNodeAttributes: expecting an updater function.");if(e&&!Pf(e))throw new Y("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._nodes.values();let n,s;for(;n=i.next(),n.done!==!0;)s=n.value,s.attributes=t(s.key,s.attributes);this.emit("eachNodeAttributesUpdated",{hints:e||null})}updateEachEdgeAttributes(t,e){if(typeof t!="function")throw new Y("Graph.updateEachEdgeAttributes: expecting an updater function.");if(e&&!Pf(e))throw new Y("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._edges.values();let n,s,o,a;for(;n=i.next(),n.done!==!0;)s=n.value,o=s.source,a=s.target,s.attributes=t(s.key,s.attributes,o.key,a.key,o.attributes,a.attributes,s.undirected);this.emit("eachEdgeAttributesUpdated",{hints:e||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new Y("Graph.forEachAdjacencyEntry: expecting a callback.");Xs(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new Y("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");Xs(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new Y("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");Xs(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new Y("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");Xs(!1,!0,!0,this,t)}nodes(){return typeof Array.from=="function"?Array.from(this._nodes.keys()):Fm(this._nodes.keys(),this._nodes.size)}forEachNode(t){if(typeof t!="function")throw new Y("Graph.forEachNode: expecting a callback.");const e=this._nodes.values();let i,n;for(;i=e.next(),i.done!==!0;)n=i.value,t(n.key,n.attributes)}findNode(t){if(typeof t!="function")throw new Y("Graph.findNode: expecting a callback.");const e=this._nodes.values();let i,n;for(;i=e.next(),i.done!==!0;)if(n=i.value,t(n.key,n.attributes))return n.key}mapNodes(t){if(typeof t!="function")throw new Y("Graph.mapNode: expecting a callback.");const e=this._nodes.values();let i,n;const s=new Array(this.order);let o=0;for(;i=e.next(),i.done!==!0;)n=i.value,s[o++]=t(n.key,n.attributes);return s}someNode(t){if(typeof t!="function")throw new Y("Graph.someNode: expecting a callback.");const e=this._nodes.values();let i,n;for(;i=e.next(),i.done!==!0;)if(n=i.value,t(n.key,n.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new Y("Graph.everyNode: expecting a callback.");const e=this._nodes.values();let i,n;for(;i=e.next(),i.done!==!0;)if(n=i.value,!t(n.key,n.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new Y("Graph.filterNodes: expecting a callback.");const e=this._nodes.values();let i,n;const s=[];for(;i=e.next(),i.done!==!0;)n=i.value,t(n.key,n.attributes)&&s.push(n.key);return s}reduceNodes(t,e){if(typeof t!="function")throw new Y("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new Y("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let i=e;const n=this._nodes.values();let s,o;for(;s=n.next(),s.done!==!0;)o=s.value,i=t(i,o.key,o.attributes);return i}nodeEntries(){const t=this._nodes.values();return new Ae(()=>{const e=t.next();if(e.done)return e;const i=e.value;return{value:{node:i.key,attributes:i.attributes},done:!1}})}export(){const t=new Array(this._nodes.size);let e=0;this._nodes.forEach((n,s)=>{t[e++]=AR(s,n)});const i=new Array(this._edges.size);return e=0,this._edges.forEach((n,s)=>{i[e++]=TR(this.type,s,n)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:i}}import(t,e=!1){if(t instanceof Nt)return t.forEachNode((h,l)=>{e?this.mergeNode(h,l):this.addNode(h,l)}),t.forEachEdge((h,l,u,c,d,f,p)=>{e?p?this.mergeUndirectedEdgeWithKey(h,u,c,l):this.mergeDirectedEdgeWithKey(h,u,c,l):p?this.addUndirectedEdgeWithKey(h,u,c,l):this.addDirectedEdgeWithKey(h,u,c,l)}),this;if(!ne(t))throw new Y("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!ne(t.attributes))throw new Y("Graph.import: invalid attributes. Expecting a plain object.");e?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let i,n,s,o,a;if(t.nodes){if(s=t.nodes,!Array.isArray(s))throw new Y("Graph.import: invalid nodes. Expecting an array.");for(i=0,n=s.length;i<n;i++){o=s[i],SR(o);const{key:h,attributes:l}=o;e?this.mergeNode(h,l):this.addNode(h,l)}}if(t.edges){let h=!1;if(this.type==="undirected"&&(h=!0),s=t.edges,!Array.isArray(s))throw new Y("Graph.import: invalid edges. Expecting an array.");for(i=0,n=s.length;i<n;i++){a=s[i],IR(a);const{source:l,target:u,attributes:c,undirected:d=h}=a;let f;"key"in a?(f=e?d?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:d?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,a.key,l,u,c)):(f=e?d?this.mergeUndirectedEdge:this.mergeDirectedEdge:d?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,u,c))}}return this}nullCopy(t){const e=new Nt(Kt({},this._options,t));return e.replaceAttributes(Kt({},this.getAttributes())),e}emptyCopy(t){const e=this.nullCopy(t);return this._nodes.forEach((i,n)=>{const s=Kt({},i.attributes);i=new e.NodeDataClass(n,s),e._nodes.set(n,i)}),e}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new ot(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new ot("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new ot("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const e=this.emptyCopy(t),i=this._edges.values();let n,s;for(;n=i.next(),n.done!==!0;)s=n.value,Wm(e,"copy",!1,s.undirected,s.key,s.source.key,s.target.key,Kt({},s.attributes));return e}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((s,o)=>{t[o]=s.attributes});const e={},i={};this._edges.forEach((s,o)=>{const a=s.undirected?"--":"->";let h="",l=s.source.key,u=s.target.key,c;s.undirected&&l>u&&(c=l,l=u,u=c);const d=`(${l})${a}(${u})`;o.startsWith("geid_")?this.multi&&(typeof i[d]>"u"?i[d]=0:i[d]++,h+=`${i[d]}. `):h+=`[${o}]: `,h+=d,e[h]=s.attributes});const n={};for(const s in this)this.hasOwnProperty(s)&&!Mf.has(s)&&typeof this[s]!="function"&&typeof s!="symbol"&&(n[s]=this[s]);return n.attributes=this._attributes,n.nodes=t,n.edges=e,ve(n,"constructor",this.constructor),n}}typeof Symbol<"u"&&(Nt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Nt.prototype.inspect);RR.forEach(r=>{["add","merge","update"].forEach(t=>{const e=r.name(t),i=t==="add"?Wm:DR;r.generateKey?Nt.prototype[e]=function(n,s,o){return i(this,e,!0,(r.type||this.type)==="undirected",null,n,s,o,t==="update")}:Nt.prototype[e]=function(n,s,o,a){return i(this,e,!1,(r.type||this.type)==="undirected",n,s,o,a,t==="update")}})});HN(Nt);JN(Nt);gR(Nt);ER(Nt);class jm extends Nt{constructor(t){const e=Kt({type:"directed"},t);if("multi"in e&&e.multi!==!1)throw new Y("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="directed")throw new Y('DirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class Ym extends Nt{constructor(t){const e=Kt({type:"undirected"},t);if("multi"in e&&e.multi!==!1)throw new Y("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="undirected")throw new Y('UndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class qm extends Nt{constructor(t){const e=Kt({multi:!0},t);if("multi"in e&&e.multi!==!0)throw new Y("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(e)}}class Km extends Nt{constructor(t){const e=Kt({type:"directed",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new Y("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="directed")throw new Y('MultiDirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class Zm extends Nt{constructor(t){const e=Kt({type:"undirected",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new Y("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="undirected")throw new Y('MultiUndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}function cn(r){r.from=function(t,e){const i=Kt({},t.options,e),n=new r(i);return n.import(t),n}}cn(Nt);cn(jm);cn(Ym);cn(qm);cn(Km);cn(Zm);Nt.Graph=Nt;Nt.DirectedGraph=jm;Nt.UndirectedGraph=Ym;Nt.MultiGraph=qm;Nt.MultiDirectedGraph=Km;Nt.MultiUndirectedGraph=Zm;Nt.InvalidArgumentsGraphError=Y;Nt.NotFoundGraphError=$;Nt.UsageGraphError=ot;function Er(r){return Array.isArray?Array.isArray(r):ty(r)==="[object Array]"}const LR=1/0;function BR(r){if(typeof r=="string")return r;let t=r+"";return t=="0"&&1/r==-LR?"-0":t}function kR(r){return r==null?"":BR(r)}function Ze(r){return typeof r=="string"}function Qm(r){return typeof r=="number"}function FR(r){return r===!0||r===!1||OR(r)&&ty(r)=="[object Boolean]"}function Jm(r){return typeof r=="object"}function OR(r){return Jm(r)&&r!==null}function ye(r){return r!=null}function xh(r){return!r.trim().length}function ty(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const UR="Incorrect 'index' type",GR=r=>`Invalid value for key ${r}`,$R=r=>`Pattern length exceeds max of ${r}.`,HR=r=>`Missing ${r} property in key`,zR=r=>`Property 'weight' in key '${r}' must be a positive integer`,Lf=Object.prototype.hasOwnProperty;class XR{constructor(t){this._keys=[],this._keyMap={};let e=0;t.forEach(i=>{let n=ey(i);this._keys.push(n),this._keyMap[n.id]=n,e+=n.weight}),this._keys.forEach(i=>{i.weight/=e})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function ey(r){let t=null,e=null,i=null,n=1,s=null;if(Ze(r)||Er(r))i=r,t=Bf(r),e=kl(r);else{if(!Lf.call(r,"name"))throw new Error(HR("name"));const o=r.name;if(i=o,Lf.call(r,"weight")&&(n=r.weight,n<=0))throw new Error(zR(o));t=Bf(o),e=kl(o),s=r.getFn}return{path:t,id:e,weight:n,src:i,getFn:s}}function Bf(r){return Er(r)?r:r.split(".")}function kl(r){return Er(r)?r.join("."):r}function VR(r,t){let e=[],i=!1;const n=(s,o,a)=>{if(ye(s))if(!o[a])e.push(s);else{let h=o[a];const l=s[h];if(!ye(l))return;if(a===o.length-1&&(Ze(l)||Qm(l)||FR(l)))e.push(kR(l));else if(Er(l)){i=!0;for(let u=0,c=l.length;u<c;u+=1)n(l[u],o,a+1)}else o.length&&n(l,o,a+1)}};return n(r,Ze(t)?t.split("."):t,0),i?e:e[0]}const WR={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},jR={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(r,t)=>r.score===t.score?r.idx<t.idx?-1:1:r.score<t.score?-1:1},YR={location:0,threshold:.6,distance:100},qR={useExtendedSearch:!1,getFn:VR,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var lt={...jR,...WR,...YR,...qR};const KR=/[^ ]+/g;function ZR(r=1,t=3){const e=new Map,i=Math.pow(10,t);return{get(n){const s=n.match(KR).length;if(e.has(s))return e.get(s);const o=1/Math.pow(s,.5*r),a=parseFloat(Math.round(o*i)/i);return e.set(s,a),a},clear(){e.clear()}}}class Cu{constructor({getFn:t=lt.getFn,fieldNormWeight:e=lt.fieldNormWeight}={}){this.norm=ZR(e,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((e,i)=>{this._keysMap[e.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ze(this.docs[0])?this.docs.forEach((t,e)=>{this._addString(t,e)}):this.docs.forEach((t,e)=>{this._addObject(t,e)}),this.norm.clear())}add(t){const e=this.size();Ze(t)?this._addString(t,e):this._addObject(t,e)}removeAt(t){this.records.splice(t,1);for(let e=t,i=this.size();e<i;e+=1)this.records[e].i-=1}getValueForItemAtKeyId(t,e){return t[this._keysMap[e]]}size(){return this.records.length}_addString(t,e){if(!ye(t)||xh(t))return;let i={v:t,i:e,n:this.norm.get(t)};this.records.push(i)}_addObject(t,e){let i={i:e,$:{}};this.keys.forEach((n,s)=>{let o=n.getFn?n.getFn(t):this.getFn(t,n.path);if(ye(o)){if(Er(o)){let a=[];const h=[{nestedArrIndex:-1,value:o}];for(;h.length;){const{nestedArrIndex:l,value:u}=h.pop();if(ye(u))if(Ze(u)&&!xh(u)){let c={v:u,i:l,n:this.norm.get(u)};a.push(c)}else Er(u)&&u.forEach((c,d)=>{h.push({nestedArrIndex:d,value:c})})}i.$[s]=a}else if(Ze(o)&&!xh(o)){let a={v:o,n:this.norm.get(o)};i.$[s]=a}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function ry(r,t,{getFn:e=lt.getFn,fieldNormWeight:i=lt.fieldNormWeight}={}){const n=new Cu({getFn:e,fieldNormWeight:i});return n.setKeys(r.map(ey)),n.setSources(t),n.create(),n}function QR(r,{getFn:t=lt.getFn,fieldNormWeight:e=lt.fieldNormWeight}={}){const{keys:i,records:n}=r,s=new Cu({getFn:t,fieldNormWeight:e});return s.setKeys(i),s.setIndexRecords(n),s}function Vs(r,{errors:t=0,currentLocation:e=0,expectedLocation:i=0,distance:n=lt.distance,ignoreLocation:s=lt.ignoreLocation}={}){const o=t/r.length;if(s)return o;const a=Math.abs(i-e);return n?o+a/n:a?1:o}function JR(r=[],t=lt.minMatchCharLength){let e=[],i=-1,n=-1,s=0;for(let o=r.length;s<o;s+=1){let a=r[s];a&&i===-1?i=s:!a&&i!==-1&&(n=s-1,n-i+1>=t&&e.push([i,n]),i=-1)}return r[s-1]&&s-i>=t&&e.push([i,s-1]),e}const ei=32;function tP(r,t,e,{location:i=lt.location,distance:n=lt.distance,threshold:s=lt.threshold,findAllMatches:o=lt.findAllMatches,minMatchCharLength:a=lt.minMatchCharLength,includeMatches:h=lt.includeMatches,ignoreLocation:l=lt.ignoreLocation}={}){if(t.length>ei)throw new Error($R(ei));const u=t.length,c=r.length,d=Math.max(0,Math.min(i,c));let f=s,p=d;const g=a>1||h,m=g?Array(c):[];let y;for(;(y=r.indexOf(t,p))>-1;){let S=Vs(t,{currentLocation:y,expectedLocation:d,distance:n,ignoreLocation:l});if(f=Math.min(S,f),p=y+u,g){let T=0;for(;T<u;)m[y+T]=1,T+=1}}p=-1;let x=[],v=1,_=u+c;const E=1<<u-1;for(let S=0;S<u;S+=1){let T=0,D=_;for(;T<D;)Vs(t,{errors:S,currentLocation:d+D,expectedLocation:d,distance:n,ignoreLocation:l})<=f?T=D:_=D,D=Math.floor((_-T)/2+T);_=D;let B=Math.max(1,d-D+1),k=o?c:Math.min(d+D,c)+u,M=Array(k+2);M[k+1]=(1<<S)-1;for(let w=k;w>=B;w-=1){let C=w-1,I=e[r.charAt(C)];if(g&&(m[C]=+!!I),M[w]=(M[w+1]<<1|1)&I,S&&(M[w]|=(x[w+1]|x[w])<<1|1|x[w+1]),M[w]&E&&(v=Vs(t,{errors:S,currentLocation:C,expectedLocation:d,distance:n,ignoreLocation:l}),v<=f)){if(f=v,p=C,p<=d)break;B=Math.max(1,2*d-p)}}if(Vs(t,{errors:S+1,currentLocation:d,expectedLocation:d,distance:n,ignoreLocation:l})>f)break;x=M}const N={isMatch:p>=0,score:Math.max(.001,v)};if(g){const S=JR(m,a);S.length?h&&(N.indices=S):N.isMatch=!1}return N}function eP(r){let t={};for(let e=0,i=r.length;e<i;e+=1){const n=r.charAt(e);t[n]=(t[n]||0)|1<<i-e-1}return t}const Go=String.prototype.normalize?r=>r.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):r=>r;class iy{constructor(t,{location:e=lt.location,threshold:i=lt.threshold,distance:n=lt.distance,includeMatches:s=lt.includeMatches,findAllMatches:o=lt.findAllMatches,minMatchCharLength:a=lt.minMatchCharLength,isCaseSensitive:h=lt.isCaseSensitive,ignoreDiacritics:l=lt.ignoreDiacritics,ignoreLocation:u=lt.ignoreLocation}={}){if(this.options={location:e,threshold:i,distance:n,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:h,ignoreDiacritics:l,ignoreLocation:u},t=h?t:t.toLowerCase(),t=l?Go(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const c=(f,p)=>{this.chunks.push({pattern:f,alphabet:eP(f),startIndex:p})},d=this.pattern.length;if(d>ei){let f=0;const p=d%ei,g=d-p;for(;f<g;)c(this.pattern.substr(f,ei),f),f+=ei;if(p){const m=d-ei;c(this.pattern.substr(m),m)}}else c(this.pattern,0)}searchIn(t){const{isCaseSensitive:e,ignoreDiacritics:i,includeMatches:n}=this.options;if(t=e?t:t.toLowerCase(),t=i?Go(t):t,this.pattern===t){let g={isMatch:!0,score:0};return n&&(g.indices=[[0,t.length-1]]),g}const{location:s,distance:o,threshold:a,findAllMatches:h,minMatchCharLength:l,ignoreLocation:u}=this.options;let c=[],d=0,f=!1;this.chunks.forEach(({pattern:g,alphabet:m,startIndex:y})=>{const{isMatch:x,score:v,indices:_}=tP(t,g,m,{location:s+y,distance:o,threshold:a,findAllMatches:h,minMatchCharLength:l,includeMatches:n,ignoreLocation:u});x&&(f=!0),d+=v,x&&_&&(c=[...c,..._])});let p={isMatch:f,score:f?d/this.chunks.length:1};return f&&n&&(p.indices=c),p}}class zr{constructor(t){this.pattern=t}static isMultiMatch(t){return kf(t,this.multiRegex)}static isSingleMatch(t){return kf(t,this.singleRegex)}search(){}}function kf(r,t){const e=r.match(t);return e?e[1]:null}class rP extends zr{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const e=t===this.pattern;return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class iP extends zr{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const i=t.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,t.length-1]}}}class nP extends zr{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const e=t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class sP extends zr{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const e=!t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class oP extends zr{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const e=t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class aP extends zr{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const e=!t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class ny extends zr{constructor(t,{location:e=lt.location,threshold:i=lt.threshold,distance:n=lt.distance,includeMatches:s=lt.includeMatches,findAllMatches:o=lt.findAllMatches,minMatchCharLength:a=lt.minMatchCharLength,isCaseSensitive:h=lt.isCaseSensitive,ignoreDiacritics:l=lt.ignoreDiacritics,ignoreLocation:u=lt.ignoreLocation}={}){super(t),this._bitapSearch=new iy(t,{location:e,threshold:i,distance:n,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:h,ignoreDiacritics:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class sy extends zr{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let e=0,i;const n=[],s=this.pattern.length;for(;(i=t.indexOf(this.pattern,e))>-1;)e=i+s,n.push([i,e-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const Fl=[rP,sy,nP,sP,aP,oP,iP,ny],Ff=Fl.length,hP=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,lP="|";function uP(r,t={}){return r.split(lP).map(e=>{let i=e.trim().split(hP).filter(s=>s&&!!s.trim()),n=[];for(let s=0,o=i.length;s<o;s+=1){const a=i[s];let h=!1,l=-1;for(;!h&&++l<Ff;){const u=Fl[l];let c=u.isMultiMatch(a);c&&(n.push(new u(c,t)),h=!0)}if(!h)for(l=-1;++l<Ff;){const u=Fl[l];let c=u.isSingleMatch(a);if(c){n.push(new u(c,t));break}}}return n})}const cP=new Set([ny.type,sy.type]);class dP{constructor(t,{isCaseSensitive:e=lt.isCaseSensitive,ignoreDiacritics:i=lt.ignoreDiacritics,includeMatches:n=lt.includeMatches,minMatchCharLength:s=lt.minMatchCharLength,ignoreLocation:o=lt.ignoreLocation,findAllMatches:a=lt.findAllMatches,location:h=lt.location,threshold:l=lt.threshold,distance:u=lt.distance}={}){this.query=null,this.options={isCaseSensitive:e,ignoreDiacritics:i,includeMatches:n,minMatchCharLength:s,findAllMatches:a,ignoreLocation:o,location:h,threshold:l,distance:u},t=e?t:t.toLowerCase(),t=i?Go(t):t,this.pattern=t,this.query=uP(this.pattern,this.options)}static condition(t,e){return e.useExtendedSearch}searchIn(t){const e=this.query;if(!e)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:n,ignoreDiacritics:s}=this.options;t=n?t:t.toLowerCase(),t=s?Go(t):t;let o=0,a=[],h=0;for(let l=0,u=e.length;l<u;l+=1){const c=e[l];a.length=0,o=0;for(let d=0,f=c.length;d<f;d+=1){const p=c[d],{isMatch:g,indices:m,score:y}=p.search(t);if(g){if(o+=1,h+=y,i){const x=p.constructor.type;cP.has(x)?a=[...a,...m]:a.push(m)}}else{h=0,o=0,a.length=0;break}}if(o){let d={isMatch:!0,score:h/o};return i&&(d.indices=a),d}}return{isMatch:!1,score:1}}}const Ol=[];function fP(...r){Ol.push(...r)}function Ul(r,t){for(let e=0,i=Ol.length;e<i;e+=1){let n=Ol[e];if(n.condition(r,t))return new n(r,t)}return new iy(r,t)}const $o={AND:"$and",OR:"$or"},Gl={PATH:"$path",PATTERN:"$val"},$l=r=>!!(r[$o.AND]||r[$o.OR]),pP=r=>!!r[Gl.PATH],gP=r=>!Er(r)&&Jm(r)&&!$l(r),Of=r=>({[$o.AND]:Object.keys(r).map(t=>({[t]:r[t]}))});function oy(r,t,{auto:e=!0}={}){const i=n=>{let s=Object.keys(n);const o=pP(n);if(!o&&s.length>1&&!$l(n))return i(Of(n));if(gP(n)){const h=o?n[Gl.PATH]:s[0],l=o?n[Gl.PATTERN]:n[h];if(!Ze(l))throw new Error(GR(h));const u={keyId:kl(h),pattern:l};return e&&(u.searcher=Ul(l,t)),u}let a={children:[],operator:s[0]};return s.forEach(h=>{const l=n[h];Er(l)&&l.forEach(u=>{a.children.push(i(u))})}),a};return $l(r)||(r=Of(r)),i(r)}function mP(r,{ignoreFieldNorm:t=lt.ignoreFieldNorm}){r.forEach(e=>{let i=1;e.matches.forEach(({key:n,norm:s,score:o})=>{const a=n?n.weight:null;i*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(t?1:s))}),e.score=i})}function yP(r,t){const e=r.matches;t.matches=[],ye(e)&&e.forEach(i=>{if(!ye(i.indices)||!i.indices.length)return;const{indices:n,value:s}=i;let o={indices:n,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),t.matches.push(o)})}function _P(r,t){t.score=r.score}function vP(r,t,{includeMatches:e=lt.includeMatches,includeScore:i=lt.includeScore}={}){const n=[];return e&&n.push(yP),i&&n.push(_P),r.map(s=>{const{idx:o}=s,a={item:t[o],refIndex:o};return n.length&&n.forEach(h=>{h(s,a)}),a})}class dn{constructor(t,e={},i){this.options={...lt,...e},this.options.useExtendedSearch,this._keyStore=new XR(this.options.keys),this.setCollection(t,i)}setCollection(t,e){if(this._docs=t,e&&!(e instanceof Cu))throw new Error(UR);this._myIndex=e||ry(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){ye(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const e=[];for(let i=0,n=this._docs.length;i<n;i+=1){const s=this._docs[i];t(s,i)&&(this.removeAt(i),i-=1,n-=1,e.push(s))}return e}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:e=-1}={}){const{includeMatches:i,includeScore:n,shouldSort:s,sortFn:o,ignoreFieldNorm:a}=this.options;let h=Ze(t)?Ze(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return mP(h,{ignoreFieldNorm:a}),s&&h.sort(o),Qm(e)&&e>-1&&(h=h.slice(0,e)),vP(h,this._docs,{includeMatches:i,includeScore:n})}_searchStringList(t){const e=Ul(t,this.options),{records:i}=this._myIndex,n=[];return i.forEach(({v:s,i:o,n:a})=>{if(!ye(s))return;const{isMatch:h,score:l,indices:u}=e.searchIn(s);h&&n.push({item:s,idx:o,matches:[{score:l,value:s,norm:a,indices:u}]})}),n}_searchLogical(t){const e=oy(t,this.options),i=(a,h,l)=>{if(!a.children){const{keyId:c,searcher:d}=a,f=this._findMatches({key:this._keyStore.get(c),value:this._myIndex.getValueForItemAtKeyId(h,c),searcher:d});return f&&f.length?[{idx:l,item:h,matches:f}]:[]}const u=[];for(let c=0,d=a.children.length;c<d;c+=1){const f=a.children[c],p=i(f,h,l);if(p.length)u.push(...p);else if(a.operator===$o.AND)return[]}return u},n=this._myIndex.records,s={},o=[];return n.forEach(({$:a,i:h})=>{if(ye(a)){let l=i(e,a,h);l.length&&(s[h]||(s[h]={idx:h,item:a,matches:[]},o.push(s[h])),l.forEach(({matches:u})=>{s[h].matches.push(...u)}))}}),o}_searchObjectList(t){const e=Ul(t,this.options),{keys:i,records:n}=this._myIndex,s=[];return n.forEach(({$:o,i:a})=>{if(!ye(o))return;let h=[];i.forEach((l,u)=>{h.push(...this._findMatches({key:l,value:o[u],searcher:e}))}),h.length&&s.push({idx:a,item:o,matches:h})}),s}_findMatches({key:t,value:e,searcher:i}){if(!ye(e))return[];let n=[];if(Er(e))e.forEach(({v:s,i:o,n:a})=>{if(!ye(s))return;const{isMatch:h,score:l,indices:u}=i.searchIn(s);h&&n.push({score:l,key:t,value:s,idx:o,norm:a,indices:u})});else{const{v:s,n:o}=e,{isMatch:a,score:h,indices:l}=i.searchIn(s);a&&n.push({score:h,key:t,value:s,norm:o,indices:l})}return n}}dn.version="7.1.0";dn.createIndex=ry;dn.parseIndex=QR;dn.config=lt;dn.parseQuery=oy;fP(dP);const b={graphDataType:"parameter",currentLayout:"default",showSingleNodes:!0,showArrows:!0,initialLoadComplete:!1,parameterData:{},hierarchyData:{},allNodeNames:[],expandedTreeData:{},collapsedTreeData:{},currentTreeData:{},tier1And2Mapper:{},subModules:[],selectedNodeNames:[],defaultNodePositions:[],notDefaultSelectedNodeNames:[],notDefaultSelectedLinks:[],nearestNeighbourOrigin:"",nearestNeighbourDegree:1,shortestPathStart:"",shortestPathEnd:"",allCategoryHierarchy:{},currentCategoryHierarchy:{},setHierarchyData(r){typeof r=="object"?this.hierarchyData=r:console.error("Expected an array for hierarchyData.")},setParameterData(r){typeof r=="object"?this.parameterData=r:console.error("Expected an array for parameterData.")},setAllCategoryHierarchy(r){typeof r=="object"?this.allCategoryHierarchy=r:console.error("Expected an array for collapsedCategoryHierarchy.")},setCurrentCategoryHierarchy(r){typeof r=="object"?this.currentCategoryHierarchy=r:console.error("Expected an array for currentCategoryHierarchy.")},setTier1And2Mapper(r){typeof r=="object"?this.tier1And2Mapper=r:console.error("Expected an array for tier1And2Mapper.")},setAllNodeNames(r){typeof r=="object"?this.allNodeNames=r:console.error("Expected an array for allNodeNames.")},setNearestNeighbourDegree(r){typeof+r=="number"?this.nearestNeighbourDegree=+r:console.error("Expected an array for nearestNeighbourDegree.")},setDefaultNodePositions(r){typeof r=="object"?this.defaultNodePositions=r:console.error("Expected an array for defaultNodePositions.")},setNotDefaultSelectedLinks(r){typeof r=="object"?this.notDefaultSelectedLinks=r:console.error("Expected an array for notDefaultSelectedLinks.")},setNearestNeighbourOrigin(r){typeof r=="string"?this.nearestNeighbourOrigin=r:console.error("Expected an array for nearestNeighbourOrigin.")},setShortestPathStart(r){typeof r=="string"?this.shortestPathStart=r:console.error("Expected an array for shortestPathStart.")},setShortestPathEnd(r){typeof r=="string"?this.shortestPathEnd=r:console.error("Expected an array for shortestPathEnd.")},setCollapsedTreeData(r){typeof r=="object"?this.collapsedTreeData=r:console.error("Expected an array for collapsedTreeData.")},setExpandedTreeData(r){typeof r=="object"?this.expandedTreeData=r:console.error("Expected an array for expandedTreeData.")},setCurrentTreeData(r){typeof r=="object"?this.currentTreeData=r:console.error("Expected an array for currentTreeData.")},setSubModules(r){Array.isArray(r)?this.subModules=r:console.error("Expected an array for setSelectedNodeName.")},setSelectedNodeNames(r){Array.isArray(r)?this.selectedNodeNames=r:console.error("Expected an array for setSelectedNodeName.")},setNotDefaultSelectedNodeNames(r){Array.isArray(r)?this.notDefaultSelectedNodeNames=r:console.error("Expected an array for notDefaultSelectedNodeNames.")},addToSelectedNodeNames(r){typeof r=="string"?this.selectedNodeNames.some(t=>t===r)||this.selectedNodeNames.push(r):console.error("Expected an array for setSelectedNodeName.")},setCurrentLayout(r){typeof r=="string"?this.currentLayout=r:console.error("Expected a string for currentLayout.")},setShowSingleNodes(r){typeof r=="boolean"?this.showSingleNodes=r:console.error("Expected a boolean for showSingleNodes.")},setShowArrows(r){typeof r=="boolean"?this.showArrows=r:console.error("Expected a boolean for showArrows.")},setInitialLoadComplete(r){typeof r=="boolean"?this.initialLoadComplete=r:console.error("Expected a boolean for initialLoadComplete.")}},xP=["#418BFC","#46BCC8","#D6AB1B","#EB5E68","#B6BE1C","#F64D1A","#BA6DE4","#EA6BCB","#B9AAC8","#F08519"],Ii={noSP:"There is no shortest path between the selected nodes",SP:"Search for nodes to find the Shortest Path",NN:"Search for nodes to find the Nearest Neighbour"},ay=()=>xm(b.subModules,xP),wP=r=>{const t={id:"ROOT"},e=Array.from(r.reduce((o,a)=>(o.add(`${a.SUBMODULE}-${a.SUBMODULE_NAME}`),o),new Set)).reduce((o,a)=>{const h=a.split("-"),l=`submodule-${h[0]}`;return o.some(u=>u.id===l)?console.error(`${a} is being filtered out as this subModule ID has been used previously with a different subModule Name`):o.push({id:l,parent:"ROOT",subModule:l,NAME:h[1],type:"tier1"}),o},[]).sort((o,a)=>_r(o.NAME,a.NAME));b.setSubModules(e.map(o=>o.id));const i=Array.from(r.reduce((o,a)=>(o.add(`${a.SEGMENT}-${a.SEGMENT_NAME}-${a.SUBMODULE}`),o),new Set)).reduce((o,a)=>{const h=a.split("-"),l=`submodule-${h[2]}`,u=`segment-${h[0]}`;return o.some(c=>c.id===u)?console.error(`${u} with submodule ${l} is being filtered out as this segmentId has been used previously with a different Segment Name`):o.push({id:u,subModule:l,parent:l,NAME:h[1],type:"tier2"}),o},[]);let n=r.reduce((o,a,h)=>(o.push({parent:`segment-${a.SEGMENT}`,subModule:`submodule-${a.SUBMODULE}`,id:a.id,NAME:a.NAME,type:"tier3"}),o),[]);n=n.sort((o,a)=>_r(o.NAME.toLowerCase(),a.NAME.toLowerCase()));const s=[t].concat(e).concat(i).concat(n);return _m().id(o=>o.id).parentId(o=>o.parent)(s).eachBefore((o,a)=>{o.data.hOrderPosition=a})},bP="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z",EP="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z",AP="0 0 320 512",Uf="0 0 448 512",hy="M64 80c-8.8 0-16 7.2-16 16l0 320c0 8.8 7.2 16 16 16l320 0c8.8 0 16-7.2 16-16l0-320c0-8.8-7.2-16-16-16L64 80zM0 96C0 60.7 28.7 32 64 32l320 0c35.3 0 64 28.7 64 64l0 320c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 96zM337 209L209 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L303 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z",TP="M64 80c-8.8 0-16 7.2-16 16l0 320c0 8.8 7.2 16 16 16l320 0c8.8 0 16-7.2 16-16l0-320c0-8.8-7.2-16-16-16L64 80zM0 96C0 60.7 28.7 32 64 32l320 0c35.3 0 64 28.7 64 64l0 320c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 96zM152 232l144 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-144 0c-13.3 0-24-10.7-24-24s10.7-24 24-24z",SP="M384 80c8.8 0 16 7.2 16 16l0 320c0 8.8-7.2 16-16 16L64 432c-8.8 0-16-7.2-16-16L48 96c0-8.8 7.2-16 16-16l320 0zM64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32z",IP=ay(),Ce=16,Ge=(r,t)=>(r-1)*t,qi=r=>{const t=parseFloat(getComputedStyle(document.documentElement).fontSize);return r*t},Hl=0,We=qi(1.7),Ln="view";let Fr=qi(18);const zl=r=>{const t=r.some(i=>b.selectedNodeNames.includes(i)),e=r.some(i=>!b.selectedNodeNames.includes(i));return t&&!e?hy:t?TP:SP},ii=()=>{const r=b.currentTreeData,t=V(`.${Ln}_svg`),e=Hl+r.descendants().length*We;t.attr("height",e);const i=r.descendants().filter(s=>s.depth>0).sort((s,o)=>_r(s.data.hOrderPosition,o.data.hOrderPosition)),n=t.selectAll(".treeGroup").data(i,s=>s.data.hOrderPosition).join(s=>{const o=s.append("g").attr("class","treeGroup");return o.append("text").attr("class","treeLabel"),o.append("line").attr("class","verticalLine"),o.append("svg").attr("class","expandCollapseIcon").append("path").attr("class","expandCollapseIconPath"),o.append("rect").attr("class","expandClickRect"),o.append("svg").attr("class","selectedCheckboxIcon").append("path").attr("class","selectedCheckboxIconPath"),o.append("rect").attr("class","checkboxClickRect"),o});n.attr("transform",(s,o)=>`translate(0,${Hl+o*We})`),n.select(".expandClickRect").attr("display",s=>!s.children&&!s.data._children?"none":"block").attr("cursor","pointer").attr("width",Fr-Ce-10).attr("height",We).attr("fill","transparent").on("click",(s,o)=>{!o.children&&o.data._children?(o.children=o.data._children,o.data._children=void 0):o.children!==void 0&&(o.data._children=o.children,o.children=void 0),b.setCurrentTreeData(r),ii()}),n.select(".treeLabel").attr("font-weight",400).attr("font-size",s=>`${.9-Ge(s.depth,.1)}rem`).attr("dominant-baseline","middle").attr("x",s=>Ce+5+Ge(s.depth,15)).attr("y",We/2).attr("fill",s=>IP(s.data.subModule)).text(s=>`${s.data.NAME}`),n.select(".verticalLine").attr("x1",0).attr("x2",Fr).attr("y1",We).attr("y2",We).attr("stroke","#A0A0A0").attr("stroke-width",.25),n.select(".expandCollapseIcon").attr("display",s=>s.depth===3?"none":"block").attr("width",s=>Ce-Ge(s.depth,2)).attr("height",s=>Ce-Ge(s.depth,2)).attr("viewBox",s=>s.children?Uf:AP).attr("x",s=>Ge(s.depth,15)).attr("y",s=>(We-Ce+Ge(s.depth,2))/2),n.select(".expandCollapseIconPath").attr("d",s=>s.children?bP:EP).attr("fill","#F0F0F0"),n.select(".selectedCheckboxIcon").style("display",b.graphDataType==="parameter"?"block":"none").attr("width",s=>Ce-Ge(s.depth,2)).attr("height",s=>Ce-Ge(s.depth,2)).attr("viewBox",Uf).attr("x",s=>Fr-5-(Ce-Ge(s.depth,2))).attr("y",s=>(We-Ce+Ge(s.depth,2))/2),n.select(".selectedCheckboxIconPath").attr("d",s=>zl(s.data.type==="tier3"?[s.data.NAME]:b.tier1And2Mapper[s.data.id])).attr("fill","#F0F0F0"),n.select(".checkboxClickRect").attr("cursor","pointer").attr("x",Fr-Ce-10).attr("width",Ce+10).attr("height",We).attr("fill","transparent").on("click",(s,o)=>{if(o.data.type==="tier3")b.selectedNodeNames.includes(o.data.NAME)?b.setSelectedNodeNames(b.selectedNodeNames.filter(a=>a!==o.data.NAME)):b.addToSelectedNodeNames(o.data.NAME);else if(b.graphDataType==="parameter"){const a=b.tier1And2Mapper[o.data.id];zl(a)===hy?b.setSelectedNodeNames(b.selectedNodeNames.filter(l=>!a.includes(l))):a.forEach(l=>{b.addToSelectedNodeNames(l)})}b.setCurrentTreeData(r),ii(),lo(!1)})},CP=(r,t)=>r&&t?"both":r?"inbound":"outbound",Gf=(r,t)=>Array.from(r).reduce((e,i)=>{const n=Array.from(r).filter(o=>o!==i),s=b.tier1And2Mapper[i];return n.forEach(o=>{const a=b.tier1And2Mapper[o],h=t.some(c=>s.includes(c.source)&&a.includes(c.target)),l=t.some(c=>s.includes(c.target)&&a.includes(c.source)),u=CP(l,h);e.some(c=>c.source===i&&c.target===o||c.source===o&&c.target===i)||e.push({source:i,target:o,direction:u})}),e},[]),NP=r=>{const t=new Set,e=new Set;r.descendants().map(a=>{a.depth===2&&(a.data.parameterCount=a.children.length,a.children=void 0,a.data.children=void 0,e.add(a.data.id)),a.depth===1&&(a.data.parameterCount=Ug(a.children,h=>h.children.length),t.add(a.data.id))});const i=Gf(t,b.parameterData.links),n=Gf(e,b.parameterData.links),s=r.descendants().filter(a=>a.depth===1).map(a=>a.data),o=r.descendants().filter(a=>a.depth===2).map(a=>a.data);b.setHierarchyData({submodule:{nodes:s,links:i,nodeNames:Array.from(t)},segment:{nodes:o,links:n,nodeNames:Array.from(e)}})};function RP(r){const t=JSON.parse(JSON.stringify(b.selectedNodeNames));b.setAllNodeNames(t);const e=wP(r);b.tier1And2Mapper=e.descendants().filter(f=>f.data.type==="tier3").reduce((f,p)=>{const{subModule:g,parent:m,NAME:y}=p.data;return f[g]||(f[g]=[]),f[m]||(f[m]=[]),f[g].push(y),f[m].push(y),f},{});const i=e.copy();NP(i),ee(".chartDataRadio").on("change",f=>{b.graphDataType=f.currentTarget.value,b.currentLayout="default";const p=b.graphDataType==="parameter"?t:b.hierarchyData[b.graphDataType].nodeNames,g=JSON.parse(JSON.stringify(p));b.setSelectedNodeNames(g),u.selectAll(".viewPanelFilterButton").attr("visibility",b.graphDataType==="parameter"?"visible":"hidden"),u.selectAll(".selectedCheckboxIcon").style("display",b.graphDataType==="parameter"?"block":"none"),u.selectAll(".selectedCheckboxIconPath").attr("d",m=>zl(m.data.type==="tier3"?[m.data.NAME]:b.tier1And2Mapper[m.data.id])),lo(b.graphDataType!=="parameter")});const n=1,s=f=>(f.descendants().forEach(p=>{p.children&&p.depth>=n&&(p.data._children=p.children,p.children=void 0)}),e),o=e.copy();b.setExpandedTreeData(o);const a=s(e),h=a.copy();b.setCollapsedTreeData(h),b.setCurrentTreeData(a);const l=Hl+a.descendants().length*We;V(`#${Ln}`).style("pointer-events","auto").on("wheel",function(f){f.stopPropagation()});let u=V(`.${Ln}_svg`);u.node()===null?u=V(`#${Ln}`).append("svg").attr("class",`${Ln}_svg`).attr("width",Fr).attr("height",l):u.attr("width",Fr).attr("height",l),ii(),lo(!0),V("#selectUnselectButton").text("unselect ALL").on("click",f=>{if(b.graphDataType==="parameter"){const p=V(f.currentTarget).text(),g=p==="select ALL"?"unselect ALL":"select ALL";V(f.currentTarget).text(g),p==="select ALL"?b.setSelectedNodeNames(t):b.setSelectedNodeNames([]),ii(),lo(!1)}}),V("#collapseExpandButton").text("expand ALL").on("click",f=>{const p=V(f.currentTarget).text(),g=p==="expand ALL"?"collapse ALL":"expand ALL";p==="expand ALL"?(V(f.currentTarget).text("..."),b.setCurrentTreeData(b.expandedTreeData)):b.setCurrentTreeData(b.collapsedTreeData),V(f.currentTarget).text(g),ii()});const c=(f,p)=>{let g;return function(){const m=arguments,y=this;g||(f.apply(y,m),g=!0,setTimeout(()=>g=!1,p))}};function d(){Fr=qi(18),u.attr("width",Fr),ii()}window.addEventListener("resize",c(d,100))}var fn={},ly=hs,PP=wu;function Vt(){this.clear()}Vt.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};Vt.prototype.enqueue=function(r){return this.items.push(r),++this.size};Vt.prototype.dequeue=function(){if(this.size){var r=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,r}};Vt.prototype.peek=function(){if(this.size)return this.items[this.offset]};Vt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.offset,i=0,n=this.items.length;e<n;e++,i++)r.call(t,this.items[e],i,this)};Vt.prototype.toArray=function(){return this.items.slice(this.offset)};Vt.prototype.values=function(){var r=this.items,t=this.offset;return new ly(function(){if(t>=r.length)return{done:!0};var e=r[t];return t++,{value:e,done:!1}})};Vt.prototype.entries=function(){var r=this.items,t=this.offset,e=0;return new ly(function(){if(t>=r.length)return{done:!0};var i=r[t];return t++,{value:[e++,i],done:!1}})};typeof Symbol<"u"&&(Vt.prototype[Symbol.iterator]=Vt.prototype.values);Vt.prototype.toString=function(){return this.toArray().join(",")};Vt.prototype.toJSON=function(){return this.toArray()};Vt.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:Vt,enumerable:!1}),r};typeof Symbol<"u"&&(Vt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Vt.prototype.inspect);Vt.from=function(r){var t=new Vt;return PP(r,function(e){t.enqueue(e)}),t};Vt.of=function(){return Vt.from(arguments)};var MP=Vt,DP=function(t,e){var i=e.length;if(i!==0){var n=t.length;t.length+=i;for(var s=0;s<i;s++)t[n+s]=e[s]}},Nu=xu,LP=MP,BP=DP;function kP(r,t,e){if(!Nu(r))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<3)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 3.");if(!r.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');if(!r.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" target node does not exist in the given graph.');if(t=""+t,e=""+e,t===e)return[t];var i=r.inboundNeighbors.bind(r),n=r.outboundNeighbors.bind(r),s={},o={};s[t]=null,o[e]=null;var a=[t],h=[e],l,u,c,d,f,p,g,m,y=!1;t:for(;a.length&&h.length;)if(a.length<=h.length){for(l=a,a=[],f=0,g=l.length;f<g;f++)for(u=l[f],c=n(u),p=0,m=c.length;p<m;p++)if(d=c[p],d in s||(a.push(d),s[d]=u),d in o){y=!0;break t}}else for(l=h,h=[],f=0,g=l.length;f<g;f++)for(u=l[f],c=i(u),p=0,m=c.length;p<m;p++)if(d=c[p],d in o||(h.push(d),o[d]=u),d in s){y=!0;break t}if(!y)return null;for(var x=[];d;)x.unshift(d),d=s[d];for(d=o[x[x.length-1]];d;)x.push(d),d=o[d];return x.length?x:null}function FP(r,t){if(!Nu(r))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<2)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 2.");if(!r.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');t=""+t;var e={},i={},n,s,o,a,h,l;for(e[t]=!0,i[t]=[t];Object.keys(e).length;){n=e,e={};for(o in n)for(s=r.outboundNeighbors(o),h=0,l=s.length;h<l;h++)a=s[h],i[a]||(i[a]=i[o].concat(a),e[a]=!0)}return i}function uy(r,t,e){if(!Nu(t))throw new Error("graphology-shortest-path: invalid graphology instance.");if(!t.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" source node does not exist in the given graph.');e=""+e;var i=new Set,n={},s=0;n[e]=0;for(var o=[e],a,h,l;o.length!==0;){var u=[];for(a=0,h=o.length;a<h;a++)l=o[a],!i.has(l)&&(i.add(l),BP(u,t[r](l)),n[l]=s);s++,o=u}return n}var OP=uy.bind(null,"outboundNeighbors"),UP=uy.bind(null,"neighbors");function GP(r,t){t=""+t;var e=[],i={},n={},s=r.nodes(),o,a,h,l,u,c,d,f,p;for(c=0,f=s.length;c<f;c++)l=s[c],i[l]=[],n[l]=0;var g={};n[t]=1,g[t]=0;for(var m=LP.of(t);m.size;)for(l=m.dequeue(),e.push(l),o=g[l],a=n[l],h=r.outboundNeighbors(l),d=0,p=h.length;d<p;d++)u=h[d],u in g||(m.enqueue(u),g[u]=o+1),g[u]===o+1&&(n[u]+=a,i[u].push(l));return[e,i,n]}fn.bidirectional=kP;fn.singleSource=FP;fn.singleSourceLength=OP;fn.undirectedSingleSourceLength=UP;fn.brandes=GP;var ca={},ls={};function $P(r){return typeof r!="number"||isNaN(r)?1:r}function HP(r,t){var e={},i=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(i=t);var n=function(o){return i(o[r])},s=function(){return i(void 0)};return typeof r=="string"?(e.fromAttributes=n,e.fromGraph=function(o,a){return n(o.getNodeAttributes(a))},e.fromEntry=function(o,a){return n(a)}):typeof r=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){return i(r(a,o.getNodeAttributes(a)))},e.fromEntry=function(o,a){return i(r(o,a))}):(e.fromAttributes=s,e.fromGraph=s,e.fromEntry=s),e}function cy(r,t){var e={},i=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(i=t);var n=function(o){return i(o[r])},s=function(){return i(void 0)};return typeof r=="string"?(e.fromAttributes=n,e.fromGraph=function(o,a){return n(o.getEdgeAttributes(a))},e.fromEntry=function(o,a){return n(a)},e.fromPartialEntry=e.fromEntry,e.fromMinimalEntry=e.fromEntry):typeof r=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){var h=o.extremities(a);return i(r(a,o.getEdgeAttributes(a),h[0],h[1],o.getNodeAttributes(h[0]),o.getNodeAttributes(h[1]),o.isUndirected(a)))},e.fromEntry=function(o,a,h,l,u,c,d){return i(r(o,a,h,l,u,c,d))},e.fromPartialEntry=function(o,a,h,l){return i(r(o,a,h,l))},e.fromMinimalEntry=function(o,a){return i(r(o,a))}):(e.fromAttributes=s,e.fromGraph=s,e.fromEntry=s,e.fromMinimalEntry=s),e}ls.createNodeValueGetter=HP;ls.createEdgeValueGetter=cy;ls.createEdgeWeightGetter=function(r){return cy(r,$P)};var us={},zP=function(r,t){return r<t?-1:r>t?1:0},XP=function(r,t){return r<t?1:r>t?-1:0};function VP(r){return function(t,e){return r(e,t)}}function WP(r){return r===2?function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:t[1]<e[1]?-1:t[1]>e[1]?1:0}:function(t,e){for(var i=0;i<r;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i++}return 0}}us.DEFAULT_COMPARATOR=zP;us.DEFAULT_REVERSE_COMPARATOR=XP;us.reverseComparator=VP;us.createTupleComparator=WP;var Ho=wu,dy=us,er=ln,da=dy.DEFAULT_COMPARATOR,Ru=dy.reverseComparator;function Pu(r,t,e,i){for(var n=t[i],s,o;i>e;){if(s=i-1>>1,o=t[s],r(n,o)<0){t[i]=o,i=s;continue}break}t[i]=n}function cs(r,t,e){for(var i=t.length,n=e,s=t[e],o=2*e+1,a;o<i;)a=o+1,a<i&&r(t[o],t[a])>=0&&(o=a),t[e]=t[o],e=o,o=2*e+1;t[e]=s,Pu(r,t,n,e)}function fy(r,t,e){t.push(e),Pu(r,t,0,t.length-1)}function Mu(r,t){var e=t.pop();if(t.length!==0){var i=t[0];return t[0]=e,cs(r,t,0),i}return e}function sn(r,t,e){if(t.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var i=t[0];return t[0]=e,cs(r,t,0),i}function py(r,t,e){var i;return t.length!==0&&r(t[0],e)<0&&(i=t[0],t[0]=e,e=i,cs(r,t,0)),e}function fi(r,t){for(var e=t.length,i=e>>1,n=i;--n>=0;)cs(r,t,n)}function Du(r,t){for(var e=t.length,i=0,n=new Array(e);i<e;)n[i++]=Mu(r,t);return n}function jP(r,t,e){arguments.length===2&&(e=t,t=r,r=da);var i=Ru(r),n,s,o,a=1/0,h;if(t===1){if(er.isArrayLike(e)){for(n=0,s=e.length;n<s;n++)o=e[n],(a===1/0||r(o,a)<0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Ho(e,function(u){(a===1/0||r(u,a)<0)&&(a=u)}),[a]}if(er.isArrayLike(e)){if(t>=e.length)return e.slice().sort(r);for(h=e.slice(0,t),fi(i,h),n=t,s=e.length;n<s;n++)i(e[n],h[0])>0&&sn(i,h,e[n]);return h.sort(r)}var l=er.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),n=0,Ho(e,function(u){n<t?h[n]=u:(n===t&&fi(i,h),i(u,h[0])>0&&sn(i,h,u)),n++}),h.length>n&&(h.length=n),h.sort(r)}function YP(r,t,e){arguments.length===2&&(e=t,t=r,r=da);var i=Ru(r),n,s,o,a=-1/0,h;if(t===1){if(er.isArrayLike(e)){for(n=0,s=e.length;n<s;n++)o=e[n],(a===-1/0||r(o,a)>0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Ho(e,function(u){(a===-1/0||r(u,a)>0)&&(a=u)}),[a]}if(er.isArrayLike(e)){if(t>=e.length)return e.slice().sort(i);for(h=e.slice(0,t),fi(r,h),n=t,s=e.length;n<s;n++)r(e[n],h[0])>0&&sn(r,h,e[n]);return h.sort(i)}var l=er.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),n=0,Ho(e,function(u){n<t?h[n]=u:(n===t&&fi(r,h),r(u,h[0])>0&&sn(r,h,u)),n++}),h.length>n&&(h.length=n),h.sort(i)}function St(r){if(this.clear(),this.comparator=r||da,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}St.prototype.clear=function(){this.items=[],this.size=0};St.prototype.push=function(r){return fy(this.comparator,this.items,r),++this.size};St.prototype.peek=function(){return this.items[0]};St.prototype.pop=function(){return this.size!==0&&this.size--,Mu(this.comparator,this.items)};St.prototype.replace=function(r){return sn(this.comparator,this.items,r)};St.prototype.pushpop=function(r){return py(this.comparator,this.items,r)};St.prototype.consume=function(){return this.size=0,Du(this.comparator,this.items)};St.prototype.toArray=function(){return Du(this.comparator,this.items.slice())};St.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:St,enumerable:!1}),r};typeof Symbol<"u"&&(St.prototype[Symbol.for("nodejs.util.inspect.custom")]=St.prototype.inspect);function zo(r){if(this.clear(),this.comparator=r||da,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=Ru(this.comparator)}zo.prototype=St.prototype;St.from=function(r,t){var e=new St(t),i;return er.isArrayLike(r)?i=r.slice():i=er.toArray(r),fi(e.comparator,i),e.items=i,e.size=i.length,e};zo.from=function(r,t){var e=new zo(t),i;return er.isArrayLike(r)?i=r.slice():i=er.toArray(r),fi(e.comparator,i),e.items=i,e.size=i.length,e};St.siftUp=cs;St.siftDown=Pu;St.push=fy;St.pop=Mu;St.replace=sn;St.pushpop=py;St.heapify=fi;St.consume=Du;St.nsmallest=jP;St.nlargest=YP;St.MinHeap=St;St.MaxHeap=zo;var gy=St,my=xu,Lu=ls.createEdgeWeightGetter,Xo=gy,Bu="weight";function Xl(r,t){return r[0]>t[0]?1:r[0]<t[0]?-1:r[1]>t[1]?1:r[1]<t[1]?-1:r[2]>t[2]?1:r[2]<t[2]?-1:0}function qP(r,t){return r[0]>t[0]?1:r[0]<t[0]?-1:r[1]>t[1]?1:r[1]<t[1]?-1:r[2]>t[2]?1:r[2]<t[2]?-1:r[3]>t[3]?1:r[3]<t[3]?-1:0}function KP(r,t,e,i){if(t=""+t,e=""+e,!my(r))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(t&&!r.hasNode(t))throw new Error('graphology-shortest-path/dijkstra: the "'+t+'" source node does not exist in the given graph.');if(e&&!r.hasNode(e))throw new Error('graphology-shortest-path/dijkstra: the "'+e+'" target node does not exist in the given graph.');if(i=Lu(i||Bu).fromMinimalEntry,t===e)return[0,[t]];var n=[{},{}],s=[{},{}],o=[new Xo(Xl),new Xo(Xl)],a=[{},{}];s[0][t]=[t],s[1][e]=[e],a[0][t]=0,a[1][e]=0;var h=[],l=1/0,u=0,c=1,d,f,p,g,m,y,x,v,_;for(o[0].push([0,u++,t]),o[1].push([0,u++,e]);o[0].size&&o[1].size;)if(c=1-c,d=o[c].pop(),g=d[0],m=d[2],!(m in n[c])){if(n[c][m]=g,m in n[1-c])return[l,h];for(f=c===1?r.inboundEdges(m):r.outboundEdges(m),v=0,_=f.length;v<_;v++){if(x=f[v],y=r.opposite(m,x),p=n[c][m]+i(x,r.getEdgeAttributes(x)),y in n[c]&&p<n[c][y])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(y in a[c])||p<a[c][y])&&(a[c][y]=p,o[c].push([p,u++,y]),s[c][y]=s[c][m].concat(y),y in a[0]&&y in a[1]&&(g=a[0][y]+a[1][y],(h.length===0||l>g)&&(l=g,h=s[0][y].concat(s[1][y].slice(0,-1).reverse()))))}}return[1/0,null]}function ZP(r,t,e,i,n,s){if(!my(r))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(n&&!r.hasNode(n))throw new Error('graphology-shortest-path/dijkstra: the "'+n+'" target node does not exist in the given graph.');e=Lu(e||Bu).fromMinimalEntry;var o={},a={},h=new Xo(Xl),l=0,u,c,d,f,p,g,m,y,x,v,_;for(y=0,v=t.length;y<v;y++)f=t[y],a[f]=0,h.push([0,l++,f]),s&&(s[f]=[f]);for(;h.size;)if(c=h.pop(),m=c[0],f=c[2],!(f in o)){if(o[f]=m,f===n)break;for(u=r.outboundEdges(f),x=0,_=u.length;x<_;x++)if(g=u[x],p=r.opposite(f,g),d=e(g,r.getEdgeAttributes(g))+o[f],!(i&&d>i)){if(p in o&&d<o[p])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(p in a)||d<a[p])&&(a[p]=d,h.push([d,l++,p]),s&&(s[p]=s[f].concat(p)))}}return o}function QP(r,t,e){var i={};return ZP(r,[t],e,0,null,i),i}function JP(r,t,e,i){return KP(r,t,e,i)[1]}function tM(r,t,e){t=""+t,e=Lu(e||Bu).fromMinimalEntry;var i=[],n={},s={},o=r.nodes(),a,h,l,u,c,d,f,p,g,m;for(g=0,m=o.length;g<m;g++)d=o[g],n[d]=[],s[d]=0;var y={};s[t]=1;var x={};x[t]=0;var v=0,_=new Xo(qP);for(_.push([0,v++,t,t]);_.size;)if(h=_.pop(),u=h[0],l=h[2],d=h[3],!(d in y))for(s[d]+=s[l],i.push(d),y[d]=u,a=r.outboundEdges(d),g=0,m=a.length;g<m;g++)p=a[g],f=r.opposite(d,p),c=u+e(p,r.getEdgeAttributes(p)),!(f in y)&&(!(f in x)||c<x[f])?(x[f]=c,_.push([c,v++,d,f]),s[f]=0,n[f]=[d]):c===x[f]&&(s[f]+=s[d],n[f].push(d));return[i,n,s]}ca.bidirectional=JP;ca.singleSource=QP;ca.brandes=tM;var eM={},rM=xu,iM=ls.createEdgeWeightGetter,nM=gy,sM="weight";function oM(r,t){return r[0]>t[0]?1:r[0]<t[0]?-1:r[1]>t[1]?1:r[1]<t[1]?-1:0}function aM(r,t,e,i,n,s){if(!rM(r))throw new Error("graphology-shortest-path/astar: invalid graphology instance.");if(t&&!r.hasNode(t))throw new Error('graphology-shortest-path/astar: the "'+t+'" source node does not exist in the given graph.');if(e&&!r.hasNode(e))throw new Error('graphology-shortest-path/astar: the "'+e+'" target node does not exist in the given graph.');if(i=iM(i||sM).fromMinimalEntry,t===e)return[t];n=n||function(){return 0},s=s||{};var o=0,a=new nM(oM);a.push([0,o++,t,0,null]);var h={},l={},u,c,d,f,p,g,m,y,x,v,_,E;function N(S,T,D,B){if(E=c===D?B:D,v=i(S,T),v!==null){if(_=f+v,h.hasOwnProperty(E)){if(d=h[E],y=d[0],x=d[1],y<=_)return}else x=n(E,e);s.cutoff&&_+x>s.cutoff||(h[E]=[_,x],a.push([_+x,o++,E,_,c]))}}for(;a.size!==0;){if(u=a.pop(),c=u[2],f=u[3],p=u[4],c===e){for(g=[c],m=p;m!==null;)g.push(m),m=l[m];return g.reverse(),g}l.hasOwnProperty(c)&&(l[c]===null||(y=h[c][0],y<f))||(l[c]=p,r.forEachOutboundEdge(c,N))}return null}eM.bidirectional=aM;var ds=fn,hM=ca;ds.bidirectional;ds.singleSource;ds.singleSourceLength;ds.undirectedSingleSourceLength;ds.brandes;async function lM({nodes:r,links:t},{containerSelector:e,initial:i=!0,nodeRadius:n,nodeStroke:s="0xFFFFFF",nodeStrokeWidth:o=.5,nodeFillOpacity:a=1,nodeMinSize:h=6,linkStroke:l="0xFFFFFF",labelColor:u="white",width:c=640,height:d=400,tooltipStyles:f={width:"18rem",height:"auto","max-height":"10rem","overflow-y":"auto",padding:"0px","background-color":"black",color:"white",border:"0.075rem solid white","z-index":10},tooltipExtraStyles:p={width:"auto","max-width":"8rem",height:"auto",padding:"0.1rem","font-size":"0.5rem","pointer-events":"none","background-color":"white","border-radius":"0.1rem",border:"0.05rem solid black",color:"#404040","z-index":30}}={}){if(console.log("received data",r,t),!r)return;ee(".otherButton").style("top",b.graphDataType==="parameter"?"2.9rem":"1.4rem"),V("#hideInfo").style("display")==="block"||V("#search-tab-container").style("height",b.graphDataType==="parameter"?"4rem":"2.5rem"),V("#parameter-menu").style("display",b.graphDataType==="parameter"?"block":"none"),ee(".viewButton").style("top",`${b.graphDataType==="parameter"?3.1:1.4}rem`);let m=r.length===b.selectedNodeNames.length,y=["NAME","Parameter Explanation","SUBMODULE_NAME","SEGMENT_NAME"];const x={nodes:r,links:t},v=r.reduce((L,G)=>{const j=t.filter(J=>Cr(J)===G.id).length,X=t.filter(J=>Nr(J)===G.id).length;return L[G.id]=j+X,L},{}),_=b.graphDataType==="parameter"?vn(Object.values(v)):vn(x.nodes,L=>L.parameterCount),E=QC().domain(n?hh(r,n):[0,_]).range([h,h*3]).clamp(!0),N=ay();x.nodes=x.nodes.reduce((L,G)=>(G.radiusVar=b.graphDataType==="parameter"?v[G.id]:G.parameterCount,G.color=N(G.subModule),G.radius=E(G.radiusVar),L.push(G),L),[]);let S=V(e).select(".tooltip");S.node()===null&&(S=V(e).append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden"));let T=V(e).select(".tooltipExtra");T.node()===null&&(T=V(e).append("div").attr("class","tooltipExtra").style("position","absolute").style("visibility","hidden"));for(const L in f)S.style(L,f[L]),T.style(L,p[L]);const D=uM(x.nodes,x.links),B=gf().force("link",XI().id(L=>L.id).strength(L=>b.graphDataType!=="parameter"?0:1/Math.min(L.source.radiusVar,L.target.radiusVar))).force("x",mf(L=>L.x)).force("y",yf(L=>L.y)).force("collide",df().radius(L=>b.graphDataType==="parameter"?L.radius:L.radius*1.5).iterations(3)).force("cluster",It().strength(.45));B.stop();let k=V(e).select("svg");if(k.node()===null){k=V(e).append("svg").attr("class","baseSvg").attr("width",c).attr("height",d);const L=k.append("g").attr("class","chartGroup");L.append("g").attr("class","nnGroup"),L.append("g").attr("class","linkGroup"),L.append("g").attr("class","nodeGroup");const G=L.append("defs");G.append("marker").attr("class","markerGroupStart").append("svg:path").attr("class","markerPathStart"),G.append("marker").attr("class","markerGroupEnd").append("svg:path").attr("class","markerPathEnd")}const M=V(".chartGroup");M.select(".markerGroupStart").attr("id","arrowPathStart").attr("viewBox","0 -5 10 10").attr("refX",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto"),M.select(".markerPathStart").attr("fill","#A0A0A0").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("d","M9,-4L1,0L9,4"),M.select(".markerGroupEnd").attr("id","arrowPathEnd").attr("viewBox","0 -5 10 10").attr("refX",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto"),M.select(".markerPathEnd").attr("fill","#A0A0A0").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("d","M1, -4L9,0L1,4");let A=1;const w=L=>b.graphDataType!=="parameter"||b.currentLayout==="shortestPath"||L.id===b.nearestNeighbourOrigin&&b.currentLayout==="nearestNeighbour"?"block":b.currentLayout==="default"&&!m?b.selectedNodeNames.includes(L.id)?"block":"none":A>2?"block":"none",C=sN().on("zoom",L=>{const{x:G,y:j,k:X}=L.transform;A=X,M.attr("transform",`translate(${G},${j}) scale(${X})`),M.selectAll(".nodeLabel").style("display",w)});k.call(C).on("dblclick.zoom",null);const I=L=>{const[G,j]=hh(L,st=>st.fx||st.x);if(G===void 0||j===void 0)return{translateX:0,translateY:0,fitToScale:1};const[X,J]=hh(L,st=>st.fy||st.y);if(X===void 0||J===void 0)return{translateX:0,translateY:0,fitToScale:1};let pt=j-G+(L.length===1?250:100),mt=J-X+(L.length===1?250:100);const yt=-(G+j)/2,Z=-(X+J)/2+(b.currentLayout==="nearestNeighbour"?30:0),ut=.9/Math.max(pt/c,mt/d);return{translateX:yt,translateY:Z,fitToScale:ut}},R=(L,G,j)=>{if(j==="zoomIn"&&k.interrupt().transition().duration(G).call(C.scaleBy,2),j==="zoomOut"&&k.interrupt().transition().duration(G).call(C.scaleBy,.5),j==="zoomFit"){const{translateX:X,translateY:J,fitToScale:pt}=I(L);k.interrupt().transition().duration(G).call(C.transform,vu.scale(1).translate(c/2,d/2).scale(pt).translate(X,J))}},O=()=>{const L=b.defaultNodePositions;x.nodes.map(G=>{const j=L[G.id];G.x=j.x,G.y=j.y})};if(!i)b.currentLayout==="default"&&O(),ct(!0);else{B.nodes(x.nodes).force("link").links(x.links),console.log("run static graph layout"),B.force("charge",QI().strength(m?-100:-250)),B.alphaTarget(.1).restart();const L=Math.ceil(Math.log(B.alphaMin())/Math.log(1-B.alphaDecay()));if(B.tick(L),console.log("simulation finished"),B.stop(),b.graphDataType==="parameter"){const G=x.nodes.reduce((j,X)=>(j[X.id]={x:X.x,y:X.y},j),{});b.setDefaultNodePositions(G)}ct(!0)}ge(x.nodes,D,""),ge(x.nodes,D,"-sp-end"),$t(D);const z=(L,G,j,X)=>L.reduce((J,pt)=>(x.links.filter(yt=>(G==="outbound"?Cr(yt):Nr(yt))===pt).forEach(yt=>{const Z=Cr(yt),ut=Nr(yt),st=Z===pt?ut:Z;!X.includes(st)&&!J.some(Dt=>Dt.node===st)&&J.push({source:Z,target:ut,direction:G,depth:j,node:st})}),J),[]),P=()=>{const L=z([b.nearestNeighbourOrigin],"outbound",1,[]),G=z([b.nearestNeighbourOrigin],"inbound",1,[]),j=L.concat(G);if(b.nearestNeighbourDegree>1&&j.length>0){const X=[b.nearestNeighbourOrigin].concat(j.map(yt=>yt.node)),J=z(L.map(yt=>yt.node),"outbound",2,X),pt=z(G.map(yt=>yt.node),"inbound",2,X),mt=J.concat(pt);if(b.nearestNeighbourDegree>2&&mt.length>0){const yt=X.concat(mt.map(Dt=>Dt.node)),Z=z(J.map(Dt=>Dt.node),"outbound",3,yt),ut=z(pt.map(Dt=>Dt.node),"inbound",3,yt),st=Z.concat(ut);return j.concat(mt).concat(st)}return j.concat(mt)}return j},F=()=>{const L=[];for(let G=b.nearestNeighbourDegree;G>0;G--)L.push({type:"driver",level:G});L.push({type:"root",level:0});for(let G=1;G<=b.nearestNeighbourDegree;G++)L.push({type:"outcome",level:G});return L},rt=L=>{const X=M.select(".nnGroup").selectAll(".nnLabelGroup").data(L).join(J=>{const pt=J.append("g").attr("class","nnLabelGroup");return pt.append("text").attr("class","nnLabelType"),pt.append("text").attr("class","nnLabelLevel"),pt});return X.attr("transform",(J,pt)=>`translate(${pt*200},${-qi(4)})`),X.select(".nnLabelType").attr("x",200/2).attr("y",0).attr("font-size","1rem").attr("text-anchor","middle").attr("fill","white").text(J=>J.type.toUpperCase()),X.select(".nnLabelLevel").attr("x",200/2).attr("y","1em").attr("font-size","0.7rem").attr("text-anchor","middle").attr("fill","white").text(J=>`${J.level>0?`Level ${J.level}`:""}`),{nnWidth:200,nnHeight:1e3}};function ft(){b.setNotDefaultSelectedLinks([]),b.setNotDefaultSelectedNodeNames([]);const{nnWidth:L,nnHeight:G}=rt(F()),j=P(),X=(wt,Rt,Zt,vi)=>_m().parentId(se=>se[wt]).id(se=>se[Rt])(vi.concat(j.filter(se=>se.direction===Zt))),J=2.4,pt=[{target:"",source:b.nearestNeighbourOrigin}],mt=X("target","source","inbound",pt),yt=[{source:"",target:b.nearestNeighbourOrigin}],Z=X("source","target","outbound",yt),ut=j.reduce((wt,Rt)=>{const Zt=`${Rt.depth}-${Rt.direction}`;wt[Zt]||(wt[Zt]=0);const vi=x.nodes.find(se=>se.NAME===Rt[Rt.direction==="outbound"?"source":"target"]);return wt[Zt]+=vi.radius*J,wt},{}),st=j.length===0?0:vn(Object.values(ut)),Dt=(wt,Rt)=>UC().size([G*.9,Rt])(wt).descendants().filter(Zt=>Zt.depth>0),Ht=wt=>{const Rt=wt.descendants().map(Zt=>Zt.id);return wt.ancestors().forEach(Zt=>{Rt.some(vi=>vi===Zt.id)||Rt.push(Zt.id)}),Rt},H=vn(mt,wt=>wt.depth),Q=vn(Z,wt=>wt.depth),xt=(b.nearestNeighbourDegree+.5)*L,oe=(()=>{const wt=[{name:b.nearestNeighbourOrigin,x:xt,y:0,direction:"center",depth:0,nnLinkIds:Ht(mt).concat(Ht(Z))}],Rt=Dt(mt,L*H).reduce((se,ae)=>(se.push({name:ae.id,x:-ae.y+xt,y:ae.x,direction:"in",depth:ae.depth,nnLinkIds:Ht(ae)}),se),[]),Zt=Dt(Z,L*Q).reduce((se,ae)=>(se.push({name:ae.id,x:ae.y+xt,y:ae.x,direction:"out",depth:ae.depth,nnLinkIds:Ht(ae)}),se),[]);return wt.concat(Rt).concat(Zt).reduce((se,ae)=>{const yy=x.nodes.find(_y=>_y.NAME===ae.name);return ae.radius=yy.radius,se.push(ae),se},[])})();if(Array.from(zE(oe,wt=>`${wt.direction}-${wt.depth}`)).filter(wt=>wt[1].length>1&&Ug(wt[1],Rt=>Rt.radius*J)<d).forEach(wt=>{let Rt=0;wt[1].forEach(Zt=>{Zt.y=Rt+Zt.radius,Rt+=Zt.radius*J})}),st>d){const wt=gf().alphaDecay(.1).force("x",mf(Rt=>Rt.x).strength(.8)).force("y",yf(Rt=>Rt.y).strength(.8)).force("collide",df().radius(Rt=>Rt.radius*(J/2)).strength(.6));wt.stop(),wt.nodes(oe),wt.tick(300)}b.setNotDefaultSelectedLinks(j),b.setNotDefaultSelectedNodeNames(oe),ct(!0)}function ht(L){const G=hM.bidirectional(L,b.shortestPathStart,b.shortestPathEnd);if(G){const j=G.reduce((mt,yt,Z)=>{if(Z>0){const ut=G[Z-1];x.links.find(Dt=>Cr(Dt)===ut&&Nr(Dt)===yt)&&mt.push({source:ut,target:yt,node:ut,depth:1,direction:"outbound"})}return mt},[]);let X=100;const J=-(G.length*X)/2,pt=G.reduce((mt,yt,Z)=>{const ut=x.nodes.find(st=>st.NAME===yt);return Z===0&&(X-=ut.radius),mt.push({name:ut.id,x:J+X*Z,y:0,direction:"out"}),mt},[]);b.setNotDefaultSelectedLinks(j),b.setNotDefaultSelectedNodeNames(pt)}else V("#infoMessage").text(Ii.noSP).style("visibility","visible"),b.setNotDefaultSelectedLinks([]),b.setNotDefaultSelectedNodeNames([]);ct(!0)}function Et(L,G,j,X){if(V("#infoMessage").style("visibility","hidden"),G==="search"&&b.currentLayout==="nearestNeighbour")b.setNearestNeighbourOrigin(L),ft();else if(b.currentLayout==="shortestPath")G==="search"?b.setShortestPathStart(L):b.setShortestPathEnd(L),b.shortestPathStart!==""&&b.shortestPathEnd!==""&&ht(j);else if(X)b.setCurrentLayout("nearestNeighbour"),b.setNearestNeighbourOrigin(L),b.setSelectedNodeNames(b.allNodeNames),m=!0,Lt(j);else if(m)b.setSelectedNodeNames([L]);else if(b.selectedNodeNames.some(J=>J===L)){const J=b.selectedNodeNames.filter(pt=>pt!==L);J.length===0?b.setSelectedNodeNames(b.allNodeNames):b.setSelectedNodeNames(J)}else{const J=b.selectedNodeNames.concat([L]);b.setSelectedNodeNames(J)}ct(!0),b.currentLayout==="default"&&ii()}function ct(L){const G=()=>b.selectedNodeNames.length===1?x.nodes.find(Q=>Q.NAME===b.selectedNodeNames[0]):void 0;V(".animation-container").style("display","none");let j=x.nodes;if(b.currentLayout!=="default"){const H=b.currentLayout==="nearestNeighbour"&&b.nearestNeighbourOrigin!=="",Q=b.currentLayout==="shortestPath"&&b.shortestPathStart!==""&&b.shortestPathEnd!=="";H||Q?j=x.nodes.reduce((xt,Bt)=>{const oe=b.notDefaultSelectedNodeNames.find(Xr=>Xr.name===Bt.NAME);return oe&&(Bt.x=oe.x,Bt.y=oe.y,Bt.nnLinkIds=oe.nnLinkIds,xt.push(Bt)),xt},[]):j=[]}!b.showSingleNodes&&b.currentLayout==="default"&&(j=j.filter(H=>H.radiusVar>0)),m=x.nodes.length===b.selectedNodeNames.length,V("#selectUnselectButton").text(m?"unselect ALL":"select ALL");let X=x.links;b.currentLayout==="nearestNeighbour"?X=x.links.filter(H=>b.notDefaultSelectedLinks.some(Q=>Q.source===Cr(H)&&Q.target===Nr(H))):j.length!==x.nodes.length&&(X=x.links.filter(H=>j.some(Q=>Q.NAME===Cr(H))&&j.some(Q=>Q.NAME===Nr(H))));const J=(H,Q,xt)=>m||b.currentLayout!=="default"?1:b.selectedNodeNames.includes(H)?a:xt?0:.2,pt=H=>b.currentLayout==="default"?b.selectedNodeNames.includes(Cr(H))&&b.selectedNodeNames.includes(Nr(H)):!0,mt=(H,Q)=>{const xt=Q>100?.4:.6;return m||b.currentLayout!=="default"||pt(H)?xt:.05},yt=M.select(".linkGroup").selectAll(".linksGroup").data(X).join(H=>{const Q=H.append("g").attr("class","linksGroup");return Q.append("path").attr("class","allLinkPaths linkPathForArrows"),Q.append("path").attr("class","allLinkPaths linkPath"),Q}),Z=(H,Q)=>{const xt=V(`#arrowLinkPath${Q}`).node(),Bt=xt.getTotalLength(),oe=xt.getPointAtLength(H.source.radius+2),Xr=xt.getPointAtLength(Bt-(H.target.radius+2));return`M${oe.x},${oe.y},L${Xr.x},${Xr.y}`};yt.select(".linkPathForArrows").attr("id",(H,Q)=>`arrowLinkPath${Q}`).attr("pointer-events","none").attr("stroke","transparent").attr("fill","none").attr("d",H=>`M${H.source.x},${H.source.y},L${H.target.x},${H.target.y}`),yt.select(".linkPath").attr("pointer-events","none").attr("stroke-opacity",H=>mt(H,X.length)).attr("stroke-width",.5).attr("stroke",l).attr("fill","none"),ee(".linkPath").attr("d",Z).attr("marker-start",H=>pt(H)&&H.direction==="both"&&b.showArrows?"url(#arrowPathStart)":"").attr("marker-end",H=>pt(H)&&b.showArrows?"url(#arrowPathEnd)":"");const ut=(H,Q)=>{Q.x=H.x,Q.y=H.y,ee(".nodesGroup").filter(xt=>xt.id===Q.id).attr("transform",`translate(${H.x},${H.y})`),ct()},st=M.select(".nodeGroup").selectAll(".nodesGroup").data(j,H=>H.id).join(H=>{const Q=H.append("g").attr("class","nodesGroup");return Q.append("circle").attr("class","nodeCircle"),Q.append("text").attr("class","nodeLabel"),Q});st.attr("transform",H=>`translate(${H.x},${H.y})`).call(kT().on("drag",ut)).on("mouseover",(H,Q)=>{if(V(H.currentTarget).select(".nodeCircle").attr("fill","white"),b.graphDataType!=="parameter"){const xt=Q.id;M.selectAll(".allLinkPaths").attr("stroke-opacity",.05),M.selectAll(".nodeCircle").attr("opacity",.2),M.selectAll(".allLinkPaths").attr("marker-start","").attr("marker-end","").filter(Bt=>Bt.source.id===xt||Bt.target.id===xt).each((Bt,oe,Xr)=>{const ku=Bt.source.id===xt?Bt.target.id:Bt.source.id;M.selectAll(".nodeCircle").filter(wt=>wt.id===ku||wt.id===xt).attr("opacity",1),V(Xr[oe]).attr("marker-start",wt=>wt.direction==="both"?"url(#arrowPathStart)":"").attr("marker-end","url(#arrowPathEnd)").attr("stroke-opacity",.5)})}else Gt(Q,!0,H.x),b.currentLayout==="nearestNeighbour"&&(M.selectAll(".allLinkPaths").attr("marker-start","").attr("marker-end","").attr("stroke-opacity",.05),M.selectAll(".nodeCircle").attr("opacity",.2),M.selectAll(".allLinkPaths").filter(xt=>Q.nnLinkIds.includes(xt.source.id)&&Q.nnLinkIds.includes(xt.target.id)).attr("marker-start",xt=>xt.direction==="both"?"url(#arrowPathStart)":"").attr("marker-end","url(#arrowPathEnd)").attr("stroke-opacity",.5),M.selectAll(".nodeCircle").filter(xt=>Q.nnLinkIds.includes(xt.id)).attr("opacity",1))}).on("mouseout",H=>{if(ee(".nodeCircle").attr("fill",Q=>Q.color).attr("opacity",Q=>b.graphDataType!=="parameter"||b.currentLayout!=="default"||b.selectedNodeNames.includes(Q.id)?1:.2),M.selectAll(".linkPath").attr("stroke-opacity",Q=>mt(Q,X.length)).attr("marker-start",Q=>pt(Q)&&Q.direction==="both"&&b.showArrows?"url(#arrowPathStart)":"").attr("marker-end",Q=>pt(Q)&&b.showArrows?"url(#arrowPathEnd)":""),b.graphDataType==="parameter")if(m&&b.currentLayout==="default")S.style("visibility","hidden");else{const Q=G();Gt(Q,!1,H.x)}}).on("click",(H,Q)=>{H.defaultPrevented||b.currentLayout==="default"&&b.graphDataType==="parameter"&&(V(H.currentTarget).raise(),Et(Q.NAME,"node",D,H.shiftKey))}),st.select(".nodeCircle").attr("opacity",H=>J(H.NAME,H.radiusVar,!1)).attr("r",H=>H.radius).attr("fill",H=>H.color).attr("stroke-width",o).attr("stroke",s);const Dt=qi(b.currentLayout==="shortestPath"?.4:.2);if(st.select(".nodeLabel").style("display",w).attr("text-anchor","middle").attr("dy",H=>H.radius+(b.currentLayout==="nearestNeighbour"&&H.id===b.nearestNeighbourOrigin?Dt*2:Dt)).attr("fill","white").attr("font-size",H=>b.currentLayout==="shortestPath"||b.currentLayout==="nearestNeighbour"&&H.id===b.nearestNeighbourOrigin?"0.4rem":"0.2rem").text(H=>H.NAME),L){let H=j;!m&&b.currentLayout==="default"&&(H=H.filter(Q=>b.selectedNodeNames.includes(Q.id))),R(H,400,"zoomFit")}const Ht=G();Gt(Ht,!1)}function At(L){let G=0,j=0,X=0;for(const J of L){let pt=E(J.radiusVar)**2;G+=J.x*pt,j+=J.y*pt,X+=pt}return{x:G/X,y:j/X}}function It(){var L=.8;let G;function j(X){const J=XE(G,At,mt=>mt.subModule),pt=X*L;for(const mt of G){const{x:yt,y:Z}=J.get(mt.subModule);mt.vx-=(mt.x-yt)*pt,mt.vy-=(mt.y-Z)*pt}}return j.initialize=X=>G=X,j.strength=function(X){return arguments.length?(L=+X,j):L},j}function Gt(L,G){let j="",X={};const J=b.currentLayout==="default"&&b.selectedNodeNames.length===1,pt=b.currentLayout!=="default"&&b.notDefaultSelectedNodeNames.length==1,mt=b.currentLayout==="default"?b.selectedNodeNames:b.notDefaultSelectedNodeNames;if(G||J||pt){S.style("padding","0.4rem");let Z=[];Z.push(`<div style="background-color: ${L.color} "><h3 style='text-align: center' >${L.NAME}</h3></div>`);const ut=r.find(st=>st.NAME===L.NAME);y.forEach(st=>{ut[st]&&ut[st]!==""&&Z.push(`<div><b>${st}: </b><span>${ut[st]}</span></div>`)}),Z.map(st=>j+=st)}else if(!m||b.currentLayout!=="default"&&b.graphDataType==="parameter"){let Z=[];if(mt.length>0){S.style("padding","0.05rem");const ut=`<table style='font-size: 0.7rem; table-layout: fixed;  width: 100%;'><thead><tr>${b.graphDataType==="parameter"?"<th style='width:55%; color: black;'>GROUP</th>":""}<th style='width:45%; color: black;'>NAME</th></tr></thead><tbody>`;Z.push(ut);let st=[];mt.forEach((Ht,H)=>{let Q="";Ht.direction&&Ht.direction!=="centre"&&(Q=Ht.direction==="in"?" (&larr;)":" (&rarr;)");const xt=typeof Ht=="string"?Ht:Ht.name,Bt=x.nodes.find(oe=>oe.NAME===xt);Bt?(st.push({row:`<tr>${b.graphDataType==="parameter"?`<td style='background-color:${Bt.color}; color: white; width:55%;'>${Bt.SUBMODULE_NAME} - ${Bt.SEGMENT_NAME}</td>`:""}<td class="nodeTableRow" id='nodeTableRow${H}' style="width:45%;">${xt}${Q}</td></tr>`,subModule:Bt.SUBMODULE_NAME,name:Bt.NAME}),X[`nodeTableRow${H}`]=Bt["Parameter Explanation"]):console.log(`issue with ${Ht}`)}),st=st.sort((Ht,H)=>_r(Ht.subModule,H.subModule)||_r(Ht.name,H.name)),Z=Z.concat(st.map(Ht=>Ht.row));const Dt="</tbody></table>";Z.push(Dt),j=Z.join("")}}const yt=b.graphDataType!=="parameter"&&!G||m&&!G&&b.currentLayout==="default"||mt.length===0?"hidden":"visible";V("#tooltipCount").text(yt==="visible"&&!G?`${mt.length} node${mt.length>1?"s":""} selected`:""),S.html(`${j}`).style("top","1.2rem").style("left","1rem").style("visibility",yt),ee(".nodeTableRow").style("cursor",function(){return X[this.id]&&X[this.id]!==""?"pointer":"default"}).attr("pointer-events",function(){return X[this.id]&&X[this.id]!==""?"all":"none"}).on("mouseover mousemove",Z=>{const ut=Z.currentTarget.id;X[ut]&&X[ut]!==""&&Tt(Z.x,Z.y,X[ut])}).on("mouseout",()=>{T.style("visibility","hidden")})}const jt=(L,G)=>{const j=document.createElement("canvas").getContext("2d");return j.font=`${G}px Arial`,j.measureText(L).width},Tt=(L,G,j)=>{const X=qi(.5),J=jt(j,X);let pt=L-J/2;L+J>c&&(pt=L-J),L-J<0&&(pt=L);let mt=G+X*2;mt+X*2>d&&(mt=G-X*2),T.style("left",`${pt}px`).style("font-size","0.5rem").style("top",`${mt}px`).style("visibility","visible").text(j)},Lt=L=>{if(V("#search-input").property("value",""),V("#infoMessage").style("visibility","hidden"),M.selectAll(".nodeLabel").style("display",w),ee(".otherButton").style("top",b.currentLayout==="default"?"2.9rem":"4.8rem"),V("#hide-single-button").style("display","none"),b.currentLayout==="default"){V("#view").style("display","block"),V("#tabbed-component").classed("hidden",window.innerWidth<1e3),V("#showInfo").classed("hidden",window.innerWidth>=1e3),V("#hideInfo").classed("hidden",window.innerWidth<1e3);const G=V("#hideInfo").style("display")==="block";V("#search-tab-container").style("height",G?"auto":"4rem"),ee(".viewButton").style("opacity",1),V("#nnDegreeDiv").style("display","none"),ee("#search-input").attr("placeholder","Search for variables"),V("#hide-single-button").style("display","block"),V("#search-container-sp-end").style("display","none"),O(),ct(!0)}else b.setNotDefaultSelectedNodeNames([]),b.setNotDefaultSelectedLinks([]),V("#view").style("display","none"),V("#tabbed-component").classed("hidden",!0),ee(".viewButton").style("opacity",0),b.currentLayout==="nearestNeighbour"&&(b.selectedNodeNames.length>0&&!m&&(b.nearestNeighbourOrigin=b.selectedNodeNames[0]),b.nearestNeighbourOrigin!==""?ft():(b.setNotDefaultSelectedLinks([]),b.setNotDefaultSelectedNodeNames([]),V("#infoMessage").text(Ii.NN).style("visibility","visible"),ct(!0)),V("#search-container-sp-end").style("display","none"),V("#nnDegreeDiv").style("display","block"),V("#search-tab-container").style("height","6rem"),ee("#search-input").attr("placeholder","Search for origin node").property("value",b.nearestNeighbourOrigin)),b.currentLayout==="shortestPath"&&(b.selectedNodeNames.length>0&&!m?(b.shortestPathStart=b.selectedNodeNames[0],b.selectedNodeNames.length>1?(b.shortestPathEnd=b.selectedNodeNames[1],ht(L)):(V("#infoMessage").text(Ii.SP).style("visibility","visible"),ct(!0))):b.shortestPathStart!==""&&b.shortestPathEnd!==""?ht(L):(V("#infoMessage").text(Ii.SP).style("visibility","visible"),ct(!0)),V("#search-container-sp-end").style("display","block"),V("#search-input-sp-end").property("value",b.shortestPathEnd),V("#search-tab-container").style("height","6rem"),V("#nnDegreeDiv").style("display","none"),ee("#search-input").attr("placeholder","Search for start node").property("value",b.shortestPathStart));ee(".dropdown-item").style("color",(G,j,X)=>b.currentLayout===X[j].id?"white":"#808080")};function $t(L){ee(".resetButton").style("cursor","pointer").on("mouseover mousemove",Z=>{Tt(Z.x,Z.y,"reset search")}).on("mouseout",()=>{T.style("visibility","hidden")}).on("click",Z=>{const ut=Z.currentTarget.id;let st="";ut==="refreshNN"?(b.nearestNeighbourOrigin="",st=Ii.NN,b.setNotDefaultSelectedLinks([]),rt([])):(b.shortestPathStart="",b.shortestPathEnd="",st=Ii.SP),b.setNotDefaultSelectedNodeNames([]),V("#search-input").property("value",""),V("#search-input-sp-end").property("value",""),V("#infoMessage").text(st).style("visibility","visible"),ct(!0)}),V("#downloadImage").style("cursor","pointer").on("mouseover mousemove",Z=>{Tt(Z.x,Z.y,"click to download chart as an image")}).on("mouseout",()=>{T.style("visibility","hidden")});const X=V("#hide-single-button");X.style("color",b.showSingleNodes?"#808080":"white").style("cursor","pointer").on("mouseover mousemove",Z=>{Tt(Z.x,Z.y,b.showSingleNodes?"hide single nodes":"show single nodes")}).on("mouseout",()=>{T.style("visibility","hidden")}).on("click",()=>{b.setShowSingleNodes(!b.showSingleNodes),X.style("color",b.showSingleNodes?"#808080":"white"),ct(!1)});const J=V("#show-arrows-button");J.style("color",b.showArrows?"white":"#808080").on("mouseover mousemove",Z=>{Tt(Z.x,Z.y,b.showArrows?"hide arrows":"show arrows")}).on("mouseout",()=>{T.style("visibility","hidden")}).on("click",()=>{b.setShowArrows(!b.showArrows),J.style("color",b.showArrows?"white":"#808080"),ct(!1)}),V("#layout-button").on("mouseover mousemove",Z=>{Tt(Z.x,Z.y,"toggle layouts")}).on("mouseout",()=>{T.style("visibility","hidden")}),V("#nnDegree").on("input",function(){b.setNearestNeighbourDegree(this.value),V("#nnDegreeValue").html(this.value),b.nearestNeighbourOrigin!==""&&ft()}),ee(".zoom-button").on("mouseover mousemove",Z=>{Tt(Z.x,Z.y,Z.currentTarget.id.replace(/-/g," "))}).on("mouseout",()=>{T.style("visibility","hidden")}).on("click",Z=>{const ut=Z.currentTarget.id;ut==="zoom-in"?R(x.nodes,500,"zoomIn"):ut==="zoom-out"?R(x.nodes,500,"zoomOut"):ct(!0)}),ee(".dropdown-item").style("color",(Z,ut,st)=>b.currentLayout===st[ut].id?"white":"#808080").on("click",Z=>{rt([]);const ut=Z.currentTarget.id;ut==="default"&&(m&&b.notDefaultSelectedNodeNames.length>0&&b.setSelectedNodeNames([]),b.notDefaultSelectedNodeNames.forEach(st=>{b.selectedNodeNames.some(Dt=>Dt===st.name)||b.selectedNodeNames.push(st.name)})),b.setCurrentLayout(ut),Lt(L)})}function ge(L,G,j){const X=document.getElementById(`search-input${j}`),J=document.getElementById(`suggestions-container${j}`),pt=yt=>{const Z={keys:["NAME","DEFINITION"],threshold:.4},st=new dn(L,Z).search(yt),Dt=st.filter(Q=>Q.item.NAME.toLowerCase().startsWith(yt.toLowerCase())),Ht=st.filter(Q=>!Q.item.NAME.startsWith(yt)).sort((Q,xt)=>Q.item.NAME.toLowerCase().localeCompare(xt.item.NAME.toLowerCase()));return[...Dt,...Ht].map(Q=>Q.item)},mt=yt=>{const Z=pt(yt);J.innerHTML="",Z.forEach(ut=>{const st=document.createElement("div");st.classList.add("suggestion"),st.textContent=ut.DEFINITION?`${ut.NAME} - ${ut.DEFINITION}`:ut.NAME,st.addEventListener("click",()=>{X.value=ut.NAME,J.style.display="none",x.nodes.find(Dt=>Dt.NAME===ut.NAME)?(Et(ut.NAME,`search${j}`,G),b.currentLayout==="default"&&(X.value="")):b.currentLayout!=="default"&&ut.NAME===""&&(b.setNotDefaultSelectedLinks([]),b.setNotDefaultSelectedNodeNames([]),ct(!1))}),J.appendChild(st)}),Z.length>0?J.style.display="block":J.style.display="none"};X.addEventListener("input",()=>{B.alpha(0);const yt=X.value;mt(yt)})}}const uM=(r,t)=>{const e=new Nt;for(let i=0;i<r.length;i++)e.hasNode(r[i].id)||e.addNode(r[i].id);for(let i=0;i<t.length;i++){let n=Cr(t[i]),s=Nr(t[i]);e.hasNode(n)&&e.hasNode(s)&&(e.hasEdge(n,s)||e.addEdge(n,s))}return e};function Cr(r){return r.source&&(r.source.id?r.source.id:r.source)}function Nr(r){return r.target&&(r.target.id?r.target.id:r.target)}const cM=(r,t)=>{const e="NAME",i="UsesVariable",n="Variable",s=r.reduce((a,h)=>(h.id=h[e],h.type="tier3",h.subModule=`submodule-${h.SUBMODULE}`,a.push(h),a),[]),o=t.reduce((a,h)=>{if(h.source=h[i],h.target=h[n],!a.some(l=>l.source===h.source&&l.target===h.target)){const l=a.find(u=>u.source===h.target&&u.target===h.source);l?l.direction="both":a.push(h)}return a},[]);return{nodes:s,links:o}},$f=(r,t)=>(r.filter(e=>e[t]===null).map(e=>{const i=r.find(n=>n[`${t}_NAME`]===e[`${t}_NAME`]);i?e[t]=i[t]:console.error(`${JSON.stringify(e)} has missing ${t} data`)}),r.filter(e=>e[t]!==null));async function dM(){try{b.setInitialLoadComplete(!0),console.log("call get data"),console.log("Base URL:","/duForce/"),console.log("Current URL:",window.location.href);const[r,t]=await Promise.all([fetch("/duForce/assets/nodes.json"),fetch("/duForce/assets/edges.json")]);if(!r.ok||!t.ok)throw new Error(`HTTP error! Status: ${r.status} ${t.status}`);const e=await r.json(),i=await t.json();if(e&&i){let n=e.map(s=>({NAME:s.NAME,DEFINITION:s.DEFINITION,SUBMODULE:s.SUBMODULE,SUBMODULE_NAME:s["SUBMODULE NAME"],SEGMENT:s.SEGMENT,SEGMENT_NAME:s["SEGMENT NAME"],UNITS:s.UNITS,ReportValue:s.ReportValue,...s}));n=$f(n,"SUBMODULE"),n=$f(n,"SEGMENT"),b.setSelectedNodeNames(n.map(s=>s.NAME)),b.parameterData=cM(n,i),RP(n)}else throw new Error("Invalid response format")}catch(r){console.error("Error fetching data:",r)}}const fM=()=>b.graphDataType==="parameter"?b.parameterData:b.graphDataType==="segment"?b.hierarchyData.segment:b.hierarchyData.submodule,lo=r=>{const t=fM();lM(t,{containerSelector:"#app",initial:r,nodeId:"NAME",sourceId:"UsesVariable",targetId:"Variable",nodeTitle:e=>e.NAME,nodeStroke:"#000",linkStroke:"#A0A0A0",labelColor:"#fff",width:window.innerWidth,height:window.innerHeight})};b.initialLoadComplete||dM();const pM=(r="image.png",t="image/png")=>{const i=V(".baseSvg").node(),n=new XMLSerializer().serializeToString(i),s=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(s),a=new Image;a.onload=function(){const h=document.createElement("canvas");h.width=(i.viewBox.baseVal.width||i.width.baseVal.value)*3,h.height=(i.viewBox.baseVal.height||i.height.baseVal.value)*3;const l=h.getContext("2d");l.scale(3,3),l.fillStyle="black",l.fillRect(0,0,h.width,h.height),l.drawImage(a,0,0),URL.revokeObjectURL(o),h.toBlob(function(u){const c=document.createElement("a");c.download=r,c.href=URL.createObjectURL(u),c.click()},t)},a.onerror=function(h){console.error("Image load error:",h),URL.revokeObjectURL(o)},a.src=o};V("#helpInfo").on("mouseover",()=>{V("#helpInformationPanel").style("visibility","visible")}).on("mouseout",()=>{V("#helpInformationPanel").style("visibility","hidden")});V("#downloadImage").on("click",()=>{pM()});
