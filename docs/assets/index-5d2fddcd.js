(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var _r=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(_r||{}),ap=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(ap||{}),Dh=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Dh||{}),lt=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(lt||{}),Qe=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Qe||{}),G=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(G||{}),Xr=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Xr||{}),ot=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(ot||{}),K=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(K||{}),_i=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(_i||{}),Hi=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Hi||{}),ni=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(ni||{}),ge=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(ge||{}),Ke=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Ke||{}),tu=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(tu||{}),Ee=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ee||{}),Yt=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Yt||{}),Vt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Vt||{}),ti=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(ti||{});const Hy={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},Z={ADAPTER:Hy,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ca=/iPhone/i,oc=/iPod/i,ac=/iPad/i,hc=/\biOS-universal(?:.+)Mac\b/i,Ma=/\bAndroid(?:.+)Mobile\b/i,lc=/Android/i,Sr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,bs=/Silk/i,di=/Windows Phone/i,uc=/\bWindows(?:.+)ARM\b/i,cc=/BlackBerry/i,dc=/BB10/i,fc=/Opera Mini/i,pc=/\b(CriOS|Chrome)(?:.+)Mobile/i,gc=/Mobile(?:.+)Firefox\b/i,mc=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function Wy(i){return function(t){return t.test(i)}}function yc(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=Wy(e),s={apple:{phone:n(Ca)&&!n(di),ipod:n(oc),tablet:!n(Ca)&&(n(ac)||mc(t))&&!n(di),universal:n(hc),device:(n(Ca)||n(oc)||n(ac)||n(hc)||mc(t))&&!n(di)},amazon:{phone:n(Sr),tablet:!n(Sr)&&n(bs),device:n(Sr)||n(bs)},android:{phone:!n(di)&&n(Sr)||!n(di)&&n(Ma),tablet:!n(di)&&!n(Sr)&&!n(Ma)&&(n(bs)||n(lc)),device:!n(di)&&(n(Sr)||n(bs)||n(Ma)||n(lc))||n(/\bokhttp\b/i)},windows:{phone:n(di),tablet:n(uc),device:n(di)||n(uc)},other:{blackberry:n(cc),blackberry10:n(dc),opera:n(fc),firefox:n(gc),chrome:n(pc),device:n(cc)||n(dc)||n(fc)||n(gc)||n(pc)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const zy=yc.default??yc,xi=zy(globalThis.navigator);Z.RETINA_PREFIX=/@([0-9\.]+)x/;Z.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var $n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ss(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Xy(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var hp={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function s(h,l,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,c||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p},a.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},a.prototype.emit=function(l,u,c,d,f,p){var g=e?e+l:l;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,_,v;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,c),!0;case 4:return m.fn.call(m.context,u,c,d),!0;case 5:return m.fn.call(m.context,u,c,d,f),!0;case 6:return m.fn.call(m.context,u,c,d,f,p),!0}for(v=1,_=new Array(y-1);v<y;v++)_[v-1]=arguments[v];m.fn.apply(m.context,_)}else{var x=m.length,A;for(v=0;v<x;v++)switch(m[v].once&&this.removeListener(l,m[v].fn,void 0,!0),y){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,u);break;case 3:m[v].fn.call(m[v].context,u,c);break;case 4:m[v].fn.call(m[v].context,u,c,d);break;default:if(!_)for(A=1,_=new Array(y-1);A<y;A++)_[A-1]=arguments[A];m[v].fn.apply(m[v].context,_)}}return!0},a.prototype.on=function(l,u,c){return s(this,l,u,c,!1)},a.prototype.once=function(l,u,c){return s(this,l,u,c,!0)},a.prototype.removeListener=function(l,u,c,d){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!c||p.context===c)&&o(this,f);else{for(var g=0,m=[],y=p.length;g<y;g++)(p[g].fn!==u||d&&!p[g].once||c&&p[g].context!==c)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(hp);var Vy=hp.exports;const os=ss(Vy);var eu={exports:{}};eu.exports=Jo;eu.exports.default=Jo;function Jo(i,t,e){e=e||2;var r=t&&t.length,n=r?t[0]*e:i.length,s=lp(i,0,n,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,h,l,u,c,d,f;if(r&&(s=Zy(i,t,s,e)),i.length>80*e){a=l=i[0],h=u=i[1];for(var p=e;p<n;p+=e)c=i[p],d=i[p+1],c<a&&(a=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return qn(s,o,e,a,h,f,0),o}function lp(i,t,e,r,n){var s,o;if(n===Oh(i,t,e,r)>0)for(s=t;s<e;s+=r)o=vc(s,i[s],i[s+1],o);else for(s=e-r;s>=t;s-=r)o=vc(s,i[s],i[s+1],o);return o&&ta(o,o.next)&&(Zn(o),o=o.next),o}function fr(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(ta(e,e.next)||kt(e.prev,e,e.next)===0)){if(Zn(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function qn(i,t,e,r,n,s,o){if(i){!o&&s&&i0(i,r,n,s);for(var a=i,h,l;i.prev!==i.next;){if(h=i.prev,l=i.next,s?Yy(i,r,n,s):jy(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(l.i/e|0),Zn(i),i=l.next,a=l.next;continue}if(i=l,i===a){o?o===1?(i=qy(fr(i),t,e),qn(i,t,e,r,n,s,2)):o===2&&Ky(i,t,e,r,n,s):qn(fr(i),t,e,r,n,s,1);break}}}}function jy(i){var t=i.prev,e=i,r=i.next;if(kt(t,e,r)>=0)return!1;for(var n=t.x,s=e.x,o=r.x,a=t.y,h=e.y,l=r.y,u=n<s?n<o?n:o:s<o?s:o,c=a<h?a<l?a:l:h<l?h:l,d=n>s?n>o?n:o:s>o?s:o,f=a>h?a>l?a:l:h>l?h:l,p=r.next;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&Hr(n,a,s,h,o,l,p.x,p.y)&&kt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Yy(i,t,e,r){var n=i.prev,s=i,o=i.next;if(kt(n,s,o)>=0)return!1;for(var a=n.x,h=s.x,l=o.x,u=n.y,c=s.y,d=o.y,f=a<h?a<l?a:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,g=a>h?a>l?a:l:h>l?h:l,m=u>c?u>d?u:d:c>d?c:d,y=Lh(f,p,t,e,r),_=Lh(g,m,t,e,r),v=i.prevZ,x=i.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=f&&v.x<=g&&v.y>=p&&v.y<=m&&v!==n&&v!==o&&Hr(a,u,h,c,l,d,v.x,v.y)&&kt(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=f&&x.x<=g&&x.y>=p&&x.y<=m&&x!==n&&x!==o&&Hr(a,u,h,c,l,d,x.x,x.y)&&kt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=g&&v.y>=p&&v.y<=m&&v!==n&&v!==o&&Hr(a,u,h,c,l,d,v.x,v.y)&&kt(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=g&&x.y>=p&&x.y<=m&&x!==n&&x!==o&&Hr(a,u,h,c,l,d,x.x,x.y)&&kt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function qy(i,t,e){var r=i;do{var n=r.prev,s=r.next.next;!ta(n,s)&&up(n,r,r.next,s)&&Kn(n,s)&&Kn(s,n)&&(t.push(n.i/e|0),t.push(r.i/e|0),t.push(s.i/e|0),Zn(r),Zn(r.next),r=i=s),r=r.next}while(r!==i);return fr(r)}function Ky(i,t,e,r,n,s){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&s0(o,a)){var h=cp(o,a);o=fr(o,o.next),h=fr(h,h.next),qn(o,t,e,r,n,s,0),qn(h,t,e,r,n,s,0);return}a=a.next}o=o.next}while(o!==i)}function Zy(i,t,e,r){var n=[],s,o,a,h,l;for(s=0,o=t.length;s<o;s++)a=t[s]*r,h=s<o-1?t[s+1]*r:i.length,l=lp(i,a,h,r,!1),l===l.next&&(l.steiner=!0),n.push(n0(l));for(n.sort(Qy),s=0;s<n.length;s++)e=Jy(n[s],e);return e}function Qy(i,t){return i.x-t.x}function Jy(i,t){var e=t0(i,t);if(!e)return t;var r=cp(e,i);return fr(r,r.next),fr(e,e.next)}function t0(i,t){var e=t,r=i.x,n=i.y,s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,u=o.y,c=1/0,d;e=o;do r>=e.x&&e.x>=l&&r!==e.x&&Hr(n<u?r:s,n,l,u,n<u?s:r,n,e.x,e.y)&&(d=Math.abs(n-e.y)/(r-e.x),Kn(e,i)&&(d<c||d===c&&(e.x>o.x||e.x===o.x&&e0(o,e)))&&(o=e,c=d)),e=e.next;while(e!==h);return o}function e0(i,t){return kt(i.prev,i,t.prev)<0&&kt(t.next,i,i.next)<0}function i0(i,t,e,r){var n=i;do n.z===0&&(n.z=Lh(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,r0(n)}function r0(i){var t,e,r,n,s,o,a,h,l=1;do{for(e=i,i=null,s=null,o=0;e;){for(o++,r=e,a=0,t=0;t<l&&(a++,r=r.nextZ,!!r);t++);for(h=l;a>0||h>0&&r;)a!==0&&(h===0||!r||e.z<=r.z)?(n=e,e=e.nextZ,a--):(n=r,r=r.nextZ,h--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;e=r}s.nextZ=null,l*=2}while(o>1);return i}function Lh(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function n0(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Hr(i,t,e,r,n,s,o,a){return(n-o)*(t-a)>=(i-o)*(s-a)&&(i-o)*(r-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(n-o)*(r-a)}function s0(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!o0(i,t)&&(Kn(i,t)&&Kn(t,i)&&a0(i,t)&&(kt(i.prev,i,t.prev)||kt(i,t.prev,t))||ta(i,t)&&kt(i.prev,i,i.next)>0&&kt(t.prev,t,t.next)>0)}function kt(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function ta(i,t){return i.x===t.x&&i.y===t.y}function up(i,t,e,r){var n=As(kt(i,t,e)),s=As(kt(i,t,r)),o=As(kt(e,r,i)),a=As(kt(e,r,t));return!!(n!==s&&o!==a||n===0&&Es(i,e,t)||s===0&&Es(i,r,t)||o===0&&Es(e,i,r)||a===0&&Es(e,t,r))}function Es(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function As(i){return i>0?1:i<0?-1:0}function o0(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&up(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Kn(i,t){return kt(i.prev,i,i.next)<0?kt(i,t,i.next)>=0&&kt(i,i.prev,t)>=0:kt(i,t,i.prev)<0||kt(i,i.next,t)<0}function a0(i,t){var e=i,r=!1,n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function cp(i,t){var e=new Bh(i.i,i.x,i.y),r=new Bh(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function vc(i,t,e,r){var n=new Bh(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Zn(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Bh(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Jo.deviation=function(i,t,e,r){var n=t&&t.length,s=n?t[0]*e:i.length,o=Math.abs(Oh(i,0,s,e));if(n)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:i.length;o-=Math.abs(Oh(i,l,u,e))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*e,f=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((i[d]-i[p])*(i[f+1]-i[d+1])-(i[d]-i[f])*(i[p+1]-i[d+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function Oh(i,t,e,r){for(var n=0,s=t,o=e-r;s<e;s+=r)n+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return n}Jo.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,n=0;n<i.length;n++){for(var s=0;s<i[n].length;s++)for(var o=0;o<t;o++)e.vertices.push(i[n][s][o]);n>0&&(r+=i[n-1].length,e.holes.push(r))}return e};var h0=eu.exports;const l0=ss(h0);var vo={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */vo.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,s=typeof $n=="object"&&$n;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,g="-",m=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,A=Math.floor,N=String.fromCharCode,S;function T(F){throw new RangeError(v[F])}function C(F,H){for(var mt=F.length,xt=[];mt--;)xt[mt]=H(F[mt]);return xt}function k(F,H){var mt=F.split("@"),xt="";mt.length>1&&(xt=mt[0]+"@",F=mt[1]),F=F.replace(_,".");var At=F.split("."),Ut=C(At,H).join(".");return xt+Ut}function O(F){for(var H=[],mt=0,xt=F.length,At,Ut;mt<xt;)At=F.charCodeAt(mt++),At>=55296&&At<=56319&&mt<xt?(Ut=F.charCodeAt(mt++),(Ut&64512)==56320?H.push(((At&1023)<<10)+(Ut&1023)+65536):(H.push(At),mt--)):H.push(At);return H}function M(F){return C(F,function(H){var mt="";return H>65535&&(H-=65536,mt+=N(H>>>10&1023|55296),H=56320|H&1023),mt+=N(H),mt}).join("")}function E(F){return F-48<10?F-22:F-65<26?F-65:F-97<26?F-97:h}function I(F,H){return F+22+75*(F<26)-((H!=0)<<5)}function Q(F,H,mt){var xt=0;for(F=mt?A(F/d):F>>1,F+=A(F/H);F>x*u>>1;xt+=h)F=A(F/x);return A(xt+(x+1)*F/(F+c))}function et(F){var H=[],mt=F.length,xt,At=0,Ut=p,Rt=f,Xt,Kt,ae,Bt,Tt,Lt,b,pe,Pt;for(Xt=F.lastIndexOf(g),Xt<0&&(Xt=0),Kt=0;Kt<Xt;++Kt)F.charCodeAt(Kt)>=128&&T("not-basic"),H.push(F.charCodeAt(Kt));for(ae=Xt>0?Xt+1:0;ae<mt;){for(Bt=At,Tt=1,Lt=h;ae>=mt&&T("invalid-input"),b=E(F.charCodeAt(ae++)),(b>=h||b>A((a-At)/Tt))&&T("overflow"),At+=b*Tt,pe=Lt<=Rt?l:Lt>=Rt+u?u:Lt-Rt,!(b<pe);Lt+=h)Pt=h-pe,Tt>A(a/Pt)&&T("overflow"),Tt*=Pt;xt=H.length+1,Rt=Q(At-Bt,xt,Bt==0),A(At/xt)>a-Ut&&T("overflow"),Ut+=A(At/xt),At%=xt,H.splice(At++,0,Ut)}return M(H)}function Y(F){var H,mt,xt,At,Ut,Rt,Xt,Kt,ae,Bt,Tt,Lt=[],b,pe,Pt,Ge;for(F=O(F),b=F.length,H=p,mt=0,Ut=f,Rt=0;Rt<b;++Rt)Tt=F[Rt],Tt<128&&Lt.push(N(Tt));for(xt=At=Lt.length,At&&Lt.push(g);xt<b;){for(Xt=a,Rt=0;Rt<b;++Rt)Tt=F[Rt],Tt>=H&&Tt<Xt&&(Xt=Tt);for(pe=xt+1,Xt-H>A((a-mt)/pe)&&T("overflow"),mt+=(Xt-H)*pe,H=Xt,Rt=0;Rt<b;++Rt)if(Tt=F[Rt],Tt<H&&++mt>a&&T("overflow"),Tt==H){for(Kt=mt,ae=h;Bt=ae<=Ut?l:ae>=Ut+u?u:ae-Ut,!(Kt<Bt);ae+=h)Ge=Kt-Bt,Pt=h-Bt,Lt.push(N(I(Bt+Ge%Pt,0))),Kt=A(Ge/Pt);Lt.push(N(I(Kt,0))),Ut=Q(mt,pe,xt==At),mt=0,++xt}++mt,++H}return Lt.join("")}function rt(F){return k(F,function(H){return m.test(H)?et(H.slice(4).toLowerCase()):H})}function gt(F){return k(F,function(H){return y.test(H)?"xn--"+Y(H):H})}if(o={version:"1.4.1",ucs2:{decode:O,encode:M},decode:et,encode:Y,toASCII:gt,toUnicode:rt},r&&n)if(i.exports==r)n.exports=o;else for(S in o)o.hasOwnProperty(S)&&(r[S]=o[S]);else e.punycode=o})($n)})(vo,vo.exports);var u0=vo.exports,cn=TypeError;const c0={},d0=Object.freeze(Object.defineProperty({__proto__:null,default:c0},Symbol.toStringTag,{value:"Module"})),f0=Xy(d0);var iu=typeof Map=="function"&&Map.prototype,Ra=Object.getOwnPropertyDescriptor&&iu?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,_o=iu&&Ra&&typeof Ra.get=="function"?Ra.get:null,_c=iu&&Map.prototype.forEach,ru=typeof Set=="function"&&Set.prototype,Pa=Object.getOwnPropertyDescriptor&&ru?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,xo=ru&&Pa&&typeof Pa.get=="function"?Pa.get:null,xc=ru&&Set.prototype.forEach,p0=typeof WeakMap=="function"&&WeakMap.prototype,Hn=p0?WeakMap.prototype.has:null,g0=typeof WeakSet=="function"&&WeakSet.prototype,Wn=g0?WeakSet.prototype.has:null,m0=typeof WeakRef=="function"&&WeakRef.prototype,wc=m0?WeakRef.prototype.deref:null,y0=Boolean.prototype.valueOf,v0=Object.prototype.toString,_0=Function.prototype.toString,x0=String.prototype.match,nu=String.prototype.slice,ki=String.prototype.replace,w0=String.prototype.toUpperCase,bc=String.prototype.toLowerCase,dp=RegExp.prototype.test,Ec=Array.prototype.concat,Ze=Array.prototype.join,b0=Array.prototype.slice,Ac=Math.floor,kh=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Na=Object.getOwnPropertySymbols,Fh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,rn=typeof Symbol=="function"&&typeof Symbol.iterator=="object",zn=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===rn||"symbol")?Symbol.toStringTag:null,fp=Object.prototype.propertyIsEnumerable,Tc=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function Sc(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||dp.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-Ac(-i):Ac(i);if(r!==i){var n=String(r),s=nu.call(t,n.length+1);return ki.call(n,e,"$&_")+"."+ki.call(ki.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ki.call(t,e,"$&_")}var Uh=f0,Ic=Uh.custom,Cc=mp(Ic)?Ic:null,pp={__proto__:null,double:'"',single:"'"},E0={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},ea=function i(t,e,r,n){var s=e||{};if(mi(s,"quoteStyle")&&!mi(pp,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(mi(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=mi(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(mi(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(mi(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return vp(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?Sc(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?Sc(t,l):l}var u=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof t=="object")return Gh(t)?"[Array]":"[Object]";var c=$0(s,r);if(typeof n>"u")n=[];else if(yp(n,t)>=0)return"[Circular]";function d(E,I,Q){if(I&&(n=b0.call(n),n.push(I)),Q){var et={depth:s.depth};return mi(s,"quoteStyle")&&(et.quoteStyle=s.quoteStyle),i(E,et,r+1,n)}return i(E,s,r+1,n)}if(typeof t=="function"&&!Mc(t)){var f=N0(t),p=Ts(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Ze.call(p,", ")+" }":"")}if(mp(t)){var g=rn?ki.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Fh.call(t);return typeof t=="object"&&!rn?xn(g):g}if(F0(t)){for(var m="<"+bc.call(String(t.nodeName)),y=t.attributes||[],_=0;_<y.length;_++)m+=" "+y[_].name+"="+gp(A0(y[_].value),"double",s);return m+=">",t.childNodes&&t.childNodes.length&&(m+="..."),m+="</"+bc.call(String(t.nodeName))+">",m}if(Gh(t)){if(t.length===0)return"[]";var v=Ts(t,d);return c&&!G0(v)?"["+$h(v,c)+"]":"[ "+Ze.call(v,", ")+" ]"}if(S0(t)){var x=Ts(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!fp.call(t,"cause")?"{ ["+String(t)+"] "+Ze.call(Ec.call("[cause]: "+d(t.cause),x),", ")+" }":x.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ze.call(x,", ")+" }"}if(typeof t=="object"&&o){if(Cc&&typeof t[Cc]=="function"&&Uh)return Uh(t,{depth:u-r});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(D0(t)){var A=[];return _c&&_c.call(t,function(E,I){A.push(d(I,t,!0)+" => "+d(E,t))}),Rc("Map",_o.call(t),A,c)}if(O0(t)){var N=[];return xc&&xc.call(t,function(E){N.push(d(E,t))}),Rc("Set",xo.call(t),N,c)}if(L0(t))return Da("WeakMap");if(k0(t))return Da("WeakSet");if(B0(t))return Da("WeakRef");if(C0(t))return xn(d(Number(t)));if(R0(t))return xn(d(kh.call(t)));if(M0(t))return xn(y0.call(t));if(I0(t))return xn(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof $n<"u"&&t===$n)return"{ [object globalThis] }";if(!T0(t)&&!Mc(t)){var S=Ts(t,d),T=Tc?Tc(t)===Object.prototype:t instanceof Object||t.constructor===Object,C=t instanceof Object?"":"null prototype",k=!T&&zn&&Object(t)===t&&zn in t?nu.call(zi(t),8,-1):C?"Object":"",O=T||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",M=O+(k||C?"["+Ze.call(Ec.call([],k||[],C||[]),": ")+"] ":"");return S.length===0?M+"{}":c?M+"{"+$h(S,c)+"}":M+"{ "+Ze.call(S,", ")+" }"}return String(t)};function gp(i,t,e){var r=e.quoteStyle||t,n=pp[r];return n+i+n}function A0(i){return ki.call(String(i),/"/g,"&quot;")}function xr(i){return!zn||!(typeof i=="object"&&(zn in i||typeof i[zn]<"u"))}function Gh(i){return zi(i)==="[object Array]"&&xr(i)}function T0(i){return zi(i)==="[object Date]"&&xr(i)}function Mc(i){return zi(i)==="[object RegExp]"&&xr(i)}function S0(i){return zi(i)==="[object Error]"&&xr(i)}function I0(i){return zi(i)==="[object String]"&&xr(i)}function C0(i){return zi(i)==="[object Number]"&&xr(i)}function M0(i){return zi(i)==="[object Boolean]"&&xr(i)}function mp(i){if(rn)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!Fh)return!1;try{return Fh.call(i),!0}catch{}return!1}function R0(i){if(!i||typeof i!="object"||!kh)return!1;try{return kh.call(i),!0}catch{}return!1}var P0=Object.prototype.hasOwnProperty||function(i){return i in this};function mi(i,t){return P0.call(i,t)}function zi(i){return v0.call(i)}function N0(i){if(i.name)return i.name;var t=x0.call(_0.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function yp(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function D0(i){if(!_o||!i||typeof i!="object")return!1;try{_o.call(i);try{xo.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function L0(i){if(!Hn||!i||typeof i!="object")return!1;try{Hn.call(i,Hn);try{Wn.call(i,Wn)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function B0(i){if(!wc||!i||typeof i!="object")return!1;try{return wc.call(i),!0}catch{}return!1}function O0(i){if(!xo||!i||typeof i!="object")return!1;try{xo.call(i);try{_o.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function k0(i){if(!Wn||!i||typeof i!="object")return!1;try{Wn.call(i,Wn);try{Hn.call(i,Hn)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function F0(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function vp(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return vp(nu.call(i,0,t.maxStringLength),t)+r}var n=E0[t.quoteStyle||"single"];n.lastIndex=0;var s=ki.call(ki.call(i,n,"\\$1"),/[\x00-\x1f]/g,U0);return gp(s,"single",t)}function U0(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+w0.call(t.toString(16))}function xn(i){return"Object("+i+")"}function Da(i){return i+" { ? }"}function Rc(i,t,e,r){var n=r?$h(e,r):Ze.call(e,", ");return i+" ("+t+") {"+n+"}"}function G0(i){for(var t=0;t<i.length;t++)if(yp(i[t],`
`)>=0)return!1;return!0}function $0(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=Ze.call(Array(i.indent+1)," ");else return null;return{base:e,prev:Ze.call(Array(t+1),e)}}function $h(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+Ze.call(i,","+e)+`
`+t.prev}function Ts(i,t){var e=Gh(i),r=[];if(e){r.length=i.length;for(var n=0;n<i.length;n++)r[n]=mi(i,n)?t(i[n],i):""}var s=typeof Na=="function"?Na(i):[],o;if(rn){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var h in i)mi(i,h)&&(e&&String(Number(h))===h&&h<i.length||rn&&o["$"+h]instanceof Symbol||(dp.call(/[^\w$]/,h)?r.push(t(h,i)+": "+t(i[h],i)):r.push(h+": "+t(i[h],i))));if(typeof Na=="function")for(var l=0;l<s.length;l++)fp.call(i,s[l])&&r.push("["+t(s[l])+"]: "+t(i[s[l]],i));return r}var H0=ea,W0=cn,ia=function(i,t,e){for(var r=i,n;(n=r.next)!=null;r=n)if(n.key===t)return r.next=n.next,e||(n.next=i.next,i.next=n),n},z0=function(i,t){if(i){var e=ia(i,t);return e&&e.value}},X0=function(i,t,e){var r=ia(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},V0=function(i,t){return i?!!ia(i,t):!1},j0=function(i,t){if(i)return ia(i,t,!0)},Y0=function(){var t,e={assert:function(r){if(!e.has(r))throw new W0("Side channel does not contain "+H0(r))},delete:function(r){var n=t&&t.next,s=j0(t,r);return s&&n&&n===s&&(t=void 0),!!s},get:function(r){return z0(t,r)},has:function(r){return V0(t,r)},set:function(r,n){t||(t={next:void 0}),X0(t,r,n)}};return e},_p=Object,q0=Error,K0=EvalError,Z0=RangeError,Q0=ReferenceError,J0=SyntaxError,tv=URIError,ev=Math.abs,iv=Math.floor,rv=Math.max,nv=Math.min,sv=Math.pow,ov=Math.round,av=Number.isNaN||function(t){return t!==t},hv=av,lv=function(t){return hv(t)||t===0?t:t<0?-1:1},uv=Object.getOwnPropertyDescriptor,io=uv;if(io)try{io([],"length")}catch{io=null}var xp=io,ro=Object.defineProperty||!1;if(ro)try{ro({},"a",{value:1})}catch{ro=!1}var cv=ro,La,Pc;function dv(){return Pc||(Pc=1,La=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,e);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),La}var Ba,Nc;function fv(){if(Nc)return Ba;Nc=1;var i=typeof Symbol<"u"&&Symbol,t=dv();return Ba=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Ba}var Oa,Dc;function wp(){return Dc||(Dc=1,Oa=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Oa}var ka,Lc;function bp(){if(Lc)return ka;Lc=1;var i=_p;return ka=i.getPrototypeOf||null,ka}var pv="Function.prototype.bind called on incompatible ",gv=Object.prototype.toString,mv=Math.max,yv="[object Function]",Bc=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var s=0;s<e.length;s+=1)r[s+t.length]=e[s];return r},vv=function(t,e){for(var r=[],n=e||0,s=0;n<t.length;n+=1,s+=1)r[s]=t[n];return r},_v=function(i,t){for(var e="",r=0;r<i.length;r+=1)e+=i[r],r+1<i.length&&(e+=t);return e},xv=function(t){var e=this;if(typeof e!="function"||gv.apply(e)!==yv)throw new TypeError(pv+e);for(var r=vv(arguments,1),n,s=function(){if(this instanceof n){var u=e.apply(this,Bc(r,arguments));return Object(u)===u?u:this}return e.apply(t,Bc(r,arguments))},o=mv(0,e.length-r.length),a=[],h=0;h<o;h++)a[h]="$"+h;if(n=Function("binder","return function ("+_v(a,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var l=function(){};l.prototype=e.prototype,n.prototype=new l,l.prototype=null}return n},wv=xv,ra=Function.prototype.bind||wv,su=Function.prototype.call,Fa,Oc;function Ep(){return Oc||(Oc=1,Fa=Function.prototype.apply),Fa}var bv=typeof Reflect<"u"&&Reflect&&Reflect.apply,Ev=ra,Av=Ep(),Tv=su,Sv=bv,Iv=Sv||Ev.call(Tv,Av),Cv=ra,Mv=cn,Rv=su,Pv=Iv,Ap=function(t){if(t.length<1||typeof t[0]!="function")throw new Mv("a function is required");return Pv(Cv,Rv,t)},Ua,kc;function Nv(){if(kc)return Ua;kc=1;var i=Ap,t=xp,e;try{e=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!e&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return Ua=r&&typeof r.get=="function"?i([r.get]):typeof s=="function"?function(a){return s(a==null?a:n(a))}:!1,Ua}var Ga,Fc;function Dv(){if(Fc)return Ga;Fc=1;var i=wp(),t=bp(),e=Nv();return Ga=i?function(n){return i(n)}:t?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return t(n)}:e?function(n){return e(n)}:null,Ga}var $a,Uc;function Lv(){if(Uc)return $a;Uc=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=ra;return $a=e.call(i,t),$a}var wt,Bv=_p,Ov=q0,kv=K0,Fv=Z0,Uv=Q0,nn=J0,Vr=cn,Gv=tv,$v=ev,Hv=iv,Wv=rv,zv=nv,Xv=sv,Vv=ov,jv=lv,Tp=Function,Ha=function(i){try{return Tp('"use strict"; return ('+i+").constructor;")()}catch{}},Qn=xp,Yv=cv,Wa=function(){throw new Vr},qv=Qn?function(){try{return arguments.callee,Wa}catch{try{return Qn(arguments,"callee").get}catch{return Wa}}}():Wa,Ir=fv()(),Zt=Dv(),Kv=bp(),Zv=wp(),Sp=Ep(),as=su,Br={},Qv=typeof Uint8Array>"u"||!Zt?wt:Zt(Uint8Array),lr={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?wt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?wt:ArrayBuffer,"%ArrayIteratorPrototype%":Ir&&Zt?Zt([][Symbol.iterator]()):wt,"%AsyncFromSyncIteratorPrototype%":wt,"%AsyncFunction%":Br,"%AsyncGenerator%":Br,"%AsyncGeneratorFunction%":Br,"%AsyncIteratorPrototype%":Br,"%Atomics%":typeof Atomics>"u"?wt:Atomics,"%BigInt%":typeof BigInt>"u"?wt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?wt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?wt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?wt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Ov,"%eval%":eval,"%EvalError%":kv,"%Float16Array%":typeof Float16Array>"u"?wt:Float16Array,"%Float32Array%":typeof Float32Array>"u"?wt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?wt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?wt:FinalizationRegistry,"%Function%":Tp,"%GeneratorFunction%":Br,"%Int8Array%":typeof Int8Array>"u"?wt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?wt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?wt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ir&&Zt?Zt(Zt([][Symbol.iterator]())):wt,"%JSON%":typeof JSON=="object"?JSON:wt,"%Map%":typeof Map>"u"?wt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ir||!Zt?wt:Zt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Bv,"%Object.getOwnPropertyDescriptor%":Qn,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?wt:Promise,"%Proxy%":typeof Proxy>"u"?wt:Proxy,"%RangeError%":Fv,"%ReferenceError%":Uv,"%Reflect%":typeof Reflect>"u"?wt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?wt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ir||!Zt?wt:Zt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?wt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ir&&Zt?Zt(""[Symbol.iterator]()):wt,"%Symbol%":Ir?Symbol:wt,"%SyntaxError%":nn,"%ThrowTypeError%":qv,"%TypedArray%":Qv,"%TypeError%":Vr,"%Uint8Array%":typeof Uint8Array>"u"?wt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?wt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?wt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?wt:Uint32Array,"%URIError%":Gv,"%WeakMap%":typeof WeakMap>"u"?wt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?wt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?wt:WeakSet,"%Function.prototype.call%":as,"%Function.prototype.apply%":Sp,"%Object.defineProperty%":Yv,"%Object.getPrototypeOf%":Kv,"%Math.abs%":$v,"%Math.floor%":Hv,"%Math.max%":Wv,"%Math.min%":zv,"%Math.pow%":Xv,"%Math.round%":Vv,"%Math.sign%":jv,"%Reflect.getPrototypeOf%":Zv};if(Zt)try{null.error}catch(i){var Jv=Zt(Zt(i));lr["%Error.prototype%"]=Jv}var t_=function i(t){var e;if(t==="%AsyncFunction%")e=Ha("async function () {}");else if(t==="%GeneratorFunction%")e=Ha("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Ha("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=i("%AsyncGenerator%");n&&Zt&&(e=Zt(n.prototype))}return lr[t]=e,e},Gc={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},hs=ra,wo=Lv(),e_=hs.call(as,Array.prototype.concat),i_=hs.call(Sp,Array.prototype.splice),$c=hs.call(as,String.prototype.replace),bo=hs.call(as,String.prototype.slice),r_=hs.call(as,RegExp.prototype.exec),n_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,s_=/\\(\\)?/g,o_=function(t){var e=bo(t,0,1),r=bo(t,-1);if(e==="%"&&r!=="%")throw new nn("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new nn("invalid intrinsic syntax, expected opening `%`");var n=[];return $c(t,n_,function(s,o,a,h){n[n.length]=a?$c(h,s_,"$1"):o||s}),n},a_=function(t,e){var r=t,n;if(wo(Gc,r)&&(n=Gc[r],r="%"+n[0]+"%"),wo(lr,r)){var s=lr[r];if(s===Br&&(s=t_(r)),typeof s>"u"&&!e)throw new Vr("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new nn("intrinsic "+t+" does not exist!")},ou=function(t,e){if(typeof t!="string"||t.length===0)throw new Vr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Vr('"allowMissing" argument must be a boolean');if(r_(/^%?[^%]*%?$/,t)===null)throw new nn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=o_(t),n=r.length>0?r[0]:"",s=a_("%"+n+"%",e),o=s.name,a=s.value,h=!1,l=s.alias;l&&(n=l[0],i_(r,e_([0,1],l)));for(var u=1,c=!0;u<r.length;u+=1){var d=r[u],f=bo(d,0,1),p=bo(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new nn("property names with quotes must have matching quotes");if((d==="constructor"||!c)&&(h=!0),n+="."+d,o="%"+n+"%",wo(lr,o))a=lr[o];else if(a!=null){if(!(d in a)){if(!e)throw new Vr("base intrinsic for "+t+" exists, but the property is not available.");return}if(Qn&&u+1>=r.length){var g=Qn(a,d);c=!!g,c&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[d]}else c=wo(a,d),a=a[d];c&&!h&&(lr[o]=a)}}return a},Ip=ou,Cp=Ap,h_=Cp([Ip("%String.prototype.indexOf%")]),Mp=function(t,e){var r=Ip(t,!!e);return typeof r=="function"&&h_(t,".prototype.")>-1?Cp([r]):r},l_=ou,ls=Mp,u_=ea,c_=cn,Hc=l_("%Map%",!0),d_=ls("Map.prototype.get",!0),f_=ls("Map.prototype.set",!0),p_=ls("Map.prototype.has",!0),g_=ls("Map.prototype.delete",!0),m_=ls("Map.prototype.size",!0),Rp=!!Hc&&function(){var t,e={assert:function(r){if(!e.has(r))throw new c_("Side channel does not contain "+u_(r))},delete:function(r){if(t){var n=g_(t,r);return m_(t)===0&&(t=void 0),n}return!1},get:function(r){if(t)return d_(t,r)},has:function(r){return t?p_(t,r):!1},set:function(r,n){t||(t=new Hc),f_(t,r,n)}};return e},y_=ou,na=Mp,v_=ea,Ss=Rp,__=cn,Cr=y_("%WeakMap%",!0),x_=na("WeakMap.prototype.get",!0),w_=na("WeakMap.prototype.set",!0),b_=na("WeakMap.prototype.has",!0),E_=na("WeakMap.prototype.delete",!0),A_=Cr?function(){var t,e,r={assert:function(n){if(!r.has(n))throw new __("Side channel does not contain "+v_(n))},delete:function(n){if(Cr&&n&&(typeof n=="object"||typeof n=="function")){if(t)return E_(t,n)}else if(Ss&&e)return e.delete(n);return!1},get:function(n){return Cr&&n&&(typeof n=="object"||typeof n=="function")&&t?x_(t,n):e&&e.get(n)},has:function(n){return Cr&&n&&(typeof n=="object"||typeof n=="function")&&t?b_(t,n):!!e&&e.has(n)},set:function(n,s){Cr&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new Cr),w_(t,n,s)):Ss&&(e||(e=Ss()),e.set(n,s))}};return r}:Ss,T_=cn,S_=ea,I_=Y0,C_=Rp,M_=A_,R_=M_||C_||I_,P_=function(){var t,e={assert:function(r){if(!e.has(r))throw new T_("Side channel does not contain "+S_(r))},delete:function(r){return!!t&&t.delete(r)},get:function(r){return t&&t.get(r)},has:function(r){return!!t&&t.has(r)},set:function(r,n){t||(t=R_()),t.set(r,n)}};return e},N_=String.prototype.replace,D_=/%20/g,za={RFC1738:"RFC1738",RFC3986:"RFC3986"},au={default:za.RFC3986,formatters:{RFC1738:function(i){return N_.call(i,D_,"+")},RFC3986:function(i){return String(i)}},RFC1738:za.RFC1738,RFC3986:za.RFC3986},L_=au,Xa=Object.prototype.hasOwnProperty,sr=Array.isArray,He=function(){for(var i=[],t=0;t<256;++t)i.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return i}(),B_=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(sr(r)){for(var n=[],s=0;s<r.length;++s)typeof r[s]<"u"&&n.push(r[s]);e.obj[e.prop]=n}}},Pp=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(r[n]=t[n]);return r},O_=function i(t,e,r){if(!e)return t;if(typeof e!="object"){if(sr(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Xa.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return sr(t)&&!sr(e)&&(n=Pp(t,r)),sr(t)&&sr(e)?(e.forEach(function(s,o){if(Xa.call(t,o)){var a=t[o];a&&typeof a=="object"&&s&&typeof s=="object"?t[o]=i(a,s,r):t.push(s)}else t[o]=s}),t):Object.keys(e).reduce(function(s,o){var a=e[o];return Xa.call(s,o)?s[o]=i(s[o],a,r):s[o]=a,s},n)},k_=function(t,e){return Object.keys(e).reduce(function(r,n){return r[n]=e[n],r},t)},F_=function(i,t,e){var r=i.replace(/\+/g," ");if(e==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Va=1024,U_=function(t,e,r,n,s){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;h+=Va){for(var l=o.length>=Va?o.slice(h,h+Va):o,u=[],c=0;c<l.length;++c){var d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===L_.RFC1738&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=He[d];continue}if(d<2048){u[u.length]=He[192|d>>6]+He[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=He[224|d>>12]+He[128|d>>6&63]+He[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=He[240|d>>18]+He[128|d>>12&63]+He[128|d>>6&63]+He[128|d&63]}a+=u.join("")}return a},G_=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],u=o[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(e.push({obj:o,prop:l}),r.push(u))}return B_(e),t},$_=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},H_=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},W_=function(t,e){return[].concat(t,e)},z_=function(t,e){if(sr(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},Np={arrayToObject:Pp,assign:k_,combine:W_,compact:G_,decode:F_,encode:U_,isBuffer:H_,isRegExp:$_,maybeMap:z_,merge:O_},Dp=P_,no=Np,Xn=au,X_=Object.prototype.hasOwnProperty,Lp={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},qe=Array.isArray,V_=Array.prototype.push,Bp=function(i,t){V_.apply(i,qe(t)?t:[t])},j_=Date.prototype.toISOString,Wc=Xn.default,jt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:no.encode,encodeValuesOnly:!1,format:Wc,formatter:Xn.formatters[Wc],indices:!1,serializeDate:function(t){return j_.call(t)},skipNulls:!1,strictNullHandling:!1},Y_=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},ja={},q_=function i(t,e,r,n,s,o,a,h,l,u,c,d,f,p,g,m,y,_){for(var v=t,x=_,A=0,N=!1;(x=x.get(ja))!==void 0&&!N;){var S=x.get(t);if(A+=1,typeof S<"u"){if(S===A)throw new RangeError("Cyclic object value");N=!0}typeof x.get(ja)>"u"&&(A=0)}if(typeof u=="function"?v=u(e,v):v instanceof Date?v=f(v):r==="comma"&&qe(v)&&(v=no.maybeMap(v,function(F){return F instanceof Date?f(F):F})),v===null){if(o)return l&&!m?l(e,jt.encoder,y,"key",p):e;v=""}if(Y_(v)||no.isBuffer(v)){if(l){var T=m?e:l(e,jt.encoder,y,"key",p);return[g(T)+"="+g(l(v,jt.encoder,y,"value",p))]}return[g(e)+"="+g(String(v))]}var C=[];if(typeof v>"u")return C;var k;if(r==="comma"&&qe(v))m&&l&&(v=no.maybeMap(v,l)),k=[{value:v.length>0?v.join(",")||null:void 0}];else if(qe(u))k=u;else{var O=Object.keys(v);k=c?O.sort(c):O}var M=h?e.replace(/\./g,"%2E"):e,E=n&&qe(v)&&v.length===1?M+"[]":M;if(s&&qe(v)&&v.length===0)return E+"[]";for(var I=0;I<k.length;++I){var Q=k[I],et=typeof Q=="object"&&typeof Q.value<"u"?Q.value:v[Q];if(!(a&&et===null)){var Y=d&&h?Q.replace(/\./g,"%2E"):Q,rt=qe(v)?typeof r=="function"?r(E,Y):E:E+(d?"."+Y:"["+Y+"]");_.set(t,A);var gt=Dp();gt.set(ja,_),Bp(C,i(et,rt,r,n,s,o,a,h,r==="comma"&&m&&qe(v)?null:l,u,c,d,f,p,g,m,y,gt))}}return C},K_=function(t){if(!t)return jt;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||jt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Xn.default;if(typeof t.format<"u"){if(!X_.call(Xn.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=Xn.formatters[r],s=jt.filter;(typeof t.filter=="function"||qe(t.filter))&&(s=t.filter);var o;if(t.arrayFormat in Lp?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=jt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:jt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:jt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:jt.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:jt.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?jt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:jt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:jt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:jt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:jt.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:jt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:jt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:jt.strictNullHandling}},Z_=function(i,t){var e=i,r=K_(t),n,s;typeof r.filter=="function"?(s=r.filter,e=s("",e)):qe(r.filter)&&(s=r.filter,n=s);var o=[];if(typeof e!="object"||e===null)return"";var a=Lp[r.arrayFormat],h=a==="comma"&&r.commaRoundTrip;n||(n=Object.keys(e)),r.sort&&n.sort(r.sort);for(var l=Dp(),u=0;u<n.length;++u){var c=n[u];r.skipNulls&&e[c]===null||Bp(o,q_(e[c],c,a,h,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}var d=o.join(r.delimiter),f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),d.length>0?f+d:""},sn=Np,Hh=Object.prototype.hasOwnProperty,Q_=Array.isArray,Gt={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:sn.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},J_=function(i){return i.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Op=function(i,t){return i&&typeof i=="string"&&t.comma&&i.indexOf(",")>-1?i.split(","):i},tx="utf8=%26%2310003%3B",ex="utf8=%E2%9C%93",ix=function(t,e){var r={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=n.split(e.delimiter,s),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===ex?l="utf-8":o[h]===tx&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var u=o[h],c=u.indexOf("]="),d=c===-1?u.indexOf("="):c+1,f,p;d===-1?(f=e.decoder(u,Gt.decoder,l,"key"),p=e.strictNullHandling?null:""):(f=e.decoder(u.slice(0,d),Gt.decoder,l,"key"),p=sn.maybeMap(Op(u.slice(d+1),e),function(m){return e.decoder(m,Gt.decoder,l,"value")})),p&&e.interpretNumericEntities&&l==="iso-8859-1"&&(p=J_(p)),u.indexOf("[]=")>-1&&(p=Q_(p)?[p]:p);var g=Hh.call(r,f);g&&e.duplicates==="combine"?r[f]=sn.combine(r[f],p):(!g||e.duplicates==="last")&&(r[f]=p)}return r},rx=function(i,t,e,r){for(var n=r?t:Op(t,e),s=i.length-1;s>=0;--s){var o,a=i[s];if(a==="[]"&&e.parseArrays)o=e.allowEmptyArrays&&(n===""||e.strictNullHandling&&n===null)?[]:[].concat(n);else{o=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=e.decodeDotInKeys?h.replace(/%2E/g,"."):h,u=parseInt(l,10);!e.parseArrays&&l===""?o={0:n}:!isNaN(u)&&a!==l&&String(u)===l&&u>=0&&e.parseArrays&&u<=e.arrayLimit?(o=[],o[u]=n):l!=="__proto__"&&(o[l]=n)}n=o}return n},nx=function(t,e,r,n){if(t){var s=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=r.depth>0&&o.exec(s),l=h?s.slice(0,h.index):s,u=[];if(l){if(!r.plainObjects&&Hh.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var c=0;r.depth>0&&(h=a.exec(s))!==null&&c<r.depth;){if(c+=1,!r.plainObjects&&Hh.call(Object.prototype,h[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(h[1])}if(h){if(r.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");u.push("["+s.slice(h.index)+"]")}return rx(u,e,r,n)}},sx=function(t){if(!t)return Gt;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Gt.charset:t.charset,r=typeof t.duplicates>"u"?Gt.duplicates:t.duplicates;if(r!=="combine"&&r!=="first"&&r!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:Gt.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Gt.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Gt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Gt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Gt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Gt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Gt.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:Gt.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:Gt.decoder,delimiter:typeof t.delimiter=="string"||sn.isRegExp(t.delimiter)?t.delimiter:Gt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Gt.depth,duplicates:r,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Gt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Gt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Gt.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:Gt.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Gt.strictNullHandling}},ox=function(i,t){var e=sx(t);if(i===""||i===null||typeof i>"u")return e.plainObjects?Object.create(null):{};for(var r=typeof i=="string"?ix(i,e):i,n=e.plainObjects?Object.create(null):{},s=Object.keys(r),o=0;o<s.length;++o){var a=s[o],h=nx(a,r[a],e,typeof i=="string");n=sn.merge(n,h,e)}return e.allowSparse===!0?n:sn.compact(n)},ax=Z_,hx=ox,lx=au,ux={formats:lx,parse:hx,stringify:ax},cx=u0;function Ei(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var dx=/^([a-z0-9.+-]+:)/i,fx=/:[0-9]*$/,px=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,gx=["<",">",'"',"`"," ","\r",`
`,"	"],mx=["{","}","|","\\","^","`"].concat(gx),Wh=["'"].concat(mx),zc=["%","/","?",";","#"].concat(Wh),Xc=["/","?","#"],yx=255,Vc=/^[+a-z0-9A-Z_-]{0,63}$/,vx=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_x={javascript:!0,"javascript:":!0},zh={javascript:!0,"javascript:":!0},jr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Xh=ux;function xx(i,t,e){if(i&&typeof i=="object"&&i instanceof Ei)return i;var r=new Ei;return r.parse(i,t,e),r}Ei.prototype.parse=function(i,t,e){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),n=r!==-1&&r<i.indexOf("#")?"?":"#",s=i.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),i=s.join(n);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var h=px.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Xh.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=dx.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&zh[l])&&(a=a.substr(2),this.slashes=!0)}if(!zh[l]&&(c||l&&!jr[l])){for(var d=-1,f=0;f<Xc.length;f++){var p=a.indexOf(Xc[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var g,m;d===-1?m=a.lastIndexOf("@"):m=a.lastIndexOf("@",d),m!==-1&&(g=a.slice(0,m),a=a.slice(m+1),this.auth=decodeURIComponent(g)),d=-1;for(var f=0;f<zc.length;f++){var p=a.indexOf(zc[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),f=0,v=_.length;f<v;f++){var x=_[f];if(x&&!x.match(Vc)){for(var A="",N=0,S=x.length;N<S;N++)x.charCodeAt(N)>127?A+="x":A+=x[N];if(!A.match(Vc)){var T=_.slice(0,f),C=_.slice(f+1),k=x.match(vx);k&&(T.push(k[1]),C.unshift(k[2])),C.length&&(a="/"+C.join(".")+a),this.hostname=T.join(".");break}}}this.hostname.length>yx?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=cx.toASCII(this.hostname));var O=this.port?":"+this.port:"",M=this.hostname||"";this.host=M+O,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!_x[u])for(var f=0,v=Wh.length;f<v;f++){var E=Wh[f];if(a.indexOf(E)!==-1){var I=encodeURIComponent(E);I===E&&(I=escape(E)),a=a.split(E).join(I)}}var Q=a.indexOf("#");Q!==-1&&(this.hash=a.substr(Q),a=a.slice(0,Q));var et=a.indexOf("?");if(et!==-1?(this.search=a.substr(et),this.query=a.substr(et+1),t&&(this.query=Xh.parse(this.query)),a=a.slice(0,et)):t&&(this.search="",this.query={}),a&&(this.pathname=a),jr[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var O=this.pathname||"",Y=this.search||"";this.path=O+Y}return this.href=this.format(),this};Ei.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",n=!1,s="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Xh.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||jr[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+r};Ei.prototype.resolve=function(i){return this.resolveObject(xx(i,!1,!0)).format()};Ei.prototype.resolveObject=function(i){if(typeof i=="string"){var t=new Ei;t.parse(i,!1,!0),i=t}for(var e=new Ei,r=Object.keys(this),n=0;n<r.length;n++){var s=r[n];e[s]=this[s]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=i[h])}return jr[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!jr[i.protocol]){for(var l=Object.keys(i),u=0;u<l.length;u++){var c=l[u];e[c]=i[c]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!zh[i.protocol]){for(var v=(i.pathname||"").split("/");v.length&&!(i.host=v.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),v[0]!==""&&v.unshift(""),v.length<2&&v.unshift(""),e.pathname=v.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",g=i.host||i.pathname&&i.pathname.charAt(0)==="/",m=g||p||e.host&&i.pathname,y=m,_=e.pathname&&e.pathname.split("/")||[],v=i.pathname&&i.pathname.split("/")||[],x=e.protocol&&!jr[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(_[0]===""?_[0]=e.host:_.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(v[0]===""?v[0]=i.host:v.unshift(i.host)),i.host=null),m=m&&(v[0]===""||_[0]==="")),g)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,_=v;else if(v.length)_||(_=[]),_.pop(),_=_.concat(v),e.search=i.search,e.query=i.query;else if(i.search!=null){if(x){e.host=_.shift(),e.hostname=e.host;var A=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;A&&(e.auth=A.shift(),e.hostname=A.shift(),e.host=e.hostname)}return e.search=i.search,e.query=i.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!_.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var N=_.slice(-1)[0],S=(e.host||i.host||_.length>1)&&(N==="."||N==="..")||N==="",T=0,C=_.length;C>=0;C--)N=_[C],N==="."?_.splice(C,1):N===".."?(_.splice(C,1),T++):T&&(_.splice(C,1),T--);if(!m&&!y)for(;T--;T)_.unshift("..");m&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),S&&_.join("/").substr(-1)!=="/"&&_.push("");var k=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(x){e.hostname=k?"":_.length?_.shift():"",e.host=e.hostname;var A=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;A&&(e.auth=A.shift(),e.hostname=A.shift(),e.host=e.hostname)}return m=m||e.host&&_.length,m&&!k&&_.unshift(""),_.length>0?e.pathname=_.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};Ei.prototype.parseHost=function(){var i=this.host,t=fx.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const jc={};function bt(i,t,e=3){if(jc[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),jc[t]=!0}function Ce(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function wn(i){return i.split("?")[0].split("#")[0]}function wx(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function bx(i,t,e){return i.replace(new RegExp(wx(t),"g"),e)}function Ex(i,t){let e="",r=0,n=-1,s=0,o=-1;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",r=0):(e=e.slice(0,h),r=e.length-1-e.lastIndexOf("/")),n=a,s=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=a,s=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(n+1,a)}`:e=i.slice(n+1,a),r=a-n-1;n=a,s=0}else o===46&&s!==-1?++s:s=-1}return e}const te={toPosix(i){return bx(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){Ce(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(Ce(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=wn(this.toPosix(t??Z.ADAPTER.getBaseUrl())),n=wn(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?te.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(Ce(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=Ex(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return Ce(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(Ce(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(Ce(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const s=this.getProtocol(i),o=i;i=i.slice(s.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!n){r=a;break}}else n=!1;return r===-1?e?"/":this.isUrl(o)?s+i:s:e&&r===1?"//":s+i.slice(0,r)},rootname(i){Ce(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){Ce(i),t&&Ce(t),i=wn(this.toPosix(i));let e=0,r=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(s=i.length-1;s>=0;--s){const h=i.charCodeAt(s);if(h===47){if(!n){e=s+1;break}}else a===-1&&(n=!1,a=s+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(r=s):(o=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(s=i.length-1;s>=0;--s)if(i.charCodeAt(s)===47){if(!n){e=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":i.slice(e,r)},extname(i){Ce(i),i=wn(this.toPosix(i));let t=-1,e=0,r=-1,n=!0,s=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}r===-1&&(n=!1,r=o+1),a===46?t===-1?t=o:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){Ce(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=wn(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let s=-1,o=0,a=-1,h=!0,l=i.length-1,u=0;for(;l>=n;--l){if(e=i.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?s===-1?s=l:u!==1&&(u=1):s!==-1&&(u=-1)}return s===-1||a===-1||u===0||u===1&&s===a-1&&s===o+1?a!==-1&&(o===0&&r?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(o,a)):(o===0&&r?(t.name=i.slice(1,s),t.base=i.slice(1,a)):(t.name=i.slice(o,s),t.base=i.slice(o,a)),t.ext=i.slice(s,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let Ya;async function Ax(){return Ya??(Ya=(async()=>{var s;const i=document.createElement("canvas").getContext("webgl");if(!i)return ge.UNPACK;const t=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return ge.UNPACK;const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);const r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,n),i.deleteFramebuffer(r),i.deleteTexture(e),(s=i.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?ge.PMA:ge.UNPACK})()),Ya}let qa;function Tx(){return typeof qa>"u"&&(qa=function(){var t;const i={stencil:!0,failIfMajorPerformanceCaveat:Z.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Z.ADAPTER.getWebGLRenderingContext())return!1;const e=Z.ADAPTER.createCanvas();let r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);const n=!!((t=r==null?void 0:r.getContextAttributes())!=null&&t.stencil);if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}}()),qa}var Sx={grad:.9,turn:360,rad:360/(2*Math.PI)},fi=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Qt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Ae=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},kp=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Yc=function(i){return{r:Ae(i.r,0,255),g:Ae(i.g,0,255),b:Ae(i.b,0,255),a:Ae(i.a)}},Ka=function(i){return{r:Qt(i.r),g:Qt(i.g),b:Qt(i.b),a:Qt(i.a,3)}},Ix=/^#([0-9a-f]{3,8})$/i,Is=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},Fp=function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=Math.max(t,e,r),o=s-Math.min(t,e,r),a=o?s===t?(e-r)/o:s===e?2+(r-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},Up=function(i){var t=i.h,e=i.s,r=i.v,n=i.a;t=t/360*6,e/=100,r/=100;var s=Math.floor(t),o=r*(1-e),a=r*(1-(t-s)*e),h=r*(1-(1-t+s)*e),l=s%6;return{r:255*[r,a,o,o,h,r][l],g:255*[h,r,r,a,o,o][l],b:255*[o,o,h,r,r,a][l],a:n}},qc=function(i){return{h:kp(i.h),s:Ae(i.s,0,100),l:Ae(i.l,0,100),a:Ae(i.a)}},Kc=function(i){return{h:Qt(i.h),s:Qt(i.s),l:Qt(i.l),a:Qt(i.a,3)}},Zc=function(i){return Up((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},Vn=function(i){return{h:(t=Fp(i)).h,s:(n=(200-(e=t.s))*(r=t.v)/100)>0&&n<200?e*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,r,n},Cx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Mx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Rx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Px=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Vh={string:[[function(i){var t=Ix.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Qt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Qt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Rx.exec(i)||Px.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Yc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=Cx.exec(i)||Mx.exec(i);if(!t)return null;var e,r,n=qc({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(Sx[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Zc(n)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=n===void 0?1:n;return fi(t)&&fi(e)&&fi(r)?Yc({r:Number(t),g:Number(e),b:Number(r),a:Number(s)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,n=i.a,s=n===void 0?1:n;if(!fi(t)||!fi(e)||!fi(r))return null;var o=qc({h:Number(t),s:Number(e),l:Number(r),a:Number(s)});return Zc(o)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,n=i.a,s=n===void 0?1:n;if(!fi(t)||!fi(e)||!fi(r))return null;var o=function(a){return{h:kp(a.h),s:Ae(a.s,0,100),v:Ae(a.v,0,100),a:Ae(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(s)});return Up(o)},"hsv"]]},Qc=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},Nx=function(i){return typeof i=="string"?Qc(i.trim(),Vh.string):typeof i=="object"&&i!==null?Qc(i,Vh.object):[null,void 0]},Za=function(i,t){var e=Vn(i);return{h:e.h,s:Ae(e.s+100*t,0,100),l:e.l,a:e.a}},Qa=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Jc=function(i,t){var e=Vn(i);return{h:e.h,s:e.s,l:Ae(e.l+100*t,0,100),a:e.a}},jh=function(){function i(t){this.parsed=Nx(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Qt(Qa(this.rgba),2)},i.prototype.isDark=function(){return Qa(this.rgba)<.5},i.prototype.isLight=function(){return Qa(this.rgba)>=.5},i.prototype.toHex=function(){return t=Ka(this.rgba),e=t.r,r=t.g,n=t.b,o=(s=t.a)<1?Is(Qt(255*s)):"","#"+Is(e)+Is(r)+Is(n)+o;var t,e,r,n,s,o},i.prototype.toRgb=function(){return Ka(this.rgba)},i.prototype.toRgbString=function(){return t=Ka(this.rgba),e=t.r,r=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+n+", "+s+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,s},i.prototype.toHsl=function(){return Kc(Vn(this.rgba))},i.prototype.toHslString=function(){return t=Kc(Vn(this.rgba)),e=t.h,r=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+s+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,s},i.prototype.toHsv=function(){return t=Fp(this.rgba),{h:Qt(t.h),s:Qt(t.s),v:Qt(t.v),a:Qt(t.a,3)};var t},i.prototype.invert=function(){return ze({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),ze(Za(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),ze(Za(this.rgba,-t))},i.prototype.grayscale=function(){return ze(Za(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),ze(Jc(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),ze(Jc(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?ze({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Qt(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Vn(this.rgba);return typeof t=="number"?ze({h:t,s:e.s,l:e.l,a:e.a}):Qt(e.h)},i.prototype.isEqual=function(t){return this.toHex()===ze(t).toHex()},i}(),ze=function(i){return i instanceof jh?i:new jh(i)},td=[],Dx=function(i){i.forEach(function(t){td.indexOf(t)<0&&(t(jh,Vh),td.push(t))})};function Lx(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in e)r[e[n]]=n;var s={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=r[this.toHex()];if(l)return l;if(o!=null&&o.closest){var u=this.toRgb(),c=1/0,d="black";if(!s.length)for(var f in e)s[f]=new i(e[f]).toRgb();for(var p in e){var g=(a=u,h=s[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));g<c&&(c=g,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new i(h).toRgb():null},"name"])}Dx([Lx]);const Or=class so{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof so)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,s)=>n===e[s]);if(t!==null&&e!==null){const n=Object.keys(t),s=Object.keys(e);return n.length!==s.length?!1:n.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(n*255),t}toRgbArray(t){t=t??[];const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,n,s]=so.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(r=r*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(r<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,n,s]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}normalize(t){let e,r,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,r=(o>>8&255)/255,n=(o&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,n,s=255]=t,e/=255,r/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=so.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=ze(t);o.isValid()&&({r:e,g:r,b:n,a:s}=o.rgba,e/=255,r/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),r)}),t)}};Or.shared=new Or,Or.temp=new Or,Or.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Nt=Or;function Bx(i){return bt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Nt.shared.setValue(i).toHex()}function Ox(i){return bt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Nt.shared.setValue(i).toNumber()}function kx(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[lt.NORMAL_NPM]=lt.NORMAL,i[lt.ADD_NPM]=lt.ADD,i[lt.SCREEN_NPM]=lt.SCREEN,t[lt.NORMAL]=lt.NORMAL_NPM,t[lt.ADD]=lt.ADD_NPM,t[lt.SCREEN]=lt.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const Gp=kx();function $p(i,t){return Gp[t?1:0][i]}function Fx(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function Hp(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function Eo(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function ed(i){return!(i&i-1)&&!!i}function id(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Yr(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}function Fi(i){return i===0?0:i<0?-1:1}let Ux=0;function pr(){return++Ux}const Yh=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Yh.EMPTY=new Yh(0,0,0,0);let rd=Yh;const nd={},Xe=Object.create(null),Ni=Object.create(null);class Gx{constructor(t,e,r){this._canvas=Z.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||Z.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function sd(i,t,e){for(let r=0,n=4*e*t;r<t;++r,n+=4)if(i[n+3]!==0)return!1;return!0}function od(i,t,e,r,n){const s=4*t;for(let o=r,a=r*s+4*e;o<=n;++o,a+=s)if(i[a+3]!==0)return!1;return!0}function $x(i){const{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const n=r.getImageData(0,0,t,e).data;let s=0,o=0,a=t-1,h=e-1;for(;o<e&&sd(n,t,o);)++o;if(o===e)return rd.EMPTY;for(;sd(n,t,h);)--h;for(;od(n,t,s,o,h);)++s;for(;od(n,t,a,o,h);)--a;return++a,++h,new rd(s,o,a,h)}function Hx(i){const t=$x(i),{width:e,height:r}=t;let n=null;if(!t.isEmpty()){const s=i.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:n}}function Wx(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Si(i,t=1){var r;const e=(r=Z.RETINA_PREFIX)==null?void 0:r.exec(i);return e?parseFloat(e[1]):t}var V=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(V||{});const qh=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},ad=(i,t)=>qh(i).priority??t,nt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(qh).forEach(t=>{t.type.forEach(e=>{var r,n;return(n=(r=this._removeHandlers)[e])==null?void 0:n.call(r,t)})}),this},add(...i){return i.map(qh).forEach(t=>{t.type.forEach(e=>{var s,o;const r=this._addHandlers,n=this._queue;r[e]?(s=r[e])==null||s.call(r,t):(n[e]=n[e]||[],(o=n[e])==null||o.push(t))})}),this},handle(i,t,e){var o;const r=this._addHandlers,n=this._removeHandlers;if(r[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,n[i]=e;const s=this._queue;return s[i]&&((o=s[i])==null||o.forEach(a=>t(a)),delete s[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((n,s)=>ad(s,e)-ad(n,e)))},r=>{const n=t.indexOf(r.ref);n!==-1&&t.splice(n,1)})}};class Kh{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const zx=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Xx(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function Vx(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=zx.replace(/%forloop%/gi,Xx(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Ja=0,th=1,eh=2,ih=3,rh=4,nh=5;class oi{constructor(){this.data=0,this.blendMode=lt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Ja)}set blend(t){!!(this.data&1<<Ja)!==t&&(this.data^=1<<Ja)}get offsets(){return!!(this.data&1<<th)}set offsets(t){!!(this.data&1<<th)!==t&&(this.data^=1<<th)}get culling(){return!!(this.data&1<<eh)}set culling(t){!!(this.data&1<<eh)!==t&&(this.data^=1<<eh)}get depthTest(){return!!(this.data&1<<ih)}set depthTest(t){!!(this.data&1<<ih)!==t&&(this.data^=1<<ih)}get depthMask(){return!!(this.data&1<<nh)}set depthMask(t){!!(this.data&1<<nh)!==t&&(this.data^=1<<nh)}get clockwiseFrontFace(){return!!(this.data&1<<rh)}set clockwiseFrontFace(t){!!(this.data&1<<rh)!==t&&(this.data^=1<<rh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==lt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new oi;return t.depthTest=!1,t.blend=!0,t}}oi.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Zh=[];function Wp(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=Zh.length-1;r>=0;--r){const n=Zh[r];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Oe{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,s,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,r,n,s,o,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Oe.prototype,{dispatch:{value:Oe.prototype.emit},run:{value:Oe.prototype.emit}});class Jn{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Oe("setRealSize"),this.onUpdate=new Oe("update"),this.onError=new Oe("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class sa extends Jn{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ge.UNPACK);const s=e.realWidth,o=e.realHeight;return r.width===s&&r.height===o?n.texSubImage2D(e.target,0,0,0,s,o,e.format,r.type,this.data):(r.width=s,r.height=o,n.texImage2D(e.target,0,r.internalFormat,s,o,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const jx={scaleMode:_i.NEAREST,alphaMode:ge.NPM},Qh=class kr extends os{constructor(t=null,e=null){super(),e=Object.assign({},kr.defaultOptions,e);const{alphaMode:r,mipmap:n,anisotropicLevel:s,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Jn)&&(t=Wp(t,p),t.internal=!0),this.resolution=f||Z.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=r,this.uid=pr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ed(this.realWidth)&&ed(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ni[this.cacheId],delete Xe[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),kr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=Z.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${pr()}`}s=t._pixiId}let o=Ni[s];if(n&&r&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new kr(t,e),o.cacheId=s,kr.addToCache(o,s)),o}static fromBuffer(t,e,r,n){t=t||new Float32Array(e*r*4);const s=new sa(t,{width:e,height:r,...n==null?void 0:n.resourceOptions});let o,a;return t instanceof Float32Array?(o=G.RGBA,a=ot.FLOAT):t instanceof Int32Array?(o=G.RGBA_INTEGER,a=ot.INT):t instanceof Uint32Array?(o=G.RGBA_INTEGER,a=ot.UNSIGNED_INT):t instanceof Int16Array?(o=G.RGBA_INTEGER,a=ot.SHORT):t instanceof Uint16Array?(o=G.RGBA_INTEGER,a=ot.UNSIGNED_SHORT):t instanceof Int8Array?(o=G.RGBA,a=ot.BYTE):(o=G.RGBA,a=ot.UNSIGNED_BYTE),s.internal=!0,new kr(s,Object.assign({},jx,{type:a,format:o},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ni[e]&&Ni[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Ni[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Ni[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ni[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Ni[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Qh.defaultOptions={mipmap:ni.POW2,anisotropicLevel:0,scaleMode:_i.LINEAR,wrapMode:Hi.CLAMP,alphaMode:ge.UNPACK,target:Xr.TEXTURE_2D,format:G.RGBA,type:ot.UNSIGNED_BYTE},Qh._globalBatch=0;let pt=Qh;class Jh{constructor(){this.texArray=null,this.blend=0,this.type=Qe.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Yx=0;class Ht{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Yx++,this.disposeRunner=new Oe("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ti.ELEMENT_ARRAY_BUFFER:ti.ARRAY_BUFFER}get index(){return this.type===ti.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ht(t)}}class Ao{constructor(t,e=0,r=!1,n=ot.FLOAT,s,o,a,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,n,s){return new Ao(t,e,r,n,s)}}const qx={Float32Array,Uint32Array,Int32Array,Uint8Array};function Kx(i,t){let e=0,r=0;const n={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;const s=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<i.length;h++){const l=t[h],u=i[h],c=Hp(u);n[c]||(n[c]=new qx[c](s)),o=n[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*r+a,p=d%l;o[f+p]=u[d]}a+=l}return new Float32Array(s)}const hd={5126:4,5123:2,5121:1};let Zx=0;const Qx={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Wi{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Zx++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Oe("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,s,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ht||(e instanceof Array&&(e=new Float32Array(e)),e=new Ht(e));const l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,r,n,s);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Ao(u,r,n,s,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ht||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ht(t)),t.type=ti.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Ht;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*hd[s.type]/4),s.buffer=0}for(r.data=Kx(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Wi;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ht(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Ao(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ti.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Wi,r=[],n=[],s=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)n[h]=n[h]||0,n[h]+=o.buffers[h].data.length,s[h]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new Qx[Hp(o.buffers[a].data)](n[a]),e.buffers[a]=new Ht(r[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)r[h].set(o.buffers[h].data,s[h]),s[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=ti.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<o.buffers.length;c++)if(o.buffers[c]!==o.indexBuffer){u=c;break}for(const c in o.attributes){const d=o.attributes[c];(d.buffer|0)===u&&(h+=d.size*hd[d.type]/4)}for(let c=0;c<t.length;c++){const d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}}class zp extends Wi{constructor(t=!1){super(),this._buffer=new Ht(null,t,!1),this._indexBuffer=new Ht(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ot.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ot.FLOAT).addAttribute("aColor",this._buffer,4,!0,ot.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ot.FLOAT).addIndex(this._indexBuffer)}}const To=Math.PI*2,Jx=180/Math.PI,tw=Math.PI/180;var re=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(re||{});class at{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new at(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}at.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Cs=[new at,new at,new at,new at];class dt{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=re.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new dt(0,0,0,0)}clone(){return new dt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const T=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=T)return!1;const C=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>C}const r=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=r||o<=s)return!1;const a=Cs[0].set(t.left,t.top),h=Cs[1].set(t.left,t.bottom),l=Cs[2].set(t.right,t.top),u=Cs[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=r||Math.min(a.x,h.x,l.x,u.x)>=n||Math.max(a.y,h.y,l.y,u.y)<=s||Math.min(a.y,h.y,l.y,u.y)>=o))return!1;const d=c*(h.y-a.y),f=c*(a.x-h.x),p=d*r+f*s,g=d*n+f*s,m=d*r+f*o,y=d*n+f*o;if(Math.max(p,g,m,y)<=d*a.x+f*a.y||Math.min(p,g,m,y)>=d*u.x+f*u.y)return!1;const _=c*(a.y-l.y),v=c*(l.x-a.x),x=_*r+v*s,A=_*n+v*s,N=_*r+v*o,S=_*n+v*o;return!(Math.max(x,A,N,S)<=_*a.x+v*a.y||Math.min(x,A,N,S)>=_*u.x+v*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}}dt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class us{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=re.CIRC}clone(){return new us(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}getBounds(){return new dt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}us.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class oa{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=re.ELIP}clone(){return new oa(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new dt(this.x-this.width,this.y-this.height,this.width,this.height)}}oa.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ur{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,s=e.length;n<s;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.type=re.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new ur(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const a=this.points[s*2],h=this.points[s*2+1],l=this.points[o*2],u=this.points[o*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(r=!r)}return r}}ur.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,t)=>`${i}, ${t}`,"")}]`};class aa{constructor(t=0,e=0,r=0,n=0,s=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=re.RREC}clone(){return new aa(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const o=r*r;if(n*n+s*s<=o||(n=t-(this.x+this.width-r),n*n+s*s<=o)||(s=e-(this.y+this.height-r),n*n+s*s<=o)||(n=t-(this.x+r),n*n+s*s<=o))return!0}return!1}}aa.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Dt{constructor(t=1,e=0,r=0,n=1,s=0,o=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,o){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new at;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new at;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,n,s,o,a,h,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),h=Math.atan2(r,e),l=Math.abs(a+h);return l<1e-5||Math.abs(To-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*r+o.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Dt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Dt}static get TEMP_MATRIX(){return new Dt}}Dt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Ji=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],tr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],er=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ir=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],tl=[],Xp=[],Ms=Math.sign;function ew(){for(let i=0;i<16;i++){const t=[];tl.push(t);for(let e=0;e<16;e++){const r=Ms(Ji[i]*Ji[e]+er[i]*tr[e]),n=Ms(tr[i]*Ji[e]+ir[i]*tr[e]),s=Ms(Ji[i]*er[e]+er[i]*ir[e]),o=Ms(tr[i]*er[e]+ir[i]*ir[e]);for(let a=0;a<16;a++)if(Ji[a]===r&&tr[a]===n&&er[a]===s&&ir[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new Dt;t.set(Ji[i],tr[i],er[i],ir[i],0,0),Xp.push(t)}}ew();const Ot={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Ji[i],uY:i=>tr[i],vX:i=>er[i],vY:i=>ir[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>tl[i][t],sub:(i,t)=>tl[i][Ot.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Ot.S:Ot.N:Math.abs(t)*2<=Math.abs(i)?i>0?Ot.E:Ot.W:t>0?i>0?Ot.SE:Ot.SW:i>0?Ot.NE:Ot.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=Xp[Ot.inv(t)];n.tx=e,n.ty=r,i.append(n)}};class wi{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new wi(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}wi.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const el=class{constructor(){this.worldTransform=new Dt,this.localTransform=new Dt,this.position=new wi(this.onChange,this,0,0),this.scale=new wi(this.onChange,this,1,1),this.pivot=new wi(this.onChange,this,0,0),this.skew=new wi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};el.IDENTITY=new el;let hu=el;hu.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var iw=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,rw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function ld(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function sh(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Vp(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return sh(2*t);case"bvec3":return sh(3*t);case"bvec4":return sh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const qr=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],nw={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},sw={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function ow(i,t){var r;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in i.uniforms){const s=t[n];if(!s){((r=i.uniforms[n])==null?void 0:r.group)===!0&&(i.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=i.uniforms[n];let a=!1;for(let h=0;h<qr.length;h++)if(qr[h].test(s,o)){e.push(qr[h].code(n,o)),a=!0;break}if(!a){const h=(s.size===1&&!s.isArray?nw:sw)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const jp={};let Mr=jp;function aw(){if(Mr===jp||Mr!=null&&Mr.isContextLost()){const i=Z.ADAPTER.createCanvas();let t;Z.PREFER_ENV>=_r.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Mr=t}return Mr}let Rs;function hw(){if(!Rs){Rs=Ee.MEDIUM;const i=aw();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(Rs=t.precision?Ee.HIGH:Ee.MEDIUM)}}return Rs}function ud(i,t){const e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),n=r.split(`
`),s={},o=n.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!s[l]?(s[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function lw(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||ud(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||ud(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const uw={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Yp(i){return uw[i]}let Ps=null;const cd={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function qp(i,t){if(!Ps){const e=Object.keys(cd);Ps={};for(let r=0;r<e.length;++r){const n=e[r];Ps[i[n]]=cd[n]}}return Ps[t]}function dd(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Ee.HIGH&&e!==Ee.HIGH&&(r=Ee.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Ee.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let bn;function cw(){if(typeof bn=="boolean")return bn;try{bn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{bn=!1}return bn}let dw=0;const Ns={},il=class Fr{constructor(t,e,r="pixi-shader",n={}){this.extra={},this.id=dw++,this.vertexSrc=t||Fr.defaultVertexSrc,this.fragmentSrc=e||Fr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Ns[r]?(Ns[r]++,r+=`-${Ns[r]}`):Ns[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=dd(this.vertexSrc,Fr.defaultVertexPrecision,Ee.HIGH),this.fragmentSrc=dd(this.fragmentSrc,Fr.defaultFragmentPrecision,hw())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return rw}static get defaultFragmentSrc(){return iw}static from(t,e,r){const n=t+e;let s=nd[n];return s||(nd[n]=s=new Fr(t,e,r)),s}};il.defaultVertexPrecision=Ee.HIGH,il.defaultFragmentPrecision=xi.apple.device?Ee.HIGH:Ee.MEDIUM;let bi=il,fw=0;class ke{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=fw++,this.static=!!e,this.ubo=!!r,t instanceof Ht?(this.buffer=t,this.buffer.type=ti.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ht(new Float32Array(1)),this.buffer.type=ti.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new ke(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new ke(t,e,r)}static uboFrom(t,e){return new ke(t,e??!0,!0)}}class ei{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof ke?this.uniformGroup=e:this.uniformGroup=new ke(e):this.uniformGroup=new ke({}),this.disposeRunner=new Oe("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group===!0&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=bi.from(t,e);return new ei(n,r)}}class pw{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;this.defaultGroupCache[t]=ke.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new bi(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Dt,default:this.defaultGroupCache[t]};return new ei(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class rl{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function gw(){return!xi.apple.device}function mw(i){let t=!0;const e=Z.ADAPTER.getNavigator();if(xi.tablet||xi.phone){if(xi.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(xi.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class ha{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var yw=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,vw=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Rn=class Pe extends ha{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=zp,this.vertexSize=6,this.state=oi.for2d(),this.size=Pe.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??mw(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??gw(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return bt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return vw}static get defaultFragmentTemplate(){return yw}setShaderGenerator({vertex:t=Pe.defaultVertexSrc,fragment:e=Pe.defaultFragmentTemplate}={}){this.shaderGenerator=new pw(t,e)}contextChange(){const t=this.renderer.gl;Z.PREFER_ENV===_r.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Pe.defaultMaxTextures),this.maxTextures=Vx(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Pe,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new Jh);for(;e.length<n;)e.push(new rl);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Pe._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++pt._globalBatch,h=0,l=r[0],u=0;n.copyBoundTextures(s,e);for(let c=0;c<this._bufferSize;++c){const d=t[c];t[c]=null,d._batchEnabled!==a&&(l.count>=e&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++a),d._batchEnabled=a,d.touched=o,l.elements[l.count++]=d)}l.count>0&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let c=0;c<s.length;c++)s[c]=null;pt._globalBatch=a}buildDrawCalls(t,e,r){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:o,vertexSize:a}=this,h=Pe._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<r;++f){const p=n[f],g=p._texture.baseTexture,m=Gp[g.alphaMode?1:0][p.blendMode];n[f]=null,e<f&&d.blend!==m&&(d.size=c-d.start,e=f,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(p,s,o,u,c),u+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=m}e<r&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Pe.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,n=Pe._drawCallPool;let s=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:u,blend:c}=n[o];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Pe.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Eo(Math.ceil(t/8)),r=id(e),n=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new Kh(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=Eo(Math.ceil(t/12)),r=id(e),n=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._iBuffers[r];return s||(this._iBuffers[r]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,r,n,s){const{uint32View:o,float32View:a}=e,h=n/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=Nt.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let g=0;g<c.length;g+=2)a[n++]=c[g],a[n++]=c[g+1],a[n++]=l[g],a[n++]=l[g+1],o[n++]=p,a[n++]=d;for(let g=0;g<u.length;g++)r[s++]=h+u[g]}};Rn.defaultBatchSize=4096,Rn.extension={name:"batch",type:V.RendererPlugin},Rn._drawCallPool=[],Rn._textureArrayPool=[];let rr=Rn;nt.add(rr);var _w=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,xw=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const nl=class Pn extends ei{constructor(t,e,r){const n=bi.from(t||Pn.defaultVertexSrc,e||Pn.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=Pn.defaultResolution,this.multisample=Pn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new oi}apply(t,e,r,n,s){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return xw}static get defaultFragmentSrc(){return _w}};nl.defaultResolution=1,nl.defaultMultisample=Vt.NONE;let ue=nl;class So{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Nt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,s=r??e;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}So.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},So.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"background"};nt.add(So);class Kp{constructor(t){this.renderer=t,this.emptyRenderer=new ha(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:s,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const u=s[l],c=u._batchLocation;if(c>=0&&c<n&&e[c]===u){o[l]=c;continue}for(;h<n;){const d=e[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}o[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}Kp.extension={type:V.RendererSystem,name:"batch"};nt.add(Kp);let fd=0;class Io{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=fd++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=fd++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(Z.PREFER_ENV>=_r.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Io.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Io.extension={type:V.RendererSystem,name:"context"};nt.add(Io);class sl{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Oe("disposeFramebuffer"),this.multisample=Vt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new pt(null,{scaleMode:_i.NEAREST,resolution:1,mipmap:ni.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new pt(null,{scaleMode:_i.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ni.OFF,format:G.DEPTH_COMPONENT,type:ot.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Zp extends pt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:r,scaleMode:n,resolution:s}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Vt.NONE),super(null,t),this.mipmap=ni.OFF,this.valid=!0,this._clear=new Nt([0,0,0,0]),this.framebuffer=new sl(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ii extends Jn{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,n=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(r,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=Wx(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,n){const s=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ge.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&r.width===o&&r.height===a?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,n):(r.width=o,r.height=a,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class Qp extends Ii{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Ii.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Z.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ge.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const o in s){const a=s[o];if(a!==r&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class lu{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,s=e.height;if(r){const o=t.width/2/n,a=t.height/2/s,h=t.x/n+o,l=t.y/s+a;r=Ot.add(r,Ot.NW),this.x0=h+o*Ot.uX(r),this.y0=l+a*Ot.uY(r),r=Ot.add(r,2),this.x1=h+o*Ot.uX(r),this.y1=l+a*Ot.uY(r),r=Ot.add(r,2),this.x2=h+o*Ot.uX(r),this.y2=l+a*Ot.uY(r),r=Ot.add(r,2),this.x3=h+o*Ot.uX(r),this.y3=l+a*Ot.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}lu.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const pd=new lu;function Ds(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class it extends os{constructor(t,e,r,n,s,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new dt(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=pd,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new at(o.x,o.y):new at(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&Xe[e.url]&&it.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new it(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===pd&&(this._uvs=new lu),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=Z.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof pt){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${pr()}`,pt.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${pr()}`}s=t._pixiId}let o=Xe[s];if(n&&r&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(t instanceof pt)?(e.resolution||(e.resolution=Si(t)),o=new it(new pt(t,e)),o.baseTexture.cacheId=s,pt.addToCache(o.baseTexture,s),it.addToCache(o,s)):!o&&t instanceof pt&&(o=new it(t),it.addToCache(o,s)),o}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=it.from(t,Object.assign({resourceOptions:r},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,r,n){return new it(pt.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const s=new pt(t,Object.assign({scaleMode:pt.defaultOptions.scaleMode,resolution:Si(e)},n)),{resource:o}=s;o instanceof Qp&&(o.url=e);const a=new it(s);return r||(r=e),pt.addToCache(a.baseTexture,r),it.addToCache(a,r),r!==e&&(pt.addToCache(a.baseTexture,e),it.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xe[e]&&Xe[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Xe[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Xe[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Xe[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Xe[t.textureCacheIds[e]]===t&&delete Xe[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:s}=t,o=e+n>this.baseTexture.width,a=r+s>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,u=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new pt),Ds(it._EMPTY),Ds(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){const t=Z.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),it._WHITE=new it(pt.from(t)),Ds(it._WHITE),Ds(it._WHITE.baseTexture)}return it._WHITE}}class wr extends it{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new wr(new Zp(t))}}class Jp{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Vt.NONE){const n=new Zp(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new wr(n)}getOptimalTexture(t,e,r=1,n=Vt.NONE){let s;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Eo(t),e=Eo(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(r),o}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Vt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Jp.SCREEN_KEY=-1;let ww=class extends Wi{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};class tg extends Wi{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ht(this.vertices),this.uvBuffer=new Ht(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class bw{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Vt.NONE,this.sourceFrame=new dt,this.destinationFrame=new dt,this.bindingSourceFrame=new dt,this.bindingDestinationFrame=new dt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ls=[new at,new at,new at,new at],oh=new Dt;class eg{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Jp,this.statePool=[],this.quad=new ww,this.quadUv=new tg,this.tempRect=new dt,this.activeState={},this.globalUniforms=new ke({outputFrame:new dt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new bw,o=r.renderTexture;let a,h;if(o.current){const m=o.current;a=m.resolution,h=m.multisample}else a=r.resolution,h=r.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let m=1;m<e.length;m++){const y=e[m];l=Math.min(l,y.resolution||a),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,d=d&&y.autoFit,f=f||(y.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=l,s.multisample=u,s.legacy=f,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(c);const p=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(oh.copyFrom(r.projection.transform).invert(),p),d?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,u),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=s.sourceFrame.width,g.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,g),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){const l=n.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,Ke.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,Ke.CLEAR,e);const d=l;l=u,u=d}r[c].apply(this,l,h.renderTexture,Ke.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Ke.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,r.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===Ke.CLEAR||e===Ke.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Qe.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Qe.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:s}=e._texture,o=t.set(n.width,0,0,n.height,r.x,r.y),a=e.worldTransform.copyTo(Dt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=Vt.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Vt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Ls[0],n=Ls[1],s=Ls[2],o=Ls[3];r.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(s,s),t.apply(o,o);const a=Math.min(r.x,n.x,s.x,o.x),h=Math.min(r.y,n.y,s.y,o.y),l=Math.max(r.x,n.x,s.x,o.x),u=Math.max(r.y,n.y,s.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,r,n,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a:o,b:a,c:h,d:l}=s;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?oh.copyFrom(s):oh.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}eg.extension={type:V.RendererSystem,name:"filter"};nt.add(eg);class Ew{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Vt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Aw=new dt;class ig{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new sl(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new dt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Z.PREFER_ENV===_r.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>r,a=e.height>>r,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>r,a=t.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(s.width!==r||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,s=Dh.COLOR|Dh.DEPTH){const{gl:o}=this;o.clearColor(t,e,r,n),o.clear(s)}initFramebuffer(t){const{gl:e}=this,r=new Ew(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=n[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let o=s.length;r.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=s[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,n.stencil)}else n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Vt.NONE;if(t<=1||e===null)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return r===1&&(r=Vt.NONE),r}blit(t,e,r){const{current:n,renderer:s,gl:o,CONTEXT_UID:a}=this;if(s.context.webGLVersion!==2||!n)return;const h=n.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=n.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new sl(n.width,n.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=Aw,e.width=n.width,e.height=n.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,n=t.height,s=this.gl,o=e.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH_STENCIL):t.depth?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH24_STENCIL8):(a=s.STENCIL_ATTACHMENT,h=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,h,r,n):s.renderbufferStorage(s.RENDERBUFFER,h,r,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,a,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new dt}destroy(){this.renderer=null}}ig.extension={type:V.RendererSystem,name:"framebuffer"};nt.add(ig);const ah={5126:4,5123:2,5121:1};class rg{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;Z.PREFER_ENV===_r.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=n=>r.bindVertexArrayOES(n),t.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(n,s)=>r.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,o,a,h)=>r.drawElementsInstancedANGLE(n,s,o,a,h),t.drawArraysInstanced=(n,s,o,a)=>r.drawArraysInstancedANGLE(n,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const s in n)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,s=["g",t.id];for(const o in r)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[a.id]=u,u;const c=t.buffers,d=t.attributes,f={},p={};for(const g in c)f[g]=0,p[g]=0;for(const g in d)!d[g].size&&a.attributeData[g]?d[g].size=a.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[g].buffer]+=d[g].size*ah[d[g].type];for(const g in d){const m=d[g],y=m.size;m.stride===void 0&&(f[m.buffer]===y*ah[m.type]?m.stride=0:m.stride=f[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=y*ah[m.type])}u=n.createVertexArray(),n.bindVertexArray(u);for(let g=0;g<c.length;g++){const m=c[g];o.bind(m),r&&m._glBuffers[s].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,n.bindVertexArray(null),o.unbind(ti.ARRAY_BUFFER),u}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!r){if(o)for(let h=0;h<s.length;h++){const l=s[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(s[h],e))}if(!e){for(const h in r)if(h[0]==="g"){const l=r[h];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let h=null;for(const l in a){const u=a[l],c=o[u.buffer],d=c._glBuffers[n];if(e.attributeData[l]){h!==d&&(s.bind(c),h=d);const f=e.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(r||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,r,e||o.getSize(),n||1):s.drawArrays(t,r,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}rg.extension={type:V.RendererSystem,name:"geometry"};nt.add(rg);const gd=new Dt;class ng{constructor(t,e){this._texture=t,this.mapCoord=new Dt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],o=t[n+1];e[n]=s*r.a+o*r.c+r.tx,e[n+1]=s*r.b+o*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,s=e.trim;s&&(gd.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(gd));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var Tw=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Sw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Iw extends ue{constructor(t,e,r){let n=null;typeof t!="string"&&e===void 0&&r===void 0&&(n=t,t=void 0,e=void 0,r=void 0),super(t||Sw,e||Tw,r),this.maskSprite=n,this.maskMatrix=new Dt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new ng(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class Cw{constructor(t=null){this.type=Yt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ue.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Yt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class sg{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const s=this.maskDataPool.pop()||new Cw;s.pooled=!0,s.maskObject=e,r=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Yt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Yt.SCISSOR:this.renderer.scissor.push(r);break;case Yt.STENCIL:this.renderer.stencil.push(r);break;case Yt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Yt.COLOR:this.pushColorMask(r);break}r.type===Yt.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Yt.SCISSOR:this.renderer.scissor.pop(e);break;case Yt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Yt.SPRITE:this.popSpriteMask(e);break;case Yt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Yt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Yt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Yt.SCISSOR:t.type=Yt.STENCIL:t.type=Yt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new Iw])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}sg.extension={type:V.RendererSystem,name:"mask"};nt.add(sg);class og{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const md=new Dt,yd=[],ag=class oo extends og{constructor(t){super(t),this.glConst=Z.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:n}=this,s=n.renderTexture,o=r.getBounds(!0,yd.pop()??new dt);this.roundFrameToPixels(o,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:n,d:s}=t;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||oo.isMatrixRotated(e.worldTransform)||oo.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,n,s){oo.isMatrixRotated(s)||(s=s?md.copyFrom(s):md.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&yd.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};ag.extension={type:V.RendererSystem,name:"scissor"};let Mw=ag;nt.add(Mw);class hg extends og{constructor(t){super(t),this.glConst=Z.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,r.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(r._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}hg.extension={type:V.RendererSystem,name:"stencil"};nt.add(hg);class lg{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return bt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return bt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return bt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}lg.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"_plugin"};nt.add(lg);class ug{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Dt,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}ug.extension={type:V.RendererSystem,name:"projection"};nt.add(ug);const Rw=new hu,vd=new dt;class cg{constructor(t){this.renderer=t,this._tempMatrix=new Dt}generateTexture(t,e){const{region:r,...n}=e||{},s=(r==null?void 0:r.copyTo(vd))||t.getLocalBounds(vd,!0),o=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/o),s.height=Math.max(s.height,1/o),n.width=s.width,n.height=s.height,n.resolution=o,n.multisample??(n.multisample=this.renderer.multisample);const a=wr.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const h=t.transform;return t.transform=Rw,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}cg.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"textureGenerator"};nt.add(cg);const Zi=new dt,En=new dt;class dg{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new dt,this.destinationFrame=new dt,this.viewportFrame=new dt}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;this.current=t;let s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(Zi.width=t.frame.width,Zi.height=t.frame.height,e=Zi),r||(En.x=t.frame.x,En.y=t.frame.y,En.width=e.width,En.height=e.height,r=En),o=s.framebuffer):(a=n.resolution,e||(Zi.width=n._view.screen.width,Zi.height=n._view.screen.height,e=Zi),r||(r=Zi,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(r,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=Nt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}dg.extension={type:V.RendererSystem,name:"renderTexture"};nt.add(dg);class Pw{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Nw(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(i,n);if(s.name.startsWith("gl_"))continue;const o=qp(t,s.type),a={type:o,name:s.name,size:Yp(o),location:t.getAttribLocation(i,s.name)};e[s.name]=a}return e}function Dw(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const s=t.getActiveUniform(i,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),h=qp(t,s.type);e[o]={name:o,index:n,type:h,size:s.size,isArray:a,value:Vp(h,s.size)}}return e}function Lw(i,t){var a;const e=ld(i,i.VERTEX_SHADER,t.vertexSrc),r=ld(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,r);const s=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(s&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||lw(i,n,e,r),t.attributeData=Nw(n,i),t.uniformData=Dw(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,i.bindAttribLocation(n,l,h[l]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(r);const o={};for(const h in t.uniformData){const l=t.uniformData[h];o[h]={location:i.getUniformLocation(n,h),value:Vp(l.type,l.size)}}return new Pw(n,o)}function Bw(i,t,e,r,n){e.buffer.update(n)}const Ow={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},fg={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function kw(i){const t=i.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,r=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(e=fg[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,r%e!==0&&r<16){const a=r%e%16;r+=a,n+=a}r+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,r=e):(o.offset=n,r+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function Fw(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,n)=>r.index-n.index),e}function Uw(i,t){if(!i.autoManage)return{size:0,syncFunc:Bw};const e=Fw(i.uniforms,t),{uboElements:r,size:n}=kw(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){const a=r[o],h=i.uniforms[a.data.name],l=a.data.name;let u=!1;for(let c=0;c<qr.length;c++){const d=qr[c];if(d.codeUbo&&d.test(a.data,h)){s.push(`offset = ${a.offset/4};`,qr[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){const c=Yp(a.data.type),d=Math.max(fg[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=Ow[a.data.type];s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let Gw=0;const Bs={textureCount:0,uboCount:0};class pg{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Gw++}systemCheck(){if(!cw())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Bs.textureCount=0,Bs.uboCount=0,this.syncUniformGroup(t.uniformGroup,Bs)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=ow(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Bs,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=Uw(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,s=[`${r}-`];for(const o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=Lw(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}pg.extension={type:V.RendererSystem,name:"shader"};nt.add(pg);class Co{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.3 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Co.defaultOptions={hello:!1},Co.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"startup"};nt.add(Co);function $w(i,t=[]){return t[lt.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.ADD]=[i.ONE,i.ONE],t[lt.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.NONE]=[0,0],t[lt.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[lt.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[lt.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[lt.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[lt.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[lt.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[lt.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[lt.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[lt.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[lt.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const Hw=0,Ww=1,zw=2,Xw=3,Vw=4,jw=5,gg=class ol{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=lt.NONE,this._blendEq=!1,this.map=[],this.map[Hw]=this.setBlend,this.map[Ww]=this.setOffset,this.map[zw]=this.setCullFace,this.map[Xw]=this.setDepthTest,this.map[Vw]=this.setFrontFace,this.map[jw]=this.setDepthMask,this.checks=[],this.defaultState=new oi,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=$w(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(ol.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(ol.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};gg.extension={type:V.RendererSystem,name:"state"};let Yw=gg;nt.add(Yw);class qw extends os{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),r=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Oe(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=r.find(o=>this._systemsHash[o]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Nn=class ao{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=ao.defaultMaxIdle,this.checkCountMax=ao.defaultCheckCountMax,this.mode=ao.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==tu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,r=!0)}if(r){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};Nn.defaultMode=tu.AUTO,Nn.defaultMaxIdle=60*60,Nn.defaultCheckCountMax=60*10,Nn.extension={type:V.RendererSystem,name:"textureGC"};let nr=Nn;nt.add(nr);class hh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ot.UNSIGNED_BYTE,this.internalFormat=G.RGBA,this.samplerType=0}}function Kw(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:K.FLOAT,[i.RGBA]:K.FLOAT,[i.ALPHA]:K.FLOAT,[i.LUMINANCE]:K.FLOAT,[i.LUMINANCE_ALPHA]:K.FLOAT,[i.R8]:K.FLOAT,[i.R8_SNORM]:K.FLOAT,[i.RG8]:K.FLOAT,[i.RG8_SNORM]:K.FLOAT,[i.RGB8]:K.FLOAT,[i.RGB8_SNORM]:K.FLOAT,[i.RGB565]:K.FLOAT,[i.RGBA4]:K.FLOAT,[i.RGB5_A1]:K.FLOAT,[i.RGBA8]:K.FLOAT,[i.RGBA8_SNORM]:K.FLOAT,[i.RGB10_A2]:K.FLOAT,[i.RGB10_A2UI]:K.FLOAT,[i.SRGB8]:K.FLOAT,[i.SRGB8_ALPHA8]:K.FLOAT,[i.R16F]:K.FLOAT,[i.RG16F]:K.FLOAT,[i.RGB16F]:K.FLOAT,[i.RGBA16F]:K.FLOAT,[i.R32F]:K.FLOAT,[i.RG32F]:K.FLOAT,[i.RGB32F]:K.FLOAT,[i.RGBA32F]:K.FLOAT,[i.R11F_G11F_B10F]:K.FLOAT,[i.RGB9_E5]:K.FLOAT,[i.R8I]:K.INT,[i.R8UI]:K.UINT,[i.R16I]:K.INT,[i.R16UI]:K.UINT,[i.R32I]:K.INT,[i.R32UI]:K.UINT,[i.RG8I]:K.INT,[i.RG8UI]:K.UINT,[i.RG16I]:K.INT,[i.RG16UI]:K.UINT,[i.RG32I]:K.INT,[i.RG32UI]:K.UINT,[i.RGB8I]:K.INT,[i.RGB8UI]:K.UINT,[i.RGB16I]:K.INT,[i.RGB16UI]:K.UINT,[i.RGB32I]:K.INT,[i.RGB32UI]:K.UINT,[i.RGBA8I]:K.INT,[i.RGBA8UI]:K.UINT,[i.RGBA16I]:K.INT,[i.RGBA16UI]:K.UINT,[i.RGBA32I]:K.INT,[i.RGBA32UI]:K.UINT,[i.DEPTH_COMPONENT16]:K.FLOAT,[i.DEPTH_COMPONENT24]:K.FLOAT,[i.DEPTH_COMPONENT32F]:K.FLOAT,[i.DEPTH_STENCIL]:K.FLOAT,[i.DEPTH24_STENCIL8]:K.FLOAT,[i.DEPTH32F_STENCIL8]:K.FLOAT}:t={[i.RGB]:K.FLOAT,[i.RGBA]:K.FLOAT,[i.ALPHA]:K.FLOAT,[i.LUMINANCE]:K.FLOAT,[i.LUMINANCE_ALPHA]:K.FLOAT,[i.DEPTH_STENCIL]:K.FLOAT},t}function Zw(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[ot.UNSIGNED_BYTE]:{[G.RGBA]:i.RGBA8,[G.RGB]:i.RGB8,[G.RG]:i.RG8,[G.RED]:i.R8,[G.RGBA_INTEGER]:i.RGBA8UI,[G.RGB_INTEGER]:i.RGB8UI,[G.RG_INTEGER]:i.RG8UI,[G.RED_INTEGER]:i.R8UI,[G.ALPHA]:i.ALPHA,[G.LUMINANCE]:i.LUMINANCE,[G.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ot.BYTE]:{[G.RGBA]:i.RGBA8_SNORM,[G.RGB]:i.RGB8_SNORM,[G.RG]:i.RG8_SNORM,[G.RED]:i.R8_SNORM,[G.RGBA_INTEGER]:i.RGBA8I,[G.RGB_INTEGER]:i.RGB8I,[G.RG_INTEGER]:i.RG8I,[G.RED_INTEGER]:i.R8I},[ot.UNSIGNED_SHORT]:{[G.RGBA_INTEGER]:i.RGBA16UI,[G.RGB_INTEGER]:i.RGB16UI,[G.RG_INTEGER]:i.RG16UI,[G.RED_INTEGER]:i.R16UI,[G.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[ot.SHORT]:{[G.RGBA_INTEGER]:i.RGBA16I,[G.RGB_INTEGER]:i.RGB16I,[G.RG_INTEGER]:i.RG16I,[G.RED_INTEGER]:i.R16I},[ot.UNSIGNED_INT]:{[G.RGBA_INTEGER]:i.RGBA32UI,[G.RGB_INTEGER]:i.RGB32UI,[G.RG_INTEGER]:i.RG32UI,[G.RED_INTEGER]:i.R32UI,[G.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[ot.INT]:{[G.RGBA_INTEGER]:i.RGBA32I,[G.RGB_INTEGER]:i.RGB32I,[G.RG_INTEGER]:i.RG32I,[G.RED_INTEGER]:i.R32I},[ot.FLOAT]:{[G.RGBA]:i.RGBA32F,[G.RGB]:i.RGB32F,[G.RG]:i.RG32F,[G.RED]:i.R32F,[G.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[ot.HALF_FLOAT]:{[G.RGBA]:i.RGBA16F,[G.RGB]:i.RGB16F,[G.RG]:i.RG16F,[G.RED]:i.R16F},[ot.UNSIGNED_SHORT_5_6_5]:{[G.RGB]:i.RGB565},[ot.UNSIGNED_SHORT_4_4_4_4]:{[G.RGBA]:i.RGBA4},[ot.UNSIGNED_SHORT_5_5_5_1]:{[G.RGBA]:i.RGB5_A1},[ot.UNSIGNED_INT_2_10_10_10_REV]:{[G.RGBA]:i.RGB10_A2,[G.RGBA_INTEGER]:i.RGB10_A2UI},[ot.UNSIGNED_INT_10F_11F_11F_REV]:{[G.RGB]:i.R11F_G11F_B10F},[ot.UNSIGNED_INT_5_9_9_9_REV]:{[G.RGB]:i.RGB9_E5},[ot.UNSIGNED_INT_24_8]:{[G.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[ot.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[G.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[ot.UNSIGNED_BYTE]:{[G.RGBA]:i.RGBA,[G.RGB]:i.RGB,[G.ALPHA]:i.ALPHA,[G.LUMINANCE]:i.LUMINANCE,[G.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ot.UNSIGNED_SHORT_5_6_5]:{[G.RGB]:i.RGB},[ot.UNSIGNED_SHORT_4_4_4_4]:{[G.RGBA]:i.RGBA},[ot.UNSIGNED_SHORT_5_5_5_1]:{[G.RGBA]:i.RGBA}},t}class mg{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new pt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Zw(t),this.samplerTypes=Kw(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new hh(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new hh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let s=t-1;s>=0;--s){const o=e[s];o&&o._glTextures[n].samplerType!==K.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new hh(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r;e.internalFormat=((r=this.internalFormats[t.type])==null?void 0:r[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??K.FLOAT,this.webGLVersion===2&&t.type===ot.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),(n=t.resource)==null?void 0:n.upload(r,t,e))e.samplerType!==K.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,o=t.realHeight,a=r.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,a.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&Yr(this.managedTextures,n,1)}}updateTextureStyle(t){var r;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===ni.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Hi.CLAMP:e.wrapMode=t.wrapMode,(r=t.resource)!=null&&r.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==ni.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===_i.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===_i.LINEAR){const s=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===_i.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===_i.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}mg.extension={type:V.RendererSystem,name:"texture"};nt.add(mg);class yg{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(r.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&s.dispose(a,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}yg.extension={type:V.RendererSystem,name:"transformFeedback"};nt.add(yg);class Mo{constructor(t){this.renderer=t}init(t){this.screen=new dt(0,0,t.width,t.height),this.element=t.view||Z.ADAPTER.createCanvas(),this.resolution=t.resolution||Z.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Mo.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Mo.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"_view"};nt.add(Mo);Z.PREFER_ENV=_r.WEBGL2;Z.STRICT_TEXTURE_CACHE=!1;Z.RENDER_OPTIONS={...Io.defaultOptions,...So.defaultOptions,...Mo.defaultOptions,...Co.defaultOptions};Object.defineProperties(Z,{WRAP_MODE:{get(){return pt.defaultOptions.wrapMode},set(i){bt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),pt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return pt.defaultOptions.scaleMode},set(i){bt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),pt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return pt.defaultOptions.mipmap},set(i){bt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),pt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return pt.defaultOptions.anisotropicLevel},set(i){bt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),pt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return bt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ue.defaultResolution},set(i){ue.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return bt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ue.defaultMultisample},set(i){ue.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return rr.defaultMaxTextures},set(i){bt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),rr.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return rr.defaultBatchSize},set(i){bt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),rr.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return rr.canUploadSameBuffer},set(i){bt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),rr.canUploadSameBuffer=i}},GC_MODE:{get(){return nr.defaultMode},set(i){bt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),nr.defaultMode=i}},GC_MAX_IDLE:{get(){return nr.defaultMaxIdle},set(i){bt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),nr.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return nr.defaultCheckCountMax},set(i){bt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),nr.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return bi.defaultVertexPrecision},set(i){bt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),bi.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return bi.defaultFragmentPrecision},set(i){bt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),bi.defaultFragmentPrecision=i}}});var gr=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(gr||{});let lh=class{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}};const vg=class ye{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new lh(null,null,1/0),this.deltaMS=1/ye.targetFPMS,this.elapsedMS=1/ye.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=gr.NORMAL){return this._addListener(new lh(t,e,r))}addOnce(t,e,r=gr.NORMAL){return this._addListener(new lh(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ye.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,ye.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ye._shared){const t=ye._shared=new ye;t.autoStart=!0,t._protected=!0}return ye._shared}static get system(){if(!ye._system){const t=ye._system=new ye;t.autoStart=!0,t._protected=!0}return ye._system}};vg.targetFPMS=.06;let _e=vg;Object.defineProperties(Z,{TARGET_FPMS:{get(){return _e.targetFPMS},set(i){bt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),_e.targetFPMS=i}}});class _g{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,gr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?_e.shared:new _e,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}_g.extension=V.Application;nt.add(_g);const xg=[];nt.handleByList(V.Renderer,xg);function Qw(i){for(const t of xg)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var Jw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,t1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const e1=Jw,wg=t1;class bg{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Vt.HIGH?this.multisample=Vt.HIGH:e>=Vt.MEDIUM?this.multisample=Vt.MEDIUM:e>=Vt.LOW?this.multisample=Vt.LOW:this.multisample=Vt.NONE}destroy(){}}bg.extension={type:V.RendererSystem,name:"_multisample"};nt.add(bg);class i1{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Eg{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:s}=this;r=r||0;const o=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new i1(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Eg.extension={type:V.RendererSystem,name:"buffer"};nt.add(Eg);class Ag{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,s,o,a;if(e&&(n=e.renderTexture,s=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(n||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Ag.extension={type:V.RendererSystem,name:"objectRenderer"};nt.add(Ag);const ho=class al extends qw{constructor(t){super(),this.type=ap.WEBGL,t=Object.assign({},Z.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ke({projectionMatrix:new Dt},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:al.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(bt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=al.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:Tx()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return bt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return bt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return bt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return bt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){bt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return bt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){bt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return bt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};ho.extension={type:V.Renderer,priority:1},ho.__plugins={},ho.__systems={};let uu=ho;nt.handleByMap(V.RendererPlugin,uu.__plugins);nt.handleByMap(V.RendererSystem,uu.__systems);nt.add(uu);class Tg extends Jn{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const o=new pt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Jn?this.addResourceAt(t[r],r):this.addResourceAt(Wp(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class r1 extends Tg{constructor(t,e){const{width:r,height:n}=e||{};let s,o;Array.isArray(t)?(s=t,o=t.length):o=t,super(o,{width:r,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Xr.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:s,items:o}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let h=0;h<n;h++){const l=o[h];s[h]<l.dirtyId&&(s[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}}class n1 extends Ii{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Sg=class Dn extends Tg{constructor(t,e){const{width:r,height:n,autoLoad:s,linkBaseTexture:o}=e||{};if(t&&t.length!==Dn.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:n});for(let a=0;a<Dn.SIDES;a++)this.items[a].target=Xr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=Xr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Xr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const n=this.itemDirtyIds;for(let s=0;s<Dn.SIDES;s++){const o=this.items[s];(n[s]<o.dirtyId||r.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,r),n[s]=o.dirtyId):n[s]<-1&&(t.gl.texImage2D(o.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),n[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Dn.SIDES}};Sg.SIDES=6;let s1=Sg;class Wr extends Ii{constructor(t,e){e=e||{};let r,n,s;typeof t=="string"?(r=Wr.EMPTY,n=t,s=!0):(r=t,n=null,s=!1),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await Z.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ge.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Wr._EMPTY=Wr._EMPTY??Z.ADAPTER.createCanvas(0,0),Wr._EMPTY}}const hl=class lo extends Ii{constructor(t,e){e=e||{},super(Z.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},lo.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Ii.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*e,s=this._overrideHeight||this._overrideWidth/e*r),n=Math.round(n),s=Math.round(s);const o=this.source;o.width=n,o.height=s,o._pixiId=`canvas_${pr()}`,o.getContext("2d").drawImage(t,0,0,e,r,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(t){const e=lo.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&lo.SVG_XML.test(t)}};hl.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,hl.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let ll=hl;class o1 extends Ii{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const ul=class cl extends Ii{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const n=t[0].src||t[0];Ii.crossOrigin(r,n,e.crossorigin);for(let s=0;s<t.length;++s){const o=document.createElement("source");let{src:a,mime:h}=t[s];if(a=a||t[s],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||cl.MIME_TYPES[u]||`video/${u}`}o.src=a,h&&(o.type=h),r.appendChild(o)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=_e.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(_e.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(_e.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(_e.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||cl.TYPES.includes(e)}};ul.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],ul.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Ig=ul;Zh.push(Wr,Qp,n1,Ig,o1,ll,sa,s1,r1);class Ro{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?dt.EMPTY:(t=t||new dt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:s,d:o,tx:a,ty:h}=t,l=r*e.x+s*e.y+a,u=n*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s}addFrame(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)}addFrameMatrix(t,e,r,n,s){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,g=this.maxY,m=o*e+h*r+u,y=a*e+l*r+c;d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*n+h*r+u,y=a*n+l*r+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*e+h*s+u,y=a*e+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*n+h*s+u,y=a*n+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,this.minX=d,this.minY=f,this.maxX=p,this.maxY=g}addVertexData(t,e,r){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];n=l<n?l:n,s=u<s?u:s,o=l>o?l:o,a=u>a?u:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,s=0,o=s){const a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty;let f=this.minX,p=this.minY,g=this.maxX,m=this.maxY;for(let y=r;y<n;y+=2){const _=e[y],v=e[y+1],x=a*_+l*v+c,A=u*v+h*_+d;f=Math.min(f,x-s),g=Math.max(g,x+s),p=Math.min(p,A-o),m=Math.max(m,A+o)}this.minX=f,this.minY=p,this.maxX=g,this.maxY=m}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,s,o){t-=s,e-=o,r+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Ft extends os{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new hu,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ro,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(Ft.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new dt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new dt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ro);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,s=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new a1),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Jx}set angle(t){this.transform.rotation=t*tw}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class a1 extends Ft{constructor(){super(...arguments),this.sortDirty=null}}Ft.prototype.displayObjectUpdateTransform=Ft.prototype.updateTransform;const h1=new Dt;function l1(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const Cg=class dl extends Ft{constructor(){super(),this.children=[],this.sortableChildren=dl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Yr(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,Yr(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Yr(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e,s=n-r;let o;if(s>0&&s<=n){o=this.children.splice(r,s);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(l1),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const o=this.children[n];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==dl.prototype._render&&(r=this.getBounds(!0));const s=t.projection.transform;if(s&&(n?(n=h1.copyFrom(n),n.prepend(s)):n=s),r&&e.intersects(r,n))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let r=0,n=this.children.length;r<n;++r)this.children[r].render(t)}}renderAdvanced(t){var s,o,a;const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Yt.NONE));if(n&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,r=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<r.length;++n)r[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Cg.defaultSortableChildren=!1;let Jt=Cg;Jt.prototype.containerUpdateTransform=Jt.prototype.updateTransform;Object.defineProperties(Z,{SORTABLE_CHILDREN:{get(){return Jt.defaultSortableChildren},set(i){bt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Jt.defaultSortableChildren=i}}});const An=new at,u1=new Uint16Array([0,1,2,0,2,3]);class Ai extends Jt{constructor(t){super(),this._anchor=new wi(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Nt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=lt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=u1,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Z.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Fi(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Fi(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor;let f=0,p=0,g=0,m=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,m=u.y-d._y*c.height,g=m+u.height):(p=-d._x*c.width,f=p+c.width,m=-d._y*c.height,g=m+c.height),l[0]=r*p+s*m+a,l[1]=o*m+n*p+h,l[2]=r*f+s*m+a,l[3]=o*m+n*f+h,l[4]=r*f+s*g+a,l[5]=o*g+n*f+h,l[6]=r*p+s*g+a,l[7]=o*g+n*p+h,this._roundPixels){const y=Z.RESOLUTION;for(let _=0;_<l.length;++_)l[_]=Math.round(l[_]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,u=s.tx,c=s.ty,d=-n._x*r.width,f=d+r.width,p=-n._y*r.height,g=p+r.height;if(e[0]=o*d+h*p+u,e[1]=l*p+a*d+c,e[2]=o*f+h*p+u,e[3]=l*p+a*f+c,e[4]=o*f+h*g+u,e[5]=l*g+a*f+c,e[6]=o*d+h*g+u,e[7]=l*g+a*d+c,this._roundPixels){const m=Z.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*m)/m}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Ro),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new dt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,An);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return An.x>=n&&An.x<n+e&&(s=-r*this.anchor.y,An.y>=s&&An.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof it?t:it.from(t,e);return new Ai(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Fi(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Fi(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Mg=new Dt;Ft.prototype._cacheAsBitmap=!1;Ft.prototype._cacheData=null;Ft.prototype._cacheAsBitmapResolution=null;Ft.prototype._cacheAsBitmapMultisample=null;class c1{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Ft.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new c1),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Ft.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};Ft.prototype._initCachedDisplayObject=function(i){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const t=this.alpha;this.alpha=1,i.batch.flush();const e=this.getLocalBounds(new dt,!0);if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;e.pad(p)}const r=this.cacheAsBitmapResolution||i.resolution;e.ceil(r),e.width=Math.max(e.width,1/r),e.height=Math.max(e.height,1/r);const n=i.renderTexture.current,s=i.renderTexture.sourceFrame.clone(),o=i.renderTexture.destinationFrame.clone(),a=i.projection.transform,h=wr.create({width:e.width,height:e.height,resolution:r,multisample:this.cacheAsBitmapMultisample??i.multisample}),l=`cacheAsBitmap_${pr()}`;this._cacheData.textureCacheId=l,pt.addToCache(h.baseTexture,l),it.addToCache(h,l);const u=this.transform.localTransform.copyTo(Mg).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=a,i.renderTexture.bind(n,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new Ai(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};Ft.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};Ft.prototype._initCachedDisplayObjectCanvas=function(i){var u;if((u=this._cacheData)!=null&&u.sprite)return;const t=this.getLocalBounds(new dt,!0),e=this.alpha;this.alpha=1;const r=i.canvasContext.activeContext,n=i._projTransform,s=this.cacheAsBitmapResolution||i.resolution;t.ceil(s),t.width=Math.max(t.width,1/s),t.height=Math.max(t.height,1/s);const o=wr.create({width:t.width,height:t.height,resolution:s}),a=`cacheAsBitmap_${pr()}`;this._cacheData.textureCacheId=a,pt.addToCache(o.baseTexture,a),it.addToCache(o,a);const h=Mg;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new Ai(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};Ft.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Ft.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Ft.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,pt.removeFromCache(this._cacheData.textureCacheId),it.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Ft.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};Ft.prototype.name=null;Jt.prototype.getChildByName=function(i,t){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===i)return this.children[e];if(t)for(let e=0,r=this.children.length;e<r;e++){const n=this.children[e];if(!n.getChildByName)continue;const s=n.getChildByName(i,!0);if(s)return s}return null};Ft.prototype.getGlobalPosition=function(i=new at,t=!1){return this.parent?this.parent.toGlobal(this.position,i,t):(i.x=this.position.x,i.y=this.position.y),i};var d1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class f1 extends ue{constructor(t=1){super(e1,d1,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const p1={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},g1=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function m1(i){const t=p1[i],e=t.length;let r=g1,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<i;a++){let h=s.replace("%index%",a.toString());o=a,a>=e&&(o=i-a-1),h=h.replace("%value%",t[o].toString()),n+=h,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}const y1=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function v1(i,t){const e=Math.ceil(i/2);let r=y1,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<i;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),n+=a,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}class fl extends ue{constructor(t,e=8,r=4,n=ue.defaultResolution,s=5){const o=v1(s,t),a=m1(s);super(o,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,n);else{const s=t.getFilterTexture(),o=t.renderer;let a=e,h=s;this.state.blend=!1,t.applyFilter(this,a,h,Ke.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,Ke.BLIT),this.uniforms.uSampler=h;const u=h;h=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,r,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class _1 extends ue{constructor(t=8,e=4,r=ue.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new fl(!0,t,e,r,n),this.blurYFilter=new fl(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Ke.CLEAR),this.blurYFilter.apply(t,a,r,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var x1=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class pl extends ue{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(wg,x1,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,s]=Nt.shared.setValue(t).toArray(),o=[r,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),s=Math.sqrt,o=1/3,a=s(o),h=r+(1-r)*o,l=o*(1-r)-a*n,u=o*(1-r)+a*n,c=o*(1-r)+a*n,d=r+o*(1-r),f=o*(1-r)-a*n,p=o*(1-r)-a*n,g=o*(1-r)+a*n,m=r+o*(1-r),y=[h,l,u,0,0,c,d,f,0,0,p,g,m,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),s=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=t*2/3+1,n=(r-1)*-.5,s=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,n,s){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const o=Nt.shared,[a,h,l]=o.setValue(r).toArray(),[u,c,d]=o.setValue(n).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,u,c,d,e,0,a-u,h-c,l-d,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}pl.prototype.grayscale=pl.prototype.greyscale;var w1=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,b1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class E1 extends ue{constructor(t,e){const r=new Dt;t.renderable=!1,super(b1,w1,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new at(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var A1=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,T1=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class S1 extends ue{constructor(){super(T1,A1)}}var I1=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class C1 extends ue{constructor(t=.5,e=Math.random()){super(wg,I1,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const _d={AlphaFilter:f1,BlurFilter:_1,BlurFilterPass:fl,ColorMatrixFilter:pl,DisplacementFilter:E1,FXAAFilter:S1,NoiseFilter:C1};Object.entries(_d).forEach(([i,t])=>{Object.defineProperty(_d,i,{get(){return bt("7.1.0",`filters.${i} has moved to ${i}`),t}})});class M1{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(_e.system.add(this.tickerUpdate,this,gr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(_e.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Oi=new M1;class cs{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=cs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new at,this.page=new at,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Po extends cs{constructor(){super(...arguments),this.client=new at,this.movement=new at,this.offset=new at,this.global=new at,this.screen=new at}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,s,o,a,h,l,u,c,d,f,p,g){throw new Error("Method not implemented.")}}class Ne extends Po{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Kr extends Po{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Kr.DOM_DELTA_PIXEL=0,Kr.DOM_DELTA_LINE=1,Kr.DOM_DELTA_PAGE=2;const R1=2048,P1=new at,uh=new at;class N1{constructor(t){this.dispatch=new os,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,n)=>r.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Oi.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,P1.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=r.length-1;n<s;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let s=r.length-1;s>=0;s--)n.forEach(o=>{t.currentTarget=r[s],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let r=0;r<R1&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,s,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Oi.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,r,n,s,o||s(t,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!s(t,r)&&n(t,r)?l?[t]:[]:null}hitTestRecursive(t,e,r,n,s){if(this._interactivePrune(t)||s(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Oi.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,r,n,s);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&n(t,r)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var r;if(t.hitArea&&(t.worldTransform.applyInverse(e,uh),!t.hitArea.contains(uh.x,uh.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((r=n.containsPoint)!=null&&r.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var s,o;e=e??t.type;const r=`on${e}`;(o=(s=t.currentTarget)[r])==null||o.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var h,l;if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((h=n.overTargets)==null?void 0:h.length)>0&&s!==e.target){const u=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,u,s);if(this.dispatchEvent(c,"pointerout"),r&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}if(s!==e.target){const u=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(e,u);this.dispatchEvent(c,"pointerover"),r&&this.dispatchEvent(c,"mouseover");let d=s==null?void 0:s.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(e,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==s&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(o=r.target)==null?void 0:o.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=s;if(s&&!r.composedPath().includes(s)){let a=s;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.notifyTarget(r,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=n.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Ne)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let s=r;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Kr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Ne);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Kr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Ne);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ne&&e instanceof Ne&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Po&&e instanceof Po&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,s=r.length;n<s&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const D1=1,L1={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},gl=class ml{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new N1(null),Oi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Ne(null),this.rootWheelEvent=new Kr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ml.defaultEventFeatures},{set:(e,r,n)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[r]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,ml._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,n=e.length;r<n;r++){const s=e[r],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Oi.pointerMoved();const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,o=n.length;s<o;s++){const a=this.bootstrapEvent(this.rootPointerEvent,n[s]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Oi.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Oi.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Oi.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(r-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const s=t.changedTouches[r];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=D1),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=L1[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};gl.extension={name:"events",type:[V.RendererSystem,V.CanvasRendererSystem]},gl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let yl=gl;nt.add(yl);function xd(i){return i==="dynamic"||i==="static"}const B1={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??xd(yl.defaultEventMode)},set interactive(i){bt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??yl.defaultEventMode},set eventMode(i){this._internalInteractive=xd(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof e=="object"?e.signal:void 0,s=typeof e=="object"?e.once===!0:!1,o=typeof t=="function"?void 0:t;i=r?`${i}capture`:i;const a=typeof t=="function"?t:t.handleEvent,h=this;n&&n.addEventListener("abort",()=>{h.off(i,a,o)}),s?h.once(i,a,o):h.on(i,a,o)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof cs))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};Ft.mixin(B1);const O1={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ft.mixin(O1);const k1=9,Os=100,F1=0,U1=0,wd=2,bd=1,G1=-1e3,$1=-1e3,H1=2;class Rg{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(xi.tablet||xi.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Os}px`,e.style.height=`${Os}px`,e.style.position="absolute",e.style.top=`${F1}px`,e.style.left=`${U1}px`,e.style.zIndex=wd.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${bd}px`,t.style.height=`${bd}px`,t.style.position="absolute",t.style.top=`${G1}px`,t.style.left=`${$1}px`,t.style.zIndex=H1.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(xi.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=n/o*h,u=s/a*h;let c=this.div;c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.width=`${o}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,Yr(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const g=f.worldTransform;f.hitArea?(c.style.left=`${(g.tx+p.x*g.a)*l}px`,c.style.top=`${(g.ty+p.y*g.d)*u}px`,c.style.width=`${p.width*g.a*l}px`,c.style.height=`${p.height*g.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*l}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*l}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Os}px`,e.style.height=`${Os}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=wd.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new cs(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(s,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===k1&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Rg.extension={name:"accessibility",type:[V.RendererPlugin,V.CanvasRendererPlugin]};nt.add(Rg);const Pg=class vl{constructor(t){this.stage=new Jt,t=Object.assign({forceCanvas:!1},t),this.renderer=Qw(t),vl._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const r=vl._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Pg._plugins=[];let Ng=Pg;nt.handleByList(V.Application,Ng._plugins);class Dg{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,r=s}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Dg.extension=V.Application;nt.add(Dg);const Ed={loader:V.LoadParser,resolver:V.ResolveParser,cache:V.CacheParser,detection:V.DetectionParser};nt.handle(V.Asset,i=>{const t=i.ref;Object.entries(Ed).filter(([e])=>!!t[e]).forEach(([e,r])=>nt.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Ed).filter(e=>!!t[e]).forEach(e=>nt.remove(t[e]))});class W1{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function dn(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function Xi(i,t){const e=i.split("?")[0],r=te.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const Le=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i),_l=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i};function Lg(i,t,e,r,n){const s=t[e];for(let o=0;o<s.length;o++){const a=s[o];e<t.length-1?Lg(i.replace(r[e],a),t,e+1,r,n):n.push(i.replace(r[e],a))}}function z1(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),Lg(i,n,0,e,r)}else r.push(i);return r}const No=i=>!Array.isArray(i);class X1{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=Le(t);let n;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){n=h.getCacheableAssets(r,e);break}}n||(n={},r.forEach(a=>{n[a]=e}));const s=Object.keys(n),o={cacheKeys:s,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{const h=n?n[a]:e;this._cache.has(a)&&this._cache.get(a)!==h&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof it){const a=e;r.forEach(h=>{a.baseTexture!==it.EMPTY.baseTexture&&pt.addToCache(a.baseTexture,h),it.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const or=new X1;class V1{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var o,a;let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((o=l.test)!=null&&o.call(l,t,e,this))){s=l;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),r.parser=s;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,n,e,this))&&(n=await l.parse(n,e,this)||n,r.parser=l)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},s=No(t),o=Le(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{const u=te.toAbsolute(l.src);if(!n[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),n[l.src]=await this.promiseCache[u].promise,e&&e(++r/a)}catch(c){throw delete this.promiseCache[u],delete n[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),s?n[o[0].src]:n}async unload(t){const e=Le(t,r=>({alias:[r],src:r})).map(async r=>{var o,a;const n=te.toAbsolute(r.src),s=this.promiseCache[n];if(s){const h=await s.promise;delete this.promiseCache[n],(a=(o=s.parser)==null?void 0:o.unload)==null||a.call(o,h,r,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Fe=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Fe||{});const j1=".json",Y1="application/json",q1={extension:{type:V.LoadParser,priority:Fe.Low},name:"loadJson",test(i){return dn(i,Y1)||Xi(i,j1)},async load(i){return await(await Z.ADAPTER.fetch(i)).json()}};nt.add(q1);const K1=".txt",Z1="text/plain",Q1={name:"loadTxt",extension:{type:V.LoadParser,priority:Fe.Low},test(i){return dn(i,Z1)||Xi(i,K1)},async load(i){return await(await Z.ADAPTER.fetch(i)).text()}};nt.add(Q1);const J1=["normal","bold","100","200","300","400","500","600","700","800","900"],tb=[".ttf",".otf",".woff",".woff2"],eb=["font/ttf","font/otf","font/woff","font/woff2"],ib=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function rb(i){const t=te.extname(i),e=te.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let r=e.length>0;for(const s of e)if(!s.match(ib)){r=!1;break}let n=e.join(" ");return r||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const nb=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function sb(i){return nb.test(i)?i:encodeURI(i)}const ob={extension:{type:V.LoadParser,priority:Fe.Low},name:"loadWebFont",test(i){return dn(i,eb)||Xi(i,tb)},async load(i,t){var r,n,s;const e=Z.ADAPTER.getFontFaceSet();if(e){const o=[],a=((r=t.data)==null?void 0:r.family)??rb(i),h=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(u=>J1.includes(u)))??["normal"],l=t.data??{};for(let u=0;u<h.length;u++){const c=h[u],d=new FontFace(a,`url(${sb(i)})`,{...l,weight:c});await d.load(),e.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>Z.ADAPTER.getFontFaceSet().delete(t))}};nt.add(ob);const ab=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let Zr=null,xl=class{constructor(){Zr||(Zr=URL.createObjectURL(new Blob([ab],{type:"application/javascript"}))),this.worker=new Worker(Zr)}};xl.revokeObjectURL=function(){Zr&&(URL.revokeObjectURL(Zr),Zr=null)};const hb=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let Qr=null;class Bg{constructor(){Qr||(Qr=URL.createObjectURL(new Blob([hb],{type:"application/javascript"}))),this.worker=new Worker(Qr)}}Bg.revokeObjectURL=function(){Qr&&(URL.revokeObjectURL(Qr),Qr=null)};let Ad=0,ch;class lb{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new xl;e.addEventListener("message",r=>{e.terminate(),xl.revokeObjectURL(),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){ch===void 0&&(ch=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<ch&&(this._createdWorkers++,t=new Bg().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[Ad]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Ad++,id:r})}}const Td=new lb;function ds(i,t,e){i.resource.internal=!0;const r=new it(i),n=()=>{delete t.promiseCache[e],or.has(e)&&or.remove(e)};return r.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),r}const ub=[".jpeg",".jpg",".png",".webp",".avif"],cb=["image/jpeg","image/png","image/webp","image/avif"];async function db(i){const t=await Z.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const la={name:"loadTextures",extension:{type:V.LoadParser,priority:Fe.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return dn(i,cb)||Xi(i,ub)},async load(i,t,e){var a;const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;r?this.config.preferWorkers&&await Td.isImageBitmapSupported()?n=await Td.loadImageBitmap(i):n=await db(i):n=await new Promise((h,l)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=i,u.complete?h(u):(u.onload=()=>h(u),u.onerror=c=>l(c))});const s={...t.data};s.resolution??(s.resolution=Si(i)),r&&((a=s.resourceOptions)==null?void 0:a.ownsImageBitmap)===void 0&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const o=new pt(n,s);return o.resource.src=i,ds(o,e,i)},unload(i){i.destroy(!0)}};nt.add(la);const fb=".svg",pb="image/svg+xml",gb={extension:{type:V.LoadParser,priority:Fe.High},name:"loadSVG",test(i){return dn(i,pb)||Xi(i,fb)},async testParse(i){return ll.test(i)},async parse(i,t,e){var s;const r=new ll(i,(s=t==null?void 0:t.data)==null?void 0:s.resourceOptions);await r.load();const n=new pt(r,{resolution:Si(i),...t==null?void 0:t.data});return n.resource.src=t.src,ds(n,e,t.src)},async load(i,t){return(await Z.ADAPTER.fetch(i)).text()},unload:la.unload};nt.add(gb);const mb=[".mp4",".m4v",".webm",".ogv"],yb=["video/mp4","video/webm","video/ogg"],vb={name:"loadVideo",extension:{type:V.LoadParser,priority:Fe.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(i){return dn(i,yb)||Xi(i,mb)},async load(i,t,e){var o;let r;const n=await(await Z.ADAPTER.fetch(i)).blob(),s=URL.createObjectURL(n);try{const a={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions,autoLoad:!0},h=new Ig(s,a);await h.load();const l=new pt(h,{alphaMode:await Ax(),resolution:Si(i),...t==null?void 0:t.data});l.resource.src=i,r=ds(l,e,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(s)})}catch(a){throw URL.revokeObjectURL(s),a}return r},unload(i){i.destroy(!0)}};nt.add(vb);class _b{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,name:r,src:n,srcs:s}=t;return Le(e||r||n||s,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>(a==null?void 0:a.src)??(a==null?void 0:a.srcs)??a):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(n=>{const s=n.src??n.srcs,o=n.alias??n.name;let a;if(typeof o=="string"){const h=this._createBundleAssetId(t,o);r.push(h),a=[o,h]}else{const h=o.map(l=>this._createBundleAssetId(t,l));r.push(...h),a=[...o,...h]}this.add({...n,alias:a,src:s})}):Object.keys(e).forEach(n=>{const s=[n,this._createBundleAssetId(t,n)];if(typeof e[n]=="string")this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const o=e[n],a=o.src??o.srcs;this.add({...o,alias:s,src:Array.isArray(a)?a:[a]})}r.push(...s)}),this._bundles[t]=r}add(t,e,r,n,s){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(bt("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:r,format:n,loadParser:s})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Le(o).forEach(h=>{const{src:l,srcs:u}=h;let{data:c,format:d,loadParser:f}=h;const p=Le(l||u).map(y=>typeof y=="string"?z1(y):Array.isArray(y)?y:[y]),g=this.getAlias(h);Array.isArray(g)?g.forEach(a):a(g);const m=[];p.forEach(y=>{y.forEach(_=>{let v={};if(typeof _!="object"){v.src=_;for(let x=0;x<this._parsers.length;x++){const A=this._parsers[x];if(A.test(_)){v=A.parse(_);break}}}else c=_.data??c,d=_.format??d,f=_.loadParser??f,v={...v,..._};if(!g)throw new Error(`[Resolver] alias is undefined for this asset: ${v.src}`);v=this.buildResolvedAsset(v,{aliases:g,data:c,format:d,loadParser:f}),m.push(v)})}),g.forEach(y=>{this._assetMap[y]=m})})}resolveBundle(t){const e=No(t);t=Le(t);const r={};return t.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(n,h)]=l}r[n]=a}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=No(t);t=Le(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=s[0],a=this._getPreferredOrder(s);a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const u=s.filter(c=>c[h]?c[h]===l:!1);u.length&&(s=u)})}),this._resolverHash[n]=s[0]??o}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});r[n]=this._resolverHash[n]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:r,data:n,loadParser:s,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=te.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=o??t.format??te.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class xb{constructor(){this._detections=[],this._initialized=!1,this.resolver=new _b,this.loader=new V1,this.cache=or,this._backgroundLoader=new W1(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((s=t.texturePreference)==null?void 0:s.resolution)??1,r=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,n,s){this.resolver.add(t,e,r,n,s)}async load(t,e){this._initialized||await this.init();const r=No(t),n=Le(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,e);return r?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},o=Object.keys(n);let a=0,h=0;const l=()=>{e==null||e(++a/h)},u=o.map(c=>{const d=n[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{s[c]=f})});return await Promise.all(u),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return or.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=or.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const o={};return r.forEach((a,h)=>{const l=s[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[n[h]]=l,or.set(u,l)}),o}async unload(t){this._initialized||await this.init();const e=Le(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Le(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{or.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,n)=>e.indexOf(r)===n),e}get detections(){return this._detections}get preferWorkers(){return la.config.preferWorkers}set preferWorkers(t){bt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const ks=new xb;nt.handleByList(V.LoadParser,ks.loader.parsers).handleByList(V.ResolveParser,ks.resolver.parsers).handleByList(V.CacheParser,ks.cache.parsers).handleByList(V.DetectionParser,ks.detections);const wb={extension:V.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof it),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,s)=>{e[r+(s===0?"":s+1)]=n})}),e}};nt.add(wb);async function Og(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const bb={extension:{type:V.DetectionParser,priority:1},test:async()=>Og("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};nt.add(bb);const Eb={extension:{type:V.DetectionParser,priority:0},test:async()=>Og("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};nt.add(Eb);const Sd=["png","jpg","jpeg"],Ab={extension:{type:V.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Sd],remove:async i=>i.filter(t=>!Sd.includes(t))};nt.add(Ab);const Tb="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function cu(i){return Tb?!1:document.createElement("video").canPlayType(i)!==""}const Sb={extension:{type:V.DetectionParser,priority:0},test:async()=>cu("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")};nt.add(Sb);const Ib={extension:{type:V.DetectionParser,priority:0},test:async()=>cu("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")};nt.add(Ib);const Cb={extension:{type:V.DetectionParser,priority:0},test:async()=>cu("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")};nt.add(Cb);const Mb={extension:V.ResolveParser,test:la.test,parse:i=>{var t;return{resolution:parseFloat(((t=Z.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:te.extname(i).slice(1),src:i}}};nt.add(Mb);var ie=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i))(ie||{});const Do={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Ve,Ur;function Id(){Ur={bptc:Ve.getExtension("EXT_texture_compression_bptc"),astc:Ve.getExtension("WEBGL_compressed_texture_astc"),etc:Ve.getExtension("WEBGL_compressed_texture_etc"),s3tc:Ve.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ve.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Ve.getExtension("WEBGL_compressed_texture_pvrtc")||Ve.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Ve.getExtension("WEBGL_compressed_texture_etc1"),atc:Ve.getExtension("WEBGL_compressed_texture_atc")}}const Rb={extension:{type:V.DetectionParser,priority:2},test:async()=>{const i=Z.ADAPTER.createCanvas().getContext("webgl");return i?(Ve=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{Ur||Id();const t=[];for(const e in Ur)Ur[e]&&t.push(e);return[...t,...i]},remove:async i=>(Ur||Id(),i.filter(t=>!(t in Ur)))};nt.add(Rb);class Pb extends sa{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;typeof t=="string"?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new Kh(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Kh(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class cr extends Pb{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=cr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||cr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,o=this.levels;s<o;s++){const{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=cr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,r,n,s,o,a){const h=new Array(r);let l=t.byteOffset,u=o,c=a,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*Do[e];for(let g=0;g<r;g++)h[g]={levelID:g,levelWidth:r>1?u:d,levelHeight:r>1?c:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,c=c>>1||1,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*Do[e];return h}}const dh=4,Fs=124,Nb=32,Cd=20,Db=542327876,Us={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Lb={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Gs={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Bb=1,Ob=2,kb=4,Fb=64,Ub=512,Gb=131072,$b=827611204,Hb=861165636,Wb=894720068,zb=808540228,Xb=4,Vb={[$b]:ie.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Hb]:ie.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Wb]:ie.COMPRESSED_RGBA_S3TC_DXT5_EXT},jb={70:ie.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ie.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ie.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ie.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ie.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ie.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:ie.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:ie.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:ie.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:ie.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Yb(i){const t=new Uint32Array(i);if(t[0]!==Db)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(i,0,Fs/Uint32Array.BYTES_PER_ELEMENT),r=e[Us.HEIGHT],n=e[Us.WIDTH],s=e[Us.MIPMAP_COUNT],o=new Uint32Array(i,Us.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Nb/Uint32Array.BYTES_PER_ELEMENT),a=o[Bb];if(a&kb){const h=o[Lb.FOURCC];if(h!==zb){const _=Vb[h],v=dh+Fs,x=new Uint8Array(i,v);return[new cr(x,{format:_,width:n,height:r,levels:s})]}const l=dh+Fs,u=new Uint32Array(t.buffer,l,Cd/Uint32Array.BYTES_PER_ELEMENT),c=u[Gs.DXGI_FORMAT],d=u[Gs.RESOURCE_DIMENSION],f=u[Gs.MISC_FLAG],p=u[Gs.ARRAY_SIZE],g=jb[c];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===Xb)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const m=new Array,y=dh+Fs+Cd;if(p===1)m.push(new Uint8Array(i,y));else{const _=Do[g];let v=0,x=n,A=r;for(let S=0;S<s;S++){const T=Math.max(1,x+3&-4),C=Math.max(1,A+3&-4),k=T*C*_;v+=k,x=x>>>1,A=A>>>1}let N=y;for(let S=0;S<p;S++)m.push(new Uint8Array(i,N,v)),N+=v}return m.map(_=>new cr(_,{format:g,width:n,height:r,levels:s}))}throw a&Fb?new Error("DDSParser does not support uncompressed texture data."):a&Ub?new Error("DDSParser does not supported YUV uncompressed texture data."):a&Gb?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&Ob?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Md=[171,75,84,88,32,49,49,187,13,10,26,10],qb=67305985,Me={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},wl=64,Rd={[ot.UNSIGNED_BYTE]:1,[ot.UNSIGNED_SHORT]:2,[ot.INT]:4,[ot.UNSIGNED_INT]:4,[ot.FLOAT]:4,[ot.HALF_FLOAT]:8},Kb={[G.RGBA]:4,[G.RGB]:3,[G.RG]:2,[G.RED]:1,[G.LUMINANCE]:1,[G.LUMINANCE_ALPHA]:2,[G.ALPHA]:1},Zb={[ot.UNSIGNED_SHORT_4_4_4_4]:2,[ot.UNSIGNED_SHORT_5_5_5_1]:2,[ot.UNSIGNED_SHORT_5_6_5]:2};function Qb(i,t,e=!1){const r=new DataView(t);if(!Jb(i,r))return null;const n=r.getUint32(Me.ENDIANNESS,!0)===qb,s=r.getUint32(Me.GL_TYPE,n),o=r.getUint32(Me.GL_FORMAT,n),a=r.getUint32(Me.GL_INTERNAL_FORMAT,n),h=r.getUint32(Me.PIXEL_WIDTH,n),l=r.getUint32(Me.PIXEL_HEIGHT,n)||1,u=r.getUint32(Me.PIXEL_DEPTH,n)||1,c=r.getUint32(Me.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=r.getUint32(Me.NUMBER_OF_FACES,n),f=r.getUint32(Me.NUMBER_OF_MIPMAP_LEVELS,n),p=r.getUint32(Me.BYTES_OF_KEY_VALUE_DATA,n);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");const g=4,m=4,y=h+3&-4,_=l+3&-4,v=new Array(c);let x=h*l;s===0&&(x=y*_);let A;if(s!==0?Rd[s]?A=Rd[s]*Kb[o]:A=Zb[s]:A=Do[a],A===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const N=e?eE(r,p,n):null;let S=x*A,T=h,C=l,k=y,O=_,M=wl+p;for(let E=0;E<f;E++){const I=r.getUint32(M,n);let Q=M+4;for(let et=0;et<c;et++){let Y=v[et];Y||(Y=v[et]=new Array(f)),Y[E]={levelID:E,levelWidth:f>1||s!==0?T:k,levelHeight:f>1||s!==0?C:O,levelBuffer:new Uint8Array(t,Q,S)},Q+=S}M+=I+4,M=M%4!==0?M+4-M%4:M,T=T>>1||1,C=C>>1||1,k=T+g-1&~(g-1),O=C+m-1&~(m-1),S=k*O*A}return s!==0?{uncompressed:v.map(E=>{let I=E[0].levelBuffer,Q=!1;return s===ot.FLOAT?I=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):s===ot.UNSIGNED_INT?(Q=!0,I=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):s===ot.INT&&(Q=!0,I=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new sa(I,{width:E[0].levelWidth,height:E[0].levelHeight}),type:s,format:Q?tE(o):o}}),kvData:N}:{compressed:v.map(E=>new cr(null,{format:a,width:h,height:l,levels:f,levelBuffers:E})),kvData:N}}function Jb(i,t){for(let e=0;e<Md.length;e++)if(t.getUint8(e)!==Md[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function tE(i){switch(i){case G.RGBA:return G.RGBA_INTEGER;case G.RGB:return G.RGB_INTEGER;case G.RG:return G.RG_INTEGER;case G.RED:return G.RED_INTEGER;default:return i}}function eE(i,t,e){const r=new Map;let n=0;for(;n<t;){const s=i.getUint32(wl+n,e),o=wl+n+4,a=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&i.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(i.buffer,o,h)),u=new DataView(i.buffer,o+h+1,s-h-1);r.set(l,u),n+=4+s+a}return r}const iE={extension:{type:V.LoadParser,priority:Fe.High},name:"loadDDS",test(i){return Xi(i,".dds")},async load(i,t,e){const r=await(await Z.ADAPTER.fetch(i)).arrayBuffer(),n=Yb(r).map(s=>{const o=new pt(s,{mipmap:ni.OFF,alphaMode:ge.NO_PREMULTIPLIED_ALPHA,resolution:Si(i),...t.data});return ds(o,e,i)});return n.length===1?n[0]:n},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};nt.add(iE);const rE={extension:{type:V.LoadParser,priority:Fe.High},name:"loadKTX",test(i){return Xi(i,".ktx")},async load(i,t,e){const r=await(await Z.ADAPTER.fetch(i)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:o}=Qb(i,r),a=n??s,h={mipmap:ni.OFF,alphaMode:ge.NO_PREMULTIPLIED_ALPHA,resolution:Si(i),...t.data},l=a.map(u=>{a===s&&Object.assign(h,{type:u.type,format:u.format});const c=u.resource??u,d=new pt(c,h);return d.ktxKeyValueData=o,ds(d,e,i)});return l.length===1?l[0]:l},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};nt.add(rE);const nE=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],sE={extension:V.ResolveParser,test:i=>{const t=te.extname(i).slice(1);return["basis","ktx","dds"].includes(t)},parse:i=>{var r,n;const t=i.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const s=t.pop();if(nE.includes(s))return{resolution:parseFloat(((r=Z.RETINA_PREFIX.exec(i))==null?void 0:r[1])??"1"),format:s,src:i}}return{resolution:parseFloat(((n=Z.RETINA_PREFIX.exec(i))==null?void 0:n[1])??"1"),format:e,src:i}}};nt.add(sE);const $s=new dt,oE=4,kg=class Ln{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,n){const s=new Image;return s.src=await this.base64(t,e,r,n),s}async base64(t,e,r,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((o,a)=>{s.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(h)},e,r)});if(s.toDataURL!==void 0)return s.toDataURL(e,r);if(s.convertToBlob!==void 0){const o=await s.convertToBlob({type:e,quality:r});return new Promise((a,h)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&Ln._flipY(r,n,s),a&&Ln._unpremultiplyAlpha(r);const h=new Gx(n,s,1),l=new ImageData(new Uint8ClampedArray(r.buffer),n,s);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:r,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&Ln._flipY(r,n,s),a&&Ln._unpremultiplyAlpha(r),r}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,s=!1,o=!1,a,h=!1;t&&(t instanceof wr?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),h=!0,e&&($s.width=e.width,$s.height=e.height,e=$s)));const l=r.gl;if(a){if(n=a.baseTexture.resolution,e=e??a.frame,s=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===G.RGBA,!h){r.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[r.CONTEXT_UID];f.blitFramebuffer&&r.framebuffer.bind(f.blitFramebuffer)}}else n=r.resolution,e||(e=$s,e.width=r.width/n,e.height=r.height/n),s=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const u=Math.max(Math.round(e.width*n),1),c=Math.max(Math.round(e.height*n),1),d=new Uint8Array(oE*u*c);return l.readPixels(Math.round(e.x*n),Math.round(e.y*n),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:c,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const n=e<<2,s=r>>1,o=new Uint8Array(n);for(let a=0;a<s;a++){const h=a*n,l=(r-a-1)*n;o.set(t.subarray(h,h+n)),t.copyWithin(h,l,l+n),t.set(o,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const n=t[r+3];if(n!==0){const s=255.001/n;t[r]=t[r]*s+.5,t[r+1]=t[r+1]*s+.5,t[r+2]=t[r+2]*s+.5}}}};kg.extension={name:"extract",type:V.RendererSystem};let aE=kg;nt.add(aE);const Lo={build(i){const t=i.points;let e,r,n,s,o,a;if(i.type===re.CIRC){const p=i.shape;e=p.x,r=p.y,o=a=p.radius,n=s=0}else if(i.type===re.ELIP){const p=i.shape;e=p.x,r=p.y,o=p.width,a=p.height,n=s=0}else{const p=i.shape,g=p.width/2,m=p.height/2;e=p.x+g,r=p.y+m,o=a=Math.max(0,Math.min(p.radius,Math.min(g,m))),n=g-o,s=m-a}if(!(o>=0&&a>=0&&n>=0&&s>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(n?4:0)+(s?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=r+s,t[2]=t[4]=e-n,t[5]=t[7]=r-s;return}let u=0,c=h*4+(n?2:0)+2,d=c,f=l;{const p=n+o,g=s,m=e+p,y=e-p,_=r+g;if(t[u++]=m,t[u++]=_,t[--c]=_,t[--c]=y,s){const v=r-g;t[d++]=y,t[d++]=v,t[--f]=v,t[--f]=m}}for(let p=1;p<h;p++){const g=Math.PI/2*(p/h),m=n+Math.cos(g)*o,y=s+Math.sin(g)*a,_=e+m,v=e-m,x=r+y,A=r-y;t[u++]=_,t[u++]=x,t[--c]=x,t[--c]=v,t[d++]=v,t[d++]=A,t[--f]=A,t[--f]=_}{const p=n,g=s+a,m=e+p,y=e-p,_=r+g,v=r-g;t[u++]=m,t[u++]=_,t[--f]=v,t[--f]=m,n&&(t[u++]=y,t[u++]=_,t[--f]=v,t[--f]=y)}},triangulate(i,t){const e=i.points,r=t.points,n=t.indices;if(e.length===0)return;let s=r.length/2;const o=s;let a,h;if(i.type!==re.RREC){const u=i.shape;a=u.x,h=u.y}else{const u=i.shape;a=u.x+u.width/2,h=u.y+u.height/2}const l=i.matrix;r.push(i.matrix?l.a*a+l.c*h+l.tx:a,i.matrix?l.b*a+l.d*h+l.ty:h),s++,r.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)r.push(e[u],e[u+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function Pd(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let n=0,s=i[e-2],o=i[e-1];n<e;n+=2){const a=i[n],h=i[n+1];r+=(a-s)*(h+o),s=a,o=h}if(!t&&r>0||t&&r<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const o=e-s-2,a=e-s-1,h=s,l=s+1;[i[o],i[h]]=[i[h],i[o]],[i[a],i[l]]=[i[l],i[a]]}}}const Fg={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,n=t.points,s=t.indices;if(e.length>=6){Pd(e,!1);const o=[];for(let l=0;l<r.length;l++){const u=r[l];Pd(u.points,!0),o.push(e.length/2),e=e.concat(u.points)}const a=l0(e,o,2);if(!a)return;const h=n.length/2;for(let l=0;l<a.length;l+=3)s.push(a[l]+h),s.push(a[l+1]+h),s.push(a[l+2]+h);for(let l=0;l<e.length;l++)n.push(e[l])}}},hE={build(i){const t=i.shape,e=t.x,r=t.y,n=t.width,s=t.height,o=i.points;o.length=0,n>=0&&s>=0&&o.push(e,r,e+n,r,e+n,r+s,e,r+s)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},lE={build(i){Lo.build(i)},triangulate(i,t){Lo.triangulate(i,t)}};var be=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(be||{}),Ui=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Ui||{});const on={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Nd{static curveTo(t,e,r,n,s,o){const a=o[o.length-2],h=o[o.length-1]-e,l=a-t,u=n-e,c=r-t,d=Math.abs(h*c-l*u);if(d<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=h*h+l*l,p=u*u+c*c,g=h*u+l*c,m=s*Math.sqrt(f)/d,y=s*Math.sqrt(p)/d,_=m*g/f,v=y*g/p,x=m*c+y*l,A=m*u+y*h,N=l*(y+_),S=h*(y+_),T=c*(m+v),C=u*(m+v),k=Math.atan2(S-A,N-x),O=Math.atan2(C-A,T-x);return{cx:x+t,cy:A+e,radius:s,startAngle:k,endAngle:O,anticlockwise:l*u>c*h}}static arc(t,e,r,n,s,o,a,h,l){const u=a-o,c=on._segmentsCount(Math.abs(u)*s,Math.ceil(Math.abs(u)/To)*40),d=u/(c*2),f=d*2,p=Math.cos(d),g=Math.sin(d),m=c-1,y=m%1/m;for(let _=0;_<=m;++_){const v=_+y*_,x=d+o+f*v,A=Math.cos(x),N=-Math.sin(x);l.push((p*A+g*N)*s+r,(p*-N+g*A)*s+n)}}}class uE{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class du{static curveLength(t,e,r,n,s,o,a,h){let l=0,u=0,c=0,d=0,f=0,p=0,g=0,m=0,y=0,_=0,v=0,x=t,A=e;for(let N=1;N<=10;++N)u=N/10,c=u*u,d=c*u,f=1-u,p=f*f,g=p*f,m=g*t+3*p*u*r+3*f*c*s+d*a,y=g*e+3*p*u*n+3*f*c*o+d*h,_=x-m,v=A-y,x=m,A=y,l+=Math.sqrt(_*_+v*v);return l}static curveTo(t,e,r,n,s,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const u=on._segmentsCount(du.curveLength(h,l,t,e,r,n,s,o));let c=0,d=0,f=0,p=0,g=0;a.push(h,l);for(let m=1,y=0;m<=u;++m)y=m/u,c=1-y,d=c*c,f=d*c,p=y*y,g=p*y,a.push(f*h+3*d*y*t+3*c*p*r+g*s,f*l+3*d*y*e+3*c*p*n+g*o)}}function Dd(i,t,e,r,n,s,o,a){const h=i-e*n,l=t-r*n,u=i+e*s,c=t+r*s;let d,f;o?(d=r,f=-e):(d=-r,f=e);const p=h+d,g=l+f,m=u+d,y=c+f;return a.push(p,g,m,y),2}function Qi(i,t,e,r,n,s,o,a){const h=e-i,l=r-t;let u=Math.atan2(h,l),c=Math.atan2(n-i,s-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),g=Math.sqrt(h*h+l*l),m=(15*p*Math.sqrt(g)/Math.PI>>0)+1,y=f/m;if(d+=y,a){o.push(i,t,e,r);for(let _=1,v=d;_<m;_++,v+=y)o.push(i,t,i+Math.sin(v)*g,t+Math.cos(v)*g);o.push(i,t,n,s)}else{o.push(e,r,i,t);for(let _=1,v=d;_<m;_++,v+=y)o.push(i+Math.sin(v)*g,t+Math.cos(v)*g,i,t);o.push(n,s,i,t)}return m*2}function cE(i,t){const e=i.shape;let r=i.points||e.points.slice();const n=t.closePointEps;if(r.length===0)return;const s=i.lineStyle,o=new at(r[0],r[1]),a=new at(r[r.length-2],r[r.length-1]),h=e.type!==re.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){r=r.slice(),l&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const Y=(o.x+a.x)*.5,rt=(a.y+o.y)*.5;r.unshift(Y,rt),r.push(Y,rt)}const u=t.points,c=r.length/2;let d=r.length;const f=u.length/2,p=s.width/2,g=p*p,m=s.miterLimit*s.miterLimit;let y=r[0],_=r[1],v=r[2],x=r[3],A=0,N=0,S=-(_-x),T=y-v,C=0,k=0,O=Math.sqrt(S*S+T*T);S/=O,T/=O,S*=p,T*=p;const M=s.alignment,E=(1-M)*2,I=M*2;h||(s.cap===Ui.ROUND?d+=Qi(y-S*(E-I)*.5,_-T*(E-I)*.5,y-S*E,_-T*E,y+S*I,_+T*I,u,!0)+2:s.cap===Ui.SQUARE&&(d+=Dd(y,_,S,T,E,I,!0,u))),u.push(y-S*E,_-T*E,y+S*I,_+T*I);for(let Y=1;Y<c-1;++Y){y=r[(Y-1)*2],_=r[(Y-1)*2+1],v=r[Y*2],x=r[Y*2+1],A=r[(Y+1)*2],N=r[(Y+1)*2+1],S=-(_-x),T=y-v,O=Math.sqrt(S*S+T*T),S/=O,T/=O,S*=p,T*=p,C=-(x-N),k=v-A,O=Math.sqrt(C*C+k*k),C/=O,k/=O,C*=p,k*=p;const rt=v-y,gt=_-x,F=v-A,H=N-x,mt=rt*F+gt*H,xt=gt*F-H*rt,At=xt<0;if(Math.abs(xt)<.001*Math.abs(mt)){u.push(v-S*E,x-T*E,v+S*I,x+T*I),mt>=0&&(s.join===be.ROUND?d+=Qi(v,x,v-S*E,x-T*E,v-C*E,x-k*E,u,!1)+4:d+=2,u.push(v-C*I,x-k*I,v+C*E,x+k*E));continue}const Ut=(-S+y)*(-T+x)-(-S+v)*(-T+_),Rt=(-C+A)*(-k+x)-(-C+v)*(-k+N),Xt=(rt*Rt-F*Ut)/xt,Kt=(H*Ut-gt*Rt)/xt,ae=(Xt-v)*(Xt-v)+(Kt-x)*(Kt-x),Bt=v+(Xt-v)*E,Tt=x+(Kt-x)*E,Lt=v-(Xt-v)*I,b=x-(Kt-x)*I,pe=Math.min(rt*rt+gt*gt,F*F+H*H),Pt=At?E:I,Ge=pe+Pt*Pt*g,xs=ae<=Ge;let hi=s.join;if(hi===be.MITER&&ae/g>m&&(hi=be.BEVEL),xs)switch(hi){case be.MITER:{u.push(Bt,Tt,Lt,b);break}case be.BEVEL:{At?u.push(Bt,Tt,v+S*I,x+T*I,Bt,Tt,v+C*I,x+k*I):u.push(v-S*E,x-T*E,Lt,b,v-C*E,x-k*E,Lt,b),d+=2;break}case be.ROUND:{At?(u.push(Bt,Tt,v+S*I,x+T*I),d+=Qi(v,x,v+S*I,x+T*I,v+C*I,x+k*I,u,!0)+4,u.push(Bt,Tt,v+C*I,x+k*I)):(u.push(v-S*E,x-T*E,Lt,b),d+=Qi(v,x,v-S*E,x-T*E,v-C*E,x-k*E,u,!1)+4,u.push(v-C*E,x-k*E,Lt,b));break}}else{switch(u.push(v-S*E,x-T*E,v+S*I,x+T*I),hi){case be.MITER:{At?u.push(Lt,b,Lt,b):u.push(Bt,Tt,Bt,Tt),d+=2;break}case be.ROUND:{At?d+=Qi(v,x,v+S*I,x+T*I,v+C*I,x+k*I,u,!0)+2:d+=Qi(v,x,v-S*E,x-T*E,v-C*E,x-k*E,u,!1)+2;break}}u.push(v-C*E,x-k*E,v+C*I,x+k*I),d+=2}}y=r[(c-2)*2],_=r[(c-2)*2+1],v=r[(c-1)*2],x=r[(c-1)*2+1],S=-(_-x),T=y-v,O=Math.sqrt(S*S+T*T),S/=O,T/=O,S*=p,T*=p,u.push(v-S*E,x-T*E,v+S*I,x+T*I),h||(s.cap===Ui.ROUND?d+=Qi(v-S*(E-I)*.5,x-T*(E-I)*.5,v-S*E,x-T*E,v+S*I,x+T*I,u,!1)+2:s.cap===Ui.SQUARE&&(d+=Dd(v,x,S,T,E,I,!1,u)));const Q=t.indices,et=on.epsilon*on.epsilon;for(let Y=f;Y<d+f-2;++Y)y=u[Y*2],_=u[Y*2+1],v=u[(Y+1)*2],x=u[(Y+1)*2+1],A=u[(Y+2)*2],N=u[(Y+2)*2+1],!(Math.abs(y*(x-N)+v*(N-_)+A*(_-x))<et)&&Q.push(Y,Y+1,Y+2)}function dE(i,t){let e=0;const r=i.shape,n=i.points||r.points,s=r.type!==re.POLY||r.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,h=n.length/2,l=o.length/2;let u=l;for(o.push(n[0],n[1]),e=1;e<h;e++)o.push(n[e*2],n[e*2+1]),a.push(u,u+1),u++;s&&a.push(u,l)}function Ld(i,t){i.lineStyle.native?dE(i,t):cE(i,t)}class fu{static curveLength(t,e,r,n,s,o){const a=t-2*r+s,h=e-2*n+o,l=2*r-2*t,u=2*n-2*e,c=4*(a*a+h*h),d=4*(a*l+h*u),f=l*l+u*u,p=2*Math.sqrt(c+d+f),g=Math.sqrt(c),m=2*c*g,y=2*Math.sqrt(f),_=d/g;return(m*p+g*d*(p-y)+(4*f*c-d*d)*Math.log((2*g+_+p)/(_+y)))/(4*m)}static curveTo(t,e,r,n,s){const o=s[s.length-2],a=s[s.length-1],h=on._segmentsCount(fu.curveLength(o,a,t,e,r,n));let l=0,u=0;for(let c=1;c<=h;++c){const d=c/h;l=o+(t-o)*d,u=a+(e-a)*d,s.push(l+(t+(r-t)*d-l)*d,u+(e+(n-e)*d-u)*d)}}}const fh={[re.POLY]:Fg,[re.CIRC]:Lo,[re.ELIP]:Lo,[re.RECT]:hE,[re.RREC]:lE},Bd=[],Hs=[];class Bo{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Bo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Rr=new at,Ug=class Gg extends zp{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ro,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Hs.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Bd.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,n=null){const s=new Bo(t,e,r,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new Bo(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const n=e[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Rr):Rr.copyFrom(t),n.shape.contains(Rr.x,Rr.y))){let s=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(Rr.x,Rr.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],u=l.fillStyle,c=l.lineStyle;fh[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,g=this.indices.length,m=this.points.length/2;p.wrapMode=Hi.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-m;y!==0&&(r&&!this._compareStyles(n,f)&&(r.end(g,m),r=null),r||(r=Bd.pop()||new uE,r.begin(f,g,m),this.batches.push(r),n=f),this.addUvs(this.points,t,f.texture,m,y,f.matrix))}}const s=this.indices.length,o=this.points.length/2;if(r&&r.end(s,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const r=this.graphicsData[t],n=r.fillStyle,s=r.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const n=t[e];for(let s=0;s<n.size;s++){const o=n.start+s;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<Gg.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++pt._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Hs.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let n=Hs.pop();n||(n=new Jh,n.texArray=new rl),n.texArray.count=0,n.start=0,n.size=0,n.type=Qe.TRIANGLES;let s=0,o=null,a=0,h=!1,l=Qe.TRIANGLES,u=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,g=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?Qe.LINES:Qe.TRIANGLES,o=null,s=f,t++),o!==g&&(o=g,g._batchEnabled!==t&&(s===f&&(t++,s=0,n.size>0&&(n=Hs.pop(),n||(n=new Jh,n.texArray=new rl),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=l),g.touched=1,g._batchEnabled=t,g._batchLocation=s,g.wrapMode=Hi.REPEAT,n.texArray.elements[n.texArray.count++]=g,s++)),n.size+=d.size,u+=d.size,a=g._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,a,d.attribSize,d.attribStart)}pt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,s=new ArrayBuffer(t.length*3*4),o=new Float32Array(s),a=new Uint32Array(s);let h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=r[l],o[h++]=n[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Fg.triangulate(t,this):fh[t.type].triangulate(t,this)}processLine(t){Ld(t,this);for(let e=0;e<t.holes.length;e++)Ld(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];fh[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const n=t[r*2],s=t[r*2+1];t[r*2]=e.a*n+e.c*s+e.tx,t[r*2+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,r,n,s=0){const o=Nt.shared.setValue(e).toLittleEndianNumber(),a=Nt.shared.setValue(o).toPremultiplied(r);t.length=Math.max(t.length,s+n);for(let h=0;h<n;h++)t[s+h]=a}addTextureIds(t,e,r,n=0){t.length=Math.max(t.length,n+r);for(let s=0;s<r;s++)t[n+s]=e}addUvs(t,e,r,n,s,o=null){let a=0;const h=e.length,l=r.frame;for(;a<s;){let c=t[(n+a)*2],d=t[(n+a)*2+1];if(o){const f=o.a*c+o.c*d+o.tx;d=o.b*c+o.d*d+o.ty,c=f}a++,e.push(c/l.width,d/l.height)}const u=r.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,r,h,s)}adjustUvs(t,e,r,n){const s=e.baseTexture,o=1e-6,a=r+n*2,h=e.frame,l=h.width/s.width,u=h.height/s.height;let c=h.x/h.width,d=h.y/h.height,f=Math.floor(t[r]+o),p=Math.floor(t[r+1]+o);for(let g=r+2;g<a;g+=2)f=Math.min(f,Math.floor(t[g]+o)),p=Math.min(p,Math.floor(t[g+1]+o));c-=f,d-=p;for(let g=r;g<a;g+=2)t[g]=(t[g]+c)*l,t[g+1]=(t[g+1]+d)*u}};Ug.BATCHABLE_SIZE=100;let fE=Ug;class ua{constructor(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new ua;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class pu extends ua{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ui.BUTT,this.join=be.MITER,this.miterLimit=10}clone(){const t=new pu;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Ui.BUTT,this.join=be.MITER,this.miterLimit=10}}const ph={},bl=class uo extends Jt{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new ua,this._lineStyle=new pu,this._matrix=null,this._holeMode=!1,this.state=oi.for2d(),this._geometry=t||new fE,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Nt(16777215),this.blendMode=lt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new uo(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,n=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:r,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:it.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ui.BUTT,join:be.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ur,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ur,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],s=r[r.length-1];return(n!==t||s!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),fu.curveTo(t,e,r,n,s),this}bezierCurveTo(t,e,r,n,s,o){return this._initCurve(),du.curveTo(t,e,r,n,s,o,this.currentPath.points),this}arcTo(t,e,r,n,s){this._initCurve(t,e);const o=this.currentPath.points,a=Nd.curveTo(t,e,r,n,s,o);if(a){const{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=a;this.arc(h,l,u,c,d,f)}return this}arc(t,e,r,n,s,o=!1){if(n===s)return this;if(!o&&s<=n?s+=To:o&&n<=s&&(n+=To),s-n===0)return this;const a=t+Math.cos(n)*r,h=e+Math.sin(n)*r,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return Nd.arc(a,h,t,e,r,n,s,o,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:it.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Nt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:it.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,n){return this.drawShape(new dt(t,e,r,n))}drawRoundedRect(t,e,r,n,s){return this.drawShape(new aa(t,e,r,n,s))}drawCircle(t,e,r){return this.drawShape(new us(t,e,r))}drawEllipse(t,e,r,n){return this.drawShape(new oa(t,e,r,n))}drawPolygon(...t){let e,r=!0;const n=t[0];n.points?(r=n.closeStroke,e=n.points):Array.isArray(t[0])?e=t[0]:e=t;const s=new ur(e);return s.closeStroke=r,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===re.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let n=0;n<r;n++){const s=t.batches[n],o=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:Nt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,n=this.worldAlpha,s=e.uniforms,o=r.drawCalls;s.translationMatrix=this.transform.worldTransform,Nt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,r.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:r,type:n,size:s,start:o}=e,a=r.count;for(let h=0;h<a;h++)t.texture.bind(r.elements[h],h);t.geometry.draw(n,s,o)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!ph[r]){const{maxTextures:n}=t.plugins[r],s=new Int32Array(n);for(let h=0;h<n;h++)s[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Dt,default:ke.from({uSamplers:s},!0)},a=t.plugins[r]._shader.program;ph[r]=new ei(a,o)}e=ph[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,r,n,s)}containsPoint(t){return this.worldTransform.applyInverse(t,uo._TEMP_POINT),this._geometry.containsPoint(uo._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Nt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<l.length;d+=2){const f=l[d],p=l[d+1];u[c++]=r*f+s*p+a,u[c++]=o*p+n*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};bl.curves=on,bl._TEMP_POINT=new at;let Oo=bl;class pE{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const gh=new at,Od=new ur,$g=class Hg extends Jt{constructor(t,e,r,n=Qe.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||oi.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Z.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Qe.TRIANGLES&&e.length<Hg.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,u=n.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=e[d*2],p=e[d*2+1];c[d*2]=s*f+a*p+l,c[d*2+1]=o*f+h*p+u}if(this._roundPixels){const d=Z.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new pE(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,gh);const e=this.geometry.getBuffer("aVertexPosition").data,r=Od.points,n=this.geometry.getIndex().data,s=n.length,o=this.drawMode===4?3:1;for(let a=0;a+2<s;a+=o){const h=n[a]*2,l=n[a+1]*2,u=n[a+2]*2;if(r[0]=e[h],r[1]=e[h+1],r[2]=e[l],r[3]=e[l+1],r[4]=e[u],r[5]=e[u+1],Od.contains(gh.x,gh.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};$g.BATCHABLE_SIZE=100;let kd=$g;class gE extends Wi{constructor(t,e,r){super();const n=new Ht(t),s=new Ht(e,!0),o=new Ht(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,ot.FLOAT).addAttribute("aTextureCoord",s,2,!1,ot.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var mE=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,yE=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Fd extends ei{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:Dt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||bi.from(yE,mE),r),this._colorDirty=!1,this.uvMatrix=new ng(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Nt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Nt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Ud{constructor(t,e,r){this.geometry=new Wi,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||ot.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Ht(Fx(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Ht(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Ht(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===ot.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===ot.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===ot.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===ot.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var vE=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,_E=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Wg extends ha{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Dt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ot.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ei.from(_E,vE,{}),this.state=oi.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,s=this.renderer;let o=e.length;if(o===0)return;o>r&&!t.autoResize&&(o=r);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=$p(t.blendMode,l),s.state.set(this.state);const u=s.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Nt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=n,p+=1){let g=o-f;g>n&&(g=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const m=a[p];m.uploadDynamic(e,f,g);const y=t._bufferUpdateIDs[p]||0;d=d||m._updateID<y,d&&(m._updateID=t._updateID,m.uploadStatic(e,f,g)),s.geometry.bind(m.geometry),u.drawElements(u.TRIANGLES,g*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,s=t._properties;for(let o=0;o<r;o+=n)e.push(new Ud(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Ud(this.properties,r,e)}uploadVertices(t,e,r,n,s,o){let a=0,h=0,l=0,u=0;for(let c=0;c<r;++c){const d=t[e+c],f=d._texture,p=d.scale.x,g=d.scale.y,m=f.trim,y=f.orig;m?(h=m.x-d.anchor.x*y.width,a=h+m.width,u=m.y-d.anchor.y*y.height,l=u+m.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),n[o]=h*p,n[o+1]=u*g,n[o+s]=a*p,n[o+s+1]=u*g,n[o+s*2]=a*p,n[o+s*2+1]=l*g,n[o+s*3]=h*p,n[o+s*3+1]=l*g,o+=s*4}}uploadPosition(t,e,r,n,s,o){for(let a=0;a<r;a++){const h=t[e+a].position;n[o]=h.x,n[o+1]=h.y,n[o+s]=h.x,n[o+s+1]=h.y,n[o+s*2]=h.x,n[o+s*2+1]=h.y,n[o+s*3]=h.x,n[o+s*3+1]=h.y,o+=s*4}}uploadRotation(t,e,r,n,s,o){for(let a=0;a<r;a++){const h=t[e+a].rotation;n[o]=h,n[o+s]=h,n[o+s*2]=h,n[o+s*3]=h,o+=s*4}}uploadUvs(t,e,r,n,s,o){for(let a=0;a<r;++a){const h=t[e+a]._texture._uvs;h?(n[o]=h.x0,n[o+1]=h.y0,n[o+s]=h.x1,n[o+s+1]=h.y1,n[o+s*2]=h.x2,n[o+s*2+1]=h.y2,n[o+s*3]=h.x3,n[o+s*3+1]=h.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(t,e,r,n,s,o){for(let a=0;a<r;++a){const h=t[e+a],l=Nt.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);n[o]=l,n[o+s]=l,n[o+s*2]=l,n[o+s*3]=l,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Wg.extension={name:"particle",type:V.RendererPlugin};nt.add(Wg);var ca=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(ca||{});const Ws={willReadFrequently:!0},je=class st{static get experimentalLetterSpacingSupported(){let t=st._experimentalLetterSpacingSupported;if(t!==void 0){const e=Z.ADAPTER.getCanvasRenderingContext2D().prototype;t=st._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,s,o,a,h,l){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,r,n=st._canvas){r=r??e.wordWrap;const s=e.toFontString(),o=st.measureFont(s);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=n.getContext("2d",Ws);a.font=s;const h=(r?st.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let u=0;for(let p=0;p<h.length;p++){const g=st._measureText(h[p],e.letterSpacing,a);l[p]=g,u=Math.max(u,g)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const d=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new st(t,e,c,f,h,l,d+e.leading,u,o)}static _measureText(t,e,r){let n=!1;st.experimentalLetterSpacingSupported&&(st.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let s=r.measureText(t).width;return s>0&&(n?s-=e:s+=(st.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,r=st._canvas){const n=r.getContext("2d",Ws);let s=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=st.collapseSpaces(u),d=st.collapseNewlines(u);let f=!c;const p=e.wordWrapWidth+l,g=st.tokenize(t);for(let m=0;m<g.length;m++){let y=g[m];if(st.isNewline(y)){if(!d){a+=st.addLine(o),f=!c,o="",s=0;continue}y=" "}if(c){const v=st.isBreakingSpace(y),x=st.isBreakingSpace(o[o.length-1]);if(v&&x)continue}const _=st.getFromCache(y,l,h,n);if(_>p)if(o!==""&&(a+=st.addLine(o),o="",s=0),st.canBreakWords(y,e.breakWords)){const v=st.wordWrapSplit(y);for(let x=0;x<v.length;x++){let A=v[x],N=A,S=1;for(;v[x+S];){const C=v[x+S];if(!st.canBreakChars(N,C,y,x,e.breakWords))A+=C;else break;N=C,S++}x+=S-1;const T=st.getFromCache(A,l,h,n);T+s>p&&(a+=st.addLine(o),f=!1,o="",s=0),o+=A,s+=T}}else{o.length>0&&(a+=st.addLine(o),o="",s=0);const v=m===g.length-1;a+=st.addLine(y,!v),f=!1,o="",s=0}else _+s>p&&(f=!1,a+=st.addLine(o),o="",s=0),(o.length>0||!st.isBreakingSpace(y)||f)&&(o+=y,s+=_)}return a+=st.addLine(o,!1),a}static addLine(t,e=!0){return t=st.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,n){let s=r[t];return typeof s!="number"&&(s=st._measureText(t,e,n)+e,r[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!st.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:st._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:st._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],o=t[n+1];if(st.isBreakingSpace(s,o)||st.isNewline(s)){r!==""&&(e.push(r),r=""),e.push(s);continue}r+=s}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(t){return st.graphemeSegmenter(t)}static measureFont(t){if(st._fonts[t])return st._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=st._canvas,n=st._context;n.font=t;const s=st.METRICS_STRING+st.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width);let a=Math.ceil(n.measureText(st.BASELINE_SYMBOL).width);const h=Math.ceil(st.HEIGHT_MULTIPLIER*a);if(a=a*st.BASELINE_MULTIPLIER|0,o===0||h===0)return st._fonts[t]=e,e;r.width=o,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);const l=n.getImageData(0,0,o,h).data,u=l.length,c=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let g=0;g<c;g+=4)if(l[f+g]!==255){p=!0;break}if(!p)f+=c;else break}for(e.ascent=a-d,f=u-c,p=!1,d=h;d>a;--d){for(let g=0;g<c;g+=4)if(l[f+g]!==255){p=!0;break}if(!p)f-=c;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,st._fonts[t]=e,e}static clearMetrics(t=""){t?delete st._fonts[t]:st._fonts={}}static get _canvas(){var t;if(!st.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if((t=r.getContext("2d",Ws))!=null&&t.measureText)return st.__canvas=r,r;e=Z.ADAPTER.createCanvas()}catch{e=Z.ADAPTER.createCanvas()}e.width=e.height=10,st.__canvas=e}return st.__canvas}static get _context(){return st.__context||(st.__context=st._canvas.getContext("2d",Ws)),st.__context}};je.METRICS_STRING="|q",je.BASELINE_SYMBOL="M",je.BASELINE_MULTIPLIER=1.4,je.HEIGHT_MULTIPLIER=2,je.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})(),je.experimentalLetterSpacing=!1,je._fonts={},je._newlines=[10,13],je._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let vi=je;const xE=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],zg=class Bn{constructor(t){this.styleID=0,this.reset(),yh(this,t,t)}clone(){const t={};return yh(t,this,Bn.defaultStyle),new Bn(t)}reset(){yh(this,Bn.defaultStyle,Bn.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=mh(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=mh(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){wE(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=mh(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!xE.includes(n)&&(n=`"${n}"`),e[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};zg.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ca.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ci=zg;function mh(i){const t=Nt.shared,e=r=>{const n=t.setValue(r);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(i)?i.map(e):e(i)}function wE(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function yh(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const bE={texture:!0,children:!1,baseTexture:!0},Xg=class El extends Ai{constructor(t,e,r){let n=!1;r||(r=Z.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const s=it.from(r);s.orig=new dt,s.trim=new dt,super(s),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=El.defaultResolution??Z.RESOLUTION,this._autoResolution=El.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return vi.experimentalLetterSpacing}static set experimentalLetterSpacing(t){bt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),vi.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,n=vi.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,o=n.height,a=n.lines,h=n.lineHeight,l=n.lineWidths,u=n.maxLineWidth,c=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let g=0;g<p;++g){const m=e.dropShadow&&g===0,y=m?Math.ceil(Math.max(1,o)+e.padding*2):0,_=y*this._resolution;if(m){r.fillStyle="black",r.strokeStyle="black";const x=e.dropShadowColor,A=e.dropShadowBlur*this._resolution,N=e.dropShadowDistance*this._resolution;r.shadowColor=Nt.shared.setValue(x).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=A,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*N,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*N+_}else r.fillStyle=this._generateFillStyle(e,a,n),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let v=(h-c.fontSize)/2;h-c.fontSize<0&&(v=0);for(let x=0;x<a.length;x++)d=e.strokeThickness/2,f=e.strokeThickness/2+x*h+c.ascent+v,e.align==="right"?d+=u-l[x]:e.align==="center"&&(d+=(u-l[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[x],d+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[x],d+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,r,n=!1){const s=this._style.letterSpacing;let o=!1;if(vi.experimentalLetterSpacingSupported&&(vi.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r);return}let a=e;const h=vi.graphemeSegmenter(t);let l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){const d=h[c];n?this.context.strokeText(d,a,r):this.context.fillText(d,a,r);let f="";for(let p=c+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,a+=l-u+s,l=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=Hx(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,r=this._style,n=r.trim?0:r.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const n=t.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,u=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(n[0]),c.unshift(0),u.push(n[n.length-1]),c.push(1),t.fillGradientType===ca.LINEAR_VERTICAL){s=this.context.createLinearGradient(h/2,a,h/2,l+a);const d=r.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=r.lineHeight*(f-1)+d,g=r.lineHeight*f;let m=g;f>0&&p>g&&(m=(g+p)/2);const y=g+d,_=r.lineHeight*(f+1);let v=y;f+1<e.length&&_<y&&(v=(y+_)/2);const x=(v-m)/l;for(let A=0;A<u.length;A++){let N=0;typeof c[A]=="number"?N=c[A]:N=A/u.length;let S=Math.min(1,Math.max(0,m/l+N*x));S=Number(S.toFixed(5)),s.addColorStop(S,u[A])}}}else{s=this.context.createLinearGradient(a,l/2,h+a,l/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let g;typeof c[p]=="number"?g=c[p]:g=f/d,s.addColorStop(g,u[p]),f++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},bE,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Fi(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Fi(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Ci?this._style=t:this._style=new Ci(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Xg.defaultAutoResolution=!0;let gu=Xg;class EE{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function AE(i,t){var r;let e=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let n=0;n<i._textures.length;n++)if(i._textures[n]instanceof it){const s=i._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function TE(i,t){if(i.baseTexture instanceof pt){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function SE(i,t){if(i._texture&&i._texture instanceof it){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function IE(i,t){return t instanceof gu?(t.updateText(!0),!0):!1}function CE(i,t){if(t instanceof Ci){const e=t.toFontString();return vi.measureFont(e),!0}return!1}function ME(i,t){if(i instanceof gu){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function RE(i,t){return i instanceof Ci?(t.includes(i)||t.push(i),!0):!1}const Vg=class jg{constructor(t){this.limiter=new EE(jg.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(ME),this.registerFindHook(RE),this.registerFindHook(AE),this.registerFindHook(TE),this.registerFindHook(SE),this.registerUploadHook(IE),this.registerUploadHook(CE)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,_e.system.addOnce(this.tick,this,gr.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)_e.system.addOnce(this.tick,this,gr.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Jt)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&_e.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Vg.uploadsPerFrame=4;let Al=Vg;Object.defineProperties(Z,{UPLOADS_PER_FRAME:{get(){return Al.uploadsPerFrame},set(i){bt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Al.uploadsPerFrame=i}}});function Yg(i,t){return t instanceof pt?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function PE(i,t){if(!(t instanceof Oo))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let n=0;n<r.length;n++){const{texture:s}=r[n].style;s&&Yg(i,s.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function NE(i,t){return i instanceof Oo?(t.push(i),!0):!1}class qg extends Al{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(NE),this.registerUploadHook(Yg),this.registerUploadHook(PE)}}qg.extension={name:"prepare",type:V.RendererSystem};nt.add(qg);var DE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,LE=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,BE=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Gd=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,OE=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const zs=new Dt;class Kg extends ha{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new tg,this.state=oi.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ei.from(Gd,OE,e),this.shader=t.context.webGLVersion>1?ei.from(LE,DE,e):ei.from(Gd,BE,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,r.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==Hi.CLAMP:h.wrapMode===Hi.CLAMP&&(h.wrapMode=Hi.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,g=a.height,m=t._width,y=t._height;zs.set(u.a*p/m,u.b*p/y,u.c*g/m,u.d*g/y,u.tx/m,u.ty/y),zs.invert(),d?zs.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=zs.toArray(!0),f.uniforms.uColor=Nt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=$p(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Kg.extension={name:"tilingSprite",type:V.RendererPlugin};nt.add(Kg);const Zg=class On{constructor(t,e,r){this.linkedSheets=[],(t instanceof pt||t instanceof it)&&(t={texture:t,data:e,resolutionFilename:r});const{texture:n,data:s,resolutionFilename:o=null,cachePrefix:a=""}=t;this.cachePrefix=a,this._texture=n instanceof it?n:null,this.baseTexture=n instanceof pt?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=s;const h=this.baseTexture.resource;this.resolution=this._updateResolution(o||(h?h.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=Si(t,null);return r===null&&(r=typeof e=="number"?e:parseFloat(e??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=On.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=On.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],o=s.frame;if(o){let a=null,h=null;const l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,u=new dt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?a=new dt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new dt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(h=new dt(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new it(this.baseTexture,a,u,h,s.rotated?2:0,s.anchor,s.borders),it.addToCache(this.textures[n],this.cachePrefix+n.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*On.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*On.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Zg.BATCH_SIZE=1e3;let $d=Zg;const kE=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Qg(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=te.dirname(i[0]);t.linkedSheets.forEach((s,o)=>{Object.assign(r,Qg([`${n}/${t.data.meta.related_multi_packs[o]}`],s,!0))})}return r}const FE={extension:V.Asset,cache:{test:i=>i instanceof $d,getCacheableAssets:(i,t)=>Qg(i,t,!1)},resolver:{test:i=>{const t=i.split("?")[0].split("."),e=t.pop(),r=t.pop();return e==="json"&&kE.includes(r)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=Z.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:V.LoadParser,priority:Fe.Normal},async testParse(i,t){return te.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var u,c;const{texture:r,imageFilename:n,cachePrefix:s}=(t==null?void 0:t.data)??{};let o=te.dirname(t.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let a;if(r&&r.baseTexture)a=r;else{const d=_l(o+(n??i.meta.image),t.src);a=(await e.load([d]))[d]}const h=new $d({texture:a.baseTexture,data:i,resolutionFilename:t.src,cachePrefix:s});await h.parse();const l=(u=i==null?void 0:i.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(l)){const d=[];for(const p of l){if(typeof p!="string")continue;let g=o+p;(c=t.data)!=null&&c.ignoreMultiPack||(g=_l(g,t.src),d.push(e.load({src:g,data:{ignoreMultiPack:!0}})))}const f=await Promise.all(d);h.linkedSheets=f,f.forEach(p=>{p.linkedSheets=[h].concat(h.linkedSheets.filter(g=>g!==p))})}return h},unload(i){i.destroy(!0)}}};nt.add(FE);class ko{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class co{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const o=e[s].match(/^[a-z]+/gm)[0],a=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const u=a[l].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[c]=p}r[o].push(h)}const n=new ko;return r.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),r.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),r.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),r.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),r.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),r.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class Tl{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new ko,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<r.length;l++)e.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(let l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(let l=0;l<s.length;l++)e.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(let l=0;l<o.length;l++){const u=o[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}}class Sl{static test(t){return typeof t=="string"&&t.includes("<font>")?Tl.test(Z.ADAPTER.parseXML(t)):!1}static parse(t){return Tl.parse(Z.ADAPTER.parseXML(t))}}const vh=[co,Tl,Sl];function UE(i){for(let t=0;t<vh.length;t++)if(vh[t].test(i))return vh[t];return null}function GE(i,t,e,r,n,s){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=i.width/r-h-l*2,c=i.height/r-h-l*2,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let g=1;g<p;++g)f.push(g/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===ca.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,c+l);let p=0;const g=(s.fontProperties.fontSize+e.strokeThickness)/c;for(let m=0;m<n.length;m++){const y=s.lineHeight*m;for(let _=0;_<d.length;_++){let v=0;typeof f[_]=="number"?v=f[_]:v=_/d.length;const x=y/c+v*g;let A=Math.max(p,x);A=Math.min(A,1),a.addColorStop(A,d[_]),p=A}}}else{a=t.createLinearGradient(l,c/2,u+l,c/2);const p=d.length+1;let g=1;for(let m=0;m<d.length;m++){let y;typeof f[m]=="number"?y=f[m]:y=g/p,a.addColorStop(y,d[m]),g++}}return a}function $E(i,t,e,r,n,s,o){const a=e.text,h=e.fontProperties;t.translate(r,n),t.scale(s,s);const l=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=GE(i,t,o,s,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const c=o.dropShadowColor,d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;t.shadowColor=Nt.shared.setValue(c).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),o.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function fo(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function Jg(i){return Array.from?Array.from(i):i.split("")}function HE(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Jg(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Li=class Ye{constructor(t,e,r){var u;const[n]=t.info,[s]=t.common,[o]=t.page,[a]=t.distanceField,h=Si(o.file),l={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/h,this.chars={},this.pageTextures=l;for(let c=0;c<t.page.length;c++){const{id:d,file:f}=t.page[c];l[d]=e instanceof Array?e[c]:e[f],a!=null&&a.fieldType&&a.fieldType!=="none"&&(l[d].baseTexture.alphaMode=ge.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=ni.OFF)}for(let c=0;c<t.char.length;c++){const{id:d,page:f}=t.char[c];let{x:p,y:g,width:m,height:y,xoffset:_,yoffset:v,xadvance:x}=t.char[c];p/=h,g/=h,m/=h,y/=h,_/=h,v/=h,x/=h;const A=new dt(p+l[f].frame.x/h,g+l[f].frame.y/h,m,y);this.chars[d]={xOffset:_,yOffset:v,xAdvance:x,kerning:{},texture:new it(l[f].baseTexture,A),page:f}}for(let c=0;c<t.kerning.length;c++){let{first:d,second:f,amount:p}=t.kerning[c];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let n;if(t instanceof ko)n=t;else{const o=UE(t);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(t)}e instanceof it&&(e=[e]);const s=new Ye(n,e,r);return Ye.available[s.font]=s,s}static uninstall(t){const e=Ye.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Ye.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},Ye.defaultOptions,r),u=HE(n),c=e instanceof Ci?e:new Ci(e),d=a,f=new ko;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,g=0,m,y,_,v=0;const x=[];for(let N=0;N<u.length;N++){m||(m=Z.ADAPTER.createCanvas(),m.width=a,m.height=h,y=m.getContext("2d"),_=new pt(m,{resolution:o,...l}),x.push(new it(_)),f.page.push({id:x.length-1,file:""}));const S=u[N],T=vi.measureText(S,c,!1,m),C=T.width,k=Math.ceil(T.height),O=Math.ceil((c.fontStyle==="italic"?2:1)*C);if(g>=h-k*o){if(g===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${S}')`);--N,m=null,y=null,_=null,g=0,p=0,v=0;continue}if(v=Math.max(k+T.fontProperties.descent,v),O*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${S}')`);--N,g+=v*o,g=Math.ceil(g),p=0,v=0;continue}$E(m,y,T,p,g,o,c);const M=fo(T.text);f.char.push({id:M,page:x.length-1,x:p/o,y:g/o,width:O,height:k,xoffset:0,yoffset:0,xadvance:C-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(O+2*s)*o,p=Math.ceil(p)}if(!(r!=null&&r.skipKerning))for(let N=0,S=u.length;N<S;N++){const T=u[N];for(let C=0;C<S;C++){const k=u[C],O=y.measureText(T).width,M=y.measureText(k).width,E=y.measureText(T+k).width-(O+M);E&&f.kerning.push({first:fo(T),second:fo(k),amount:E})}}const A=new Ye(f,x,!0);return Ye.available[t]!==void 0&&Ye.uninstall(t),Ye.available[t]=A,A}};Li.ALPHA=[["a","z"],["A","Z"]," "],Li.NUMERIC=[["0","9"]],Li.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Li.ASCII=[[" ","~"]],Li.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Li.ALPHANUMERIC},Li.available={};let Bi=Li;var WE=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,zE=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Hd=[],Wd=[],zd=[],XE=class tm extends Jt{constructor(t,e={}){super();const{align:r,tint:n,maxWidth:s,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},tm.styleDefaults,e);if(!Bi.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new Nt(n),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new wi(()=>{this.dirty=!0},this,0,0),this._roundPixels=Z.ROUND_PIXELS,this.dirty=!0,this._resolution=Z.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var O;const t=Bi.available[this._fontName],e=this.fontSize,r=e/t.size,n=new at,s=[],o=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Jg(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?Hd:Wd;let d=null,f=0,p=0,g=0,m=-1,y=0,_=0,v=0,x=0;for(let M=0;M<l.length;M++){const E=l[M],I=fo(E);if(/(?:\s)/.test(E)&&(m=M,y=f,x++),E==="\r"||E===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++g,++_,n.x=0,n.y+=t.lineHeight,d=null,x=0;continue}const Q=t.chars[I];if(!Q)continue;d&&Q.kerning[d]&&(n.x+=Q.kerning[d]);const et=zd.pop()||{texture:it.EMPTY,line:0,charCode:0,prevSpaces:0,position:new at};et.texture=Q.texture,et.line=g,et.charCode=I,et.position.x=Math.round(n.x+Q.xOffset+this._letterSpacing/2),et.position.y=Math.round(n.y+Q.yOffset),et.prevSpaces=x,s.push(et),f=et.position.x+Math.max(Q.xAdvance-Q.xOffset,Q.texture.orig.width),n.x+=Q.xAdvance+this._letterSpacing,v=Math.max(v,Q.yOffset+Q.texture.height),d=I,m!==-1&&u>0&&n.x>u&&(++_,Yr(s,1+m-_,1+M-m),M=m,m=-1,o.push(y),a.push(s.length>0?s[s.length-1].prevSpaces:0),p=Math.max(p,y),g++,n.x=0,n.y+=t.lineHeight,d=null,x=0)}const A=l[l.length-1];A!=="\r"&&A!==`
`&&(/(?:\s)/.test(A)&&(f=y),o.push(f),p=Math.max(p,f),a.push(-1));const N=[];for(let M=0;M<=g;M++){let E=0;this._align==="right"?E=p-o[M]:this._align==="center"?E=(p-o[M])/2:this._align==="justify"&&(E=a[M]<0?0:(p-o[M])/a[M]),N.push(E)}const S=s.length,T={},C=[],k=this._activePagesMeshData;c.push(...k);for(let M=0;M<S;M++){const E=s[M].texture,I=E.baseTexture.uid;if(!T[I]){let Q=c.pop();if(!Q){const Y=new gE;let rt,gt;t.distanceFieldType==="none"?(rt=new Fd(it.EMPTY),gt=lt.NORMAL):(rt=new Fd(it.EMPTY,{program:bi.from(zE,WE),uniforms:{uFWidth:0}}),gt=lt.NORMAL_NPM);const F=new kd(Y,rt);F.blendMode=gt,Q={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:F,vertices:null,uvs:null,indices:null}}Q.index=0,Q.indexCount=0,Q.vertexCount=0,Q.uvsCount=0,Q.total=0;const{_textureCache:et}=this;et[I]=et[I]||new it(E.baseTexture),Q.mesh.texture=et[I],Q.mesh.tint=this._tintColor.value,C.push(Q),T[I]=Q}T[I].total++}for(let M=0;M<k.length;M++)C.includes(k[M])||this.removeChild(k[M].mesh);for(let M=0;M<C.length;M++)C[M].mesh.parent!==this&&this.addChild(C[M].mesh);this._activePagesMeshData=C;for(const M in T){const E=T[M],I=E.total;if(!(((O=E.indices)==null?void 0:O.length)>6*I)||E.vertices.length<kd.BATCHABLE_SIZE*2)E.vertices=new Float32Array(4*2*I),E.uvs=new Float32Array(4*2*I),E.indices=new Uint16Array(6*I);else{const Q=E.total,et=E.vertices;for(let Y=Q*4*2;Y<et.length;Y++)et[Y]=0}E.mesh.size=6*I}for(let M=0;M<S;M++){const E=s[M];let I=E.position.x+N[E.line]*(this._align==="justify"?E.prevSpaces:1);this._roundPixels&&(I=Math.round(I));const Q=I*r,et=E.position.y*r,Y=E.texture,rt=T[Y.baseTexture.uid],gt=Y.frame,F=Y._uvs,H=rt.index++;rt.indices[H*6+0]=0+H*4,rt.indices[H*6+1]=1+H*4,rt.indices[H*6+2]=2+H*4,rt.indices[H*6+3]=0+H*4,rt.indices[H*6+4]=2+H*4,rt.indices[H*6+5]=3+H*4,rt.vertices[H*8+0]=Q,rt.vertices[H*8+1]=et,rt.vertices[H*8+2]=Q+gt.width*r,rt.vertices[H*8+3]=et,rt.vertices[H*8+4]=Q+gt.width*r,rt.vertices[H*8+5]=et+gt.height*r,rt.vertices[H*8+6]=Q,rt.vertices[H*8+7]=et+gt.height*r,rt.uvs[H*8+0]=F.x0,rt.uvs[H*8+1]=F.y0,rt.uvs[H*8+2]=F.x1,rt.uvs[H*8+3]=F.y1,rt.uvs[H*8+4]=F.x2,rt.uvs[H*8+5]=F.y2,rt.uvs[H*8+6]=F.x3,rt.uvs[H*8+7]=F.y3}this._textWidth=p*r,this._textHeight=(n.y+t.lineHeight)*r;for(const M in T){const E=T[M];if(this.anchor.x!==0||this.anchor.y!==0){let Y=0;const rt=this._textWidth*this.anchor.x,gt=this._textHeight*this.anchor.y;for(let F=0;F<E.total;F++)E.vertices[Y++]-=rt,E.vertices[Y++]-=gt,E.vertices[Y++]-=rt,E.vertices[Y++]-=gt,E.vertices[Y++]-=rt,E.vertices[Y++]-=gt,E.vertices[Y++]-=rt,E.vertices[Y++]-=gt}this._maxLineHeight=v*r;const I=E.mesh.geometry.getBuffer("aVertexPosition"),Q=E.mesh.geometry.getBuffer("aTextureCoord"),et=E.mesh.geometry.getIndex();I.data=E.vertices,Q.data=E.uvs,et.data=E.indices,I.update(),Q.update(),et.update()}for(let M=0;M<s.length;M++)zd.push(s[M]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:n}=Bi.available[this._fontName];if(r!=="none"){const{a:s,b:o,c:a,d:h}=this.worldTransform,l=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/n,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Bi.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Bi.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Bi.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r=Bi.available[this._fontName].distanceFieldType==="none"?Hd:Wd;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=it.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};XE.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const VE=[".xml",".fnt"],jE={extension:{type:V.LoadParser,priority:Fe.Normal},name:"loadBitmapFont",test(i){return VE.includes(te.extname(i).toLowerCase())},async testParse(i){return co.test(i)||Sl.test(i)},async parse(i,t,e){const r=co.test(i)?co.parse(i):Sl.parse(i),{src:n}=t,{page:s}=r,o=[];for(let l=0;l<s.length;++l){const u=s[l].file;let c=te.join(te.dirname(n),u);c=_l(c,n),o.push(c)}const a=await e.load(o),h=o.map(l=>a[l]);return Bi.install(r,h,!0)},async load(i,t){return(await Z.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};nt.add(jE);const Il=class Gr extends Ci{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Gr(Object.keys(Gr.defaultOptions).reduce((e,r)=>({...e,[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Gr.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=Gr;if(r[t]){const n=r[t];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Z.ADAPTER.fetch(t).then(n=>n.blob()).then(async n=>new Promise((s,o)=>{const a=URL.createObjectURL(n),h=new FileReader;h.onload=()=>s([a,h.result]),h.onerror=o,h.readAsDataURL(n)})).then(async([n,s])=>{const o=Object.assign({family:te.basename(t,te.extname(t)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);r[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(r=>!this._overrides.includes(r));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(r=>this._overrides.includes(r));e.length>0&&(this._overrides=this._overrides.filter(r=>!e.includes(r)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Ox(t)),typeof t=="number"?Bx(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const s=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,Gr.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=Z.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Il.availableFonts={},Il.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let _h=Il;const Xs=class $r extends Ai{constructor(t="",e={}){super(it.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,n=it.from(r,{scaleMode:Z.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new dt,n.trim=new dt,this.texture=n;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(s,"svg"),h=document.createElementNS(s,"foreignObject"),l=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=$r.defaultMaxWidth,this.maxHeight=$r.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=r,this._loadImage=new Image,this._autoResolution=$r.defaultAutoResolution,this._resolution=$r.defaultResolution??Z.RESOLUTION,this.text=t,this.style=e}measureText(t){var u,c;const{text:e,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:a}=s;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const h=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(u=this._style)==null?void 0:u.toCSS(n)}),this._styleElement.textContent=(c=this._style)==null?void 0:c.toGlobalCSS()),{width:h+r.padding*2,height:l+r.padding*2}}async updateText(t=!0){const{style:e,_image:r,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:o}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,s)),r.height=n.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(h=>{n.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),r.src=n.src,n.onload=null,n.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:n}=this,{padding:s}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=r.width/n,e.trim.height=e._frame.height=r.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(r.width,r.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var r,n,s,o,a;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},$r.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=e,(n=this._svgRoot)==null||n.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Fi(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Fi(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof _h?(this.ownsStyle=!1,this._style=t):t instanceof Ci?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=_h.from(t)):(this.ownsStyle=!0,this._style=new _h(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Xs.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Xs.defaultMaxWidth=2024,Xs.defaultMaxHeight=2024,Xs.defaultAutoResolution=!0;/*!
 * @pixi/constants - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Xd;(function(i){i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2"})(Xd||(Xd={}));var Vd;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS"})(Vd||(Vd={}));var jd;(function(i){i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL"})(jd||(jd={}));var Yd;(function(i){i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR"})(Yd||(Yd={}));var qd;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(qd||(qd={}));var Kd;(function(i){i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(Kd||(Kd={}));var Zd;(function(i){i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(Zd||(Zd={}));var Qd;(function(i){i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT"})(Qd||(Qd={}));var Jd;(function(i){i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT"})(Jd||(Jd={}));var Cl;(function(i){i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR"})(Cl||(Cl={}));var Ml;(function(i){i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Ml||(Ml={}));var Rl;(function(i){i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL"})(Rl||(Rl={}));var tf;(function(i){i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(tf||(tf={}));var ef;(function(i){i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT"})(ef||(ef={}));var Pl;(function(i){i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL"})(Pl||(Pl={}));var jn;(function(i){i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp"})(jn||(jn={}));var rf;(function(i){i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR"})(rf||(rf={}));var nf;(function(i){i[i.RED=1]="RED",i[i.GREEN=2]="GREEN",i[i.BLUE=4]="BLUE",i[i.ALPHA=8]="ALPHA"})(nf||(nf={}));var Nl;(function(i){i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH"})(Nl||(Nl={}));var sf;(function(i){i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(sf||(sf={}));/*!
 * @pixi/settings - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var YE={createCanvas:function(i,t){var e=document.createElement("canvas");return e.width=i,e.height=t,e},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var i;return(i=document.baseURI)!==null&&i!==void 0?i:window.location.href},fetch:function(i,t){return fetch(i,t)}},xh=/iPhone/i,of=/iPod/i,af=/iPad/i,hf=/\biOS-universal(?:.+)Mac\b/i,wh=/\bAndroid(?:.+)Mobile\b/i,lf=/Android/i,Pr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Vs=/Silk/i,pi=/Windows Phone/i,uf=/\bWindows(?:.+)ARM\b/i,cf=/BlackBerry/i,df=/BB10/i,ff=/Opera Mini/i,pf=/\b(CriOS|Chrome)(?:.+)Mobile/i,gf=/Mobile(?:.+)Firefox\b/i,mf=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function qE(i){return function(t){return t.test(i)}}function KE(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=qE(e),s={apple:{phone:n(xh)&&!n(pi),ipod:n(of),tablet:!n(xh)&&(n(af)||mf(t))&&!n(pi),universal:n(hf),device:(n(xh)||n(of)||n(af)||n(hf)||mf(t))&&!n(pi)},amazon:{phone:n(Pr),tablet:!n(Pr)&&n(Vs),device:n(Pr)||n(Vs)},android:{phone:!n(pi)&&n(Pr)||!n(pi)&&n(wh),tablet:!n(pi)&&!n(Pr)&&!n(wh)&&(n(Vs)||n(lf)),device:!n(pi)&&(n(Pr)||n(Vs)||n(wh)||n(lf))||n(/\bokhttp\b/i)},windows:{phone:n(pi),tablet:n(uf),device:n(pi)||n(uf)},other:{blackberry:n(cf),blackberry10:n(df),opera:n(ff),firefox:n(gf),chrome:n(pf),device:n(cf)||n(df)||n(ff)||n(gf)||n(pf)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var zr=KE(globalThis.navigator);function ZE(){return!zr.apple.device}function QE(i){var t=!0;if(zr.tablet||zr.phone){if(zr.apple.device){var e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(e){var r=parseInt(e[1],10);r<11&&(t=!1)}}if(zr.android.device){var e=navigator.userAgent.match(/Android\s([0-9.]*)/);if(e){var r=parseInt(e[1],10);r<7&&(t=!1)}}}return t?i:4}var kn={ADAPTER:YE,MIPMAP_TEXTURES:Rl.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:Nl.NONE,SPRITE_MAX_TEXTURES:QE(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:Pl.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Ml.CLAMP,SCALE_MODE:Cl.LINEAR,PRECISION_VERTEX:jn.HIGH,PRECISION_FRAGMENT:zr.apple.device?jn.HIGH:jn.MEDIUM,CAN_UPLOAD_SAME_BUFFER:ZE(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};/*!
 * @pixi/extensions - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Dl;(function(i){i.Application="application",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Loader="loader",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser"})(Dl||(Dl={}));/*!
 * @pixi/ticker - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */kn.TARGET_FPMS=.06;var ts;(function(i){i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY"})(ts||(ts={}));var bh=function(){function i(t,e,r,n){e===void 0&&(e=null),r===void 0&&(r=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}return i.prototype.match=function(t,e){return e===void 0&&(e=null),this.fn===t&&this.context===e},i.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},i.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},i.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},i}(),Ll=function(){function i(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new bh(null,null,1/0),this.deltaMS=1/kn.TARGET_FPMS,this.elapsedMS=1/kn.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return i.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},i.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},i.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},i.prototype.add=function(t,e,r){return r===void 0&&(r=ts.NORMAL),this._addListener(new bh(t,e,r))},i.prototype.addOnce=function(t,e,r){return r===void 0&&(r=ts.NORMAL),this._addListener(new bh(t,e,r,!0))},i.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this},i.prototype.remove=function(t,e){for(var r=this._head.next;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(i.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),i.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},i.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},i.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},i.prototype.update=function(t){t===void 0&&(t=performance.now());var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*kn.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(i.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,kn.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(i,"shared",{get:function(){if(!i._shared){var t=i._shared=new i;t.autoStart=!0,t._protected=!0}return i._shared},enumerable:!1,configurable:!0}),Object.defineProperty(i,"system",{get:function(){if(!i._system){var t=i._system=new i;t.autoStart=!0,t._protected=!0}return i._system},enumerable:!1,configurable:!0}),i}();(function(){function i(){}return i.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,ts.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ll.shared:new Ll,t.autoStart&&this.start()},i.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},i.extension=Dl.Application,i})();class Ie{constructor(t){this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var JE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tA(i,t,e){return e={path:t,exports:{},require:function(r,n){return eA(r,n??e.path)}},i(e,e.exports),e.exports}function eA(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var yf=tA(function(i,t){(function(){var e,r;r=function(n){return i.exports=n},e={linear:function(n,s,o,a){return o*n/a+s},easeInQuad:function(n,s,o,a){return o*(n/=a)*n+s},easeOutQuad:function(n,s,o,a){return-o*(n/=a)*(n-2)+s},easeInOutQuad:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n+s:-o/2*(--n*(n-2)-1)+s},easeInCubic:function(n,s,o,a){return o*(n/=a)*n*n+s},easeOutCubic:function(n,s,o,a){return o*((n=n/a-1)*n*n+1)+s},easeInOutCubic:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n+s:o/2*((n-=2)*n*n+2)+s},easeInQuart:function(n,s,o,a){return o*(n/=a)*n*n*n+s},easeOutQuart:function(n,s,o,a){return-o*((n=n/a-1)*n*n*n-1)+s},easeInOutQuart:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n*n+s:-o/2*((n-=2)*n*n*n-2)+s},easeInQuint:function(n,s,o,a){return o*(n/=a)*n*n*n*n+s},easeOutQuint:function(n,s,o,a){return o*((n=n/a-1)*n*n*n*n+1)+s},easeInOutQuint:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n*n*n+s:o/2*((n-=2)*n*n*n*n+2)+s},easeInSine:function(n,s,o,a){return-o*Math.cos(n/a*(Math.PI/2))+o+s},easeOutSine:function(n,s,o,a){return o*Math.sin(n/a*(Math.PI/2))+s},easeInOutSine:function(n,s,o,a){return-o/2*(Math.cos(Math.PI*n/a)-1)+s},easeInExpo:function(n,s,o,a){return n===0?s:o*Math.pow(2,10*(n/a-1))+s},easeOutExpo:function(n,s,o,a){return n===a?s+o:o*(-Math.pow(2,-10*n/a)+1)+s},easeInOutExpo:function(n,s,o,a){return(n/=a/2)<1?o/2*Math.pow(2,10*(n-1))+s:o/2*(-Math.pow(2,-10*--n)+2)+s},easeInCirc:function(n,s,o,a){return-o*(Math.sqrt(1-(n/=a)*n)-1)+s},easeOutCirc:function(n,s,o,a){return o*Math.sqrt(1-(n=n/a-1)*n)+s},easeInOutCirc:function(n,s,o,a){return(n/=a/2)<1?-o/2*(Math.sqrt(1-n*n)-1)+s:o/2*(Math.sqrt(1-(n-=2)*n)+1)+s},easeInElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),-(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+s},easeOutElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),h*Math.pow(2,-10*n)*Math.sin((n*a-u)*(2*Math.PI)/l)+o+s},easeInOutElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a/2),l||(l=a*(.3*1.5)),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),n<1?-.5*(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+s:h*Math.pow(2,-10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l)*.5+o+s},easeInBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),o*(n/=a)*n*((h+1)*n-h)+s},easeOutBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),o*((n=n/a-1)*n*((h+1)*n+h)+1)+s},easeInOutBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),(n/=a/2)<1?o/2*(n*n*(((h*=1.525)+1)*n-h))+s:o/2*((n-=2)*n*(((h*=1.525)+1)*n+h)+2)+s},easeInBounce:function(n,s,o,a){var h;return h=e.easeOutBounce(a-n,0,o,a),o-h+s},easeOutBounce:function(n,s,o,a){return(n/=a)<1/2.75?o*(7.5625*n*n)+s:n<2/2.75?o*(7.5625*(n-=1.5/2.75)*n+.75)+s:n<2.5/2.75?o*(7.5625*(n-=2.25/2.75)*n+.9375)+s:o*(7.5625*(n-=2.625/2.75)*n+.984375)+s},easeInOutBounce:function(n,s,o,a){var h;return n<a/2?(h=e.easeInBounce(n*2,0,o,a),h*.5+s):(h=e.easeOutBounce(n*2-a,0,o,a),h*.5+o*.5+s)}},r(e)}).call(JE)});function da(i,t){if(i){if(typeof i=="function")return i;if(typeof i=="string")return yf[i]}else return yf[t]}const iA={removeOnInterrupt:!1,ease:"linear",time:1e3};class yi extends Ie{__init(){this.startWidth=null}__init2(){this.startHeight=null}__init3(){this.deltaWidth=null}__init4(){this.deltaHeight=null}__init5(){this.width=null}__init6(){this.height=null}__init7(){this.time=0}constructor(t,e={}){super(t),yi.prototype.__init.call(this),yi.prototype.__init2.call(this),yi.prototype.__init3.call(this),yi.prototype.__init4.call(this),yi.prototype.__init5.call(this),yi.prototype.__init6.call(this),yi.prototype.__init7.call(this),this.options=Object.assign({},iA,e),this.options.ease=da(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new at(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const r=this.parent.width,n=this.parent.height;this.complete(),(r!==this.parent.width||n!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const r=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const n=this.startWidth,s=this.deltaWidth;this.parent.fitWidth(n+s*r,this.keepCenter,this.height===null)}if(this.height!==null){const n=this.startHeight,s=this.deltaHeight;this.parent.fitHeight(n+s*r,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const n=this.startX,s=this.startY,o=this.deltaX,a=this.deltaY,h=new at(this.parent.x,this.parent.y);this.parent.moveCenter(n+o*r,s+a*r),this.parent.emit("moved",{viewport:this.parent,original:h,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}function js(i){let t,e=i[0],r=1;for(;r<i.length;){const n=i[r],s=i[r+1];if(r+=2,(n==="optionalAccess"||n==="optionalCall")&&e==null)return;n==="access"||n==="optionalAccess"?(t=e,e=s(e)):(n==="call"||n==="optionalCall")&&(e=s((...o)=>e.call(t,...o)),t=void 0)}return e}const rA={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class nA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},rA,e),this.ease=da(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const r=this.options.underflow.toLowerCase();r==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=r.indexOf("left")!==-1?-1:r.indexOf("right")!==-1?1:0,this.underflowY=r.indexOf("top")!==-1?-1:r.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,r=typeof t.y>"u"?0:t.y,n=typeof t.width>"u"?this.parent.worldWidth:t.width,s=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>n,top:this.parent.top<r,bottom:this.parent.bottom>s,topLeft:new at(e*this.parent.scale.x,r*this.parent.scale.y),bottomRight:new at(n*this.parent.scale.x-this.parent.screenWidth,s*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new at(0,0),bottomRight:new at(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){if(this.paused)return;let t,e=this.parent.plugins.get("decelerate",!0);e&&(e.x||e.y)&&(e.x&&e.percentChangeX===js([e,"access",s=>s.options,"optionalAccess",s=>s.friction])||e.y&&e.percentChangeY===js([e,"access",s=>s.options,"optionalAccess",s=>s.friction]))&&(t=this.oob(),(t.left&&this.left||t.right&&this.right)&&(e.percentChangeX=this.options.friction),(t.top&&this.top||t.bottom&&this.bottom)&&(e.percentChangeY=this.options.friction));const r=this.parent.plugins.get("drag",!0)||{},n=this.parent.plugins.get("pinch",!0)||{};if(e=e||{},!js([r,"optionalAccess",s=>s.active])&&!js([n,"optionalAccess",s=>s.active])&&(!this.toX||!this.toY)&&(!e.x||!e.y)){t=t||this.oob();const s=t.topLeft,o=t.bottomRight;if(!this.toX&&!e.x){let a=null;t.left&&this.left?a=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-s.x:t.right&&this.right&&(a=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-o.x),a!==null&&this.parent.x!==a&&(this.toX={time:0,start:this.parent.x,delta:a-this.parent.x,end:a},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!e.y){let a=null;t.top&&this.top?a=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-s.y:t.bottom&&this.bottom&&(a=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-o.y),a!==null&&this.parent.y!==a&&(this.toY={time:0,start:this.parent.y,delta:a-this.parent.y,end:a},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const sA={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class oA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},sA,e),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t={x:this.parent.x,y:this.parent.y},e=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,r=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,r=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,r=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,e.x=0,r=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,r=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,r=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,r=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,e.y=0,r=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const aA={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class hA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},aA,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&e<this.options.minHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&e>this.options.maxHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const s=this.options.minScale;t.x=typeof s.x>"u"?null:s.x,t.y=typeof s.y>"u"?null:s.y}if(typeof this.options.maxScale=="number")e.x=this.options.maxScale,e.y=this.options.maxScale;else if(this.options.maxScale!==null){const s=this.options.maxScale;e.x=typeof s.x>"u"?null:s.x,e.y=typeof s.y>"u"?null:s.y}let r=this.parent.scale.x,n=this.parent.scale.y;t.x!==null&&r<t.x&&(r=t.x),e.x!==null&&r>e.x&&(r=e.x),t.y!==null&&n<t.y&&(n=t.y),e.y!==null&&n>e.y&&(n=e.y),(r!==this.parent.scale.x||n!==this.parent.scale.y)&&(this.parent.scale.set(r,n),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const lA={friction:.98,bounce:.8,minSpeed:.01},Di=16;class uA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},lA,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",r=>this.moved(r))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}moved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];t.type==="clamp-x"?e.x===t.original.x&&(e.x=this.parent.x):t.type==="clamp-y"&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const r=t-e.time;this.x=(this.parent.x-e.x)/r,this.y=(this.parent.y-e.y)/r,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,r=this.timeSinceRelease,n=this.timeSinceRelease+t;if(this.x){const s=this.percentChangeX,o=Math.log(s);this.parent.x+=this.x*Di/o*(Math.pow(s,n/Di)-Math.pow(s,r/Di)),this.x*=Math.pow(this.percentChangeX,t/Di)}if(this.y){const s=this.percentChangeY,o=Math.log(s);this.parent.y+=this.y*Di/o*(Math.pow(s,n/Di)-Math.pow(s,r/Di)),this.y*=Math.pow(this.percentChangeY,t/Di)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const cA={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class mu extends Ie{__init(){this.windowEventHandlers=new Array}constructor(t,e={}){super(t),mu.prototype.__init.call(this),this.options=Object.assign({},cA,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const e=n=>{t.includes(n.code)&&(this.keyIsPressed=!0)},r=n=>{t.includes(n.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",r),this.addWindowEventHandler("keydown",e)}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e=t.data.pointerType==="mouse",r=this.parent.input.count();return!!((r===1||r>1&&!this.parent.plugins.get("pinch",!0))&&(!e||this.mouse[t.data.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.data.global.x,y:t.data.global.y},this.current=t.data.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.data.global.x,r=t.data.global.y,n=this.parent.input.count();if(n===1||n>1&&!this.parent.plugins.get("pinch",!0)){const s=e-this.last.x,o=r-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(s)||this.yDirection&&this.parent.input.checkThreshold(o)){const a={x:e,y:r};return this.xDirection&&(this.parent.x+=(a.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(a.y-this.last.y)*this.options.factor),this.last=a,this.moved||this.parent.emit("drag-start",{event:t,screen:new at(this.last.x,this.last.y),world:this.parent.toWorld(new at(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(e.length===1){const r=e[0];return r.last&&(this.last={x:r.last.x,y:r.last.y},this.current=r.id),this.moved=!1,!0}else if(this.last&&this.moved){const r=new at(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:r,world:this.parent.toWorld(r),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const r=t.deltaMode?this.options.lineHeight:1,n=[t.deltaX,t.deltaY],[s,o]=this.options.wheelSwapAxes?n.reverse():n;return this.xDirection&&(this.parent.x+=s*r*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=o*r*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const dA={speed:0,acceleration:null,radius:null};class fA extends Ie{constructor(t,e,r={}){super(t),this.target=e,this.options=Object.assign({},dA,r),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let r=this.target.x,n=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius){const h=Math.atan2(this.target.y-e.y,this.target.x-e.x);r=this.target.x-Math.cos(h)*this.options.radius,n=this.target.y-Math.sin(h)*this.options.radius}else return;const s=r-e.x,o=n-e.y;if(s||o)if(this.options.speed)if(this.options.acceleration){const a=Math.atan2(n-e.y,r-e.x),h=Math.sqrt(Math.pow(s,2)+Math.pow(o,2));if(h){const l=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);h>l?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const u=Math.cos(a)*this.velocity.x,c=Math.sin(a)*this.velocity.y,d=Math.abs(u)>Math.abs(s)?r:e.x+u,f=Math.abs(c)>Math.abs(o)?n:e.y+c;this.parent.moveCenter(d,f),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const a=Math.atan2(n-e.y,r-e.x),h=Math.cos(a)*this.options.speed,l=Math.sin(a)*this.options.speed,u=Math.abs(h)>Math.abs(s)?r:e.x+h,c=Math.abs(l)>Math.abs(o)?n:e.y+l;this.parent.moveCenter(u,c),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(r,n),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const pA={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class gA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},pA,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.data.pointerType!=="mouse"&&t.data.identifier!==1||!this.options.allowButtons&&t.data.buttons!==0)return!1;const e=t.data.global.x,r=t.data.global.y;if(this.radiusSquared){const n=this.parent.toScreen(this.parent.center);if(Math.pow(n.x-e,2)+Math.pow(n.y-r,2)>=this.radiusSquared){const o=Math.atan2(n.y-r,n.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(o))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(o))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(o)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(o)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&r<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&r>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const mA={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class Yn extends Ie{__init(){this.active=!1}__init2(){this.pinching=!1}__init3(){this.moved=!1}constructor(t,e={}){super(t),Yn.prototype.__init.call(this),Yn.prototype.__init2.call(this),Yn.prototype.__init3.call(this),this.options=Object.assign({},mA,e)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.data.global.x,r=t.data.global.y,n=this.parent.input.touches;if(n.length>=2){const s=n[0],o=n[1],a=s.last&&o.last?Math.sqrt(Math.pow(o.last.x-s.last.x,2)+Math.pow(o.last.y-s.last.y,2)):null;if(s.id===t.data.pointerId?s.last={x:e,y:r,data:t.data}:o.id===t.data.pointerId&&(o.last={x:e,y:r,data:t.data}),a){let h;const l={x:s.last.x+(o.last.x-s.last.x)/2,y:s.last.y+(o.last.y-s.last.y)/2};this.options.center||(h=this.parent.toLocal(l));let u=Math.sqrt(Math.pow(o.last.x-s.last.x,2)+Math.pow(o.last.y-s.last.y,2));u=u===0?u=1e-10:u;const c=(1-a/u)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=c),this.isAxisY()&&(this.parent.scale.y+=c),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:l});const d=this.parent.plugins.get("clamp-zoom",!0);if(d&&d.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const f=this.parent.toGlobal(h);this.parent.x+=(l.x-f.x)*this.options.factor,this.parent.y+=(l.y-f.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(l.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(l.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=l,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}}const yA={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class vA extends Ie{constructor(t,e,r,n={}){super(t),this.options=Object.assign({},yA,n),this.ease=da(n.ease,"easeInOutSine"),this.x=e,this.y=r,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const e=this.snapping;e.time+=t;let r,n,s;const o=this.startX,a=this.startY,h=this.deltaX,l=this.deltaY;if(e.time>this.options.time)r=!0,n=o+h,s=a+l;else{const u=this.ease(e.time,0,1,this.options.time);n=o+h*u,s=a+l*u}this.options.topLeft?this.parent.moveCorner(n,s):this.parent.moveCenter(n,s),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),r&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const e=this.options.topLeft?this.parent.corner:this.parent.center;(e.x!==this.x||e.y!==this.y)&&this.snapStart()}}}const _A={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class xA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},_A,e),this.ease=da(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,r=this.parent.screenWidth/this.xScale,n=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:r-t,deltaY:n-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const r=this.snapping;if(r.time+=t,r.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const s=this.snapping,o=this.ease(s.time,s.startX,s.deltaX,this.options.time),a=this.ease(s.time,s.startY,s.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/o,this.parent.scale.y=this.parent.screenHeight/a}const n=this.parent.plugins.get("clamp-zoom",!0);n&&n.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}resume(){this.snapping=null,super.resume()}}const wA={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class bA extends Ie{constructor(t,e={}){super(t),this.options=Object.assign({},wA,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let r;this.options.center||(r=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const s=this.parent.toGlobal(r);this.parent.x+=t.x-s.x,this.parent.y+=t.y-s.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),r=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,n=Math.pow(2,(1+this.options.percent)*r);let s;this.options.center||(s=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(s);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel",{wheel:{dx:t.deltaX,dy:t.deltaY,dz:t.deltaZ},event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),n=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,s=Math.pow(2,(1+this.options.percent)*n);if(this.options.smooth){const o={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+o.x)*s-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+o.y)*s-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let o;this.options.center||(o=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=s),this.isAxisY()&&(this.parent.scale.y*=s),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const a=this.parent.plugins.get("clamp-zoom",!0);if(a&&a.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const h=this.parent.toGlobal(o);this.parent.x+=e.x-h.x,this.parent.y+=e.y-h.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel",{wheel:{dx:t.deltaX,dy:t.deltaY,dz:t.deltaZ},event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class EA{constructor(t){this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new dt(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.on("pointerout",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.divWheel.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.divWheel.removeEventListener("wheel",this.wheelFunction)}down(t){if(this.viewport.pause||!this.viewport.worldVisible)return;if(t.data.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.data.pointerId)||this.touches.push({id:t.data.pointerId,last:null}),this.count()===1){this.last=t.data.global.clone();const r=this.viewport.plugins.get("decelerate",!0),n=this.viewport.plugins.get("bounce",!0);(!r||!r.isActive())&&(!n||!n.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const r=t.data.global.x-this.last.x,n=t.data.global.y-this.last.y;(this.checkThreshold(r)||this.checkThreshold(n))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;t.data.pointerType==="mouse"&&(this.isMouseDown=!1),t.data.pointerType!=="mouse"&&this.remove(t.data.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new at;if(this.viewport.options.interaction)this.viewport.options.interaction.mapPositionToPoint(e,t.clientX,t.clientY);else if(this.viewport.options.useDivWheelForInputManager&&this.viewport.options.divWheel){const r=this.viewport.options.divWheel.getBoundingClientRect();e.x=t.clientX-r.left,e.y=t.clientY-r.top}else e.x=t.clientX,e.y=t.clientY;return e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible||this.viewport.options.interaction&&this.viewport.options.interaction.interactionDOMElement!==t.target)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t){this.touches.splice(e,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}function Ys(i){let t,e=i[0],r=1;for(;r<i.length;){const n=i[r],s=i[r+1];if(r+=2,(n==="optionalAccess"||n==="optionalCall")&&e==null)return;n==="access"||n==="optionalAccess"?(t=e,e=s(e)):(n==="call"||n==="optionalCall")&&(e=s((...o)=>e.call(t,...o)),t=void 0)}return e}const Tn=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class AA{constructor(t){this.viewport=t,this.list=[],this.plugins={}}add(t,e,r=Tn.length){const n=this.plugins[t];n&&n.destroy(),this.plugins[t]=e;const s=Tn.indexOf(t);s!==-1&&Tn.splice(s,1),Tn.splice(r,0,t),this.sort()}get(t,e){return e&&Ys([this,"access",r=>r.plugins,"access",r=>r[t],"optionalAccess",r=>r.paused])?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){this.plugins[t]&&(Ys([this,"access",e=>e.plugins,"access",e=>e[t],"optionalAccess",e=>e.destroy,"call",e=>e()]),delete this.plugins[t],this.viewport.emit(`${t}-remove`),this.sort())}pause(t){Ys([this,"access",e=>e.plugins,"access",e=>e[t],"optionalAccess",e=>e.pause,"call",e=>e()])}resume(t){Ys([this,"access",e=>e.plugins,"access",e=>e[t],"optionalAccess",e=>e.resume,"call",e=>e()])}sort(){this.list=[];for(const t of Tn)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const r of this.list)r.down(t)&&(e=!0);return e}move(t){let e=!1;for(const r of this.viewport.plugins.list)r.move(t)&&(e=!0);return e}up(t){let e=!1;for(const r of this.list)r.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const r of this.list)r.wheel(t)&&(e=!0);return e}}const TA={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,interaction:null,disableOnContextMenu:!1,ticker:Ll.shared};class yu extends Jt{__init(){this._disableOnContextMenu=t=>t.preventDefault()}constructor(t={}){super(),yu.prototype.__init.call(this),this.options=Object.assign({},{divWheel:document.body},TA,t),this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.divWheel=this.options.divWheel||document.body,this.options.disableOnContextMenu&&this.options.divWheel.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new EA(this),this.plugins=new AA(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.divWheel.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new dt(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,r,n){this.screenWidth=t,this.screenHeight=e,typeof r<"u"&&(this._worldWidth=r),typeof n<"u"&&(this._worldHeight=n),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new dt(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return arguments.length===2?this.toLocal(new at(t,e)):this.toLocal(t)}toScreen(t,e){return arguments.length===2?this.toGlobal(new at(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new at(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,r;typeof t[0]=="number"?(e=t[0],r=t[1]):(e=t[0].x,r=t[0].y);const n=(this.worldScreenWidth/2-e)*this.scale.x,s=(this.worldScreenHeight/2-r)*this.scale.y;return(this.x!==n||this.y!==s)&&(this.position.set(n,s),this.plugins.reset(),this.dirty=!0),this}get corner(){return new at(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,r;return t.length===1?(e=-t[0].x*this.scale.x,r=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,r=-t[1]*this.scale.y),(e!==this.x||r!==this.y)&&(this.position.set(e,r),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const r=this.screenWidth/t,n=this.screenHeight/e;return Math.min(r,n)}findCover(t,e){const r=this.screenWidth/t,n=this.screenHeight/e;return Math.max(r,n)}fitWidth(t=this.worldWidth,e,r=!0,n){let s;e&&(s=this.center),this.scale.x=this.screenWidth/t,r&&(this.scale.y=this.scale.x);const o=this.plugins.get("clamp-zoom",!0);return!n&&o&&o.clamp(),e&&s&&this.moveCenter(s),this}fitHeight(t=this.worldHeight,e,r=!0,n){let s;e&&(s=this.center),this.scale.y=this.screenHeight/t,r&&(this.scale.x=this.scale.y);const o=this.plugins.get("clamp-zoom",!0);return!n&&o&&o.clamp(),e&&s&&this.moveCenter(s),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,r=this.worldHeight){let n;t&&(n=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/r,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&n&&this.moveCenter(n),this}setZoom(t,e){let r;e&&(r=this.center),this.scale.set(t);const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),e&&r&&this.moveCenter(r),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new xA(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new at(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new dt(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new mu(this,t)),this}clamp(t){return this.plugins.add("clamp",new oA(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new uA(this,t)),this}bounce(t){return this.plugins.add("bounce",new nA(this,t)),this}pinch(t){return this.plugins.add("pinch",new Yn(this,t)),this}snap(t,e,r){return this.plugins.add("snap",new vA(this,t,e,r)),this}follow(t,e){return this.plugins.add("follow",new fA(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new bA(this,t)),this}animate(t){return this.plugins.add("animate",new yi(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new hA(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new gA(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,r,n,s){s&&(r>this.worldScreenWidth||n>this.worldScreenHeight)&&(this.fit(!0,r,n),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let o=!1;t<this.left?(this.left=t,o=!0):t+r>this.right&&(this.right=t+r,o=!0),e<this.top?(this.top=e,o=!0):e+n>this.bottom&&(this.bottom=e+n,o=!0),o&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}function Jr(i,t){return i==null||t==null?NaN:i<t?-1:i>t?1:i>=t?0:NaN}function SA(i,t){return i==null||t==null?NaN:t<i?-1:t>i?1:t>=i?0:NaN}function em(i){let t,e,r;i.length!==2?(t=Jr,e=(a,h)=>Jr(i(a),h),r=(a,h)=>i(a)-h):(t=i===Jr||i===SA?i:IA,e=i,r=i);function n(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<0?l=c+1:u=c}while(l<u)}return l}function s(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<=0?l=c+1:u=c}while(l<u)}return l}function o(a,h,l=0,u=a.length){const c=n(a,h,l,u-1);return c>l&&r(a[c-1],h)>-r(a[c],h)?c-1:c}return{left:n,center:o,right:s}}function IA(){return 0}function CA(i){return i===null?NaN:+i}const MA=em(Jr),RA=MA.right;em(CA).center;const PA=RA;function NA(i,t){let e,r;if(t===void 0)for(const n of i)n!=null&&(e===void 0?n>=n&&(e=r=n):(e>n&&(e=n),r<n&&(r=n)));else{let n=-1;for(let s of i)(s=t(s,++n,i))!=null&&(e===void 0?s>=s&&(e=r=s):(e>s&&(e=s),r<s&&(r=s)))}return[e,r]}class Bl extends Map{constructor(t,e=BA){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[r,n]of t)this.set(r,n)}get(t){return super.get(vf(this,t))}has(t){return super.has(vf(this,t))}set(t,e){return super.set(DA(this,t),e)}delete(t){return super.delete(LA(this,t))}}function vf({_intern:i,_key:t},e){const r=t(e);return i.has(r)?i.get(r):e}function DA({_intern:i,_key:t},e){const r=t(e);return i.has(r)?i.get(r):(i.set(r,e),e)}function LA({_intern:i,_key:t},e){const r=t(e);return i.has(r)&&(e=i.get(r),i.delete(r)),e}function BA(i){return i!==null&&typeof i=="object"?i.valueOf():i}function OA(i){return i}function kA(i,t,...e){return FA(i,OA,t,e)}function FA(i,t,e,r){return function n(s,o){if(o>=r.length)return e(s);const a=new Bl,h=r[o++];let l=-1;for(const u of s){const c=h(u,++l,s),d=a.get(c);d?d.push(u):a.set(c,[u])}for(const[u,c]of a)a.set(u,n(c,o));return t(a)}(i,0)}function UA(i,t){return Array.from(t,e=>i[e])}function GA(i,...t){if(typeof i[Symbol.iterator]!="function")throw new TypeError("values is not iterable");i=Array.from(i);let[e]=t;if(e&&e.length!==2||t.length>1){const r=Uint32Array.from(i,(n,s)=>s);return t.length>1?(t=t.map(n=>i.map(n)),r.sort((n,s)=>{for(const o of t){const a=Ol(o[n],o[s]);if(a)return a}})):(e=i.map(e),r.sort((n,s)=>Ol(e[n],e[s]))),UA(i,r)}return i.sort($A(e))}function $A(i=Jr){if(i===Jr)return Ol;if(typeof i!="function")throw new TypeError("compare is not a function");return(t,e)=>{const r=i(t,e);return r||r===0?r:(i(e,e)===0)-(i(t,t)===0)}}function Ol(i,t){return(i==null||!(i>=i))-(t==null||!(t>=t))||(i<t?-1:i>t?1:0)}const HA=Math.sqrt(50),WA=Math.sqrt(10),zA=Math.sqrt(2);function Fo(i,t,e){const r=(t-i)/Math.max(0,e),n=Math.floor(Math.log10(r)),s=r/Math.pow(10,n),o=s>=HA?10:s>=WA?5:s>=zA?2:1;let a,h,l;return n<0?(l=Math.pow(10,-n)/o,a=Math.round(i*l),h=Math.round(t*l),a/l<i&&++a,h/l>t&&--h,l=-l):(l=Math.pow(10,n)*o,a=Math.round(i/l),h=Math.round(t/l),a*l<i&&++a,h*l>t&&--h),h<a&&.5<=e&&e<2?Fo(i,t,e*2):[a,h,l]}function XA(i,t,e){if(t=+t,i=+i,e=+e,!(e>0))return[];if(i===t)return[i];const r=t<i,[n,s,o]=r?Fo(t,i,e):Fo(i,t,e);if(!(s>=n))return[];const a=s-n+1,h=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)h[l]=(s-l)/-o;else for(let l=0;l<a;++l)h[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)h[l]=(n+l)/-o;else for(let l=0;l<a;++l)h[l]=(n+l)*o;return h}function kl(i,t,e){return t=+t,i=+i,e=+e,Fo(i,t,e)[2]}function VA(i,t,e){t=+t,i=+i,e=+e;const r=t<i,n=r?kl(t,i,e):kl(i,t,e);return(r?-1:1)*(n<0?1/-n:n)}function jA(i,t){let e;if(t===void 0)for(const r of i)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let n of i)(n=t(n,++r,i))!=null&&(e<n||e===void 0&&n>=n)&&(e=n)}return e}function We(i,t){if(typeof i[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof t!="function")throw new TypeError("mapper is not a function");return Array.from(i,(e,r)=>t(e,r,i))}var YA={value:()=>{}};function vu(){for(var i=0,t=arguments.length,e={},r;i<t;++i){if(!(r=arguments[i]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new po(e)}function po(i){this._=i}function qA(i,t){return i.trim().split(/^|\s+/).map(function(e){var r="",n=e.indexOf(".");if(n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}po.prototype=vu.prototype={constructor:po,on:function(i,t){var e=this._,r=qA(i+"",e),n,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((n=(i=r[s]).type)&&(n=KA(e[n],i.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(i=r[s]).type)e[n]=_f(e[n],i.name,t);else if(t==null)for(n in e)e[n]=_f(e[n],i.name,null);return this},copy:function(){var i={},t=this._;for(var e in t)i[e]=t[e].slice();return new po(i)},call:function(i,t){if((n=arguments.length-2)>0)for(var e=new Array(n),r=0,n,s;r<n;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(s=this._[i],r=0,n=s.length;r<n;++r)s[r].value.apply(t,e)},apply:function(i,t,e){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var r=this._[i],n=0,s=r.length;n<s;++n)r[n].value.apply(t,e)}};function KA(i,t){for(var e=0,r=i.length,n;e<r;++e)if((n=i[e]).name===t)return n.value}function _f(i,t,e){for(var r=0,n=i.length;r<n;++r)if(i[r].name===t){i[r]=YA,i=i.slice(0,r).concat(i.slice(r+1));break}return e!=null&&i.push({name:t,value:e}),i}var Fl="http://www.w3.org/1999/xhtml";const xf={svg:"http://www.w3.org/2000/svg",xhtml:Fl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function fa(i){var t=i+="",e=t.indexOf(":");return e>=0&&(t=i.slice(0,e))!=="xmlns"&&(i=i.slice(e+1)),xf.hasOwnProperty(t)?{space:xf[t],local:i}:i}function ZA(i){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Fl&&t.documentElement.namespaceURI===Fl?t.createElement(i):t.createElementNS(e,i)}}function QA(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function im(i){var t=fa(i);return(t.local?QA:ZA)(t)}function JA(){}function _u(i){return i==null?JA:function(){return this.querySelector(i)}}function tT(i){typeof i!="function"&&(i=_u(i));for(var t=this._groups,e=t.length,r=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=r[n]=new Array(o),h,l,u=0;u<o;++u)(h=s[u])&&(l=i.call(h,h.__data__,u,s))&&("__data__"in h&&(l.__data__=h.__data__),a[u]=l);return new de(r,this._parents)}function rm(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function eT(){return[]}function nm(i){return i==null?eT:function(){return this.querySelectorAll(i)}}function iT(i){return function(){return rm(i.apply(this,arguments))}}function rT(i){typeof i=="function"?i=iT(i):i=nm(i);for(var t=this._groups,e=t.length,r=[],n=[],s=0;s<e;++s)for(var o=t[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&(r.push(i.call(h,h.__data__,l,o)),n.push(h));return new de(r,n)}function sm(i){return function(){return this.matches(i)}}function om(i){return function(t){return t.matches(i)}}var nT=Array.prototype.find;function sT(i){return function(){return nT.call(this.children,i)}}function oT(){return this.firstElementChild}function aT(i){return this.select(i==null?oT:sT(typeof i=="function"?i:om(i)))}var hT=Array.prototype.filter;function lT(){return Array.from(this.children)}function uT(i){return function(){return hT.call(this.children,i)}}function cT(i){return this.selectAll(i==null?lT:uT(typeof i=="function"?i:om(i)))}function dT(i){typeof i!="function"&&(i=sm(i));for(var t=this._groups,e=t.length,r=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=r[n]=[],h,l=0;l<o;++l)(h=s[l])&&i.call(h,h.__data__,l,s)&&a.push(h);return new de(r,this._parents)}function am(i){return new Array(i.length)}function fT(){return new de(this._enter||this._groups.map(am),this._parents)}function Uo(i,t){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=t}Uo.prototype={constructor:Uo,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,t){return this._parent.insertBefore(i,t)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function pT(i){return function(){return i}}function gT(i,t,e,r,n,s){for(var o=0,a,h=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):e[o]=new Uo(i,s[o]);for(;o<h;++o)(a=t[o])&&(n[o]=a)}function mT(i,t,e,r,n,s,o){var a,h,l=new Map,u=t.length,c=s.length,d=new Array(u),f;for(a=0;a<u;++a)(h=t[a])&&(d[a]=f=o.call(h,h.__data__,a,t)+"",l.has(f)?n[a]=h:l.set(f,h));for(a=0;a<c;++a)f=o.call(i,s[a],a,s)+"",(h=l.get(f))?(r[a]=h,h.__data__=s[a],l.delete(f)):e[a]=new Uo(i,s[a]);for(a=0;a<u;++a)(h=t[a])&&l.get(d[a])===h&&(n[a]=h)}function yT(i){return i.__data__}function vT(i,t){if(!arguments.length)return Array.from(this,yT);var e=t?mT:gT,r=this._parents,n=this._groups;typeof i!="function"&&(i=pT(i));for(var s=n.length,o=new Array(s),a=new Array(s),h=new Array(s),l=0;l<s;++l){var u=r[l],c=n[l],d=c.length,f=_T(i.call(u,u&&u.__data__,l,r)),p=f.length,g=a[l]=new Array(p),m=o[l]=new Array(p),y=h[l]=new Array(d);e(u,c,g,m,y,f,t);for(var _=0,v=0,x,A;_<p;++_)if(x=g[_]){for(_>=v&&(v=_+1);!(A=m[v])&&++v<p;);x._next=A||null}}return o=new de(o,r),o._enter=a,o._exit=h,o}function _T(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function xT(){return new de(this._exit||this._groups.map(am),this._parents)}function wT(i,t,e){var r=this.enter(),n=this,s=this.exit();return typeof i=="function"?(r=i(r),r&&(r=r.selection())):r=r.append(i+""),t!=null&&(n=t(n),n&&(n=n.selection())),e==null?s.remove():e(s),r&&n?r.merge(n).order():n}function bT(i){for(var t=i.selection?i.selection():i,e=this._groups,r=t._groups,n=e.length,s=r.length,o=Math.min(n,s),a=new Array(n),h=0;h<o;++h)for(var l=e[h],u=r[h],c=l.length,d=a[h]=new Array(c),f,p=0;p<c;++p)(f=l[p]||u[p])&&(d[p]=f);for(;h<n;++h)a[h]=e[h];return new de(a,this._parents)}function ET(){for(var i=this._groups,t=-1,e=i.length;++t<e;)for(var r=i[t],n=r.length-1,s=r[n],o;--n>=0;)(o=r[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function AT(i){i||(i=TT);function t(c,d){return c&&d?i(c.__data__,d.__data__):!c-!d}for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s){for(var o=e[s],a=o.length,h=n[s]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(h[u]=l);h.sort(t)}return new de(n,this._parents).order()}function TT(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function ST(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function IT(){return Array.from(this)}function CT(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var r=i[t],n=0,s=r.length;n<s;++n){var o=r[n];if(o)return o}return null}function MT(){let i=0;for(const t of this)++i;return i}function RT(){return!this.node()}function PT(i){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,o=n.length,a;s<o;++s)(a=n[s])&&i.call(a,a.__data__,s,n);return this}function NT(i){return function(){this.removeAttribute(i)}}function DT(i){return function(){this.removeAttributeNS(i.space,i.local)}}function LT(i,t){return function(){this.setAttribute(i,t)}}function BT(i,t){return function(){this.setAttributeNS(i.space,i.local,t)}}function OT(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(i):this.setAttribute(i,e)}}function kT(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,e)}}function FT(i,t){var e=fa(i);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((t==null?e.local?DT:NT:typeof t=="function"?e.local?kT:OT:e.local?BT:LT)(e,t))}function hm(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function UT(i){return function(){this.style.removeProperty(i)}}function GT(i,t,e){return function(){this.style.setProperty(i,t,e)}}function $T(i,t,e){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(i):this.style.setProperty(i,r,e)}}function HT(i,t,e){return arguments.length>1?this.each((t==null?UT:typeof t=="function"?$T:GT)(i,t,e??"")):an(this.node(),i)}function an(i,t){return i.style.getPropertyValue(t)||hm(i).getComputedStyle(i,null).getPropertyValue(t)}function WT(i){return function(){delete this[i]}}function zT(i,t){return function(){this[i]=t}}function XT(i,t){return function(){var e=t.apply(this,arguments);e==null?delete this[i]:this[i]=e}}function VT(i,t){return arguments.length>1?this.each((t==null?WT:typeof t=="function"?XT:zT)(i,t)):this.node()[i]}function lm(i){return i.trim().split(/^|\s+/)}function xu(i){return i.classList||new um(i)}function um(i){this._node=i,this._names=lm(i.getAttribute("class")||"")}um.prototype={add:function(i){var t=this._names.indexOf(i);t<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var t=this._names.indexOf(i);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function cm(i,t){for(var e=xu(i),r=-1,n=t.length;++r<n;)e.add(t[r])}function dm(i,t){for(var e=xu(i),r=-1,n=t.length;++r<n;)e.remove(t[r])}function jT(i){return function(){cm(this,i)}}function YT(i){return function(){dm(this,i)}}function qT(i,t){return function(){(t.apply(this,arguments)?cm:dm)(this,i)}}function KT(i,t){var e=lm(i+"");if(arguments.length<2){for(var r=xu(this.node()),n=-1,s=e.length;++n<s;)if(!r.contains(e[n]))return!1;return!0}return this.each((typeof t=="function"?qT:t?jT:YT)(e,t))}function ZT(){this.textContent=""}function QT(i){return function(){this.textContent=i}}function JT(i){return function(){var t=i.apply(this,arguments);this.textContent=t??""}}function tS(i){return arguments.length?this.each(i==null?ZT:(typeof i=="function"?JT:QT)(i)):this.node().textContent}function eS(){this.innerHTML=""}function iS(i){return function(){this.innerHTML=i}}function rS(i){return function(){var t=i.apply(this,arguments);this.innerHTML=t??""}}function nS(i){return arguments.length?this.each(i==null?eS:(typeof i=="function"?rS:iS)(i)):this.node().innerHTML}function sS(){this.nextSibling&&this.parentNode.appendChild(this)}function oS(){return this.each(sS)}function aS(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function hS(){return this.each(aS)}function lS(i){var t=typeof i=="function"?i:im(i);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function uS(){return null}function cS(i,t){var e=typeof i=="function"?i:im(i),r=t==null?uS:typeof t=="function"?t:_u(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function dS(){var i=this.parentNode;i&&i.removeChild(this)}function fS(){return this.each(dS)}function pS(){var i=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function gS(){var i=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function mS(i){return this.select(i?gS:pS)}function yS(i){return arguments.length?this.property("__data__",i):this.node().__data__}function vS(i){return function(t){i.call(this,t,this.__data__)}}function _S(i){return i.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}})}function xS(i){return function(){var t=this.__on;if(t){for(var e=0,r=-1,n=t.length,s;e<n;++e)s=t[e],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function wS(i,t,e){return function(){var r=this.__on,n,s=vS(t);if(r){for(var o=0,a=r.length;o<a;++o)if((n=r[o]).type===i.type&&n.name===i.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=e),n.value=t;return}}this.addEventListener(i.type,s,e),n={type:i.type,name:i.name,value:t,listener:s,options:e},r?r.push(n):this.__on=[n]}}function bS(i,t,e){var r=_S(i+""),n,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,l=a.length,u;h<l;++h)for(n=0,u=a[h];n<s;++n)if((o=r[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?wS:xS,n=0;n<s;++n)this.each(a(r[n],t,e));return this}function fm(i,t,e){var r=hm(i),n=r.CustomEvent;typeof n=="function"?n=new n(t,e):(n=r.document.createEvent("Event"),e?(n.initEvent(t,e.bubbles,e.cancelable),n.detail=e.detail):n.initEvent(t,!1,!1)),i.dispatchEvent(n)}function ES(i,t){return function(){return fm(this,i,t)}}function AS(i,t){return function(){return fm(this,i,t.apply(this,arguments))}}function TS(i,t){return this.each((typeof t=="function"?AS:ES)(i,t))}function*SS(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var r=i[t],n=0,s=r.length,o;n<s;++n)(o=r[n])&&(yield o)}var wu=[null];function de(i,t){this._groups=i,this._parents=t}function fs(){return new de([[document.documentElement]],wu)}function IS(){return this}de.prototype=fs.prototype={constructor:de,select:tT,selectAll:rT,selectChild:aT,selectChildren:cT,filter:dT,data:vT,enter:fT,exit:xT,join:wT,merge:bT,selection:IS,order:ET,sort:AT,call:ST,nodes:IT,node:CT,size:MT,empty:RT,each:PT,attr:FT,style:HT,property:VT,classed:KT,text:tS,html:nS,raise:oS,lower:hS,append:lS,insert:cS,remove:fS,clone:mS,datum:yS,on:bS,dispatch:TS,[Symbol.iterator]:SS};function $t(i){return typeof i=="string"?new de([[document.querySelector(i)]],[document.documentElement]):new de([[i]],wu)}function Eh(i){return typeof i=="string"?new de([document.querySelectorAll(i)],[document.documentElement]):new de([rm(i)],wu)}function bu(i,t,e){i.prototype=t.prototype=e,e.constructor=i}function pm(i,t){var e=Object.create(i.prototype);for(var r in t)e[r]=t[r];return e}function ps(){}var es=.7,Go=1/es,tn="\\s*([+-]?\\d+)\\s*",is="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ii="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",CS=/^#([0-9a-f]{3,8})$/,MS=new RegExp(`^rgb\\(${tn},${tn},${tn}\\)$`),RS=new RegExp(`^rgb\\(${ii},${ii},${ii}\\)$`),PS=new RegExp(`^rgba\\(${tn},${tn},${tn},${is}\\)$`),NS=new RegExp(`^rgba\\(${ii},${ii},${ii},${is}\\)$`),DS=new RegExp(`^hsl\\(${is},${ii},${ii}\\)$`),LS=new RegExp(`^hsla\\(${is},${ii},${ii},${is}\\)$`),wf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bu(ps,mr,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:bf,formatHex:bf,formatHex8:BS,formatHsl:OS,formatRgb:Ef,toString:Ef});function bf(){return this.rgb().formatHex()}function BS(){return this.rgb().formatHex8()}function OS(){return gm(this).formatHsl()}function Ef(){return this.rgb().formatRgb()}function mr(i){var t,e;return i=(i+"").trim().toLowerCase(),(t=CS.exec(i))?(e=t[1].length,t=parseInt(t[1],16),e===6?Af(t):e===3?new me(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?qs(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?qs(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=MS.exec(i))?new me(t[1],t[2],t[3],1):(t=RS.exec(i))?new me(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=PS.exec(i))?qs(t[1],t[2],t[3],t[4]):(t=NS.exec(i))?qs(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=DS.exec(i))?If(t[1],t[2]/100,t[3]/100,1):(t=LS.exec(i))?If(t[1],t[2]/100,t[3]/100,t[4]):wf.hasOwnProperty(i)?Af(wf[i]):i==="transparent"?new me(NaN,NaN,NaN,0):null}function Af(i){return new me(i>>16&255,i>>8&255,i&255,1)}function qs(i,t,e,r){return r<=0&&(i=t=e=NaN),new me(i,t,e,r)}function kS(i){return i instanceof ps||(i=mr(i)),i?(i=i.rgb(),new me(i.r,i.g,i.b,i.opacity)):new me}function Ul(i,t,e,r){return arguments.length===1?kS(i):new me(i,t,e,r??1)}function me(i,t,e,r){this.r=+i,this.g=+t,this.b=+e,this.opacity=+r}bu(me,Ul,pm(ps,{brighter(i){return i=i==null?Go:Math.pow(Go,i),new me(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?es:Math.pow(es,i),new me(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new me(dr(this.r),dr(this.g),dr(this.b),$o(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Tf,formatHex:Tf,formatHex8:FS,formatRgb:Sf,toString:Sf}));function Tf(){return`#${hr(this.r)}${hr(this.g)}${hr(this.b)}`}function FS(){return`#${hr(this.r)}${hr(this.g)}${hr(this.b)}${hr((isNaN(this.opacity)?1:this.opacity)*255)}`}function Sf(){const i=$o(this.opacity);return`${i===1?"rgb(":"rgba("}${dr(this.r)}, ${dr(this.g)}, ${dr(this.b)}${i===1?")":`, ${i})`}`}function $o(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function dr(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function hr(i){return i=dr(i),(i<16?"0":"")+i.toString(16)}function If(i,t,e,r){return r<=0?i=t=e=NaN:e<=0||e>=1?i=t=NaN:t<=0&&(i=NaN),new Be(i,t,e,r)}function gm(i){if(i instanceof Be)return new Be(i.h,i.s,i.l,i.opacity);if(i instanceof ps||(i=mr(i)),!i)return new Be;if(i instanceof Be)return i;i=i.rgb();var t=i.r/255,e=i.g/255,r=i.b/255,n=Math.min(t,e,r),s=Math.max(t,e,r),o=NaN,a=s-n,h=(s+n)/2;return a?(t===s?o=(e-r)/a+(e<r)*6:e===s?o=(r-t)/a+2:o=(t-e)/a+4,a/=h<.5?s+n:2-s-n,o*=60):a=h>0&&h<1?0:o,new Be(o,a,h,i.opacity)}function US(i,t,e,r){return arguments.length===1?gm(i):new Be(i,t,e,r??1)}function Be(i,t,e,r){this.h=+i,this.s=+t,this.l=+e,this.opacity=+r}bu(Be,US,pm(ps,{brighter(i){return i=i==null?Go:Math.pow(Go,i),new Be(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?es:Math.pow(es,i),new Be(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,t=isNaN(i)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,n=2*e-r;return new me(Ah(i>=240?i-240:i+120,n,r),Ah(i,n,r),Ah(i<120?i+240:i-120,n,r),this.opacity)},clamp(){return new Be(Cf(this.h),Ks(this.s),Ks(this.l),$o(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=$o(this.opacity);return`${i===1?"hsl(":"hsla("}${Cf(this.h)}, ${Ks(this.s)*100}%, ${Ks(this.l)*100}%${i===1?")":`, ${i})`}`}}));function Cf(i){return i=(i||0)%360,i<0?i+360:i}function Ks(i){return Math.max(0,Math.min(1,i||0))}function Ah(i,t,e){return(i<60?t+(e-t)*i/60:i<180?e:i<240?t+(e-t)*(240-i)/60:t)*255}const Eu=i=>()=>i;function GS(i,t){return function(e){return i+e*t}}function $S(i,t,e){return i=Math.pow(i,e),t=Math.pow(t,e)-i,e=1/e,function(r){return Math.pow(i+r*t,e)}}function HS(i){return(i=+i)==1?mm:function(t,e){return e-t?$S(t,e,i):Eu(isNaN(t)?e:t)}}function mm(i,t){var e=t-i;return e?GS(i,e):Eu(isNaN(i)?t:i)}const Ho=function i(t){var e=HS(t);function r(n,s){var o=e((n=Ul(n)).r,(s=Ul(s)).r),a=e(n.g,s.g),h=e(n.b,s.b),l=mm(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=h(u),n.opacity=l(u),n+""}}return r.gamma=i,r}(1);function WS(i,t){t||(t=[]);var e=i?Math.min(t.length,i.length):0,r=t.slice(),n;return function(s){for(n=0;n<e;++n)r[n]=i[n]*(1-s)+t[n]*s;return r}}function zS(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function XS(i,t){var e=t?t.length:0,r=i?Math.min(e,i.length):0,n=new Array(r),s=new Array(e),o;for(o=0;o<r;++o)n[o]=Au(i[o],t[o]);for(;o<e;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=n[o](a);return s}}function VS(i,t){var e=new Date;return i=+i,t=+t,function(r){return e.setTime(i*(1-r)+t*r),e}}function De(i,t){return i=+i,t=+t,function(e){return i*(1-e)+t*e}}function jS(i,t){var e={},r={},n;(i===null||typeof i!="object")&&(i={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in i?e[n]=Au(i[n],t[n]):r[n]=t[n];return function(s){for(n in e)r[n]=e[n](s);return r}}var Gl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Th=new RegExp(Gl.source,"g");function YS(i){return function(){return i}}function qS(i){return function(t){return i(t)+""}}function ym(i,t){var e=Gl.lastIndex=Th.lastIndex=0,r,n,s,o=-1,a=[],h=[];for(i=i+"",t=t+"";(r=Gl.exec(i))&&(n=Th.exec(t));)(s=n.index)>e&&(s=t.slice(e,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,h.push({i:o,x:De(r,n)})),e=Th.lastIndex;return e<t.length&&(s=t.slice(e),a[o]?a[o]+=s:a[++o]=s),a.length<2?h[0]?qS(h[0].x):YS(t):(t=h.length,function(l){for(var u=0,c;u<t;++u)a[(c=h[u]).i]=c.x(l);return a.join("")})}function Au(i,t){var e=typeof t,r;return t==null||e==="boolean"?Eu(t):(e==="number"?De:e==="string"?(r=mr(t))?(t=r,Ho):ym:t instanceof mr?Ho:t instanceof Date?VS:zS(t)?WS:Array.isArray(t)?XS:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?jS:De)(i,t)}function KS(i,t){return i=+i,t=+t,function(e){return Math.round(i*(1-e)+t*e)}}var Mf=180/Math.PI,$l={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function vm(i,t,e,r,n,s){var o,a,h;return(o=Math.sqrt(i*i+t*t))&&(i/=o,t/=o),(h=i*e+t*r)&&(e-=i*h,r-=t*h),(a=Math.sqrt(e*e+r*r))&&(e/=a,r/=a,h/=a),i*r<t*e&&(i=-i,t=-t,h=-h,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(t,i)*Mf,skewX:Math.atan(h)*Mf,scaleX:o,scaleY:a}}var Zs;function ZS(i){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return t.isIdentity?$l:vm(t.a,t.b,t.c,t.d,t.e,t.f)}function QS(i){return i==null||(Zs||(Zs=document.createElementNS("http://www.w3.org/2000/svg","g")),Zs.setAttribute("transform",i),!(i=Zs.transform.baseVal.consolidate()))?$l:(i=i.matrix,vm(i.a,i.b,i.c,i.d,i.e,i.f))}function _m(i,t,e,r){function n(l){return l.length?l.pop()+" ":""}function s(l,u,c,d,f,p){if(l!==c||u!==d){var g=f.push("translate(",null,t,null,e);p.push({i:g-4,x:De(l,c)},{i:g-2,x:De(u,d)})}else(c||d)&&f.push("translate("+c+t+d+e)}function o(l,u,c,d){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),d.push({i:c.push(n(c)+"rotate(",null,r)-2,x:De(l,u)})):u&&c.push(n(c)+"rotate("+u+r)}function a(l,u,c,d){l!==u?d.push({i:c.push(n(c)+"skewX(",null,r)-2,x:De(l,u)}):u&&c.push(n(c)+"skewX("+u+r)}function h(l,u,c,d,f,p){if(l!==c||u!==d){var g=f.push(n(f)+"scale(",null,",",null,")");p.push({i:g-4,x:De(l,c)},{i:g-2,x:De(u,d)})}else(c!==1||d!==1)&&f.push(n(f)+"scale("+c+","+d+")")}return function(l,u){var c=[],d=[];return l=i(l),u=i(u),s(l.translateX,l.translateY,u.translateX,u.translateY,c,d),o(l.rotate,u.rotate,c,d),a(l.skewX,u.skewX,c,d),h(l.scaleX,l.scaleY,u.scaleX,u.scaleY,c,d),l=u=null,function(f){for(var p=-1,g=d.length,m;++p<g;)c[(m=d[p]).i]=m.x(f);return c.join("")}}}var JS=_m(ZS,"px, ","px)","deg)"),tI=_m(QS,", ",")",")"),hn=0,Fn=0,Sn=0,xm=1e3,Wo,Un,zo=0,yr=0,pa=0,rs=typeof performance=="object"&&performance.now?performance:Date,wm=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Tu(){return yr||(wm(eI),yr=rs.now()+pa)}function eI(){yr=0}function Xo(){this._call=this._time=this._next=null}Xo.prototype=Su.prototype={constructor:Xo,restart:function(i,t,e){if(typeof i!="function")throw new TypeError("callback is not a function");e=(e==null?Tu():+e)+(t==null?0:+t),!this._next&&Un!==this&&(Un?Un._next=this:Wo=this,Un=this),this._call=i,this._time=e,Hl()},stop:function(){this._call&&(this._call=null,this._time=1/0,Hl())}};function Su(i,t,e){var r=new Xo;return r.restart(i,t,e),r}function iI(){Tu(),++hn;for(var i=Wo,t;i;)(t=yr-i._time)>=0&&i._call.call(void 0,t),i=i._next;--hn}function Rf(){yr=(zo=rs.now())+pa,hn=Fn=0;try{iI()}finally{hn=0,nI(),yr=0}}function rI(){var i=rs.now(),t=i-zo;t>xm&&(pa-=t,zo=i)}function nI(){for(var i,t=Wo,e,r=1/0;t;)t._call?(r>t._time&&(r=t._time),i=t,t=t._next):(e=t._next,t._next=null,t=i?i._next=e:Wo=e);Un=i,Hl(r)}function Hl(i){if(!hn){Fn&&(Fn=clearTimeout(Fn));var t=i-yr;t>24?(i<1/0&&(Fn=setTimeout(Rf,i-rs.now()-pa)),Sn&&(Sn=clearInterval(Sn))):(Sn||(zo=rs.now(),Sn=setInterval(rI,xm)),hn=1,wm(Rf))}}function Pf(i,t,e){var r=new Xo;return t=t==null?0:+t,r.restart(n=>{r.stop(),i(n+t)},t,e),r}var sI=vu("start","end","cancel","interrupt"),oI=[],bm=0,Nf=1,Wl=2,go=3,Df=4,zl=5,mo=6;function ga(i,t,e,r,n,s){var o=i.__transition;if(!o)i.__transition={};else if(e in o)return;aI(i,e,{name:t,index:r,group:n,on:sI,tween:oI,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:bm})}function Iu(i,t){var e=Ue(i,t);if(e.state>bm)throw new Error("too late; already scheduled");return e}function ai(i,t){var e=Ue(i,t);if(e.state>go)throw new Error("too late; already running");return e}function Ue(i,t){var e=i.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function aI(i,t,e){var r=i.__transition,n;r[t]=e,e.timer=Su(s,0,e.time);function s(l){e.state=Nf,e.timer.restart(o,e.delay,e.time),e.delay<=l&&o(l-e.delay)}function o(l){var u,c,d,f;if(e.state!==Nf)return h();for(u in r)if(f=r[u],f.name===e.name){if(f.state===go)return Pf(o);f.state===Df?(f.state=mo,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete r[u]):+u<t&&(f.state=mo,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete r[u])}if(Pf(function(){e.state===go&&(e.state=Df,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=Wl,e.on.call("start",i,i.__data__,e.index,e.group),e.state===Wl){for(e.state=go,n=new Array(d=e.tween.length),u=0,c=-1;u<d;++u)(f=e.tween[u].value.call(i,i.__data__,e.index,e.group))&&(n[++c]=f);n.length=c+1}}function a(l){for(var u=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(h),e.state=zl,1),c=-1,d=n.length;++c<d;)n[c].call(i,u);e.state===zl&&(e.on.call("end",i,i.__data__,e.index,e.group),h())}function h(){e.state=mo,e.timer.stop(),delete r[t];for(var l in r)return;delete i.__transition}}function hI(i,t){var e=i.__transition,r,n,s=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((r=e[o]).name!==t){s=!1;continue}n=r.state>Wl&&r.state<zl,r.state=mo,r.timer.stop(),r.on.call(n?"interrupt":"cancel",i,i.__data__,r.index,r.group),delete e[o]}s&&delete i.__transition}}function lI(i){return this.each(function(){hI(this,i)})}function uI(i,t){var e,r;return function(){var n=ai(this,i),s=n.tween;if(s!==e){r=e=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}n.tween=r}}function cI(i,t,e){var r,n;if(typeof e!="function")throw new Error;return function(){var s=ai(this,i),o=s.tween;if(o!==r){n=(r=o).slice();for(var a={name:t,value:e},h=0,l=n.length;h<l;++h)if(n[h].name===t){n[h]=a;break}h===l&&n.push(a)}s.tween=n}}function dI(i,t){var e=this._id;if(i+="",arguments.length<2){for(var r=Ue(this.node(),e).tween,n=0,s=r.length,o;n<s;++n)if((o=r[n]).name===i)return o.value;return null}return this.each((t==null?uI:cI)(e,i,t))}function Cu(i,t,e){var r=i._id;return i.each(function(){var n=ai(this,r);(n.value||(n.value={}))[t]=e.apply(this,arguments)}),function(n){return Ue(n,r).value[t]}}function Em(i,t){var e;return(typeof t=="number"?De:t instanceof mr?Ho:(e=mr(t))?(t=e,Ho):ym)(i,t)}function fI(i){return function(){this.removeAttribute(i)}}function pI(i){return function(){this.removeAttributeNS(i.space,i.local)}}function gI(i,t,e){var r,n=e+"",s;return function(){var o=this.getAttribute(i);return o===n?null:o===r?s:s=t(r=o,e)}}function mI(i,t,e){var r,n=e+"",s;return function(){var o=this.getAttributeNS(i.space,i.local);return o===n?null:o===r?s:s=t(r=o,e)}}function yI(i,t,e){var r,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(i):(o=this.getAttribute(i),h=a+"",o===h?null:o===r&&h===n?s:(n=h,s=t(r=o,a)))}}function vI(i,t,e){var r,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(i.space,i.local):(o=this.getAttributeNS(i.space,i.local),h=a+"",o===h?null:o===r&&h===n?s:(n=h,s=t(r=o,a)))}}function _I(i,t){var e=fa(i),r=e==="transform"?tI:Em;return this.attrTween(i,typeof t=="function"?(e.local?vI:yI)(e,r,Cu(this,"attr."+i,t)):t==null?(e.local?pI:fI)(e):(e.local?mI:gI)(e,r,t))}function xI(i,t){return function(e){this.setAttribute(i,t.call(this,e))}}function wI(i,t){return function(e){this.setAttributeNS(i.space,i.local,t.call(this,e))}}function bI(i,t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&wI(i,s)),e}return n._value=t,n}function EI(i,t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&xI(i,s)),e}return n._value=t,n}function AI(i,t){var e="attr."+i;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var r=fa(i);return this.tween(e,(r.local?bI:EI)(r,t))}function TI(i,t){return function(){Iu(this,i).delay=+t.apply(this,arguments)}}function SI(i,t){return t=+t,function(){Iu(this,i).delay=t}}function II(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?TI:SI)(t,i)):Ue(this.node(),t).delay}function CI(i,t){return function(){ai(this,i).duration=+t.apply(this,arguments)}}function MI(i,t){return t=+t,function(){ai(this,i).duration=t}}function RI(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?CI:MI)(t,i)):Ue(this.node(),t).duration}function PI(i,t){if(typeof t!="function")throw new Error;return function(){ai(this,i).ease=t}}function NI(i){var t=this._id;return arguments.length?this.each(PI(t,i)):Ue(this.node(),t).ease}function DI(i,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;ai(this,i).ease=e}}function LI(i){if(typeof i!="function")throw new Error;return this.each(DI(this._id,i))}function BI(i){typeof i!="function"&&(i=sm(i));for(var t=this._groups,e=t.length,r=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=r[n]=[],h,l=0;l<o;++l)(h=s[l])&&i.call(h,h.__data__,l,s)&&a.push(h);return new Mi(r,this._parents,this._name,this._id)}function OI(i){if(i._id!==this._id)throw new Error;for(var t=this._groups,e=i._groups,r=t.length,n=e.length,s=Math.min(r,n),o=new Array(r),a=0;a<s;++a)for(var h=t[a],l=e[a],u=h.length,c=o[a]=new Array(u),d,f=0;f<u;++f)(d=h[f]||l[f])&&(c[f]=d);for(;a<r;++a)o[a]=t[a];return new Mi(o,this._parents,this._name,this._id)}function kI(i){return(i+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function FI(i,t,e){var r,n,s=kI(t)?Iu:ai;return function(){var o=s(this,i),a=o.on;a!==r&&(n=(r=a).copy()).on(t,e),o.on=n}}function UI(i,t){var e=this._id;return arguments.length<2?Ue(this.node(),e).on.on(i):this.each(FI(e,i,t))}function GI(i){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==i)return;t&&t.removeChild(this)}}function $I(){return this.on("end.remove",GI(this._id))}function HI(i){var t=this._name,e=this._id;typeof i!="function"&&(i=_u(i));for(var r=this._groups,n=r.length,s=new Array(n),o=0;o<n;++o)for(var a=r[o],h=a.length,l=s[o]=new Array(h),u,c,d=0;d<h;++d)(u=a[d])&&(c=i.call(u,u.__data__,d,a))&&("__data__"in u&&(c.__data__=u.__data__),l[d]=c,ga(l[d],t,e,d,l,Ue(u,e)));return new Mi(s,this._parents,t,e)}function WI(i){var t=this._name,e=this._id;typeof i!="function"&&(i=nm(i));for(var r=this._groups,n=r.length,s=[],o=[],a=0;a<n;++a)for(var h=r[a],l=h.length,u,c=0;c<l;++c)if(u=h[c]){for(var d=i.call(u,u.__data__,c,h),f,p=Ue(u,e),g=0,m=d.length;g<m;++g)(f=d[g])&&ga(f,t,e,g,d,p);s.push(d),o.push(u)}return new Mi(s,o,t,e)}var zI=fs.prototype.constructor;function XI(){return new zI(this._groups,this._parents)}function VI(i,t){var e,r,n;return function(){var s=an(this,i),o=(this.style.removeProperty(i),an(this,i));return s===o?null:s===e&&o===r?n:n=t(e=s,r=o)}}function Am(i){return function(){this.style.removeProperty(i)}}function jI(i,t,e){var r,n=e+"",s;return function(){var o=an(this,i);return o===n?null:o===r?s:s=t(r=o,e)}}function YI(i,t,e){var r,n,s;return function(){var o=an(this,i),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(i),an(this,i))),o===h?null:o===r&&h===n?s:(n=h,s=t(r=o,a))}}function qI(i,t){var e,r,n,s="style."+t,o="end."+s,a;return function(){var h=ai(this,i),l=h.on,u=h.value[s]==null?a||(a=Am(t)):void 0;(l!==e||n!==u)&&(r=(e=l).copy()).on(o,n=u),h.on=r}}function KI(i,t,e){var r=(i+="")=="transform"?JS:Em;return t==null?this.styleTween(i,VI(i,r)).on("end.style."+i,Am(i)):typeof t=="function"?this.styleTween(i,YI(i,r,Cu(this,"style."+i,t))).each(qI(this._id,i)):this.styleTween(i,jI(i,r,t),e).on("end.style."+i,null)}function ZI(i,t,e){return function(r){this.style.setProperty(i,t.call(this,r),e)}}function QI(i,t,e){var r,n;function s(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&ZI(i,o,e)),r}return s._value=t,s}function JI(i,t,e){var r="style."+(i+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,QI(i,t,e??""))}function tC(i){return function(){this.textContent=i}}function eC(i){return function(){var t=i(this);this.textContent=t??""}}function iC(i){return this.tween("text",typeof i=="function"?eC(Cu(this,"text",i)):tC(i==null?"":i+""))}function rC(i){return function(t){this.textContent=i.call(this,t)}}function nC(i){var t,e;function r(){var n=i.apply(this,arguments);return n!==e&&(t=(e=n)&&rC(n)),t}return r._value=i,r}function sC(i){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(i==null)return this.tween(t,null);if(typeof i!="function")throw new Error;return this.tween(t,nC(i))}function oC(){for(var i=this._name,t=this._id,e=Tm(),r=this._groups,n=r.length,s=0;s<n;++s)for(var o=r[s],a=o.length,h,l=0;l<a;++l)if(h=o[l]){var u=Ue(h,t);ga(h,i,e,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Mi(r,this._parents,i,e)}function aC(){var i,t,e=this,r=e._id,n=e.size();return new Promise(function(s,o){var a={value:o},h={value:function(){--n===0&&s()}};e.each(function(){var l=ai(this,r),u=l.on;u!==i&&(t=(i=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),l.on=t}),n===0&&s()})}var hC=0;function Mi(i,t,e,r){this._groups=i,this._parents=t,this._name=e,this._id=r}function Tm(){return++hC}var gi=fs.prototype;Mi.prototype={constructor:Mi,select:HI,selectAll:WI,selectChild:gi.selectChild,selectChildren:gi.selectChildren,filter:BI,merge:OI,selection:XI,transition:oC,call:gi.call,nodes:gi.nodes,node:gi.node,size:gi.size,empty:gi.empty,each:gi.each,on:UI,attr:_I,attrTween:AI,style:KI,styleTween:JI,text:iC,textTween:sC,remove:$I,tween:dI,delay:II,duration:RI,ease:NI,easeVarying:LI,end:aC,[Symbol.iterator]:gi[Symbol.iterator]};function lC(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var uC={time:null,delay:0,duration:250,ease:lC};function cC(i,t){for(var e;!(e=i.__transition)||!(e=e[t]);)if(!(i=i.parentNode))throw new Error(`transition ${t} not found`);return e}function dC(i){var t,e;i instanceof Mi?(t=i._id,i=i._name):(t=Tm(),(e=uC).time=Tu(),i=i==null?null:i+"");for(var r=this._groups,n=r.length,s=0;s<n;++s)for(var o=r[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&ga(h,i,t,l,o,e||cC(h,t));return new Mi(r,this._parents,i,t)}fs.prototype.interrupt=lI;fs.prototype.transition=dC;function fC(i){const t=+this._x.call(null,i),e=+this._y.call(null,i);return Sm(this.cover(t,e),t,e,i)}function Sm(i,t,e,r){if(isNaN(t)||isNaN(e))return i;var n,s=i._root,o={data:r},a=i._x0,h=i._y0,l=i._x1,u=i._y1,c,d,f,p,g,m,y,_;if(!s)return i._root=o,i;for(;s.length;)if((g=t>=(c=(a+l)/2))?a=c:l=c,(m=e>=(d=(h+u)/2))?h=d:u=d,n=s,!(s=s[y=m<<1|g]))return n[y]=o,i;if(f=+i._x.call(null,s.data),p=+i._y.call(null,s.data),t===f&&e===p)return o.next=s,n?n[y]=o:i._root=o,i;do n=n?n[y]=new Array(4):i._root=new Array(4),(g=t>=(c=(a+l)/2))?a=c:l=c,(m=e>=(d=(h+u)/2))?h=d:u=d;while((y=m<<1|g)===(_=(p>=d)<<1|f>=c));return n[_]=s,n[y]=o,i}function pC(i){var t,e,r=i.length,n,s,o=new Array(r),a=new Array(r),h=1/0,l=1/0,u=-1/0,c=-1/0;for(e=0;e<r;++e)isNaN(n=+this._x.call(null,t=i[e]))||isNaN(s=+this._y.call(null,t))||(o[e]=n,a[e]=s,n<h&&(h=n),n>u&&(u=n),s<l&&(l=s),s>c&&(c=s));if(h>u||l>c)return this;for(this.cover(h,l).cover(u,c),e=0;e<r;++e)Sm(this,o[e],a[e],i[e]);return this}function gC(i,t){if(isNaN(i=+i)||isNaN(t=+t))return this;var e=this._x0,r=this._y0,n=this._x1,s=this._y1;if(isNaN(e))n=(e=Math.floor(i))+1,s=(r=Math.floor(t))+1;else{for(var o=n-e||1,a=this._root,h,l;e>i||i>=n||r>t||t>=s;)switch(l=(t<r)<<1|i<e,h=new Array(4),h[l]=a,a=h,o*=2,l){case 0:n=e+o,s=r+o;break;case 1:e=n-o,s=r+o;break;case 2:n=e+o,r=s-o;break;case 3:e=n-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=r,this._x1=n,this._y1=s,this}function mC(){var i=[];return this.visit(function(t){if(!t.length)do i.push(t.data);while(t=t.next)}),i}function yC(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function le(i,t,e,r,n){this.node=i,this.x0=t,this.y0=e,this.x1=r,this.y1=n}function vC(i,t,e){var r,n=this._x0,s=this._y0,o,a,h,l,u=this._x1,c=this._y1,d=[],f=this._root,p,g;for(f&&d.push(new le(f,n,s,u,c)),e==null?e=1/0:(n=i-e,s=t-e,u=i+e,c=t+e,e*=e);p=d.pop();)if(!(!(f=p.node)||(o=p.x0)>u||(a=p.y0)>c||(h=p.x1)<n||(l=p.y1)<s))if(f.length){var m=(o+h)/2,y=(a+l)/2;d.push(new le(f[3],m,y,h,l),new le(f[2],o,y,m,l),new le(f[1],m,a,h,y),new le(f[0],o,a,m,y)),(g=(t>=y)<<1|i>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var _=i-+this._x.call(null,f.data),v=t-+this._y.call(null,f.data),x=_*_+v*v;if(x<e){var A=Math.sqrt(e=x);n=i-A,s=t-A,u=i+A,c=t+A,r=f.data}}return r}function _C(i){if(isNaN(u=+this._x.call(null,i))||isNaN(c=+this._y.call(null,i)))return this;var t,e=this._root,r,n,s,o=this._x0,a=this._y0,h=this._x1,l=this._y1,u,c,d,f,p,g,m,y;if(!e)return this;if(e.length)for(;;){if((p=u>=(d=(o+h)/2))?o=d:h=d,(g=c>=(f=(a+l)/2))?a=f:l=f,t=e,!(e=e[m=g<<1|p]))return this;if(!e.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(r=t,y=m)}for(;e.data!==i;)if(n=e,!(e=e.next))return this;return(s=e.next)&&delete e.next,n?(s?n.next=s:delete n.next,this):t?(s?t[m]=s:delete t[m],(e=t[0]||t[1]||t[2]||t[3])&&e===(t[3]||t[2]||t[1]||t[0])&&!e.length&&(r?r[y]=e:this._root=e),this):(this._root=s,this)}function xC(i){for(var t=0,e=i.length;t<e;++t)this.remove(i[t]);return this}function wC(){return this._root}function bC(){var i=0;return this.visit(function(t){if(!t.length)do++i;while(t=t.next)}),i}function EC(i){var t=[],e,r=this._root,n,s,o,a,h;for(r&&t.push(new le(r,this._x0,this._y0,this._x1,this._y1));e=t.pop();)if(!i(r=e.node,s=e.x0,o=e.y0,a=e.x1,h=e.y1)&&r.length){var l=(s+a)/2,u=(o+h)/2;(n=r[3])&&t.push(new le(n,l,u,a,h)),(n=r[2])&&t.push(new le(n,s,u,l,h)),(n=r[1])&&t.push(new le(n,l,o,a,u)),(n=r[0])&&t.push(new le(n,s,o,l,u))}return this}function AC(i){var t=[],e=[],r;for(this._root&&t.push(new le(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var n=r.node;if(n.length){var s,o=r.x0,a=r.y0,h=r.x1,l=r.y1,u=(o+h)/2,c=(a+l)/2;(s=n[0])&&t.push(new le(s,o,a,u,c)),(s=n[1])&&t.push(new le(s,u,a,h,c)),(s=n[2])&&t.push(new le(s,o,c,u,l)),(s=n[3])&&t.push(new le(s,u,c,h,l))}e.push(r)}for(;r=e.pop();)i(r.node,r.x0,r.y0,r.x1,r.y1);return this}function TC(i){return i[0]}function SC(i){return arguments.length?(this._x=i,this):this._x}function IC(i){return i[1]}function CC(i){return arguments.length?(this._y=i,this):this._y}function Mu(i,t,e){var r=new Ru(t??TC,e??IC,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function Ru(i,t,e,r,n,s){this._x=i,this._y=t,this._x0=e,this._y0=r,this._x1=n,this._y1=s,this._root=void 0}function Lf(i){for(var t={data:i.data},e=t;i=i.next;)e=e.next={data:i.data};return t}var fe=Mu.prototype=Ru.prototype;fe.copy=function(){var i=new Ru(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,e,r;if(!t)return i;if(!t.length)return i._root=Lf(t),i;for(e=[{source:t,target:i._root=new Array(4)}];t=e.pop();)for(var n=0;n<4;++n)(r=t.source[n])&&(r.length?e.push({source:r,target:t.target[n]=new Array(4)}):t.target[n]=Lf(r));return i};fe.add=fC;fe.addAll=pC;fe.cover=gC;fe.data=mC;fe.extent=yC;fe.find=vC;fe.remove=_C;fe.removeAll=xC;fe.root=wC;fe.size=bC;fe.visit=EC;fe.visitAfter=AC;fe.x=SC;fe.y=CC;function ce(i){return function(){return i}}function Gi(i){return(i()-.5)*1e-6}function MC(i){return i.x+i.vx}function RC(i){return i.y+i.vy}function PC(i){var t,e,r,n=1,s=1;typeof i!="function"&&(i=ce(i==null?1:+i));function o(){for(var l,u=t.length,c,d,f,p,g,m,y=0;y<s;++y)for(c=Mu(t,MC,RC).visitAfter(a),l=0;l<u;++l)d=t[l],g=e[d.index],m=g*g,f=d.x+d.vx,p=d.y+d.vy,c.visit(_);function _(v,x,A,N,S){var T=v.data,C=v.r,k=g+C;if(T){if(T.index>d.index){var O=f-T.x-T.vx,M=p-T.y-T.vy,E=O*O+M*M;E<k*k&&(O===0&&(O=Gi(r),E+=O*O),M===0&&(M=Gi(r),E+=M*M),E=(k-(E=Math.sqrt(E)))/E*n,d.vx+=(O*=E)*(k=(C*=C)/(m+C)),d.vy+=(M*=E)*k,T.vx-=O*(k=1-k),T.vy-=M*k)}return}return x>f+k||N<f-k||A>p+k||S<p-k}}function a(l){if(l.data)return l.r=e[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function h(){if(t){var l,u=t.length,c;for(e=new Array(u),l=0;l<u;++l)c=t[l],e[c.index]=+i(c,l,t)}}return o.initialize=function(l,u){t=l,r=u,h()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(n=+l,o):n},o.radius=function(l){return arguments.length?(i=typeof l=="function"?l:ce(+l),h(),o):i},o}function NC(i){return i.index}function Bf(i,t){var e=i.get(t);if(!e)throw new Error("node not found: "+t);return e}function DC(i){var t=NC,e=c,r,n=ce(30),s,o,a,h,l,u=1;i==null&&(i=[]);function c(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,_=i.length;y<u;++y)for(var v=0,x,A,N,S,T,C,k;v<_;++v)x=i[v],A=x.source,N=x.target,S=N.x+N.vx-A.x-A.vx||Gi(l),T=N.y+N.vy-A.y-A.vy||Gi(l),C=Math.sqrt(S*S+T*T),C=(C-s[v])/C*m*r[v],S*=C,T*=C,N.vx-=S*(k=h[v]),N.vy-=T*k,A.vx+=S*(k=1-k),A.vy+=T*k}function f(){if(o){var m,y=o.length,_=i.length,v=new Map(o.map((A,N)=>[t(A,N,o),A])),x;for(m=0,a=new Array(y);m<_;++m)x=i[m],x.index=m,typeof x.source!="object"&&(x.source=Bf(v,x.source)),typeof x.target!="object"&&(x.target=Bf(v,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(m=0,h=new Array(_);m<_;++m)x=i[m],h[m]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);r=new Array(_),p(),s=new Array(_),g()}}function p(){if(o)for(var m=0,y=i.length;m<y;++m)r[m]=+e(i[m],m,i)}function g(){if(o)for(var m=0,y=i.length;m<y;++m)s[m]=+n(i[m],m,i)}return d.initialize=function(m,y){o=m,l=y,f()},d.links=function(m){return arguments.length?(i=m,f(),d):i},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(u=+m,d):u},d.strength=function(m){return arguments.length?(e=typeof m=="function"?m:ce(+m),p(),d):e},d.distance=function(m){return arguments.length?(n=typeof m=="function"?m:ce(+m),g(),d):n},d}const LC=1664525,BC=1013904223,Of=4294967296;function OC(){let i=1;return()=>(i=(LC*i+BC)%Of)/Of}function kC(i){return i.x}function FC(i){return i.y}var UC=10,GC=Math.PI*(3-Math.sqrt(5));function $C(i){var t,e=1,r=.001,n=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,h=Su(c),l=vu("tick","end"),u=OC();i==null&&(i=[]);function c(){d(),l.call("tick",t),e<r&&(h.stop(),l.call("end",t))}function d(g){var m,y=i.length,_;g===void 0&&(g=1);for(var v=0;v<g;++v)for(e+=(s-e)*n,a.forEach(function(x){x(e)}),m=0;m<y;++m)_=i[m],_.fx==null?_.x+=_.vx*=o:(_.x=_.fx,_.vx=0),_.fy==null?_.y+=_.vy*=o:(_.y=_.fy,_.vy=0);return t}function f(){for(var g=0,m=i.length,y;g<m;++g){if(y=i[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var _=UC*Math.sqrt(.5+g),v=g*GC;y.x=_*Math.cos(v),y.y=_*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(i,u),g}return f(),t={tick:d,restart:function(){return h.restart(c),t},stop:function(){return h.stop(),t},nodes:function(g){return arguments.length?(i=g,f(),a.forEach(p),t):i},alpha:function(g){return arguments.length?(e=+g,t):e},alphaMin:function(g){return arguments.length?(r=+g,t):r},alphaDecay:function(g){return arguments.length?(n=+g,t):+n},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(o=1-g,t):1-o},randomSource:function(g){return arguments.length?(u=g,a.forEach(p),t):u},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),t):a.get(g)},find:function(g,m,y){var _=0,v=i.length,x,A,N,S,T;for(y==null?y=1/0:y*=y,_=0;_<v;++_)S=i[_],x=g-S.x,A=m-S.y,N=x*x+A*A,N<y&&(T=S,y=N);return T},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function HC(){var i,t,e,r,n=ce(-30),s,o=1,a=1/0,h=.81;function l(f){var p,g=i.length,m=Mu(i,kC,FC).visitAfter(c);for(r=f,p=0;p<g;++p)t=i[p],m.visit(d)}function u(){if(i){var f,p=i.length,g;for(s=new Array(p),f=0;f<p;++f)g=i[f],s[g.index]=+n(g,f,i)}}function c(f){var p=0,g,m,y=0,_,v,x;if(f.length){for(_=v=x=0;x<4;++x)(g=f[x])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,_+=m*g.x,v+=m*g.y);f.x=_/y,f.y=v/y}else{g=f,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}f.value=p}function d(f,p,g,m){if(!f.value)return!0;var y=f.x-t.x,_=f.y-t.y,v=m-p,x=y*y+_*_;if(v*v/h<x)return x<a&&(y===0&&(y=Gi(e),x+=y*y),_===0&&(_=Gi(e),x+=_*_),x<o&&(x=Math.sqrt(o*x)),t.vx+=y*f.value*r/x,t.vy+=_*f.value*r/x),!0;if(f.length||x>=a)return;(f.data!==t||f.next)&&(y===0&&(y=Gi(e),x+=y*y),_===0&&(_=Gi(e),x+=_*_),x<o&&(x=Math.sqrt(o*x)));do f.data!==t&&(v=s[f.data.index]*r/x,t.vx+=y*v,t.vy+=_*v);while(f=f.next)}return l.initialize=function(f,p){i=f,e=p,u()},l.strength=function(f){return arguments.length?(n=typeof f=="function"?f:ce(+f),u(),l):n},l.distanceMin=function(f){return arguments.length?(o=f*f,l):Math.sqrt(o)},l.distanceMax=function(f){return arguments.length?(a=f*f,l):Math.sqrt(a)},l.theta=function(f){return arguments.length?(h=f*f,l):Math.sqrt(h)},l}function WC(i){var t=ce(.1),e,r,n;typeof i!="function"&&(i=ce(i==null?0:+i));function s(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vx+=(n[h]-u.x)*r[h]*a}function o(){if(e){var a,h=e.length;for(r=new Array(h),n=new Array(h),a=0;a<h;++a)r[a]=isNaN(n[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return s.initialize=function(a){e=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:ce(+a),o(),s):t},s.x=function(a){return arguments.length?(i=typeof a=="function"?a:ce(+a),o(),s):i},s}function zC(i){var t=ce(.1),e,r,n;typeof i!="function"&&(i=ce(i==null?0:+i));function s(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vy+=(n[h]-u.y)*r[h]*a}function o(){if(e){var a,h=e.length;for(r=new Array(h),n=new Array(h),a=0;a<h;++a)r[a]=isNaN(n[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return s.initialize=function(a){e=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:ce(+a),o(),s):t},s.y=function(a){return arguments.length?(i=typeof a=="function"?a:ce(+a),o(),s):i},s}function XC(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Vo(i,t){if((e=(i=t?i.toExponential(t-1):i.toExponential()).indexOf("e"))<0)return null;var e,r=i.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+i.slice(e+1)]}function ln(i){return i=Vo(Math.abs(i)),i?i[1]:NaN}function VC(i,t){return function(e,r){for(var n=e.length,s=[],o=0,a=i[0],h=0;n>0&&a>0&&(h+a+1>r&&(a=Math.max(1,r-h)),s.push(e.substring(n-=a,n+a)),!((h+=a+1)>r));)a=i[o=(o+1)%i.length];return s.reverse().join(t)}}function jC(i){return function(t){return t.replace(/[0-9]/g,function(e){return i[+e]})}}var YC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function jo(i){if(!(t=YC.exec(i)))throw new Error("invalid format: "+i);var t;return new Pu({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}jo.prototype=Pu.prototype;function Pu(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Pu.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function qC(i){t:for(var t=i.length,e=1,r=-1,n;e<t;++e)switch(i[e]){case".":r=n=e;break;case"0":r===0&&(r=e),n=e;break;default:if(!+i[e])break t;r>0&&(r=0);break}return r>0?i.slice(0,r)+i.slice(n+1):i}var Im;function KC(i,t){var e=Vo(i,t);if(!e)return i+"";var r=e[0],n=e[1],s=n-(Im=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Vo(i,Math.max(0,t+s-1))[0]}function kf(i,t){var e=Vo(i,t);if(!e)return i+"";var r=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+new Array(n-r.length+2).join("0")}const Ff={"%":(i,t)=>(i*100).toFixed(t),b:i=>Math.round(i).toString(2),c:i=>i+"",d:XC,e:(i,t)=>i.toExponential(t),f:(i,t)=>i.toFixed(t),g:(i,t)=>i.toPrecision(t),o:i=>Math.round(i).toString(8),p:(i,t)=>kf(i*100,t),r:kf,s:KC,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function Uf(i){return i}var Gf=Array.prototype.map,$f=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ZC(i){var t=i.grouping===void 0||i.thousands===void 0?Uf:VC(Gf.call(i.grouping,Number),i.thousands+""),e=i.currency===void 0?"":i.currency[0]+"",r=i.currency===void 0?"":i.currency[1]+"",n=i.decimal===void 0?".":i.decimal+"",s=i.numerals===void 0?Uf:jC(Gf.call(i.numerals,String)),o=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"":i.minus+"",h=i.nan===void 0?"NaN":i.nan+"";function l(c){c=jo(c);var d=c.fill,f=c.align,p=c.sign,g=c.symbol,m=c.zero,y=c.width,_=c.comma,v=c.precision,x=c.trim,A=c.type;A==="n"?(_=!0,A="g"):Ff[A]||(v===void 0&&(v=12),x=!0,A="g"),(m||d==="0"&&f==="=")&&(m=!0,d="0",f="=");var N=g==="$"?e:g==="#"&&/[boxX]/.test(A)?"0"+A.toLowerCase():"",S=g==="$"?r:/[%p]/.test(A)?o:"",T=Ff[A],C=/[defgprs%]/.test(A);v=v===void 0?6:/[gprs]/.test(A)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function k(O){var M=N,E=S,I,Q,et;if(A==="c")E=T(O)+E,O="";else{O=+O;var Y=O<0||1/O<0;if(O=isNaN(O)?h:T(Math.abs(O),v),x&&(O=qC(O)),Y&&+O==0&&p!=="+"&&(Y=!1),M=(Y?p==="("?p:a:p==="-"||p==="("?"":p)+M,E=(A==="s"?$f[8+Im/3]:"")+E+(Y&&p==="("?")":""),C){for(I=-1,Q=O.length;++I<Q;)if(et=O.charCodeAt(I),48>et||et>57){E=(et===46?n+O.slice(I+1):O.slice(I))+E,O=O.slice(0,I);break}}}_&&!m&&(O=t(O,1/0));var rt=M.length+O.length+E.length,gt=rt<y?new Array(y-rt+1).join(d):"";switch(_&&m&&(O=t(gt+O,gt.length?y-E.length:1/0),gt=""),f){case"<":O=M+O+E+gt;break;case"=":O=M+gt+O+E;break;case"^":O=gt.slice(0,rt=gt.length>>1)+M+O+E+gt.slice(rt);break;default:O=gt+M+O+E;break}return s(O)}return k.toString=function(){return c+""},k}function u(c,d){var f=l((c=jo(c),c.type="f",c)),p=Math.max(-8,Math.min(8,Math.floor(ln(d)/3)))*3,g=Math.pow(10,-p),m=$f[8+p/3];return function(y){return f(g*y)+m}}return{format:l,formatPrefix:u}}var Qs,Cm,Mm;QC({thousands:",",grouping:[3],currency:["$",""]});function QC(i){return Qs=ZC(i),Cm=Qs.format,Mm=Qs.formatPrefix,Qs}function JC(i){return Math.max(0,-ln(Math.abs(i)))}function tM(i,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ln(t)/3)))*3-ln(Math.abs(i)))}function eM(i,t){return i=Math.abs(i),t=Math.abs(t)-i,Math.max(0,ln(t)-ln(i))+1}function iM(i){var t=0,e=i.children,r=e&&e.length;if(!r)t=1;else for(;--r>=0;)t+=e[r].value;i.value=t}function rM(){return this.eachAfter(iM)}function nM(i,t){let e=-1;for(const r of this)i.call(t,r,++e,this);return this}function sM(i,t){for(var e=this,r=[e],n,s,o=-1;e=r.pop();)if(i.call(t,e,++o,this),n=e.children)for(s=n.length-1;s>=0;--s)r.push(n[s]);return this}function oM(i,t){for(var e=this,r=[e],n=[],s,o,a,h=-1;e=r.pop();)if(n.push(e),s=e.children)for(o=0,a=s.length;o<a;++o)r.push(s[o]);for(;e=n.pop();)i.call(t,e,++h,this);return this}function aM(i,t){let e=-1;for(const r of this)if(i.call(t,r,++e,this))return r}function hM(i){return this.eachAfter(function(t){for(var e=+i(t.data)||0,r=t.children,n=r&&r.length;--n>=0;)e+=r[n].value;t.value=e})}function lM(i){return this.eachBefore(function(t){t.children&&t.children.sort(i)})}function uM(i){for(var t=this,e=cM(t,i),r=[t];t!==e;)t=t.parent,r.push(t);for(var n=r.length;i!==e;)r.splice(n,0,i),i=i.parent;return r}function cM(i,t){if(i===t)return i;var e=i.ancestors(),r=t.ancestors(),n=null;for(i=e.pop(),t=r.pop();i===t;)n=i,i=e.pop(),t=r.pop();return n}function dM(){for(var i=this,t=[i];i=i.parent;)t.push(i);return t}function fM(){return Array.from(this)}function pM(){var i=[];return this.eachBefore(function(t){t.children||i.push(t)}),i}function gM(){var i=this,t=[];return i.each(function(e){e!==i&&t.push({source:e.parent,target:e})}),t}function*mM(){var i=this,t,e=[i],r,n,s;do for(t=e.reverse(),e=[];i=t.pop();)if(yield i,r=i.children)for(n=0,s=r.length;n<s;++n)e.push(r[n]);while(e.length)}function Rm(i,t){i instanceof Map?(i=[void 0,i],t===void 0&&(t=_M)):t===void 0&&(t=vM);for(var e=new ns(i),r,n=[e],s,o,a,h;r=n.pop();)if((o=t(r.data))&&(h=(o=Array.from(o)).length))for(r.children=o,a=h-1;a>=0;--a)n.push(s=o[a]=new ns(o[a])),s.parent=r,s.depth=r.depth+1;return e.eachBefore(Pm)}function yM(){return Rm(this).eachBefore(xM)}function vM(i){return i.children}function _M(i){return Array.isArray(i)?i[1]:null}function xM(i){i.data.value!==void 0&&(i.value=i.data.value),i.data=i.data.data}function Pm(i){var t=0;do i.height=t;while((i=i.parent)&&i.height<++t)}function ns(i){this.data=i,this.depth=this.height=0,this.parent=null}ns.prototype=Rm.prototype={constructor:ns,count:rM,each:nM,eachAfter:oM,eachBefore:sM,find:aM,sum:hM,sort:lM,path:uM,ancestors:dM,descendants:fM,leaves:pM,links:gM,copy:yM,[Symbol.iterator]:mM};function Sh(i){return i==null?null:wM(i)}function wM(i){if(typeof i!="function")throw new Error;return i}var bM={depth:-1},Hf={},Ih={};function EM(i){return i.id}function AM(i){return i.parentId}function TM(){var i=EM,t=AM,e;function r(n){var s=Array.from(n),o=i,a=t,h,l,u,c,d,f,p,g,m=new Map;if(e!=null){const y=s.map((x,A)=>SM(e(x,A,n))),_=y.map(Wf),v=new Set(y).add("");for(const x of _)v.has(x)||(v.add(x),y.push(x),_.push(Wf(x)),s.push(Ih));o=(x,A)=>y[A],a=(x,A)=>_[A]}for(u=0,h=s.length;u<h;++u)l=s[u],f=s[u]=new ns(l),(p=o(l,u,n))!=null&&(p+="")&&(g=f.id=p,m.set(g,m.has(g)?Hf:f)),(p=a(l,u,n))!=null&&(p+="")&&(f.parent=p);for(u=0;u<h;++u)if(f=s[u],p=f.parent){if(d=m.get(p),!d)throw new Error("missing: "+p);if(d===Hf)throw new Error("ambiguous: "+p);d.children?d.children.push(f):d.children=[f],f.parent=d}else{if(c)throw new Error("multiple roots");c=f}if(!c)throw new Error("no root");if(e!=null){for(;c.data===Ih&&c.children.length===1;)c=c.children[0],--h;for(let y=s.length-1;y>=0&&(f=s[y],f.data===Ih);--y)f.data=null}if(c.parent=bM,c.eachBefore(function(y){y.depth=y.parent.depth+1,--h}).eachBefore(Pm),c.parent=null,h>0)throw new Error("cycle");return c}return r.id=function(n){return arguments.length?(i=Sh(n),r):i},r.parentId=function(n){return arguments.length?(t=Sh(n),r):t},r.path=function(n){return arguments.length?(e=Sh(n),r):e},r}function SM(i){i=`${i}`;let t=i.length;return Xl(i,t-1)&&!Xl(i,t-2)&&(i=i.slice(0,-1)),i[0]==="/"?i:`/${i}`}function Wf(i){let t=i.length;if(t<2)return"";for(;--t>1&&!Xl(i,t););return i.slice(0,t)}function Xl(i,t){if(i[t]==="/"){let e=0;for(;t>0&&i[--t]==="\\";)++e;if(!(e&1))return!0}return!1}function Nm(i,t){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(t).domain(i);break}return this}const zf=Symbol("implicit");function Dm(){var i=new Bl,t=[],e=[],r=zf;function n(s){let o=i.get(s);if(o===void 0){if(r!==zf)return r;i.set(s,o=t.push(s)-1)}return e[o%e.length]}return n.domain=function(s){if(!arguments.length)return t.slice();t=[],i=new Bl;for(const o of s)i.has(o)||i.set(o,t.push(o)-1);return n},n.range=function(s){return arguments.length?(e=Array.from(s),n):e.slice()},n.unknown=function(s){return arguments.length?(r=s,n):r},n.copy=function(){return Dm(t,e).unknown(r)},Nm.apply(n,arguments),n}function IM(i){return function(){return i}}function CM(i){return+i}var Xf=[0,1];function $i(i){return i}function Vl(i,t){return(t-=i=+i)?function(e){return(e-i)/t}:IM(isNaN(t)?NaN:.5)}function MM(i,t){var e;return i>t&&(e=i,i=t,t=e),function(r){return Math.max(i,Math.min(t,r))}}function RM(i,t,e){var r=i[0],n=i[1],s=t[0],o=t[1];return n<r?(r=Vl(n,r),s=e(o,s)):(r=Vl(r,n),s=e(s,o)),function(a){return s(r(a))}}function PM(i,t,e){var r=Math.min(i.length,t.length)-1,n=new Array(r),s=new Array(r),o=-1;for(i[r]<i[0]&&(i=i.slice().reverse(),t=t.slice().reverse());++o<r;)n[o]=Vl(i[o],i[o+1]),s[o]=e(t[o],t[o+1]);return function(a){var h=PA(i,a,1,r)-1;return s[h](n[h](a))}}function NM(i,t){return t.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function DM(){var i=Xf,t=Xf,e=Au,r,n,s,o=$i,a,h,l;function u(){var d=Math.min(i.length,t.length);return o!==$i&&(o=MM(i[0],i[d-1])),a=d>2?PM:RM,h=l=null,c}function c(d){return d==null||isNaN(d=+d)?s:(h||(h=a(i.map(r),t,e)))(r(o(d)))}return c.invert=function(d){return o(n((l||(l=a(t,i.map(r),De)))(d)))},c.domain=function(d){return arguments.length?(i=Array.from(d,CM),u()):i.slice()},c.range=function(d){return arguments.length?(t=Array.from(d),u()):t.slice()},c.rangeRound=function(d){return t=Array.from(d),e=KS,u()},c.clamp=function(d){return arguments.length?(o=d?!0:$i,u()):o!==$i},c.interpolate=function(d){return arguments.length?(e=d,u()):e},c.unknown=function(d){return arguments.length?(s=d,c):s},function(d,f){return r=d,n=f,u()}}function LM(i,t,e,r){var n=VA(i,t,e),s;switch(r=jo(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(i),Math.abs(t));return r.precision==null&&!isNaN(s=tM(n,o))&&(r.precision=s),Mm(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=eM(n,Math.max(Math.abs(i),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=JC(n))&&(r.precision=s-(r.type==="%")*2);break}}return Cm(r)}function BM(i){var t=i.domain;return i.ticks=function(e){var r=t();return XA(r[0],r[r.length-1],e??10)},i.tickFormat=function(e,r){var n=t();return LM(n[0],n[n.length-1],e??10,r)},i.nice=function(e){e==null&&(e=10);var r=t(),n=0,s=r.length-1,o=r[n],a=r[s],h,l,u=10;for(a<o&&(l=o,o=a,a=l,l=n,n=s,s=l);u-- >0;){if(l=kl(o,a,e),l===h)return r[n]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;h=l}return i},i}function Vf(i){return function(t){return t<0?-Math.pow(-t,i):Math.pow(t,i)}}function OM(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function kM(i){return i<0?-i*i:i*i}function FM(i){var t=i($i,$i),e=1;function r(){return e===1?i($i,$i):e===.5?i(OM,kM):i(Vf(e),Vf(1/e))}return t.exponent=function(n){return arguments.length?(e=+n,r()):e},BM(t)}function Lm(){var i=FM(DM());return i.copy=function(){return NM(i,Lm()).exponent(i.exponent())},Nm.apply(i,arguments),i}function UM(){return Lm.apply(null,arguments).exponent(.5)}function GM(i){for(var t=i.length/6|0,e=new Array(t),r=0;r<t;)e[r]="#"+i.slice(r*6,++r*6);return e}const $M=GM("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function Gn(i,t,e){this.k=i,this.x=t,this.y=e}Gn.prototype={constructor:Gn,scale:function(i){return i===1?this:new Gn(this.k*i,this.x,this.y)},translate:function(i,t){return i===0&t===0?this:new Gn(this.k,this.x+this.k*i,this.y+this.k*t)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Gn.prototype;var Nu={},ma=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"},fn={},ya={};ya.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";ya.SYMBOL_SUPPORT=typeof Symbol<"u";var Bm=ya,HM=Bm.ARRAY_BUFFER_SUPPORT,WM=Bm.SYMBOL_SUPPORT,Du=function(t,e){var r,n,s,o,a;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||HM&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(s=0,o=t.length;s<o;s++)e(t[s],s);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(WM&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(r=t,s=0;a=r.next(),a.done!==!0;)e(a.value,s),s++;return}for(n in t)t.hasOwnProperty(n)&&e(t[n],n)},Om={};(function(i){var t=Math.pow(2,8)-1,e=Math.pow(2,16)-1,r=Math.pow(2,32)-1,n=Math.pow(2,7)-1,s=Math.pow(2,15)-1,o=Math.pow(2,31)-1;i.getPointerArray=function(h){var l=h-1;if(l<=t)return Uint8Array;if(l<=e)return Uint16Array;if(l<=r)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},i.getSignedPointerArray=function(h){var l=h-1;return l<=n?Int8Array:l<=s?Int16Array:l<=o?Int32Array:Float64Array},i.getNumberType=function(h){return h===(h|0)?Math.sign(h)===-1?h<=127&&h>=-128?Int8Array:h<=32767&&h>=-32768?Int16Array:Int32Array:h<=255?Uint8Array:h<=65535?Uint16Array:Uint32Array:Float64Array};var a={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};i.getMinimalRepresentation=function(h,l){var u=null,c=0,d,f,p,g,m;for(g=0,m=h.length;g<m;g++)p=l?l(h[g]):h[g],f=i.getNumberType(p),d=a[f.name],d>c&&(c=d,u=f);return u},i.isTypedArray=function(h){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(h)},i.concat=function(){var h=0,l,u,c;for(l=0,c=arguments.length;l<c;l++)h+=arguments[l].length;var d=new arguments[0].constructor(h);for(l=0,u=0;l<c;l++)d.set(arguments[l],u),u+=arguments[l].length;return d},i.indices=function(h){for(var l=i.getPointerArray(h),u=new l(h),c=0;c<h;c++)u[c]=c;return u}})(Om);var km=Du,Fm=Om;function zM(i){return Array.isArray(i)||Fm.isTypedArray(i)}function Lu(i){if(typeof i.length=="number")return i.length;if(typeof i.size=="number")return i.size}function XM(i){var t=Lu(i),e=typeof t=="number"?new Array(t):[],r=0;return km(i,function(n){e[r++]=n}),e}function VM(i){var t=Lu(i),e=typeof t=="number"?Fm.getPointerArray(t):Array,r=typeof t=="number"?new Array(t):[],n=typeof t=="number"?new e(t):[],s=0;return km(i,function(o){r[s]=o,n[s]=s++}),[r,n]}fn.isArrayLike=zM;fn.guessLength=Lu;fn.toArray=XM;fn.toArrayWithIndices=VM;function si(i){if(typeof i!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=i}typeof Symbol<"u"&&(si.prototype[Symbol.iterator]=function(){return this});si.of=function(){var i=arguments,t=i.length,e=0;return new si(function(){return e>=t?{done:!0}:{done:!1,value:i[e++]}})};si.empty=function(){var i=new si(function(){return{done:!0}});return i};si.fromSequence=function(i){var t=0,e=i.length;return new si(function(){return t>=e?{done:!0}:{done:!1,value:i[t++]}})};si.is=function(i){return i instanceof si?!0:typeof i=="object"&&i!==null&&typeof i.next=="function"};var gs=si;const Se=ss(gs);var Ch=fn,Um=gs;function Wt(i,t){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=i,this.capacity=t,this.items=new i(this.capacity),this.clear()}Wt.prototype.clear=function(){this.start=0,this.size=0};Wt.prototype.push=function(i){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var t=this.start+this.size;return t>=this.capacity&&(t-=this.capacity),this.items[t]=i,++this.size};Wt.prototype.unshift=function(i){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=i,this.start=t,++this.size};Wt.prototype.pop=function(){if(this.size!==0){this.size--;var i=this.start+this.size;return i>=this.capacity&&(i-=this.capacity),this.items[i]}};Wt.prototype.shift=function(){if(this.size!==0){var i=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[i]}};Wt.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};Wt.prototype.peekLast=function(){if(this.size!==0){var i=this.start+this.size-1;return i>=this.capacity&&(i-=this.capacity),this.items[i]}};Wt.prototype.get=function(i){if(!(this.size===0||i>=this.capacity))return i=this.start+i,i>=this.capacity&&(i-=this.capacity),this.items[i]};Wt.prototype.forEach=function(i,t){t=arguments.length>1?t:this;for(var e=this.capacity,r=this.size,n=this.start,s=0;s<r;)i.call(t,this.items[n],s,this),n++,s++,n===e&&(n=0)};Wt.prototype.toArray=function(){var i=this.start+this.size;if(i<this.capacity)return this.items.slice(this.start,i);for(var t=new this.ArrayClass(this.size),e=this.capacity,r=this.size,n=this.start,s=0;s<r;)t[s]=this.items[n],n++,s++,n===e&&(n=0);return t};Wt.prototype.values=function(){var i=this.items,t=this.capacity,e=this.size,r=this.start,n=0;return new Um(function(){if(n>=e)return{done:!0};var s=i[r];return r++,n++,r===t&&(r=0),{value:s,done:!1}})};Wt.prototype.entries=function(){var i=this.items,t=this.capacity,e=this.size,r=this.start,n=0;return new Um(function(){if(n>=e)return{done:!0};var s=i[r];return r++,r===t&&(r=0),{value:[n++,s],done:!1}})};typeof Symbol<"u"&&(Wt.prototype[Symbol.iterator]=Wt.prototype.values);Wt.prototype.inspect=function(){var i=this.toArray();return i.type=this.ArrayClass.name,i.capacity=this.capacity,Object.defineProperty(i,"constructor",{value:Wt,enumerable:!1}),i};typeof Symbol<"u"&&(Wt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Wt.prototype.inspect);Wt.from=function(i,t,e){if(arguments.length<3&&(e=Ch.guessLength(i),typeof e!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var r=new Wt(t,e);if(Ch.isArrayLike(i)){var n,s;for(n=0,s=i.length;n<s;n++)r.items[n]=i[n];return r.size=s,r}return Ch.forEach(i,function(o){r.push(o)}),r};var jM=Wt,YM=jM;function Vi(i){this.graph=i,this.queue=new YM(Array,i.order),this.seen=new Set,this.size=0}Vi.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};Vi.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};Vi.prototype.forEachNodeYetUnseen=function(i){var t=this.seen,e=this.graph;e.someNode(function(r,n){if(t.size===e.order)return!0;if(t.has(r))return!1;var s=i(r,n);return!!s})};Vi.prototype.has=function(i){return this.seen.has(i)};Vi.prototype.push=function(i){var t=this.seen.size;return this.seen.add(i),t===this.seen.size?!1:(this.queue.push(i),this.size++,!0)};Vi.prototype.pushWith=function(i,t){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.queue.push(t),this.size++,!0)};Vi.prototype.shift=function(){var i=this.queue.shift();return this.size=this.queue.size,i};var qM=Vi,Bu={};function KM(i,t,e){this.node=i,this.attributes=t,this.depth=e}function ZM(i){return i[0].toUpperCase()+i.slice(1)}Bu.TraversalRecord=KM;Bu.capitalize=ZM;var QM=ma,JM=qM,Gm=Bu,jf=Gm.TraversalRecord,tR=Gm.capitalize;function $m(i,t,e,r){if(r=r||{},!QM(i))throw new Error("graphology-traversal/bfs: expecting a graphology instance.");if(typeof e!="function")throw new Error("graphology-traversal/bfs: given callback is not a function.");if(i.order===0)return;var n=new JM(i),s=i["forEach"+tR(r.mode||"outbound")+"Neighbor"].bind(i),o;t===null?o=n.forEachNodeYetUnseen.bind(n):o=function(u){t=""+t,u(t,i.getNodeAttributes(t))};var a,h;function l(u,c){n.pushWith(u,new jf(u,c,a.depth+1))}o(function(u,c){for(n.pushWith(u,new jf(u,c,0));n.size!==0;)a=n.shift(),h=e(a.node,a.attributes,a.depth),h!==!0&&s(a.node,l)})}Nu.bfs=function(i,t,e){return $m(i,null,t,e)};Nu.bfsFromNode=$m;function br(i){this.graph=i,this.stack=new Array(i.order),this.seen=new Set,this.size=0}br.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};br.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};br.prototype.forEachNodeYetUnseen=function(i){var t=this.seen,e=this.graph;e.someNode(function(r,n){if(t.size===e.order)return!0;if(t.has(r))return!1;var s=i(r,n);return!!s})};br.prototype.has=function(i){return this.seen.has(i)};br.prototype.push=function(i){var t=this.seen.size;return this.seen.add(i),t===this.seen.size?!1:(this.stack[this.size++]=i,!0)};br.prototype.pushWith=function(i,t){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.stack[this.size++]=t,!0)};br.prototype.pop=function(){if(this.size!==0)return this.stack[--this.size]};var eR=Nu,Yf=eR.bfsFromNode,pn={},Hm=gs,iR=Du;function zt(){this.clear()}zt.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};zt.prototype.enqueue=function(i){return this.items.push(i),++this.size};zt.prototype.dequeue=function(){if(this.size){var i=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,i}};zt.prototype.peek=function(){if(this.size)return this.items[this.offset]};zt.prototype.forEach=function(i,t){t=arguments.length>1?t:this;for(var e=this.offset,r=0,n=this.items.length;e<n;e++,r++)i.call(t,this.items[e],r,this)};zt.prototype.toArray=function(){return this.items.slice(this.offset)};zt.prototype.values=function(){var i=this.items,t=this.offset;return new Hm(function(){if(t>=i.length)return{done:!0};var e=i[t];return t++,{value:e,done:!1}})};zt.prototype.entries=function(){var i=this.items,t=this.offset,e=0;return new Hm(function(){if(t>=i.length)return{done:!0};var r=i[t];return t++,{value:[e++,r],done:!1}})};typeof Symbol<"u"&&(zt.prototype[Symbol.iterator]=zt.prototype.values);zt.prototype.toString=function(){return this.toArray().join(",")};zt.prototype.toJSON=function(){return this.toArray()};zt.prototype.inspect=function(){var i=this.toArray();return Object.defineProperty(i,"constructor",{value:zt,enumerable:!1}),i};typeof Symbol<"u"&&(zt.prototype[Symbol.for("nodejs.util.inspect.custom")]=zt.prototype.inspect);zt.from=function(i){var t=new zt;return iR(i,function(e){t.enqueue(e)}),t};zt.of=function(){return zt.from(arguments)};var rR=zt,nR=function(t,e){var r=e.length;if(r!==0){var n=t.length;t.length+=r;for(var s=0;s<r;s++)t[n+s]=e[s]}},Ou=ma,sR=rR,oR=nR;function aR(i,t,e){if(!Ou(i))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<3)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 3.");if(!i.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');if(!i.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" target node does not exist in the given graph.');if(t=""+t,e=""+e,t===e)return[t];var r=i.inboundNeighbors.bind(i),n=i.outboundNeighbors.bind(i),s={},o={};s[t]=null,o[e]=null;var a=[t],h=[e],l,u,c,d,f,p,g,m,y=!1;t:for(;a.length&&h.length;)if(a.length<=h.length){for(l=a,a=[],f=0,g=l.length;f<g;f++)for(u=l[f],c=n(u),p=0,m=c.length;p<m;p++)if(d=c[p],d in s||(a.push(d),s[d]=u),d in o){y=!0;break t}}else for(l=h,h=[],f=0,g=l.length;f<g;f++)for(u=l[f],c=r(u),p=0,m=c.length;p<m;p++)if(d=c[p],d in o||(h.push(d),o[d]=u),d in s){y=!0;break t}if(!y)return null;for(var _=[];d;)_.unshift(d),d=s[d];for(d=o[_[_.length-1]];d;)_.push(d),d=o[d];return _.length?_:null}function hR(i,t){if(!Ou(i))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<2)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 2.");if(!i.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');t=""+t;var e={},r={},n,s,o,a,h,l;for(e[t]=!0,r[t]=[t];Object.keys(e).length;){n=e,e={};for(o in n)for(s=i.outboundNeighbors(o),h=0,l=s.length;h<l;h++)a=s[h],r[a]||(r[a]=r[o].concat(a),e[a]=!0)}return r}function Wm(i,t,e){if(!Ou(t))throw new Error("graphology-shortest-path: invalid graphology instance.");if(!t.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" source node does not exist in the given graph.');e=""+e;var r=new Set,n={},s=0;n[e]=0;for(var o=[e],a,h,l;o.length!==0;){var u=[];for(a=0,h=o.length;a<h;a++)l=o[a],!r.has(l)&&(r.add(l),oR(u,t[i](l)),n[l]=s);s++,o=u}return n}var lR=Wm.bind(null,"outboundNeighbors"),uR=Wm.bind(null,"neighbors");function cR(i,t){t=""+t;var e=[],r={},n={},s=i.nodes(),o,a,h,l,u,c,d,f,p;for(c=0,f=s.length;c<f;c++)l=s[c],r[l]=[],n[l]=0;var g={};n[t]=1,g[t]=0;for(var m=sR.of(t);m.size;)for(l=m.dequeue(),e.push(l),o=g[l],a=n[l],h=i.outboundNeighbors(l),d=0,p=h.length;d<p;d++)u=h[d],u in g||(m.enqueue(u),g[u]=o+1),g[u]===o+1&&(n[u]+=a,r[u].push(l));return[e,r,n]}pn.bidirectional=aR;pn.singleSource=hR;pn.singleSourceLength=lR;pn.undirectedSingleSourceLength=uR;pn.brandes=cR;var va={},ms={};function dR(i){return typeof i!="number"||isNaN(i)?1:i}function fR(i,t){var e={},r=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(r=t);var n=function(o){return r(o[i])},s=function(){return r(void 0)};return typeof i=="string"?(e.fromAttributes=n,e.fromGraph=function(o,a){return n(o.getNodeAttributes(a))},e.fromEntry=function(o,a){return n(a)}):typeof i=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){return r(i(a,o.getNodeAttributes(a)))},e.fromEntry=function(o,a){return r(i(o,a))}):(e.fromAttributes=s,e.fromGraph=s,e.fromEntry=s),e}function zm(i,t){var e={},r=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(r=t);var n=function(o){return r(o[i])},s=function(){return r(void 0)};return typeof i=="string"?(e.fromAttributes=n,e.fromGraph=function(o,a){return n(o.getEdgeAttributes(a))},e.fromEntry=function(o,a){return n(a)},e.fromPartialEntry=e.fromEntry,e.fromMinimalEntry=e.fromEntry):typeof i=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){var h=o.extremities(a);return r(i(a,o.getEdgeAttributes(a),h[0],h[1],o.getNodeAttributes(h[0]),o.getNodeAttributes(h[1]),o.isUndirected(a)))},e.fromEntry=function(o,a,h,l,u,c,d){return r(i(o,a,h,l,u,c,d))},e.fromPartialEntry=function(o,a,h,l){return r(i(o,a,h,l))},e.fromMinimalEntry=function(o,a){return r(i(o,a))}):(e.fromAttributes=s,e.fromGraph=s,e.fromEntry=s,e.fromMinimalEntry=s),e}ms.createNodeValueGetter=fR;ms.createEdgeValueGetter=zm;ms.createEdgeWeightGetter=function(i){return zm(i,dR)};var ys={},pR=function(i,t){return i<t?-1:i>t?1:0},gR=function(i,t){return i<t?1:i>t?-1:0};function mR(i){return function(t,e){return i(e,t)}}function yR(i){return i===2?function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:t[1]<e[1]?-1:t[1]>e[1]?1:0}:function(t,e){for(var r=0;r<i;){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1;r++}return 0}}ys.DEFAULT_COMPARATOR=pR;ys.DEFAULT_REVERSE_COMPARATOR=gR;ys.reverseComparator=mR;ys.createTupleComparator=yR;var Yo=Du,Xm=ys,ri=fn,_a=Xm.DEFAULT_COMPARATOR,ku=Xm.reverseComparator;function Fu(i,t,e,r){for(var n=t[r],s,o;r>e;){if(s=r-1>>1,o=t[s],i(n,o)<0){t[r]=o,r=s;continue}break}t[r]=n}function vs(i,t,e){for(var r=t.length,n=e,s=t[e],o=2*e+1,a;o<r;)a=o+1,a<r&&i(t[o],t[a])>=0&&(o=a),t[e]=t[o],e=o,o=2*e+1;t[e]=s,Fu(i,t,n,e)}function Vm(i,t,e){t.push(e),Fu(i,t,0,t.length-1)}function Uu(i,t){var e=t.pop();if(t.length!==0){var r=t[0];return t[0]=e,vs(i,t,0),r}return e}function un(i,t,e){if(t.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var r=t[0];return t[0]=e,vs(i,t,0),r}function jm(i,t,e){var r;return t.length!==0&&i(t[0],e)<0&&(r=t[0],t[0]=e,e=r,vs(i,t,0)),e}function vr(i,t){for(var e=t.length,r=e>>1,n=r;--n>=0;)vs(i,t,n)}function Gu(i,t){for(var e=t.length,r=0,n=new Array(e);r<e;)n[r++]=Uu(i,t);return n}function vR(i,t,e){arguments.length===2&&(e=t,t=i,i=_a);var r=ku(i),n,s,o,a=1/0,h;if(t===1){if(ri.isArrayLike(e)){for(n=0,s=e.length;n<s;n++)o=e[n],(a===1/0||i(o,a)<0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Yo(e,function(u){(a===1/0||i(u,a)<0)&&(a=u)}),[a]}if(ri.isArrayLike(e)){if(t>=e.length)return e.slice().sort(i);for(h=e.slice(0,t),vr(r,h),n=t,s=e.length;n<s;n++)r(e[n],h[0])>0&&un(r,h,e[n]);return h.sort(i)}var l=ri.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),n=0,Yo(e,function(u){n<t?h[n]=u:(n===t&&vr(r,h),r(u,h[0])>0&&un(r,h,u)),n++}),h.length>n&&(h.length=n),h.sort(i)}function _R(i,t,e){arguments.length===2&&(e=t,t=i,i=_a);var r=ku(i),n,s,o,a=-1/0,h;if(t===1){if(ri.isArrayLike(e)){for(n=0,s=e.length;n<s;n++)o=e[n],(a===-1/0||i(o,a)>0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Yo(e,function(u){(a===-1/0||i(u,a)>0)&&(a=u)}),[a]}if(ri.isArrayLike(e)){if(t>=e.length)return e.slice().sort(r);for(h=e.slice(0,t),vr(i,h),n=t,s=e.length;n<s;n++)i(e[n],h[0])>0&&un(i,h,e[n]);return h.sort(r)}var l=ri.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),n=0,Yo(e,function(u){n<t?h[n]=u:(n===t&&vr(i,h),i(u,h[0])>0&&un(i,h,u)),n++}),h.length>n&&(h.length=n),h.sort(r)}function St(i){if(this.clear(),this.comparator=i||_a,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}St.prototype.clear=function(){this.items=[],this.size=0};St.prototype.push=function(i){return Vm(this.comparator,this.items,i),++this.size};St.prototype.peek=function(){return this.items[0]};St.prototype.pop=function(){return this.size!==0&&this.size--,Uu(this.comparator,this.items)};St.prototype.replace=function(i){return un(this.comparator,this.items,i)};St.prototype.pushpop=function(i){return jm(this.comparator,this.items,i)};St.prototype.consume=function(){return this.size=0,Gu(this.comparator,this.items)};St.prototype.toArray=function(){return Gu(this.comparator,this.items.slice())};St.prototype.inspect=function(){var i=this.toArray();return Object.defineProperty(i,"constructor",{value:St,enumerable:!1}),i};typeof Symbol<"u"&&(St.prototype[Symbol.for("nodejs.util.inspect.custom")]=St.prototype.inspect);function qo(i){if(this.clear(),this.comparator=i||_a,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=ku(this.comparator)}qo.prototype=St.prototype;St.from=function(i,t){var e=new St(t),r;return ri.isArrayLike(i)?r=i.slice():r=ri.toArray(i),vr(e.comparator,r),e.items=r,e.size=r.length,e};qo.from=function(i,t){var e=new qo(t),r;return ri.isArrayLike(i)?r=i.slice():r=ri.toArray(i),vr(e.comparator,r),e.items=r,e.size=r.length,e};St.siftUp=vs;St.siftDown=Fu;St.push=Vm;St.pop=Uu;St.replace=un;St.pushpop=jm;St.heapify=vr;St.consume=Gu;St.nsmallest=vR;St.nlargest=_R;St.MinHeap=St;St.MaxHeap=qo;var Ym=St,qm=ma,$u=ms.createEdgeWeightGetter,Ko=Ym,Hu="weight";function jl(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:i[2]>t[2]?1:i[2]<t[2]?-1:0}function xR(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:i[2]>t[2]?1:i[2]<t[2]?-1:i[3]>t[3]?1:i[3]<t[3]?-1:0}function wR(i,t,e,r){if(t=""+t,e=""+e,!qm(i))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(t&&!i.hasNode(t))throw new Error('graphology-shortest-path/dijkstra: the "'+t+'" source node does not exist in the given graph.');if(e&&!i.hasNode(e))throw new Error('graphology-shortest-path/dijkstra: the "'+e+'" target node does not exist in the given graph.');if(r=$u(r||Hu).fromMinimalEntry,t===e)return[0,[t]];var n=[{},{}],s=[{},{}],o=[new Ko(jl),new Ko(jl)],a=[{},{}];s[0][t]=[t],s[1][e]=[e],a[0][t]=0,a[1][e]=0;var h=[],l=1/0,u=0,c=1,d,f,p,g,m,y,_,v,x;for(o[0].push([0,u++,t]),o[1].push([0,u++,e]);o[0].size&&o[1].size;)if(c=1-c,d=o[c].pop(),g=d[0],m=d[2],!(m in n[c])){if(n[c][m]=g,m in n[1-c])return[l,h];for(f=c===1?i.inboundEdges(m):i.outboundEdges(m),v=0,x=f.length;v<x;v++){if(_=f[v],y=i.opposite(m,_),p=n[c][m]+r(_,i.getEdgeAttributes(_)),y in n[c]&&p<n[c][y])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(y in a[c])||p<a[c][y])&&(a[c][y]=p,o[c].push([p,u++,y]),s[c][y]=s[c][m].concat(y),y in a[0]&&y in a[1]&&(g=a[0][y]+a[1][y],(h.length===0||l>g)&&(l=g,h=s[0][y].concat(s[1][y].slice(0,-1).reverse()))))}}return[1/0,null]}function bR(i,t,e,r,n,s){if(!qm(i))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(n&&!i.hasNode(n))throw new Error('graphology-shortest-path/dijkstra: the "'+n+'" target node does not exist in the given graph.');e=$u(e||Hu).fromMinimalEntry;var o={},a={},h=new Ko(jl),l=0,u,c,d,f,p,g,m,y,_,v,x;for(y=0,v=t.length;y<v;y++)f=t[y],a[f]=0,h.push([0,l++,f]),s&&(s[f]=[f]);for(;h.size;)if(c=h.pop(),m=c[0],f=c[2],!(f in o)){if(o[f]=m,f===n)break;for(u=i.outboundEdges(f),_=0,x=u.length;_<x;_++)if(g=u[_],p=i.opposite(f,g),d=e(g,i.getEdgeAttributes(g))+o[f],!(r&&d>r)){if(p in o&&d<o[p])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(p in a)||d<a[p])&&(a[p]=d,h.push([d,l++,p]),s&&(s[p]=s[f].concat(p)))}}return o}function ER(i,t,e){var r={};return bR(i,[t],e,0,null,r),r}function AR(i,t,e,r){return wR(i,t,e,r)[1]}function TR(i,t,e){t=""+t,e=$u(e||Hu).fromMinimalEntry;var r=[],n={},s={},o=i.nodes(),a,h,l,u,c,d,f,p,g,m;for(g=0,m=o.length;g<m;g++)d=o[g],n[d]=[],s[d]=0;var y={};s[t]=1;var _={};_[t]=0;var v=0,x=new Ko(xR);for(x.push([0,v++,t,t]);x.size;)if(h=x.pop(),u=h[0],l=h[2],d=h[3],!(d in y))for(s[d]+=s[l],r.push(d),y[d]=u,a=i.outboundEdges(d),g=0,m=a.length;g<m;g++)p=a[g],f=i.opposite(d,p),c=u+e(p,i.getEdgeAttributes(p)),!(f in y)&&(!(f in _)||c<_[f])?(_[f]=c,x.push([c,v++,d,f]),s[f]=0,n[f]=[d]):c===_[f]&&(s[f]+=s[d],n[f].push(d));return[r,n,s]}va.bidirectional=AR;va.singleSource=ER;va.brandes=TR;var SR={},IR=ma,CR=ms.createEdgeWeightGetter,MR=Ym,RR="weight";function PR(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:0}function NR(i,t,e,r,n,s){if(!IR(i))throw new Error("graphology-shortest-path/astar: invalid graphology instance.");if(t&&!i.hasNode(t))throw new Error('graphology-shortest-path/astar: the "'+t+'" source node does not exist in the given graph.');if(e&&!i.hasNode(e))throw new Error('graphology-shortest-path/astar: the "'+e+'" target node does not exist in the given graph.');if(r=CR(r||RR).fromMinimalEntry,t===e)return[t];n=n||function(){return 0},s=s||{};var o=0,a=new MR(PR);a.push([0,o++,t,0,null]);var h={},l={},u,c,d,f,p,g,m,y,_,v,x,A;function N(S,T,C,k){if(A=c===C?k:C,v=r(S,T),v!==null){if(x=f+v,h.hasOwnProperty(A)){if(d=h[A],y=d[0],_=d[1],y<=x)return}else _=n(A,e);s.cutoff&&x+_>s.cutoff||(h[A]=[x,_],a.push([x+_,o++,A,x,c]))}}for(;a.size!==0;){if(u=a.pop(),c=u[2],f=u[3],p=u[4],c===e){for(g=[c],m=p;m!==null;)g.push(m),m=l[m];return g.reverse(),g}l.hasOwnProperty(c)&&(l[c]===null||(y=h[c][0],y<f))||(l[c]=p,i.forEachOutboundEdge(c,N))}return null}SR.bidirectional=NR;var _s=pn,DR=va;_s.bidirectional;_s.singleSource;_s.singleSourceLength;_s.undirectedSingleSourceLength;_s.brandes;var Wu={exports:{}},en=typeof Reflect=="object"?Reflect:null,qf=en&&typeof en.apply=="function"?en.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},yo;en&&typeof en.ownKeys=="function"?yo=en.ownKeys:Object.getOwnPropertySymbols?yo=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:yo=function(t){return Object.getOwnPropertyNames(t)};function LR(i){console&&console.warn&&console.warn(i)}var Km=Number.isNaN||function(t){return t!==t};function Ct(){Ct.init.call(this)}Wu.exports=Ct;Wu.exports.once=FR;Ct.EventEmitter=Ct;Ct.prototype._events=void 0;Ct.prototype._eventsCount=0;Ct.prototype._maxListeners=void 0;var Kf=10;function xa(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Ct,"defaultMaxListeners",{enumerable:!0,get:function(){return Kf},set:function(i){if(typeof i!="number"||i<0||Km(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Kf=i}});Ct.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ct.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Km(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Zm(i){return i._maxListeners===void 0?Ct.defaultMaxListeners:i._maxListeners}Ct.prototype.getMaxListeners=function(){return Zm(this)};Ct.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n=t==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=s[t];if(h===void 0)return!1;if(typeof h=="function")qf(h,this,e);else for(var l=h.length,u=iy(h,l),r=0;r<l;++r)qf(u[r],this,e);return!0};function Qm(i,t,e,r){var n,s,o;if(xa(e),s=i._events,s===void 0?(s=i._events=Object.create(null),i._eventsCount=0):(s.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),s=i._events),o=s[t]),o===void 0)o=s[t]=e,++i._eventsCount;else if(typeof o=="function"?o=s[t]=r?[e,o]:[o,e]:r?o.unshift(e):o.push(e),n=Zm(i),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=t,a.count=o.length,LR(a)}return i}Ct.prototype.addListener=function(t,e){return Qm(this,t,e,!1)};Ct.prototype.on=Ct.prototype.addListener;Ct.prototype.prependListener=function(t,e){return Qm(this,t,e,!0)};function BR(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Jm(i,t,e){var r={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},n=BR.bind(r);return n.listener=e,r.wrapFn=n,n}Ct.prototype.once=function(t,e){return xa(e),this.on(t,Jm(this,t,e)),this};Ct.prototype.prependOnceListener=function(t,e){return xa(e),this.prependListener(t,Jm(this,t,e)),this};Ct.prototype.removeListener=function(t,e){var r,n,s,o,a;if(xa(e),n=this._events,n===void 0)return this;if(r=n[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():OR(r,s),r.length===1&&(n[t]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};Ct.prototype.off=Ct.prototype.removeListener;Ct.prototype.removeAllListeners=function(t){var e,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var s=Object.keys(r),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this};function ty(i,t,e){var r=i._events;if(r===void 0)return[];var n=r[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?kR(n):iy(n,n.length)}Ct.prototype.listeners=function(t){return ty(this,t,!0)};Ct.prototype.rawListeners=function(t){return ty(this,t,!1)};Ct.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):ey.call(i,t)};Ct.prototype.listenerCount=ey;function ey(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Ct.prototype.eventNames=function(){return this._eventsCount>0?yo(this._events):[]};function iy(i,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=i[r];return e}function OR(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function kR(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function FR(i,t){return new Promise(function(e,r){function n(o){i.removeListener(t,s),r(o)}function s(){typeof i.removeListener=="function"&&i.removeListener("error",n),e([].slice.call(arguments))}ry(i,t,s,{once:!0}),t!=="error"&&UR(i,n,{once:!0})})}function UR(i,t,e){typeof i.on=="function"&&ry(i,"error",t,e)}function ry(i,t,e,r){if(typeof i.on=="function")r.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function n(s){r.once&&i.removeEventListener(t,n),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var GR=Wu.exports,$R=gs,ny=ya,HR=ny.ARRAY_BUFFER_SUPPORT,WR=ny.SYMBOL_SUPPORT;function zR(i){return typeof i=="string"||Array.isArray(i)||HR&&ArrayBuffer.isView(i)?$R.fromSequence(i):typeof i!="object"||i===null?null:WR&&typeof i[Symbol.iterator]=="function"?i[Symbol.iterator]():typeof i.next=="function"?i:null}var sy=function(t){var e=zR(t);if(!e)throw new Error("obliterator: target is not iterable nor a valid iterator.");return e},XR=sy,VR=function(t,e){for(var r=arguments.length>1?e:1/0,n=r!==1/0?new Array(r):[],s,o=0,a=XR(t);;){if(o===r)return n;if(s=a.next(),s.done)return o!==e&&(n.length=o),n;n[o++]=s.value}};const oy=ss(VR);var jR=gs,YR=sy,qR=function(){var t=arguments,e=null,r=-1;return new jR(function(){var s=null;do{if(e===null){if(r++,r>=t.length)return{done:!0};e=YR(t[r])}if(s=e.next(),s.done===!0){e=null;continue}break}while(!0);return s})};const Ti=ss(qR);function KR(){const i=arguments[0];for(let t=1,e=arguments.length;t<e;t++)if(arguments[t])for(const r in arguments[t])i[r]=arguments[t][r];return i}let qt=KR;typeof Object.assign=="function"&&(qt=Object.assign);function Te(i,t,e,r){const n=i._nodes.get(t);let s=null;return n&&(r==="mixed"?s=n.out&&n.out[e]||n.undirected&&n.undirected[e]:r==="directed"?s=n.out&&n.out[e]:s=n.undirected&&n.undirected[e]),s}function ne(i){return typeof i=="object"&&i!==null}function ay(i){let t;for(t in i)return!1;return!0}function we(i,t,e){Object.defineProperty(i,t,{enumerable:!1,configurable:!1,writable:!0,value:e})}function Re(i,t,e){const r={enumerable:!0,configurable:!0};typeof e=="function"?r.get=e:(r.value=e,r.writable=!1),Object.defineProperty(i,t,r)}function Zf(i){return!(!ne(i)||i.attributes&&!Array.isArray(i.attributes))}function ZR(){let i=Math.floor(Math.random()*256)&255;return()=>i++}class zu extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class q extends zu{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,q.prototype.constructor)}}class $ extends zu{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$.prototype.constructor)}}class ht extends zu{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ht.prototype.constructor)}}function hy(i,t){this.key=i,this.attributes=t,this.clear()}hy.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function ly(i,t){this.key=i,this.attributes=t,this.clear()}ly.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function uy(i,t){this.key=i,this.attributes=t,this.clear()}uy.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function gn(i,t,e,r,n){this.key=t,this.attributes=n,this.undirected=i,this.source=e,this.target=r}gn.prototype.attach=function(){let i="out",t="in";this.undirected&&(i=t="undirected");const e=this.source.key,r=this.target.key;this.source[i][r]=this,!(this.undirected&&e===r)&&(this.target[t][e]=this)};gn.prototype.attachMulti=function(){let i="out",t="in";const e=this.source.key,r=this.target.key;this.undirected&&(i=t="undirected");const n=this.source[i],s=n[r];if(typeof s>"u"){n[r]=this,this.undirected&&e===r||(this.target[t][e]=this);return}s.previous=this,this.next=s,n[r]=this,this.target[t][e]=this};gn.prototype.detach=function(){const i=this.source.key,t=this.target.key;let e="out",r="in";this.undirected&&(e=r="undirected"),delete this.source[e][t],delete this.target[r][i]};gn.prototype.detachMulti=function(){const i=this.source.key,t=this.target.key;let e="out",r="in";this.undirected&&(e=r="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[e][t],delete this.target[r][i]):(this.next.previous=void 0,this.source[e][t]=this.next,this.target[r][i]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const cy=0,dy=1,QR=2,fy=3;function Pi(i,t,e,r,n,s,o){let a,h,l,u;if(r=""+r,e===cy){if(a=i._nodes.get(r),!a)throw new $(`Graph.${t}: could not find the "${r}" node in the graph.`);l=n,u=s}else if(e===fy){if(n=""+n,h=i._edges.get(n),!h)throw new $(`Graph.${t}: could not find the "${n}" edge in the graph.`);const c=h.source.key,d=h.target.key;if(r===c)a=h.target;else if(r===d)a=h.source;else throw new $(`Graph.${t}: the "${r}" node is not attached to the "${n}" edge (${c}, ${d}).`);l=s,u=o}else{if(h=i._edges.get(r),!h)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`);e===dy?a=h.source:a=h.target,l=n,u=s}return[a,l,u]}function JR(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Pi(this,t,e,r,n,s);return o.attributes[a]}}function tP(i,t,e){i.prototype[t]=function(r,n){const[s]=Pi(this,t,e,r,n);return s.attributes}}function eP(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Pi(this,t,e,r,n,s);return o.attributes.hasOwnProperty(a)}}function iP(i,t,e){i.prototype[t]=function(r,n,s,o){const[a,h,l]=Pi(this,t,e,r,n,s,o);return a.attributes[h]=l,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function rP(i,t,e){i.prototype[t]=function(r,n,s,o){const[a,h,l]=Pi(this,t,e,r,n,s,o);if(typeof l!="function")throw new q(`Graph.${t}: updater should be a function.`);const u=a.attributes,c=l(u[h]);return u[h]=c,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function nP(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Pi(this,t,e,r,n,s);return delete o.attributes[a],this.emit("nodeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:a}),this}}function sP(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Pi(this,t,e,r,n,s);if(!ne(a))throw new q(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=a,this.emit("nodeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function oP(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Pi(this,t,e,r,n,s);if(!ne(a))throw new q(`Graph.${t}: provided attributes are not a plain object.`);return qt(o.attributes,a),this.emit("nodeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:a}),this}}function aP(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Pi(this,t,e,r,n,s);if(typeof a!="function")throw new q(`Graph.${t}: provided updater is not a function.`);return o.attributes=a(o.attributes),this.emit("nodeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const hP=[{name:i=>`get${i}Attribute`,attacher:JR},{name:i=>`get${i}Attributes`,attacher:tP},{name:i=>`has${i}Attribute`,attacher:eP},{name:i=>`set${i}Attribute`,attacher:iP},{name:i=>`update${i}Attribute`,attacher:rP},{name:i=>`remove${i}Attribute`,attacher:nP},{name:i=>`replace${i}Attributes`,attacher:sP},{name:i=>`merge${i}Attributes`,attacher:oP},{name:i=>`update${i}Attributes`,attacher:aP}];function lP(i){hP.forEach(function({name:t,attacher:e}){e(i,t("Node"),cy),e(i,t("Source"),dy),e(i,t("Target"),QR),e(i,t("Opposite"),fy)})}function uP(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Te(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return s.attributes[n]}}function cP(i,t,e){i.prototype[t]=function(r){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+r,o=""+arguments[1];if(n=Te(this,s,o,e),!n)throw new $(`Graph.${t}: could not find an edge for the given path ("${s}" - "${o}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return n.attributes}}function dP(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Te(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return s.attributes.hasOwnProperty(n)}}function fP(i,t,e){i.prototype[t]=function(r,n,s){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+r,h=""+n;if(n=arguments[2],s=arguments[3],o=Te(this,a,h,e),!o)throw new $(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,o=this._edges.get(r),!o)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return o.attributes[n]=s,this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:n}),this}}function pP(i,t,e){i.prototype[t]=function(r,n,s){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+r,h=""+n;if(n=arguments[2],s=arguments[3],o=Te(this,a,h,e),!o)throw new $(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,o=this._edges.get(r),!o)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(typeof s!="function")throw new q(`Graph.${t}: updater should be a function.`);return o.attributes[n]=s(o.attributes[n]),this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:n}),this}}function gP(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Te(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return delete s.attributes[n],this.emit("edgeAttributesUpdated",{key:s.key,type:"remove",attributes:s.attributes,name:n}),this}}function mP(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Te(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(!ne(n))throw new q(`Graph.${t}: provided attributes are not a plain object.`);return s.attributes=n,this.emit("edgeAttributesUpdated",{key:s.key,type:"replace",attributes:s.attributes}),this}}function yP(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Te(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(!ne(n))throw new q(`Graph.${t}: provided attributes are not a plain object.`);return qt(s.attributes,n),this.emit("edgeAttributesUpdated",{key:s.key,type:"merge",attributes:s.attributes,data:n}),this}}function vP(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ht(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ht(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Te(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ht(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(typeof n!="function")throw new q(`Graph.${t}: provided updater is not a function.`);return s.attributes=n(s.attributes),this.emit("edgeAttributesUpdated",{key:s.key,type:"update",attributes:s.attributes}),this}}const _P=[{name:i=>`get${i}Attribute`,attacher:uP},{name:i=>`get${i}Attributes`,attacher:cP},{name:i=>`has${i}Attribute`,attacher:dP},{name:i=>`set${i}Attribute`,attacher:fP},{name:i=>`update${i}Attribute`,attacher:pP},{name:i=>`remove${i}Attribute`,attacher:gP},{name:i=>`replace${i}Attributes`,attacher:mP},{name:i=>`merge${i}Attributes`,attacher:yP},{name:i=>`update${i}Attributes`,attacher:vP}];function xP(i){_P.forEach(function({name:t,attacher:e}){e(i,t("Edge"),"mixed"),e(i,t("DirectedEdge"),"directed"),e(i,t("UndirectedEdge"),"undirected")})}const wP=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function bP(i,t,e,r){let n=!1;for(const s in t){if(s===r)continue;const o=t[s];if(n=e(o.key,o.attributes,o.source.key,o.target.key,o.source.attributes,o.target.attributes,o.undirected),i&&n)return o.key}}function EP(i,t,e,r){let n,s,o,a=!1;for(const h in t)if(h!==r){n=t[h];do{if(s=n.source,o=n.target,a=e(n.key,n.attributes,s.key,o.key,s.attributes,o.attributes,n.undirected),i&&a)return n.key;n=n.next}while(n!==void 0)}}function Mh(i,t){const e=Object.keys(i),r=e.length;let n,s=0;return new Se(function(){do if(n)n=n.next;else{if(s>=r)return{done:!0};const a=e[s++];if(a===t){n=void 0;continue}n=i[a]}while(!n);return{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}}})}function AP(i,t,e,r){const n=t[e];if(!n)return;const s=n.source,o=n.target;if(r(n.key,n.attributes,s.key,o.key,s.attributes,o.attributes,n.undirected)&&i)return n.key}function TP(i,t,e,r){let n=t[e];if(!n)return;let s=!1;do{if(s=r(n.key,n.attributes,n.source.key,n.target.key,n.source.attributes,n.target.attributes,n.undirected),i&&s)return n.key;n=n.next}while(n!==void 0)}function Rh(i,t){let e=i[t];return e.next!==void 0?new Se(function(){if(!e)return{done:!0};const r={edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected};return e=e.next,{done:!1,value:r}}):Se.of({edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected})}function SP(i,t){if(i.size===0)return[];if(t==="mixed"||t===i.type)return typeof Array.from=="function"?Array.from(i._edges.keys()):oy(i._edges.keys(),i._edges.size);const e=t==="undirected"?i.undirectedSize:i.directedSize,r=new Array(e),n=t==="undirected",s=i._edges.values();let o=0,a,h;for(;a=s.next(),a.done!==!0;)h=a.value,h.undirected===n&&(r[o++]=h.key);return r}function py(i,t,e,r){if(t.size===0)return;const n=e!=="mixed"&&e!==t.type,s=e==="undirected";let o,a,h=!1;const l=t._edges.values();for(;o=l.next(),o.done!==!0;){if(a=o.value,n&&a.undirected!==s)continue;const{key:u,attributes:c,source:d,target:f}=a;if(h=r(u,c,d.key,f.key,d.attributes,f.attributes,a.undirected),i&&h)return u}}function IP(i,t){if(i.size===0)return Se.empty();const e=t!=="mixed"&&t!==i.type,r=t==="undirected",n=i._edges.values();return new Se(function(){let o,a;for(;;){if(o=n.next(),o.done)return o;if(a=o.value,!(e&&a.undirected!==r))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}})}function Xu(i,t,e,r,n,s){const o=t?EP:bP;let a;if(e!=="undirected"&&(r!=="out"&&(a=o(i,n.in,s),i&&a)||r!=="in"&&(a=o(i,n.out,s,r?void 0:n.key),i&&a))||e!=="directed"&&(a=o(i,n.undirected,s),i&&a))return a}function CP(i,t,e,r){const n=[];return Xu(!1,i,t,e,r,function(s){n.push(s)}),n}function MP(i,t,e){let r=Se.empty();return i!=="undirected"&&(t!=="out"&&typeof e.in<"u"&&(r=Ti(r,Mh(e.in))),t!=="in"&&typeof e.out<"u"&&(r=Ti(r,Mh(e.out,t?void 0:e.key)))),i!=="directed"&&typeof e.undirected<"u"&&(r=Ti(r,Mh(e.undirected))),r}function Vu(i,t,e,r,n,s,o){const a=e?TP:AP;let h;if(t!=="undirected"&&(typeof n.in<"u"&&r!=="out"&&(h=a(i,n.in,s,o),i&&h)||typeof n.out<"u"&&r!=="in"&&(r||n.key!==s)&&(h=a(i,n.out,s,o),i&&h))||t!=="directed"&&typeof n.undirected<"u"&&(h=a(i,n.undirected,s,o),i&&h))return h}function RP(i,t,e,r,n){const s=[];return Vu(!1,i,t,e,r,n,function(o){s.push(o)}),s}function PP(i,t,e,r){let n=Se.empty();return i!=="undirected"&&(typeof e.in<"u"&&t!=="out"&&r in e.in&&(n=Ti(n,Rh(e.in,r))),typeof e.out<"u"&&t!=="in"&&r in e.out&&(t||e.key!==r)&&(n=Ti(n,Rh(e.out,r)))),i!=="directed"&&typeof e.undirected<"u"&&r in e.undirected&&(n=Ti(n,Rh(e.undirected,r))),n}function NP(i,t){const{name:e,type:r,direction:n}=t;i.prototype[e]=function(s,o){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return[];if(!arguments.length)return SP(this,r);if(arguments.length===1){s=""+s;const a=this._nodes.get(s);if(typeof a>"u")throw new $(`Graph.${e}: could not find the "${s}" node in the graph.`);return CP(this.multi,r==="mixed"?this.type:r,n,a)}if(arguments.length===2){s=""+s,o=""+o;const a=this._nodes.get(s);if(!a)throw new $(`Graph.${e}:  could not find the "${s}" source node in the graph.`);if(!this._nodes.has(o))throw new $(`Graph.${e}:  could not find the "${o}" target node in the graph.`);return RP(r,this.multi,n,a,o)}throw new q(`Graph.${e}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function DP(i,t){const{name:e,type:r,direction:n}=t,s="forEach"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[s]=function(l,u,c){if(!(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)){if(arguments.length===1)return c=l,py(!1,this,r,c);if(arguments.length===2){l=""+l,c=u;const d=this._nodes.get(l);if(typeof d>"u")throw new $(`Graph.${s}: could not find the "${l}" node in the graph.`);return Xu(!1,this.multi,r==="mixed"?this.type:r,n,d,c)}if(arguments.length===3){l=""+l,u=""+u;const d=this._nodes.get(l);if(!d)throw new $(`Graph.${s}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(u))throw new $(`Graph.${s}:  could not find the "${u}" target node in the graph.`);return Vu(!1,r,this.multi,n,d,u,c)}throw new q(`Graph.${s}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const o="map"+e[0].toUpperCase()+e.slice(1);i.prototype[o]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop();let c;if(l.length===0){let d=0;r!=="directed"&&(d+=this.undirectedSize),r!=="undirected"&&(d+=this.directedSize),c=new Array(d);let f=0;l.push((p,g,m,y,_,v,x)=>{c[f++]=u(p,g,m,y,_,v,x)})}else c=[],l.push((d,f,p,g,m,y,_)=>{c.push(u(d,f,p,g,m,y,_))});return this[s].apply(this,l),c};const a="filter"+e[0].toUpperCase()+e.slice(1);i.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop(),c=[];return l.push((d,f,p,g,m,y,_)=>{u(d,f,p,g,m,y,_)&&c.push(d)}),this[s].apply(this,l),c};const h="reduce"+e[0].toUpperCase()+e.slice(1);i.prototype[h]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new q(`Graph.${h}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new q(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let u,c;l.length===2?(u=l[0],c=l[1],l=[]):l.length===3?(u=l[1],c=l[2],l=[l[0]]):l.length===4&&(u=l[2],c=l[3],l=[l[0],l[1]]);let d=c;return l.push((f,p,g,m,y,_,v)=>{d=u(d,f,p,g,m,y,_,v)}),this[s].apply(this,l),d}}function LP(i,t){const{name:e,type:r,direction:n}=t,s="find"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[s]=function(h,l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return!1;if(arguments.length===1)return u=h,py(!0,this,r,u);if(arguments.length===2){h=""+h,u=l;const c=this._nodes.get(h);if(typeof c>"u")throw new $(`Graph.${s}: could not find the "${h}" node in the graph.`);return Xu(!0,this.multi,r==="mixed"?this.type:r,n,c,u)}if(arguments.length===3){h=""+h,l=""+l;const c=this._nodes.get(h);if(!c)throw new $(`Graph.${s}:  could not find the "${h}" source node in the graph.`);if(!this._nodes.has(l))throw new $(`Graph.${s}:  could not find the "${l}" target node in the graph.`);return Vu(!0,r,this.multi,n,c,l,u)}throw new q(`Graph.${s}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const o="some"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[o]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((c,d,f,p,g,m,y)=>l(c,d,f,p,g,m,y)),!!this[s].apply(this,h)};const a="every"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[a]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((c,d,f,p,g,m,y)=>!l(c,d,f,p,g,m,y)),!this[s].apply(this,h)}}function BP(i,t){const{name:e,type:r,direction:n}=t,s=e.slice(0,-1)+"Entries";i.prototype[s]=function(o,a){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return Se.empty();if(!arguments.length)return IP(this,r);if(arguments.length===1){o=""+o;const h=this._nodes.get(o);if(!h)throw new $(`Graph.${s}: could not find the "${o}" node in the graph.`);return MP(r,n,h)}if(arguments.length===2){o=""+o,a=""+a;const h=this._nodes.get(o);if(!h)throw new $(`Graph.${s}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new $(`Graph.${s}:  could not find the "${a}" target node in the graph.`);return PP(r,n,h,a)}throw new q(`Graph.${s}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function OP(i){wP.forEach(t=>{NP(i,t),DP(i,t),LP(i,t),BP(i,t)})}const kP=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function wa(){this.A=null,this.B=null}wa.prototype.wrap=function(i){this.A===null?this.A=i:this.B===null&&(this.B=i)};wa.prototype.has=function(i){return this.A!==null&&i in this.A||this.B!==null&&i in this.B};function In(i,t,e,r,n){for(const s in r){const o=r[s],a=o.source,h=o.target,l=a===e?h:a;if(t&&t.has(l.key))continue;const u=n(l.key,l.attributes);if(i&&u)return l.key}}function ju(i,t,e,r,n){if(t!=="mixed"){if(t==="undirected")return In(i,null,r,r.undirected,n);if(typeof e=="string")return In(i,null,r,r[e],n)}const s=new wa;let o;if(t!=="undirected"){if(e!=="out"){if(o=In(i,null,r,r.in,n),i&&o)return o;s.wrap(r.in)}if(e!=="in"){if(o=In(i,s,r,r.out,n),i&&o)return o;s.wrap(r.out)}}if(t!=="directed"&&(o=In(i,s,r,r.undirected,n),i&&o))return o}function FP(i,t,e){if(i!=="mixed"){if(i==="undirected")return Object.keys(e.undirected);if(typeof t=="string")return Object.keys(e[t])}const r=[];return ju(!1,i,t,e,function(n){r.push(n)}),r}function Cn(i,t,e){const r=Object.keys(e),n=r.length;let s=0;return new Se(function(){let a=null;do{if(s>=n)return i&&i.wrap(e),{done:!0};const h=e[r[s++]],l=h.source,u=h.target;if(a=l===t?u:l,i&&i.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}})}function UP(i,t,e){if(i!=="mixed"){if(i==="undirected")return Cn(null,e,e.undirected);if(typeof t=="string")return Cn(null,e,e[t])}let r=Se.empty();const n=new wa;return i!=="undirected"&&(t!=="out"&&(r=Ti(r,Cn(n,e,e.in))),t!=="in"&&(r=Ti(r,Cn(n,e,e.out)))),i!=="directed"&&(r=Ti(r,Cn(n,e,e.undirected))),r}function GP(i,t){const{name:e,type:r,direction:n}=t;i.prototype[e]=function(s){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return[];s=""+s;const o=this._nodes.get(s);if(typeof o>"u")throw new $(`Graph.${e}: could not find the "${s}" node in the graph.`);return FP(r==="mixed"?this.type:r,n,o)}}function $P(i,t){const{name:e,type:r,direction:n}=t,s="forEach"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[s]=function(l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return;l=""+l;const c=this._nodes.get(l);if(typeof c>"u")throw new $(`Graph.${s}: could not find the "${l}" node in the graph.`);ju(!1,r==="mixed"?this.type:r,n,c,u)};const o="map"+e[0].toUpperCase()+e.slice(1);i.prototype[o]=function(l,u){const c=[];return this[s](l,(d,f)=>{c.push(u(d,f))}),c};const a="filter"+e[0].toUpperCase()+e.slice(1);i.prototype[a]=function(l,u){const c=[];return this[s](l,(d,f)=>{u(d,f)&&c.push(d)}),c};const h="reduce"+e[0].toUpperCase()+e.slice(1);i.prototype[h]=function(l,u,c){if(arguments.length<3)throw new q(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let d=c;return this[s](l,(f,p)=>{d=u(d,f,p)}),d}}function HP(i,t){const{name:e,type:r,direction:n}=t,s=e[0].toUpperCase()+e.slice(1,-1),o="find"+s;i.prototype[o]=function(l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return;l=""+l;const c=this._nodes.get(l);if(typeof c>"u")throw new $(`Graph.${o}: could not find the "${l}" node in the graph.`);return ju(!0,r==="mixed"?this.type:r,n,c,u)};const a="some"+s;i.prototype[a]=function(l,u){return!!this[o](l,u)};const h="every"+s;i.prototype[h]=function(l,u){return!this[o](l,(d,f)=>!u(d,f))}}function WP(i,t){const{name:e,type:r,direction:n}=t,s=e.slice(0,-1)+"Entries";i.prototype[s]=function(o){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return Se.empty();o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new $(`Graph.${s}: could not find the "${o}" node in the graph.`);return UP(r==="mixed"?this.type:r,n,a)}}function zP(i){kP.forEach(t=>{GP(i,t),$P(i,t),HP(i,t),WP(i,t)})}function Js(i,t,e,r,n){const s=r._nodes.values(),o=r.type;let a,h,l,u,c,d,f;for(;a=s.next(),a.done!==!0;){let p=!1;if(h=a.value,o!=="undirected"){u=h.out;for(l in u){c=u[l];do{if(d=c.target,p=!0,f=n(h.key,d.key,h.attributes,d.attributes,c.key,c.attributes,c.undirected),i&&f)return c;c=c.next}while(c)}}if(o!=="directed"){u=h.undirected;for(l in u)if(!(t&&h.key>l)){c=u[l];do{if(d=c.target,d.key!==l&&(d=c.source),p=!0,f=n(h.key,d.key,h.attributes,d.attributes,c.key,c.attributes,c.undirected),i&&f)return c;c=c.next}while(c)}}if(e&&!p&&(f=n(h.key,null,h.attributes,null,null,null,null),i&&f))return null}}function XP(i,t){const e={key:i};return ay(t.attributes)||(e.attributes=qt({},t.attributes)),e}function VP(i,t,e){const r={key:t,source:e.source.key,target:e.target.key};return ay(e.attributes)||(r.attributes=qt({},e.attributes)),i==="mixed"&&e.undirected&&(r.undirected=!0),r}function jP(i){if(!ne(i))throw new q('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in i))throw new q("Graph.import: serialized node is missing its key.");if("attributes"in i&&(!ne(i.attributes)||i.attributes===null))throw new q("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function YP(i){if(!ne(i))throw new q('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in i))throw new q("Graph.import: serialized edge is missing its source.");if(!("target"in i))throw new q("Graph.import: serialized edge is missing its target.");if("attributes"in i&&(!ne(i.attributes)||i.attributes===null))throw new q("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in i&&typeof i.undirected!="boolean")throw new q("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const qP=ZR(),KP=new Set(["directed","undirected","mixed"]),Qf=new Set(["domain","_events","_eventsCount","_maxListeners"]),ZP=[{name:i=>`${i}Edge`,generateKey:!0},{name:i=>`${i}DirectedEdge`,generateKey:!0,type:"directed"},{name:i=>`${i}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:i=>`${i}EdgeWithKey`},{name:i=>`${i}DirectedEdgeWithKey`,type:"directed"},{name:i=>`${i}UndirectedEdgeWithKey`,type:"undirected"}],QP={allowSelfLoops:!0,multi:!1,type:"mixed"};function JP(i,t,e){if(e&&!ne(e))throw new q(`Graph.addNode: invalid attributes. Expecting an object but got "${e}"`);if(t=""+t,e=e||{},i._nodes.has(t))throw new ht(`Graph.addNode: the "${t}" node already exist in the graph.`);const r=new i.NodeDataClass(t,e);return i._nodes.set(t,r),i.emit("nodeAdded",{key:t,attributes:e}),r}function Jf(i,t,e){const r=new i.NodeDataClass(t,e);return i._nodes.set(t,r),i.emit("nodeAdded",{key:t,attributes:e}),r}function gy(i,t,e,r,n,s,o,a){if(!r&&i.type==="undirected")throw new ht(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(r&&i.type==="directed")throw new ht(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!ne(a))throw new q(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`);if(s=""+s,o=""+o,a=a||{},!i.allowSelfLoops&&s===o)throw new ht(`Graph.${t}: source & target are the same ("${s}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const h=i._nodes.get(s),l=i._nodes.get(o);if(!h)throw new $(`Graph.${t}: source node "${s}" not found.`);if(!l)throw new $(`Graph.${t}: target node "${o}" not found.`);const u={key:null,undirected:r,source:s,target:o,attributes:a};if(e)n=i._edgeKeyGenerator();else if(n=""+n,i._edges.has(n))throw new ht(`Graph.${t}: the "${n}" edge already exists in the graph.`);if(!i.multi&&(r?typeof h.undirected[o]<"u":typeof h.out[o]<"u"))throw new ht(`Graph.${t}: an edge linking "${s}" to "${o}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const c=new gn(r,n,h,l,a);i._edges.set(n,c);const d=s===o;return r?(h.undirectedDegree++,l.undirectedDegree++,d&&(h.undirectedLoops++,i._undirectedSelfLoopCount++)):(h.outDegree++,l.inDegree++,d&&(h.directedLoops++,i._directedSelfLoopCount++)),i.multi?c.attachMulti():c.attach(),r?i._undirectedSize++:i._directedSize++,u.key=n,i.emit("edgeAdded",u),n}function tN(i,t,e,r,n,s,o,a,h){if(!r&&i.type==="undirected")throw new ht(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(r&&i.type==="directed")throw new ht(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(h){if(typeof a!="function")throw new q(`Graph.${t}: invalid updater function. Expecting a function but got "${a}"`)}else if(!ne(a))throw new q(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`)}s=""+s,o=""+o;let l;if(h&&(l=a,a=void 0),!i.allowSelfLoops&&s===o)throw new ht(`Graph.${t}: source & target are the same ("${s}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let u=i._nodes.get(s),c=i._nodes.get(o),d,f;if(!e&&(d=i._edges.get(n),d)){if((d.source.key!==s||d.target.key!==o)&&(!r||d.source.key!==o||d.target.key!==s))throw new ht(`Graph.${t}: inconsistency detected when attempting to merge the "${n}" edge with "${s}" source & "${o}" target vs. ("${d.source.key}", "${d.target.key}").`);f=d}if(!f&&!i.multi&&u&&(f=r?u.undirected[o]:u.out[o]),f){const _=[f.key,!1,!1,!1];if(h?!l:!a)return _;if(h){const v=f.attributes;f.attributes=l(v),i.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else qt(f.attributes,a),i.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:a});return _}a=a||{},h&&l&&(a=l(a));const p={key:null,undirected:r,source:s,target:o,attributes:a};if(e)n=i._edgeKeyGenerator();else if(n=""+n,i._edges.has(n))throw new ht(`Graph.${t}: the "${n}" edge already exists in the graph.`);let g=!1,m=!1;u||(u=Jf(i,s,{}),g=!0,s===o&&(c=u,m=!0)),c||(c=Jf(i,o,{}),m=!0),d=new gn(r,n,u,c,a),i._edges.set(n,d);const y=s===o;return r?(u.undirectedDegree++,c.undirectedDegree++,y&&(u.undirectedLoops++,i._undirectedSelfLoopCount++)):(u.outDegree++,c.inDegree++,y&&(u.directedLoops++,i._directedSelfLoopCount++)),i.multi?d.attachMulti():d.attach(),r?i._undirectedSize++:i._directedSize++,p.key=n,i.emit("edgeAdded",p),[n,!0,g,m]}function Nr(i,t){i._edges.delete(t.key);const{source:e,target:r,attributes:n}=t,s=t.undirected,o=e===r;s?(e.undirectedDegree--,r.undirectedDegree--,o&&(e.undirectedLoops--,i._undirectedSelfLoopCount--)):(e.outDegree--,r.inDegree--,o&&(e.directedLoops--,i._directedSelfLoopCount--)),i.multi?t.detachMulti():t.detach(),s?i._undirectedSize--:i._directedSize--,i.emit("edgeDropped",{key:t.key,attributes:n,source:e.key,target:r.key,undirected:s})}class Mt extends GR.EventEmitter{constructor(t){if(super(),t=qt({},QP,t),typeof t.multi!="boolean")throw new q(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!KP.has(t.type))throw new q(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new q(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const e=t.type==="mixed"?hy:t.type==="directed"?ly:uy;we(this,"NodeDataClass",e);const r="geid_"+qP()+"_";let n=0;const s=()=>{let o;do o=r+n++;while(this._edges.has(o));return o};we(this,"_attributes",{}),we(this,"_nodes",new Map),we(this,"_edges",new Map),we(this,"_directedSize",0),we(this,"_undirectedSize",0),we(this,"_directedSelfLoopCount",0),we(this,"_undirectedSelfLoopCount",0),we(this,"_edgeKeyGenerator",s),we(this,"_options",t),Qf.forEach(o=>we(this,o,this[o])),Re(this,"order",()=>this._nodes.size),Re(this,"size",()=>this._edges.size),Re(this,"directedSize",()=>this._directedSize),Re(this,"undirectedSize",()=>this._undirectedSize),Re(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Re(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Re(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Re(this,"multi",this._options.multi),Re(this,"type",this._options.type),Re(this,"allowSelfLoops",this._options.allowSelfLoops),Re(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,e){if(this.type==="undirected")return!1;if(arguments.length===1){const r=""+t,n=this._edges.get(r);return!!n&&!n.undirected}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?r.out.hasOwnProperty(e):!1}throw new q(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,e){if(this.type==="directed")return!1;if(arguments.length===1){const r=""+t,n=this._edges.get(r);return!!n&&n.undirected}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?r.undirected.hasOwnProperty(e):!1}throw new q(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,e){if(arguments.length===1){const r=""+t;return this._edges.has(r)}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?typeof r.out<"u"&&r.out.hasOwnProperty(e)||typeof r.undirected<"u"&&r.undirected.hasOwnProperty(e):!1}throw new q(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,e){if(this.type==="undirected")return;if(t=""+t,e=""+e,this.multi)throw new ht("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const r=this._nodes.get(t);if(!r)throw new $(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.directedEdge: could not find the "${e}" target node in the graph.`);const n=r.out&&r.out[e]||void 0;if(n)return n.key}undirectedEdge(t,e){if(this.type==="directed")return;if(t=""+t,e=""+e,this.multi)throw new ht("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const r=this._nodes.get(t);if(!r)throw new $(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.undirectedEdge: could not find the "${e}" target node in the graph.`);const n=r.undirected&&r.undirected[e]||void 0;if(n)return n.key}edge(t,e){if(this.multi)throw new ht("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.edge: could not find the "${e}" target node in the graph.`);const n=r.out&&r.out[e]||r.undirected&&r.undirected[e]||void 0;if(n)return n.key}areDirectedNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.in||e in r.out}areOutNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.out}areInNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.in}areUndirectedNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:e in r.undirected}areNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(e in r.in||e in r.out)||this.type!=="directed"&&e in r.undirected}areInboundNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in r.in||this.type!=="directed"&&e in r.undirected}areOutboundNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in r.out||this.type!=="directed"&&e in r.undirected}inDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree}outDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree}directedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree}undirectedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree}inboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.inDegree),r}outboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.outDegree),r}degree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.degree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.inDegree+e.outDegree),r}inDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree-e.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree-e.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree-e.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree-e.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,n=0;return this.type!=="directed"&&(r+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.inDegree,n+=e.directedLoops),r-n}outboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,n=0;return this.type!=="directed"&&(r+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.outDegree,n+=e.directedLoops),r-n}degreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,n=0;return this.type!=="directed"&&(r+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.inDegree+e.outDegree,n+=e.directedLoops*2),r-n}source(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.source: could not find the "${t}" edge in the graph.`);return e.source.key}target(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.target: could not find the "${t}" edge in the graph.`);return e.target.key}extremities(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[e.source.key,e.target.key]}opposite(t,e){t=""+t,e=""+e;const r=this._edges.get(e);if(!r)throw new $(`Graph.opposite: could not find the "${e}" edge in the graph.`);const n=r.source.key,s=r.target.key;if(t===n)return s;if(t===s)return n;throw new $(`Graph.opposite: the "${t}" node is not attached to the "${e}" edge (${n}, ${s}).`)}hasExtremity(t,e){t=""+t,e=""+e;const r=this._edges.get(t);if(!r)throw new $(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return r.source.key===e||r.target.key===e}isUndirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return e.undirected}isDirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!e.undirected}isSelfLoop(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return e.source===e.target}addNode(t,e){return JP(this,t,e).key}mergeNode(t,e){if(e&&!ne(e))throw new q(`Graph.mergeNode: invalid attributes. Expecting an object but got "${e}"`);t=""+t,e=e||{};let r=this._nodes.get(t);return r?(e&&(qt(r.attributes,e),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:r.attributes,data:e})),[t,!1]):(r=new this.NodeDataClass(t,e),this._nodes.set(t,r),this.emit("nodeAdded",{key:t,attributes:e}),[t,!0])}updateNode(t,e){if(e&&typeof e!="function")throw new q(`Graph.updateNode: invalid updater function. Expecting a function but got "${e}"`);t=""+t;let r=this._nodes.get(t);if(r){if(e){const s=r.attributes;r.attributes=e(s),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:r.attributes})}return[t,!1]}const n=e?e({}):{};return r=new this.NodeDataClass(t,n),this._nodes.set(t,r),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0]}dropNode(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.dropNode: could not find the "${t}" node in the graph.`);let r;if(this.type!=="undirected"){for(const n in e.out){r=e.out[n];do Nr(this,r),r=r.next;while(r)}for(const n in e.in){r=e.in[n];do Nr(this,r),r=r.next;while(r)}}if(this.type!=="directed")for(const n in e.undirected){r=e.undirected[n];do Nr(this,r),r=r.next;while(r)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:e.attributes})}dropEdge(t){let e;if(arguments.length>1){const r=""+arguments[0],n=""+arguments[1];if(e=Te(this,r,n,this.type),!e)throw new $(`Graph.dropEdge: could not find the "${r}" -> "${n}" edge in the graph.`)}else if(t=""+t,e=this._edges.get(t),!e)throw new $(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return Nr(this,e),this}dropDirectedEdge(t,e){if(arguments.length<2)throw new ht("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ht("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,e=""+e;const r=Te(this,t,e,"directed");if(!r)throw new $(`Graph.dropDirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Nr(this,r),this}dropUndirectedEdge(t,e){if(arguments.length<2)throw new ht("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ht("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const r=Te(this,t,e,"undirected");if(!r)throw new $(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Nr(this,r),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let e;for(;e=t.next(),e.done!==!0;)e.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,e){return this._attributes[t]=e,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,e){if(typeof e!="function")throw new q("Graph.updateAttribute: updater should be a function.");const r=this._attributes[t];return this._attributes[t]=e(r),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!ne(t))throw new q("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!ne(t))throw new q("Graph.mergeAttributes: provided attributes are not a plain object.");return qt(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new q("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,e){if(typeof t!="function")throw new q("Graph.updateEachNodeAttributes: expecting an updater function.");if(e&&!Zf(e))throw new q("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const r=this._nodes.values();let n,s;for(;n=r.next(),n.done!==!0;)s=n.value,s.attributes=t(s.key,s.attributes);this.emit("eachNodeAttributesUpdated",{hints:e||null})}updateEachEdgeAttributes(t,e){if(typeof t!="function")throw new q("Graph.updateEachEdgeAttributes: expecting an updater function.");if(e&&!Zf(e))throw new q("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const r=this._edges.values();let n,s,o,a;for(;n=r.next(),n.done!==!0;)s=n.value,o=s.source,a=s.target,s.attributes=t(s.key,s.attributes,o.key,a.key,o.attributes,a.attributes,s.undirected);this.emit("eachEdgeAttributesUpdated",{hints:e||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new q("Graph.forEachAdjacencyEntry: expecting a callback.");Js(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new q("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");Js(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new q("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");Js(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new q("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");Js(!1,!0,!0,this,t)}nodes(){return typeof Array.from=="function"?Array.from(this._nodes.keys()):oy(this._nodes.keys(),this._nodes.size)}forEachNode(t){if(typeof t!="function")throw new q("Graph.forEachNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)n=r.value,t(n.key,n.attributes)}findNode(t){if(typeof t!="function")throw new q("Graph.findNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)if(n=r.value,t(n.key,n.attributes))return n.key}mapNodes(t){if(typeof t!="function")throw new q("Graph.mapNode: expecting a callback.");const e=this._nodes.values();let r,n;const s=new Array(this.order);let o=0;for(;r=e.next(),r.done!==!0;)n=r.value,s[o++]=t(n.key,n.attributes);return s}someNode(t){if(typeof t!="function")throw new q("Graph.someNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)if(n=r.value,t(n.key,n.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new q("Graph.everyNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)if(n=r.value,!t(n.key,n.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new q("Graph.filterNodes: expecting a callback.");const e=this._nodes.values();let r,n;const s=[];for(;r=e.next(),r.done!==!0;)n=r.value,t(n.key,n.attributes)&&s.push(n.key);return s}reduceNodes(t,e){if(typeof t!="function")throw new q("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new q("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let r=e;const n=this._nodes.values();let s,o;for(;s=n.next(),s.done!==!0;)o=s.value,r=t(r,o.key,o.attributes);return r}nodeEntries(){const t=this._nodes.values();return new Se(()=>{const e=t.next();if(e.done)return e;const r=e.value;return{value:{node:r.key,attributes:r.attributes},done:!1}})}export(){const t=new Array(this._nodes.size);let e=0;this._nodes.forEach((n,s)=>{t[e++]=XP(s,n)});const r=new Array(this._edges.size);return e=0,this._edges.forEach((n,s)=>{r[e++]=VP(this.type,s,n)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:r}}import(t,e=!1){if(t instanceof Mt)return t.forEachNode((h,l)=>{e?this.mergeNode(h,l):this.addNode(h,l)}),t.forEachEdge((h,l,u,c,d,f,p)=>{e?p?this.mergeUndirectedEdgeWithKey(h,u,c,l):this.mergeDirectedEdgeWithKey(h,u,c,l):p?this.addUndirectedEdgeWithKey(h,u,c,l):this.addDirectedEdgeWithKey(h,u,c,l)}),this;if(!ne(t))throw new q("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!ne(t.attributes))throw new q("Graph.import: invalid attributes. Expecting a plain object.");e?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let r,n,s,o,a;if(t.nodes){if(s=t.nodes,!Array.isArray(s))throw new q("Graph.import: invalid nodes. Expecting an array.");for(r=0,n=s.length;r<n;r++){o=s[r],jP(o);const{key:h,attributes:l}=o;e?this.mergeNode(h,l):this.addNode(h,l)}}if(t.edges){let h=!1;if(this.type==="undirected"&&(h=!0),s=t.edges,!Array.isArray(s))throw new q("Graph.import: invalid edges. Expecting an array.");for(r=0,n=s.length;r<n;r++){a=s[r],YP(a);const{source:l,target:u,attributes:c,undirected:d=h}=a;let f;"key"in a?(f=e?d?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:d?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,a.key,l,u,c)):(f=e?d?this.mergeUndirectedEdge:this.mergeDirectedEdge:d?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,u,c))}}return this}nullCopy(t){const e=new Mt(qt({},this._options,t));return e.replaceAttributes(qt({},this.getAttributes())),e}emptyCopy(t){const e=this.nullCopy(t);return this._nodes.forEach((r,n)=>{const s=qt({},r.attributes);r=new e.NodeDataClass(n,s),e._nodes.set(n,r)}),e}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new ht(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new ht("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new ht("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const e=this.emptyCopy(t),r=this._edges.values();let n,s;for(;n=r.next(),n.done!==!0;)s=n.value,gy(e,"copy",!1,s.undirected,s.key,s.source.key,s.target.key,qt({},s.attributes));return e}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((s,o)=>{t[o]=s.attributes});const e={},r={};this._edges.forEach((s,o)=>{const a=s.undirected?"--":"->";let h="",l=s.source.key,u=s.target.key,c;s.undirected&&l>u&&(c=l,l=u,u=c);const d=`(${l})${a}(${u})`;o.startsWith("geid_")?this.multi&&(typeof r[d]>"u"?r[d]=0:r[d]++,h+=`${r[d]}. `):h+=`[${o}]: `,h+=d,e[h]=s.attributes});const n={};for(const s in this)this.hasOwnProperty(s)&&!Qf.has(s)&&typeof this[s]!="function"&&typeof s!="symbol"&&(n[s]=this[s]);return n.attributes=this._attributes,n.nodes=t,n.edges=e,we(n,"constructor",this.constructor),n}}typeof Symbol<"u"&&(Mt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Mt.prototype.inspect);ZP.forEach(i=>{["add","merge","update"].forEach(t=>{const e=i.name(t),r=t==="add"?gy:tN;i.generateKey?Mt.prototype[e]=function(n,s,o){return r(this,e,!0,(i.type||this.type)==="undirected",null,n,s,o,t==="update")}:Mt.prototype[e]=function(n,s,o,a){return r(this,e,!1,(i.type||this.type)==="undirected",n,s,o,a,t==="update")}})});lP(Mt);xP(Mt);OP(Mt);zP(Mt);class my extends Mt{constructor(t){const e=qt({type:"directed"},t);if("multi"in e&&e.multi!==!1)throw new q("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="directed")throw new q('DirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class yy extends Mt{constructor(t){const e=qt({type:"undirected"},t);if("multi"in e&&e.multi!==!1)throw new q("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="undirected")throw new q('UndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class vy extends Mt{constructor(t){const e=qt({multi:!0},t);if("multi"in e&&e.multi!==!0)throw new q("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(e)}}class _y extends Mt{constructor(t){const e=qt({type:"directed",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new q("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="directed")throw new q('MultiDirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class xy extends Mt{constructor(t){const e=qt({type:"undirected",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new q("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="undirected")throw new q('MultiUndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}function mn(i){i.from=function(t,e){const r=qt({},t.options,e),n=new i(r);return n.import(t),n}}mn(Mt);mn(my);mn(yy);mn(vy);mn(_y);mn(xy);Mt.Graph=Mt;Mt.DirectedGraph=my;Mt.UndirectedGraph=yy;Mt.MultiGraph=vy;Mt.MultiDirectedGraph=_y;Mt.MultiUndirectedGraph=xy;Mt.InvalidArgumentsGraphError=q;Mt.NotFoundGraphError=$;Mt.UsageGraphError=ht;function eN(i,t){const e={id:"ROOT"},r=[...new Set(i.filter(d=>d.SUBMODULE>t).map(d=>d.SUBMODULE))].filter(d=>d).map(d=>{const f=i.find(p=>p.SUBMODULE===d);return{id:"submodule-"+d,parent:"ROOT",NAME:f.SUBMODULE_NAME,type:"tier1"}}),n=[...new Set(i.filter(d=>d.SEGMENT&&d.SUBMODULE&&+d.SUBMODULE>t).map(d=>d.SUBMODULE+"_"+d.SEGMENT))].filter(d=>d!=="null_null").map(d=>{const f=i.find(p=>p.SUBMODULE===+d.split("_")[0]&&p.SEGMENT===+d.split("_")[1]);return{id:"segment-"+d,parent:"submodule-"+d.split("_")[0],NAME:f.SEGMENT_NAME,type:"tier2"}});let s=[e];i.forEach(d=>{let f;d.type==="tier1"?f="ROOT":d.type==="tier2"?f="submodule-"+d.SUBMODULE:f="segment-"+d.SUBMODULE+"_"+d.SEGMENT,s.push({parent:f,id:d.id,NAME:d.NAME,type:d.type})}),s=s.concat(r).concat(n);const o={},a=[];s.forEach(d=>{o[d.id]=d});for(const d in o)a.push(o[d]);s=a;debugger;function h(d,f){d.append("span").text(f.NAME),!(f.parent==="ROOT"||f.type==="tier1"||f.type==="tier2")&&d.append("input").attr("type","checkbox")}function l(d,f){const p=d.append("span").attr("class","list-label-"+f.depth);if(p.append("span").classed("arrow",!0),p.call(h,f.data),!f.hasOwnProperty("children"))return;const g=d.append("ul").style("list-style-type","none").selectAll("li").data(f.children,m=>m.NAME);g.exit().remove(),g.enter().append("li").attr("class","list-item-"+f.depth).style("cursor","pointer").merge(g).each(function(m){$t(this).call(l,m)}),p.select(".arrow").text(" ")}function u(d){d.classed("viewport",!0).style("overflow-y","scroll").style("height","calc(100vh - 170px)").append("div").classed("body",!0).style("transform","scale(1.5)").style("transform-origin","top left")}function c(d,f){const p=TM().id(g=>g.id).parentId(g=>g.parent)(f);p.eachBefore(g=>{g.children&&g.children.sort((m,y)=>m.data.id.localeCompare(y.data.id))}),d.select(".body").call(l,p),d.select(".body > span").remove(),d.select(".body > ul").style("padding-left",0)}$t("#view div").remove(),$t("#view").append("div").call(u).call(c,s)}function Ri(i){return Array.isArray?Array.isArray(i):Ey(i)==="[object Array]"}const iN=1/0;function rN(i){if(typeof i=="string")return i;let t=i+"";return t=="0"&&1/i==-iN?"-0":t}function nN(i){return i==null?"":rN(i)}function Je(i){return typeof i=="string"}function wy(i){return typeof i=="number"}function sN(i){return i===!0||i===!1||oN(i)&&Ey(i)=="[object Boolean]"}function by(i){return typeof i=="object"}function oN(i){return by(i)&&i!==null}function ve(i){return i!=null}function Ph(i){return!i.trim().length}function Ey(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}const aN="Incorrect 'index' type",hN=i=>`Invalid value for key ${i}`,lN=i=>`Pattern length exceeds max of ${i}.`,uN=i=>`Missing ${i} property in key`,cN=i=>`Property 'weight' in key '${i}' must be a positive integer`,tp=Object.prototype.hasOwnProperty;class dN{constructor(t){this._keys=[],this._keyMap={};let e=0;t.forEach(r=>{let n=Ay(r);this._keys.push(n),this._keyMap[n.id]=n,e+=n.weight}),this._keys.forEach(r=>{r.weight/=e})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ay(i){let t=null,e=null,r=null,n=1,s=null;if(Je(i)||Ri(i))r=i,t=ep(i),e=Yl(i);else{if(!tp.call(i,"name"))throw new Error(uN("name"));const o=i.name;if(r=o,tp.call(i,"weight")&&(n=i.weight,n<=0))throw new Error(cN(o));t=ep(o),e=Yl(o),s=i.getFn}return{path:t,id:e,weight:n,src:r,getFn:s}}function ep(i){return Ri(i)?i:i.split(".")}function Yl(i){return Ri(i)?i.join("."):i}function fN(i,t){let e=[],r=!1;const n=(s,o,a)=>{if(ve(s))if(!o[a])e.push(s);else{let h=o[a];const l=s[h];if(!ve(l))return;if(a===o.length-1&&(Je(l)||wy(l)||sN(l)))e.push(nN(l));else if(Ri(l)){r=!0;for(let u=0,c=l.length;u<c;u+=1)n(l[u],o,a+1)}else o.length&&n(l,o,a+1)}};return n(i,Je(t)?t.split("."):t,0),r?e:e[0]}const pN={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},gN={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(i,t)=>i.score===t.score?i.idx<t.idx?-1:1:i.score<t.score?-1:1},mN={location:0,threshold:.6,distance:100},yN={useExtendedSearch:!1,getFn:fN,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ct={...gN,...pN,...mN,...yN};const vN=/[^ ]+/g;function _N(i=1,t=3){const e=new Map,r=Math.pow(10,t);return{get(n){const s=n.match(vN).length;if(e.has(s))return e.get(s);const o=1/Math.pow(s,.5*i),a=parseFloat(Math.round(o*r)/r);return e.set(s,a),a},clear(){e.clear()}}}class Yu{constructor({getFn:t=ct.getFn,fieldNormWeight:e=ct.fieldNormWeight}={}){this.norm=_N(e,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((e,r)=>{this._keysMap[e.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Je(this.docs[0])?this.docs.forEach((t,e)=>{this._addString(t,e)}):this.docs.forEach((t,e)=>{this._addObject(t,e)}),this.norm.clear())}add(t){const e=this.size();Je(t)?this._addString(t,e):this._addObject(t,e)}removeAt(t){this.records.splice(t,1);for(let e=t,r=this.size();e<r;e+=1)this.records[e].i-=1}getValueForItemAtKeyId(t,e){return t[this._keysMap[e]]}size(){return this.records.length}_addString(t,e){if(!ve(t)||Ph(t))return;let r={v:t,i:e,n:this.norm.get(t)};this.records.push(r)}_addObject(t,e){let r={i:e,$:{}};this.keys.forEach((n,s)=>{let o=n.getFn?n.getFn(t):this.getFn(t,n.path);if(ve(o)){if(Ri(o)){let a=[];const h=[{nestedArrIndex:-1,value:o}];for(;h.length;){const{nestedArrIndex:l,value:u}=h.pop();if(ve(u))if(Je(u)&&!Ph(u)){let c={v:u,i:l,n:this.norm.get(u)};a.push(c)}else Ri(u)&&u.forEach((c,d)=>{h.push({nestedArrIndex:d,value:c})})}r.$[s]=a}else if(Je(o)&&!Ph(o)){let a={v:o,n:this.norm.get(o)};r.$[s]=a}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Ty(i,t,{getFn:e=ct.getFn,fieldNormWeight:r=ct.fieldNormWeight}={}){const n=new Yu({getFn:e,fieldNormWeight:r});return n.setKeys(i.map(Ay)),n.setSources(t),n.create(),n}function xN(i,{getFn:t=ct.getFn,fieldNormWeight:e=ct.fieldNormWeight}={}){const{keys:r,records:n}=i,s=new Yu({getFn:t,fieldNormWeight:e});return s.setKeys(r),s.setIndexRecords(n),s}function to(i,{errors:t=0,currentLocation:e=0,expectedLocation:r=0,distance:n=ct.distance,ignoreLocation:s=ct.ignoreLocation}={}){const o=t/i.length;if(s)return o;const a=Math.abs(r-e);return n?o+a/n:a?1:o}function wN(i=[],t=ct.minMatchCharLength){let e=[],r=-1,n=-1,s=0;for(let o=i.length;s<o;s+=1){let a=i[s];a&&r===-1?r=s:!a&&r!==-1&&(n=s-1,n-r+1>=t&&e.push([r,n]),r=-1)}return i[s-1]&&s-r>=t&&e.push([r,s-1]),e}const ar=32;function bN(i,t,e,{location:r=ct.location,distance:n=ct.distance,threshold:s=ct.threshold,findAllMatches:o=ct.findAllMatches,minMatchCharLength:a=ct.minMatchCharLength,includeMatches:h=ct.includeMatches,ignoreLocation:l=ct.ignoreLocation}={}){if(t.length>ar)throw new Error(lN(ar));const u=t.length,c=i.length,d=Math.max(0,Math.min(r,c));let f=s,p=d;const g=a>1||h,m=g?Array(c):[];let y;for(;(y=i.indexOf(t,p))>-1;){let S=to(t,{currentLocation:y,expectedLocation:d,distance:n,ignoreLocation:l});if(f=Math.min(S,f),p=y+u,g){let T=0;for(;T<u;)m[y+T]=1,T+=1}}p=-1;let _=[],v=1,x=u+c;const A=1<<u-1;for(let S=0;S<u;S+=1){let T=0,C=x;for(;T<C;)to(t,{errors:S,currentLocation:d+C,expectedLocation:d,distance:n,ignoreLocation:l})<=f?T=C:x=C,C=Math.floor((x-T)/2+T);x=C;let k=Math.max(1,d-C+1),O=o?c:Math.min(d+C,c)+u,M=Array(O+2);M[O+1]=(1<<S)-1;for(let I=O;I>=k;I-=1){let Q=I-1,et=e[i.charAt(Q)];if(g&&(m[Q]=+!!et),M[I]=(M[I+1]<<1|1)&et,S&&(M[I]|=(_[I+1]|_[I])<<1|1|_[I+1]),M[I]&A&&(v=to(t,{errors:S,currentLocation:Q,expectedLocation:d,distance:n,ignoreLocation:l}),v<=f)){if(f=v,p=Q,p<=d)break;k=Math.max(1,2*d-p)}}if(to(t,{errors:S+1,currentLocation:d,expectedLocation:d,distance:n,ignoreLocation:l})>f)break;_=M}const N={isMatch:p>=0,score:Math.max(.001,v)};if(g){const S=wN(m,a);S.length?h&&(N.indices=S):N.isMatch=!1}return N}function EN(i){let t={};for(let e=0,r=i.length;e<r;e+=1){const n=i.charAt(e);t[n]=(t[n]||0)|1<<r-e-1}return t}const Zo=String.prototype.normalize?i=>i.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):i=>i;class Sy{constructor(t,{location:e=ct.location,threshold:r=ct.threshold,distance:n=ct.distance,includeMatches:s=ct.includeMatches,findAllMatches:o=ct.findAllMatches,minMatchCharLength:a=ct.minMatchCharLength,isCaseSensitive:h=ct.isCaseSensitive,ignoreDiacritics:l=ct.ignoreDiacritics,ignoreLocation:u=ct.ignoreLocation}={}){if(this.options={location:e,threshold:r,distance:n,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:h,ignoreDiacritics:l,ignoreLocation:u},t=h?t:t.toLowerCase(),t=l?Zo(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const c=(f,p)=>{this.chunks.push({pattern:f,alphabet:EN(f),startIndex:p})},d=this.pattern.length;if(d>ar){let f=0;const p=d%ar,g=d-p;for(;f<g;)c(this.pattern.substr(f,ar),f),f+=ar;if(p){const m=d-ar;c(this.pattern.substr(m),m)}}else c(this.pattern,0)}searchIn(t){const{isCaseSensitive:e,ignoreDiacritics:r,includeMatches:n}=this.options;if(t=e?t:t.toLowerCase(),t=r?Zo(t):t,this.pattern===t){let g={isMatch:!0,score:0};return n&&(g.indices=[[0,t.length-1]]),g}const{location:s,distance:o,threshold:a,findAllMatches:h,minMatchCharLength:l,ignoreLocation:u}=this.options;let c=[],d=0,f=!1;this.chunks.forEach(({pattern:g,alphabet:m,startIndex:y})=>{const{isMatch:_,score:v,indices:x}=bN(t,g,m,{location:s+y,distance:o,threshold:a,findAllMatches:h,minMatchCharLength:l,includeMatches:n,ignoreLocation:u});_&&(f=!0),d+=v,_&&x&&(c=[...c,...x])});let p={isMatch:f,score:f?d/this.chunks.length:1};return f&&n&&(p.indices=c),p}}class ji{constructor(t){this.pattern=t}static isMultiMatch(t){return ip(t,this.multiRegex)}static isSingleMatch(t){return ip(t,this.singleRegex)}search(){}}function ip(i,t){const e=i.match(t);return e?e[1]:null}class AN extends ji{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const e=t===this.pattern;return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class TN extends ji{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const r=t.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class SN extends ji{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const e=t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class IN extends ji{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const e=!t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class CN extends ji{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const e=t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class MN extends ji{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const e=!t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class Iy extends ji{constructor(t,{location:e=ct.location,threshold:r=ct.threshold,distance:n=ct.distance,includeMatches:s=ct.includeMatches,findAllMatches:o=ct.findAllMatches,minMatchCharLength:a=ct.minMatchCharLength,isCaseSensitive:h=ct.isCaseSensitive,ignoreDiacritics:l=ct.ignoreDiacritics,ignoreLocation:u=ct.ignoreLocation}={}){super(t),this._bitapSearch=new Sy(t,{location:e,threshold:r,distance:n,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:h,ignoreDiacritics:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Cy extends ji{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let e=0,r;const n=[],s=this.pattern.length;for(;(r=t.indexOf(this.pattern,e))>-1;)e=r+s,n.push([r,e-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const ql=[AN,Cy,SN,IN,MN,CN,TN,Iy],rp=ql.length,RN=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,PN="|";function NN(i,t={}){return i.split(PN).map(e=>{let r=e.trim().split(RN).filter(s=>s&&!!s.trim()),n=[];for(let s=0,o=r.length;s<o;s+=1){const a=r[s];let h=!1,l=-1;for(;!h&&++l<rp;){const u=ql[l];let c=u.isMultiMatch(a);c&&(n.push(new u(c,t)),h=!0)}if(!h)for(l=-1;++l<rp;){const u=ql[l];let c=u.isSingleMatch(a);if(c){n.push(new u(c,t));break}}}return n})}const DN=new Set([Iy.type,Cy.type]);class LN{constructor(t,{isCaseSensitive:e=ct.isCaseSensitive,ignoreDiacritics:r=ct.ignoreDiacritics,includeMatches:n=ct.includeMatches,minMatchCharLength:s=ct.minMatchCharLength,ignoreLocation:o=ct.ignoreLocation,findAllMatches:a=ct.findAllMatches,location:h=ct.location,threshold:l=ct.threshold,distance:u=ct.distance}={}){this.query=null,this.options={isCaseSensitive:e,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:s,findAllMatches:a,ignoreLocation:o,location:h,threshold:l,distance:u},t=e?t:t.toLowerCase(),t=r?Zo(t):t,this.pattern=t,this.query=NN(this.pattern,this.options)}static condition(t,e){return e.useExtendedSearch}searchIn(t){const e=this.query;if(!e)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:s}=this.options;t=n?t:t.toLowerCase(),t=s?Zo(t):t;let o=0,a=[],h=0;for(let l=0,u=e.length;l<u;l+=1){const c=e[l];a.length=0,o=0;for(let d=0,f=c.length;d<f;d+=1){const p=c[d],{isMatch:g,indices:m,score:y}=p.search(t);if(g){if(o+=1,h+=y,r){const _=p.constructor.type;DN.has(_)?a=[...a,...m]:a.push(m)}}else{h=0,o=0,a.length=0;break}}if(o){let d={isMatch:!0,score:h/o};return r&&(d.indices=a),d}}return{isMatch:!1,score:1}}}const Kl=[];function BN(...i){Kl.push(...i)}function Zl(i,t){for(let e=0,r=Kl.length;e<r;e+=1){let n=Kl[e];if(n.condition(i,t))return new n(i,t)}return new Sy(i,t)}const Qo={AND:"$and",OR:"$or"},Ql={PATH:"$path",PATTERN:"$val"},Jl=i=>!!(i[Qo.AND]||i[Qo.OR]),ON=i=>!!i[Ql.PATH],kN=i=>!Ri(i)&&by(i)&&!Jl(i),np=i=>({[Qo.AND]:Object.keys(i).map(t=>({[t]:i[t]}))});function My(i,t,{auto:e=!0}={}){const r=n=>{let s=Object.keys(n);const o=ON(n);if(!o&&s.length>1&&!Jl(n))return r(np(n));if(kN(n)){const h=o?n[Ql.PATH]:s[0],l=o?n[Ql.PATTERN]:n[h];if(!Je(l))throw new Error(hN(h));const u={keyId:Yl(h),pattern:l};return e&&(u.searcher=Zl(l,t)),u}let a={children:[],operator:s[0]};return s.forEach(h=>{const l=n[h];Ri(l)&&l.forEach(u=>{a.children.push(r(u))})}),a};return Jl(i)||(i=np(i)),r(i)}function FN(i,{ignoreFieldNorm:t=ct.ignoreFieldNorm}){i.forEach(e=>{let r=1;e.matches.forEach(({key:n,norm:s,score:o})=>{const a=n?n.weight:null;r*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(t?1:s))}),e.score=r})}function UN(i,t){const e=i.matches;t.matches=[],ve(e)&&e.forEach(r=>{if(!ve(r.indices)||!r.indices.length)return;const{indices:n,value:s}=r;let o={indices:n,value:s};r.key&&(o.key=r.key.src),r.idx>-1&&(o.refIndex=r.idx),t.matches.push(o)})}function GN(i,t){t.score=i.score}function $N(i,t,{includeMatches:e=ct.includeMatches,includeScore:r=ct.includeScore}={}){const n=[];return e&&n.push(UN),r&&n.push(GN),i.map(s=>{const{idx:o}=s,a={item:t[o],refIndex:o};return n.length&&n.forEach(h=>{h(s,a)}),a})}class yn{constructor(t,e={},r){this.options={...ct,...e},this.options.useExtendedSearch,this._keyStore=new dN(this.options.keys),this.setCollection(t,r)}setCollection(t,e){if(this._docs=t,e&&!(e instanceof Yu))throw new Error(aN);this._myIndex=e||Ty(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){ve(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const e=[];for(let r=0,n=this._docs.length;r<n;r+=1){const s=this._docs[r];t(s,r)&&(this.removeAt(r),r-=1,n-=1,e.push(s))}return e}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:e=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:s,sortFn:o,ignoreFieldNorm:a}=this.options;let h=Je(t)?Je(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return FN(h,{ignoreFieldNorm:a}),s&&h.sort(o),wy(e)&&e>-1&&(h=h.slice(0,e)),$N(h,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(t){const e=Zl(t,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:s,i:o,n:a})=>{if(!ve(s))return;const{isMatch:h,score:l,indices:u}=e.searchIn(s);h&&n.push({item:s,idx:o,matches:[{score:l,value:s,norm:a,indices:u}]})}),n}_searchLogical(t){const e=My(t,this.options),r=(a,h,l)=>{if(!a.children){const{keyId:c,searcher:d}=a,f=this._findMatches({key:this._keyStore.get(c),value:this._myIndex.getValueForItemAtKeyId(h,c),searcher:d});return f&&f.length?[{idx:l,item:h,matches:f}]:[]}const u=[];for(let c=0,d=a.children.length;c<d;c+=1){const f=a.children[c],p=r(f,h,l);if(p.length)u.push(...p);else if(a.operator===Qo.AND)return[]}return u},n=this._myIndex.records,s={},o=[];return n.forEach(({$:a,i:h})=>{if(ve(a)){let l=r(e,a,h);l.length&&(s[h]||(s[h]={idx:h,item:a,matches:[]},o.push(s[h])),l.forEach(({matches:u})=>{s[h].matches.push(...u)}))}}),o}_searchObjectList(t){const e=Zl(t,this.options),{keys:r,records:n}=this._myIndex,s=[];return n.forEach(({$:o,i:a})=>{if(!ve(o))return;let h=[];r.forEach((l,u)=>{h.push(...this._findMatches({key:l,value:o[u],searcher:e}))}),h.length&&s.push({idx:a,item:o,matches:h})}),s}_findMatches({key:t,value:e,searcher:r}){if(!ve(e))return[];let n=[];if(Ri(e))e.forEach(({v:s,i:o,n:a})=>{if(!ve(s))return;const{isMatch:h,score:l,indices:u}=r.searchIn(s);h&&n.push({score:l,key:t,value:s,idx:o,norm:a,indices:u})});else{const{v:s,n:o}=e,{isMatch:a,score:h,indices:l}=r.searchIn(s);a&&n.push({score:h,key:t,value:s,norm:o,indices:l})}return n}}yn.version="7.1.0";yn.createIndex=Ty;yn.parseIndex=xN;yn.config=ct;yn.parseQuery=My;BN(LN);async function HN({nodes:i,links:t},{containerSelector:e,nodeId:r="id",sourceId:n="source",targetId:s="target",nodeGroup:o,nodeGroups:a,nodeRadius:h,nodeTitle:l,nodeFill:u="0xFFFFFF",nodeStroke:c="0xFFFFFF",nodeStrokeWidth:d=4,nodeFillOpacity:f=1,nodeStrokeOpacity:p=1,nodeMinSize:g=6,linkStroke:m="0xFFFFFF",linkStrokeOpacity:y=.7,linkStrokeWidth:_=1.5,labelColor:v="white",labelScale:x=2,colors:A=$M,width:N=640,height:S=400,tooltipStyles:T={width:"300px",height:"auto",padding:"10px","background-color":"white",border:"1px solid black","z-index":10}}={}){console.log("received data",i,t);const C=0;let k=0,O={},M={},E=[],I=[],Q=["NAME","Parameter Explanation","SUBMODULE_NAME","SEGMENT_NAME"],et=[],Y=!1,rt=!1,gt=!1,F=!0,H=!1,mt=!0,xt=!1,At=!0,Ut=1,Rt="Whole";const Xt=We(i,w=>w[r]).map(Dr),Kt=We(t,w=>w[n]).map(Dr),ae=We(t,w=>w[s]).map(Dr);i=We(i,(w,R)=>({id:Xt[R],...w,type:"tier3"})),t=We(t,(w,R)=>({source:Kt[R],target:ae[R]}));const Bt=[...new Set(i.filter(w=>w.SUBMODULE>C).map(w=>w.SUBMODULE))].filter(w=>w).map(w=>{O["submodule-"+w]=0,M[w]=F?1:0;const R=i.find(z=>z.SUBMODULE===w);return{id:"submodule-"+w,NAME:R?R.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE_NAME:R?R.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE:w,type:"tier1"}}),Tt=[...new Set(i.filter(w=>w.SUBMODULE>C).map(w=>w.SUBMODULE+"_"+w.SEGMENT))].filter(w=>w!=="null_null").map(w=>{O["segment-"+w]=0,M[w]=F?0:1;const R=i.find(z=>z.SUBMODULE===+w.split("_")[0]&&z.SEGMENT===+w.split("_")[1]);return{id:"segment-"+w,NAME:R?R.SEGMENT_NAME.split(",")[0]:"",SUBMODULE_NAME:R?R.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE:+w.split("_")[0],SEGMENT_NAME:R?R.SEGMENT_NAME.split(",")[0]:"",SEGMENT:+w.split("_")[1],type:"tier2"}});for(let w=0;w<i.length;w++)O[i[w].id]=0;for(let w=0;w<t.length;w++){let R=t[w];const z=i.find(W=>W.id===R.source),P=i.find(W=>W.id===R.target);O[R.target]++,O["segment-"+P.SUBMODULE+"_"+P.SEGMENT]++,O["submodule-"+P.SUBMODULE]++,R.sourceSegment=z.SEGMENT,R.targetSegment=P.SEGMENT,R.sourceSubmodule=z.SUBMODULE,R.targetSubmodule=P.SUBMODULE}let Lt=Ki(i,t,!0,"SUBMODULE",C),b=Ki(i.concat(Tt),t,F,"SUBMODULE",C),pe=[...Lt.nodes],Pt=[...Lt.links],Ge=[...Lt.nodes,...Tt,...Bt];const xs=UM().domain(h?NA(i,h):[0,jA(Object.values(O))]).range([g,g*5]).clamp(!0),hi=$t(e).append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden");for(const w in T)hi.style(w,T[w]);const li=$t(e).append("div").attr("class","message");if(li.append("h2").attr("class","clickedNodes-1"),li.append("h2").attr("class","clickedNodes-2"),li.append("h3").attr("class","shortestPath-status").style("color","white"),li.append("h3").attr("class","clickedNodes-reset").attr("text-decoration","underline").attr("pointer-events","auto").style("cursor","pointer").style("color","white").html("RESET").on("click",function(){Ar()}),window.location.href.includes("?state=%")){let w=window.location.href.split("?state=%")[1].split("-");w[0]=w[0].slice(2),w[w.length-1]=w[w.length-1].slice(0,-3),b.nodes=Ge.filter(P=>Lr(w,P.NAME.toString())),b.links=Pt.filter(P=>eo(w,P));for(let P=0;P<b.nodes.length;P++)Zu(b.nodes[P]),Ju(b.nodes[P]),tc(b.nodes[P]);const R=b.nodes.map(P=>P.id);let z=[];for(let P=0;P<b.links.length;P++)eo(R,b.links[P])&&z.push(b.links[P]);b.links=z,Bt.map(P=>{M[P.SUBMODULE]=1}),Tt.map(P=>{M[P.SEGMENT]=0})}const ee=$C().force("link",DC().id(w=>w.id)).force("x",WC(w=>w.x)).force("y",zC(w=>w.y)).force("collide",PC().radius(w=>w.type==="tier1"||w.type==="tier2"?w.radius*2:w.radius).iterations(3)).force("cluster",Dy().strength(.45));ee.stop();const xe=new Ng({width:N,height:S,resolution:2,transparent:!0,antialias:!0,autoDensity:!0,autoStart:!0});document.querySelector(e).appendChild(xe.view);const se=new yu({screenWidth:N,screenHeight:S,worldWidth:N,worldHeight:S,events:xe.renderer.events});xe.stage.eventMode="static",xe.stage.hitArea=xe.screen;const qu=()=>{xe.stage.off("pointermove"),se.pause=!1};xe.stage.on("pointerup",qu),xe.stage.on("pointerupoutside",qu),xe.stage.addChild(se),se.drag().pinch().wheel().decelerate().clampZoom({minScale:.2,maxScale:5}),se.center=new at(0,0);const ws=new Oo;ws.beginFill(u),ws.lineStyle(d,c,p),ws.drawCircle(0,0,44);const Ry=xe.renderer.generateTexture(ws,{resolution:2}),Yi=new Oo;let vn=12;Yi.beginFill(16777215,1),Yi.lineStyle(0,16777215,1),Yi.moveTo(-vn,0),Yi.lineTo(vn,vn),Yi.lineTo(vn,-vn),Yi.endFill();const Py=xe.renderer.generateTexture(Yi,{resolution:2}),ba=new Jt;se.addChild(ba);const Ea=new Jt;se.addChild(Ea);const Aa=new Jt;se.addChild(Aa);let ui=new WeakMap,_n=new WeakMap,qi=new WeakMap,ci=new WeakMap;Er(!0),ky();function Er(w){const R=[],z=new Set;for(let L=0;L<b.links.length;L++){let D=b.links[L];if(Object.keys(D).length===0)continue;const B=`${he(D)}-${oe(D)}`;!z.has(B)&&he(D)!==oe(D)&&(z.add(B),R.push(D))}b.links=R,l===void 0?We(b.nodes,L=>L.NAME).map(Dr):We(b.nodes,l).map(Dr);const P=o==null?null:We(b.nodes,o).map(Dr),W=typeof _!="function"?null:We(b.links,_),J=typeof m!="function"?null:We(b.links,m);P&&a===void 0&&(a=GA(P));const ut=o==null?null:Dm(a,A);for(let L=0;L<b.nodes.length;L++){let D=b.nodes[L];if(D.linkCnt=O[D.id]||0,D.color=P?ut(P[L]):u,D.radius=xs(D.linkCnt),I.length>0){let B=I.find(X=>X.id===D.SUBMODULE+"_"+D.SEGMENT)||I.find(X=>X.id===D.SUBMODULE);B&&!D.x&&!D.y&&(D.x=B.x,D.y=B.y)}}for(let L=0;L<b.links.length;L++){let D=b.links[L];D.linkStroke=J?J[L]:m,D.linkStrokeWidth=W?W[L]:_}console.log("elements on screen",b);const vt=Mn(b.nodes,b.links),U=()=>{const L=se.scale.x,B=[1,2,3,1/0].findIndex(X=>L<=X);for(let X=0;X<b.nodes.length;X++){const yt=qi.get(b.nodes[X]);yt.visible=b.nodes[X].type==="tier1"||b.nodes[X].type==="tier2"?1:B>=3}};let j=[];for(let L=0;L<Ge.length;L++){let D=Ge[L],B=ui.get(D),X=qi.get(D);if(b.nodes.findIndex(yt=>yt.id===D.id)===-1)B&&Ea.removeChild(B),X&&Aa.removeChild(X);else{if(!B){B=new Jt,B.name=D.id,B.cursor="pointer",B.hitArea=new us(0,0,D.radius+2),B.eventMode="static",B.visible=!Lr(E,D.id),B.on("pointerdown",Et=>{const It=_n.get(Et.currentTarget);It.pointerdown=!0,It.highlighted=!It.highlighted}),B.on("pointermove",Et=>{const It=_n.get(Et.currentTarget);if(It.pointerdown){se.pause=!0;const $e=se.toWorld(Et.global);Et.currentTarget.x=$e.x,Et.currentTarget.y=$e.y;const sc={radius:It.radius,x:$e.x,y:$e.y};vt.forEachEdge(It.id,(XN,VN,Sa,Ia)=>{const Fy=b.links.find(Tr=>Tr.source.id===Sa&&Tr.target.id===Ia),Uy=ci.get(Fy),Gy=Sa===It.id?sc:b.nodes.find(Tr=>Tr.id===Sa),$y=Ia===It.id?sc:b.nodes.find(Tr=>Tr.id===Ia);tt(Uy,Gy,$y)})}}),B.on("pointerup",Et=>{const It=_n.get(Et.currentTarget);It.pointerdown=!1,parseInt(It.x)!==parseInt(Et.currentTarget.x)&&(It.x=Et.currentTarget.x,It.y=Et.currentTarget.y,_t())}),B.on("mouseover",Et=>Oy(_n.get(Et.currentTarget))),B.on("mouseout",()=>hi.style("visibility","hidden"));const yt=new Ai(Ry);yt.name="CIRCLE",yt.x=-D.radius,yt.y=-D.radius,yt.tint=D.color,yt.alpha=f,yt.width=D.radius*2,yt.height=D.radius*2,B.addChild(yt),Ea.addChild(B)}if(!X){X=new Jt,X.visible=D.type==="tier1"||D.type==="tier2";const yt=new Ci({fontFamily:"Lato",fontSize:D.radius*x,align:"left",fill:v,stroke:"black",strokeThickness:6}),Et=new gu(D.NAME,yt);Et.name="LABEL";const It=vi.measureText(D.NAME,yt);Et.x=-It.width/4,Et.y=3,Et.resolution=2,Et.scale.set(.5),X.addChild(Et),Aa.addChild(X)}j.push([D,B,X])}}ba.removeChildren();let ft=[];for(let L=0;L<b.links.length;L++){let D=b.links[L];const B=D.linkStrokeWidth,X=b.nodes.find($e=>$e.id===oe(D)),yt=new Jt;yt.name=he(D)+"-"+oe(D),yt.pivot.set(0,B/2),yt.alpha=b.links.length>200?.3:y;const Et=new Ai(it.WHITE);Et.name="LINE",Et.x=X?X.radius:0,Et.y=-B/2,Et.height=B,yt.addChild(Et);const It=new Ai(Py);It.name="ARROW",It.x=X?X.radius:0,It.y=-3,It.width=6,It.height=6,It.alpha=H?1:0,yt.addChild(It),ba.addChild(yt),ft.push([D,yt])}ui=new WeakMap(j.map(([L,D,B])=>[L,D])),_n=new WeakMap(j.map(([L,D,B])=>[D,L])),qi=new WeakMap(j.map(([L,D,B])=>[L,B])),new WeakMap(j.map(([L,D,B])=>[B,L])),ci=new WeakMap(ft.map(([L,D])=>[L,D])),new WeakMap(ft.map(([L,D])=>[D,L])),ee.nodes(b.nodes).force("link").links(b.links),w?(console.log("run static graph layout"),ee.force("charge",HC().strength(F?-100:-250)),ee.alphaTarget(.1).restart(),ee.tick(Math.ceil(Math.log(ee.alphaMin())/Math.log(1-ee.alphaDecay()))),ee.stop(),_t(!0)):(console.log("reheat graph"),ee.stop(),ee.nodes([]).force("link").links([]),ee.nodes(b.nodes).force("link").links(b.links),ee.alphaTarget(.1).restart(),ee.tick(Math.ceil(Math.log(ee.alphaMin())/Math.log(1-ee.alphaDecay()))),ee.stop(),_t(!0)),I=b.nodes.filter(L=>L.type==="tier1"||L.type==="tier2").map(L=>({x:L.x,y:L.y,id:L.type==="tier1"?L.SUBMODULE:L.SUBMODULE+"_"+L.SEGMENT})),se.on("zoomed-end",()=>{if(se.dirty){if(rt||Y||gt)return;U(),se.dirty=!1}}),eN(b.nodes,C),nc(b.nodes,xt,vt),document.querySelector(".viewport").scrollTo(0,k),Eh(".list-label-2").on("click",function(L,D){if(rt||Y||gt)return;L.preventDefault(),L.stopPropagation(),k=document.querySelector(".viewport").scrollTop;let B=D.data;B.SUBMODULE=+B.id.split("-")[1].split("_")[0],B.SEGMENT=+B.id.split("-")[1].split("_")[1],$t(this).select(".arrow").text()!==" "?(console.log("expand segment to variable nodes",B.type),Qu(B)):(console.log("collapse variable nodes to segment"),B.type="tier3",Ku(B));const X=$t($t(this).node().parentNode).select("ul");if(X.size()){const yt=X.style("display")!=="none";$t(this).select(".arrow").text(yt?" ":" ")}}),Eh(".list-label-1").on("click",function(L,D){if(rt||Y||gt)return;L.preventDefault(),L.stopPropagation(),k=document.querySelector(".viewport").scrollTop;let B=D.data;B.SUBMODULE=+B.id.split("-")[1].split("_")[0],$t(this).select(".arrow").text()!==" "?(console.log("expand submodule to segments",B.type),Qu(B)):(console.log("collapse segments to submodules"),B.type="tier2",Ku(B));const X=$t($t(this).node().parentNode).select("ul");if(X.size()){const yt=X.style("display")!=="none";$t(this).select(".arrow").text(yt?" ":" ")}}),Eh(".list-label-3 input").on("change",function(L,D){L.preventDefault(),L.stopPropagation();const B=WN($t("#view"));if(console.log("checkbox click",B),B.length===0)return Ar();let X=[];if(mt&&(X=op(vt,B,Ut)),xt&&(ic(B),X=sp(vt,B),B.length===2&&(rt=!0,document.querySelectorAll('input[type="checkbox"]').forEach(yt=>yt.disabled=!0))),!mt&&!xt){const yt=B[B.length-1],Et=b.nodes.find(It=>It.NAME===yt);rc(Et),ec(Et.NAME)}X&&X.length>0&&Ta(X)});function tt(L,D,B){L.x=D.x,L.y=D.y,L.rotation=Math.atan2(B.y-D.y,B.x-D.x);const X=L.getChildByName("LINE"),yt=Math.max(Math.sqrt((B.x-D.x)**2+(B.y-D.y)**2)-D.radius-B.radius,0);X.width=yt}function _t(L){const D={x:[0,0],y:[0,0]};$t(".animation-container").style("display","none");for(let B=0;B<b.nodes.length;B++){let X=b.nodes[B];const yt=ui.get(X),Et=qi.get(X);yt.highlighted=X.highlighted?X.highlighted:!1,yt.x=X.x,yt.y=X.y,Et.x=X.x,Et.y=X.y,X.x<D.x[0]&&(D.x[0]=X.x),X.x>D.x[1]&&(D.x[1]=X.x),X.y<D.y[0]&&(D.y[0]=X.y),X.y>D.y[1]&&(D.y[1]=X.y)}L&&By(xe,se,D);for(let B=0;B<b.links.length;B++){let X=b.links[B];const yt=b.nodes.find($e=>$e.id===oe(X)),Et=b.nodes.find($e=>$e.id===he(X)),It=ci.get(X);tt(It,yt,Et)}}}function Ny(w){let R=0,z=0,P=0;for(const W of w){let J=xs(W.linkCnt)**2;R+=W.x*J,z+=W.y*J,P+=J}return{x:R/P,y:z/P}}function Dy(){var w=.8;let R;function z(P){const W=kA(R,Ny,o),J=P*w;for(const ut of R){const{x:vt,y:U}=W.get(ut.SUBMODULE);ut.vx-=(ut.x-vt)*J,ut.vy-=(ut.y-U)*J}}return z.initialize=P=>R=P,z.strength=function(P){return arguments.length?(w=+P,z):w},z}function Ly(w,R){if(et.length<2&&(et.indexOf(w.id)===-1?et.push(w.id):et.splice(w.id,1)),ic(et),et.length===2){const z=sp(R,et);rt=!0,z?(console.log("highlight connections"),Ta(z)):$t(".shortestPath-status").html("No shortest path found. Would you like to try again?"),document.querySelectorAll('input[type="checkbox"]').forEach(P=>P.disabled=!0)}}function Ki(w,R,z,P,W,J){let ut=w.filter(j=>j[P]>W);z&&(ut=ut.filter(j=>j.type!=="tier1"&&j.type!=="tier2"));const vt=ut.map(j=>j.id),U=R.filter(j=>eo(vt,j));if(z===!1){const j=ut.filter(tt=>J==="Quilt"?tt.type==="tier1":tt.type==="tier2"),ft=[];return U.forEach(tt=>{if(J==="Quilt"){const _t=ft.map(D=>D.sourceSubmodule+"_"+D.targetSubmodule),L=tt.sourceSubmodule+"_"+tt.targetSubmodule;_t.indexOf(L)===-1&&tt.sourceSubmodule!==null&&tt.targetSubmodule!==null&&ft.push({source:"submodule-"+tt.sourceSubmodule,target:"submodule-"+tt.targetSubmodule,sourceSegment:tt.sourceSubmodule,targetSegment:tt.targetSubmodule,sourceSubmodule:tt.sourceSubmodule,targetSubmodule:tt.targetSubmodule,type:"tier1"})}else{const _t=ft.map(D=>D.sourceSubmodule+"_"+D.sourceSegment+"_"+D.targetSubmodule+"_"+D.targetSegment),L=tt.sourceSubmodule+"_"+tt.sourceSegment+"_"+tt.targetSubmodule+"_"+tt.targetSegment;_t.indexOf(L)===-1&&tt.sourceSubmodule!==null&&tt.sourceSegment!==null&&tt.targetSubmodule!==null&&tt.targetSegment!==null&&ft.push({source:"segment-"+tt.sourceSubmodule+"_"+tt.sourceSegment,target:"segment-"+tt.targetSubmodule+"_"+tt.targetSegment,sourceSegment:tt.sourceSegment,targetSegment:tt.targetSegment,sourceSubmodule:tt.sourceSubmodule,targetSubmodule:tt.targetSubmodule,type:"tier2"})}}),{nodes:j,links:ft}}return{nodes:ut,links:U}}function Ku(w){if(w.type!=="tier1"){if(w.type==="tier2"){const R="submodule-"+w.SUBMODULE;b.nodes=b.nodes.filter(P=>P.SUBMODULE!==w.SUBMODULE),b.links=b.links.filter(P=>P.source.SUBMODULE!==w.SUBMODULE&&P.target.SUBMODULE!==w.SUBMODULE);const z=Bt.find(P=>P.id===R);b.nodes.push(z),Zu(w),M[w.SUBMODULE]=0}if(w.type==="tier3"){const R=pe.filter(U=>U.SUBMODULE===w.SUBMODULE&&U.SEGMENT===w.SEGMENT).map(U=>U.id),z=b.nodes.map(U=>U.id);let P=[];b.links.forEach(U=>{R.indexOf(he(U))!==-1&&P.push(U),R.indexOf(oe(U))!==-1&&P.push(U),z.indexOf(he(U))===-1&&P.push(U),z.indexOf(oe(U))===-1&&P.push(U)}),b.nodes=b.nodes.filter(U=>R.indexOf(U.id)===-1),b.links=b.links.filter(U=>P.indexOf(U)===-1);const W=Pt.filter(U=>U.sourceSubmodule===w.SUBMODULE&&U.sourceSegment===w.SEGMENT),J=Pt.filter(U=>U.targetSubmodule===w.SUBMODULE&&U.targetSegment===w.SEGMENT),ut="segment-"+w.SUBMODULE+"_"+w.SEGMENT,vt=Tt.find(U=>U.id===ut);b.nodes.push(vt),J.forEach(U=>{const j="segment-"+U.sourceSubmodule+"_"+U.sourceSegment,ft="submodule-"+U.sourceSubmodule,tt=he(U);let _t={};b.nodes.findIndex(L=>L.id===tt)!==-1?_t={source:tt,target:ut}:b.nodes.findIndex(L=>L.id===j)!==-1?_t={source:j,target:ut}:b.nodes.findIndex(L=>L.id===ft)!==-1&&(_t={source:ft,target:ut}),b.links.push(_t)}),W.forEach(U=>{const j="segment-"+U.targetSubmodule+"_"+U.targetSegment,ft="submodule-"+U.targetSubmodule,tt=oe(U);let _t={};b.nodes.findIndex(L=>L.id===tt)!==-1?_t={source:ut,target:tt}:b.nodes.findIndex(L=>L.id===j)!==-1?_t={source:ut,target:j}:b.nodes.findIndex(L=>L.id===ft)!==-1&&(_t={source:ut,target:ft}),b.links.push(_t)}),M[w.SUBMODULE+"_"+w.SEGMENT]=1,M[w.SUBMODULE]=1}Nh(b.nodes.map(R=>R.NAME).join("-")),$t(".animation-container").style("display","flex"),Er()}}function Zu(w){const R="submodule-"+w.SUBMODULE,z=Pt.filter(W=>W.sourceSubmodule===w.SUBMODULE);Pt.filter(W=>W.targetSubmodule===w.SUBMODULE).forEach(W=>{const J="segment-"+W.sourceSubmodule+"_"+W.sourceSegment,ut="submodule-"+W.sourceSubmodule,vt=he(W);let U={};b.nodes.findIndex(j=>j.id===vt)!==-1?U={source:vt,target:R}:b.nodes.findIndex(j=>j.id===J)!==-1?U={source:J,target:R}:b.nodes.findIndex(j=>j.id===ut)!==-1&&(U={source:ut,target:R}),b.links.push(U)}),z.forEach(W=>{const J="segment-"+W.targetSubmodule+"_"+W.targetSegment,ut="submodule-"+W.targetSubmodule,vt=oe(W);let U={};b.nodes.findIndex(j=>j.id===vt)!==-1?U={source:R,target:vt}:b.nodes.findIndex(j=>j.id===J)!==-1?U={source:R,target:J}:b.nodes.findIndex(j=>j.id===ut)!==-1&&(U={source:R,target:ut}),b.links.push(U)})}function Qu(w){if(w.type!=="tier3"){if(w.type==="tier1"){M[w.SUBMODULE]=0;const R=Tt.filter(z=>z.SUBMODULE===w.SUBMODULE);R.forEach(z=>{M[z.SUBMODULE+"_"+z.SEGMENT]=1}),b.nodes=b.nodes.concat(R),b.nodes=b.nodes.filter(z=>z.id!=="submodule-"+w.SUBMODULE),b.links=b.links.filter(z=>he(z)!=="submodule-"+w.SUBMODULE&&oe(z)!=="submodule-"+w.SUBMODULE),Ju(w)}if(w.type==="tier2"){const R=w.id;M[w.SUBMODULE+"_"+w.SEGMENT]=0,b.nodes=b.nodes.filter(J=>J.id!==R&&J.id!=="submodule-"+w.SUBMODULE),b.links=b.links.filter(J=>he(J)!==R&&oe(J)!==R);const z=pe.filter(J=>J.SUBMODULE===w.SUBMODULE&&J.SEGMENT===w.SEGMENT&&J.type!=="tier1"&&J.type!=="tier2"),W=Pt.filter(J=>J.sourceSubmodule===w.SUBMODULE&&J.targetSubmodule===w.SUBMODULE&&J.targetSegment===w.SEGMENT&&J.sourceSegment===w.SEGMENT);b.nodes=b.nodes.concat(z),b.links=b.links.concat(W),tc(w)}Nh(b.nodes.map(R=>R.NAME).join("-")),Er()}}function Ju(w){const R=Pt.filter(W=>W.sourceSubmodule===w.SUBMODULE&&W.targetSubmodule!==w.SUBMODULE),z=Pt.filter(W=>W.targetSubmodule===w.SUBMODULE&&W.sourceSubmodule!==w.SUBMODULE);Pt.filter(W=>W.targetSubmodule===w.SUBMODULE&&W.sourceSubmodule===w.SUBMODULE).forEach(W=>{b.links.push({source:"segment-"+w.SUBMODULE+"_"+W.sourceSegment,target:"segment-"+w.SUBMODULE+"_"+W.targetSegment})}),R.forEach(W=>{const J="segment-"+w.SUBMODULE+"_"+W.sourceSegment,ut="segment-"+W.targetSubmodule+"_"+W.targetSegment,vt="submodule-"+W.targetSubmodule,U=oe(W);let j={};b.nodes.findIndex(ft=>ft.id===ut)!==-1?j={source:J,target:ut}:b.nodes.findIndex(ft=>ft.id===vt)!==-1?j={source:J,target:vt}:b.nodes.findIndex(ft=>ft.id===U)!==-1&&(j={source:J,target:U}),b.links.push(j)}),z.forEach(W=>{const J="segment-"+w.SUBMODULE+"_"+W.targetSegment,ut="segment-"+W.sourceSubmodule+"_"+W.sourceSegment,vt="submodule-"+W.sourceSubmodule,U=he(W);let j={};b.nodes.findIndex(ft=>ft.id===ut)!==-1?j={source:ut,target:J}:b.nodes.findIndex(ft=>ft.id===vt)!==-1?j={source:vt,target:J}:b.nodes.findIndex(ft=>ft.id===U)!==-1&&(j={source:U,target:J}),b.links.push(j)})}function tc(w){const R=Pt.filter(P=>P.sourceSubmodule===w.SUBMODULE&&P.sourceSegment===w.SEGMENT),z=Pt.filter(P=>P.targetSubmodule===w.SUBMODULE&&P.targetSegment===w.SEGMENT);R.forEach(P=>{const W=he(P),J="segment-"+P.targetSubmodule+"_"+P.targetSegment,ut="submodule-"+P.targetSubmodule,vt=oe(P);let U={};b.nodes.findIndex(j=>j.id===J)!==-1?U={source:W,target:J}:b.nodes.findIndex(j=>j.id===ut)!==-1?U={source:W,target:ut}:b.nodes.findIndex(j=>j.id===W)!==-1&&b.nodes.findIndex(j=>j.id===vt)!==-1&&(U=P),b.links.push(U)}),z.forEach(P=>{const W=oe(P),J="segment-"+P.sourceSubmodule+"_"+P.sourceSegment,ut="submodule-"+P.sourceSubmodule,vt=he(P);let U={};b.nodes.findIndex(j=>j.id===J)!==-1?U={source:J,target:W}:b.nodes.findIndex(j=>j.id==ut)!==-1?U={source:ut,target:W}:b.nodes.findIndex(j=>j.id===vt)!==-1&&b.nodes.findIndex(j=>j.id===W)!==-1&&(U=P),b.links.push(U)})}function Ta(w){b.nodes.forEach(R=>{const z=ui.get(R);z.visible=!!Lr(w,R.id);const P=qi.get(R);P.visible=!!Lr(w,R.id)}),b.links.forEach(R=>{const z=ci.get(R);z.alpha=eo(w,R)?.7:0}),Nh(w.map(R=>R).join("-"))}function ec(w){b.nodes.forEach(R=>{const z=ui.get(R);z.visible=!0,z.alpha=R.NAME===w?1:.2;const P=qi.get(R);P.visible=R.NAME===w}),b.links.forEach(R=>{const z=ci.get(R);z.alpha=.1})}function ic(w){const R=b.nodes.find(P=>P.id===w[0]),z=b.nodes.find(P=>P.id===w[1]);w[0]&&$t(".clickedNodes-1").html("Start node: "+(R?R.NAME:"")),w[1]&&$t(".clickedNodes-2").html("End node: "+(z?z.NAME:"")),w.length>0&&$t(".message").style("visibility","visible")}function Ar(){b.nodes.forEach(w=>{const R=ui.get(w);R.alpha=1,R.visible=!Lr(E,w.id);const z=qi.get(w);z.visible=w.type==="tier1"||w.type==="tier2"}),b.links.forEach(w=>{const R=ci.get(w);R.alpha=b.links.length>200?.3:y}),Y&&(se.animate({position:new at(0,0),scaleX:1,scaleY:1,time:1e3}),document.getElementById("search-input").value="",document.getElementById("suggestions-container").innerHTML="",document.getElementById("reset-search").style.display="none",li.select(".shortestPath-status").html(""),Y=!1),gt=!1,rt=!1,et=[],li.select(".clickedNodes-1").html(""),li.select(".clickedNodes-2").html(""),li.select(".shortestPath-status").html(""),li.style("visibility","hidden"),hi.style("visibility","hidden").attr("pointer-events","none"),document.querySelectorAll('input[type="checkbox"]').forEach(w=>w.checked=!1),document.querySelectorAll('input[type="checkbox"]').forEach(w=>w.disabled=!1)}function rc(w){se.animate({position:new at(w.x,w.y),scaleX:2,scaleY:2,time:800}),Y=!0}function By(w,R,z){const P=z.x[1]-z.x[0],W=z.y[1]-z.y[0],J=N,ut=S;console.log(z,J,ut);const vt=J/P,U=ut/W,j=Math.min(vt,U);R.scale.set(j)}function Oy(w){let R=[];R.push(`<div><h3 style='text-align: center'>${w.NAME}</h3></div>`);const z=Ge.find(W=>W.NAME===w.NAME);Q.forEach(W=>{z[W]&&z[W]!==""&&R.push(`<div><b>${W}: </b><span>${z[W]}</span></div>`)});let P="";R.map(W=>P+=W),hi.html(`${P}`).style("top","150px").style("left","5px").style("visibility","visible")}function ky(){function w(tt,_t,L){const D=document.createElement("button");return D.textContent=tt,L!==6?D.classList.add("button"):D.classList.add("button1"),D.addEventListener("click",_t),D}function R(tt){switch(tt.target.getAttribute("data-button-id")){case"button1":H=!H,H?(tt.target.classList.add("clicked"),b.links.forEach(B=>{const X=ci.get(B);X.getChildByName("ARROW").alpha=1})):(tt.target.classList.remove("clicked"),b.links.forEach(B=>{const X=ci.get(B);X.getChildByName("ARROW").alpha=0}));break;case"button2":xt=!xt,xt?tt.target.classList.add("clicked"):(tt.target.classList.remove("clicked"),Ar()),mt=!1,gt=!1,document.querySelector('.button[data-button-id="button3"]').classList.remove("clicked");const L=Mn(b.nodes,b.links);nc(b.nodes,xt,L);break;case"button3":if(rt)return;mt=!mt,mt?tt.target.classList.add("clicked"):(tt.target.classList.remove("clicked"),Ar()),xt=!1,document.querySelector('.button[data-button-id="button2"]').classList.remove("clicked");break;case"button4":if(rt||Y||gt)return;F=!F,M={},Bt.map(B=>{M[B.SUBMODULE]=F?1:0}),Tt.map(B=>{M[B.SUBMODULE+"_"+B.SEGMENT]=F?0:1}),F?(tt.target.classList.add("clicked"),b=Ki(i,t,!0,"SUBMODULE",C),Er(!0)):(tt.target.classList.remove("clicked"),b=Ki(i.concat(Tt),t,!1,"SUBMODULE",C),Er(!0));break;case"button5":if(rt||Y||gt)return;if(At=!At,At)tt.target.classList.remove("clicked"),b.nodes.forEach(B=>{const X=ui.get(B);X.visible=!0}),E=[];else{tt.target.classList.add("clicked");const B=Mn(b.nodes,b.links);E=b.nodes.filter(X=>B.degreeWithoutSelfLoops(X.id)===0).map(X=>X.id),b.nodes.forEach(X=>{const yt=ui.get(X);yt.visible=!Lr(E,X.id)})}break;case"button6":Ar(),document.querySelectorAll("button").forEach(function(B,X){X!==3&&B.classList.remove("clicked")}),b.links.forEach(B=>{const X=ci.get(B);X.getChildByName("ARROW").alpha=0}),b.nodes.forEach(B=>{const X=ui.get(B);X.visible=!0,X.alpha=1}),et=[],rt=!1,gt=!1,F=!1,H=!1,mt=!1,xt=!1,Y=!1,At=!0,Rt==="Quilt"&&(b=Ki(i.concat(Bt),Pt,!1,"SUBMODULE",C,"Quilt")),Rt==="Middle"&&(b=Ki(i.concat(Tt),Pt,!1,"SUBMODULE",C)),Rt==="Whole"&&(b=Ki(pe,Pt,!0,"SUBMODULE",C)),Er();break}}const z=document.getElementById("buttonPanel"),P=document.createElement("div"),W=document.createElement("div");z.appendChild(P),z.appendChild(W),["Show directions","Show shortest path","Show neighbors"].forEach((tt,_t)=>{const L=w(tt,R,_t+1);L.setAttribute("data-button-id",`button${_t+1}`),H&&_t===0&&L.classList.add("clicked"),xt&&_t===1&&L.classList.add("clicked"),mt&&_t===2&&L.classList.add("clicked"),At&&_t===5&&L.classList.add("clicked"),P.appendChild(L)});const J=document.createElement("select");J.id="degreeSelection",P.appendChild(J);const ut=[1,2,3];for(var vt=0;vt<ut.length;vt++){var U=document.createElement("option");U.value=ut[vt],U.text=ut[vt],J.appendChild(U)}document.getElementById("degreeSelection").addEventListener("change",function(){Ut=document.getElementById("degreeSelection").value;const tt=Mn(b.nodes,b.links),_t=op(tt,et,Ut);_t&&_t.length>0&&Ta(_t)}),["Expanded Graph","Hide Single Nodes","Reset"].forEach((tt,_t)=>{const L=w(tt,R,_t+4);L.setAttribute("data-button-id",`button${_t+4}`),W.appendChild(L)});const j=document.createElement("select");j.classList.add("default-dd"),j.id="resetSelection",W.appendChild(j);const ft=["Quilt","Middle","Whole"];for(var vt=0;vt<ft.length;vt++){var U=document.createElement("option");U.value=ft[vt],U.text=ft[vt],U.value===Rt&&(U.selected=!0),j.appendChild(U)}document.getElementById("resetSelection").addEventListener("change",function(){Rt=document.getElementById("resetSelection").value})}function nc(w,R,z){z||(z=Mn(b.nodes,b.links));const P=document.getElementById("search-input"),W=document.getElementById("reset-search"),J=document.getElementById("suggestions-container");function ut(U){const j={keys:["NAME","DEFINITION"],threshold:.4};return new yn(w,j).search(U).map(_t=>_t.item)}function vt(U){const j=ut(U);J.innerHTML="",j.sort(function(ft,tt){return ft.NAME.toLowerCase().localeCompare(tt.NAME.toLowerCase())}),j.forEach(ft=>{const tt=document.createElement("div");tt.classList.add("suggestion"),tt.textContent=ft.DEFINITION?`${ft.NAME} - ${ft.DEFINITION}`:ft.NAME,tt.addEventListener("click",()=>{Y=!0,P.value=ft.NAME,J.style.display="none",W.style.display="block",b.nodes.find(_t=>_t.NAME===ft.NAME)?(R?Ly(ft,z):ec(ft.NAME),rc(ft),document.querySelectorAll('input[type="checkbox"]').forEach(_t=>_t.disabled=!0)):($t(".message").style("visibility","visible"),$t(".shortestPath-status").html("No such node found."))}),J.appendChild(tt)}),j.length>0?J.style.display="block":J.style.display="none"}P.addEventListener("input",()=>{ee.alpha(0);const U=P.value;vt(U)}),W.addEventListener("click",()=>{Y=!1,P.value="",J.innerHTML="",W.style.display="none",Ar()}),document.addEventListener("click",U=>{J.contains(U.target)||(J.style.display="none")})}}function sp(i,t){return DR.bidirectional(i,t[0],t[1])}function op(i,t,e){let r=[];return t.forEach(n=>{Yf(i,n.id?n.id:n,function(s,o,a){a<=e&&r.push(s)},{mode:"outbound"}),Yf(i,n.id?n.id:n,function(s,o,a){a<=e&&r.push(s)},{mode:"inbound"})}),r}function Mn(i,t){const e=new Mt;for(let r=0;r<i.length;r++)e.hasNode(i[r].id)||e.addNode(i[r].id);for(let r=0;r<t.length;r++){let n=he(t[r]),s=oe(t[r]);e.hasNode(n)&&e.hasNode(s)&&(e.hasEdge(n,s)||e.addEdge(n,s))}return e}function Nh(i){const t=encodeURIComponent(JSON.stringify(i)),e=`${window.location.pathname}?state=${t}`;window.history.pushState({state:i},"",e)}function WN(i){return i.selectAll("input:checked").data().map(t=>t.id)}function Dr(i){return i!==null&&typeof i=="object"?i.valueOf():i}function he(i){return i.source&&(i.source.id?i.source.id:i.source)}function oe(i){return i.target&&(i.target.id?i.target.id:i.target)}function eo(i,t){return i.indexOf(he(t))!==-1&&i.indexOf(oe(t))!==-1}function Lr(i,t){return i.indexOf(t)!==-1}async function zN(){try{const[i,t]=await Promise.all([fetch("./assets/nodes.json"),fetch("/assets/edges.json")]);if(!i.ok||!t.ok)throw new Error(`HTTP error! Status: ${i.status} ${t.status}`);const e=await i.json(),r=await t.json();if(e&&r){const n=["#418BFC","#46BCC8","#D6AB1B","#EB5E68","#B6BE1C","#F64D1A","#BA6DE4","#EA6BCB","#B9AAC8","#F08519"],s=e.map(o=>({NAME:o.NAME,DEFINITION:o.DEFINITION,SUBMODULE:o.SUBMODULE,SUBMODULE_NAME:o["SUBMODULE NAME"],SEGMENT:o.SEGMENT,SEGMENT_NAME:o["SEGMENT NAME"],UNITS:o.UNITS,ReportValue:o.ReportValue,...o}));HN({nodes:s,links:r},{containerSelector:"#app",nodeId:"NAME",sourceId:"UsesVariable",targetId:"Variable",nodeGroup:o=>o.SUBMODULE,nodeTitle:o=>o.NAME,nodeStroke:"#000",linkStrokeWidth:.6,linkStroke:"#fff",labelColor:"#fff",labelScale:3,colors:n,width:window.innerWidth,height:window.innerHeight})}else throw new Error("Invalid response format")}catch(i){console.error("Error fetching data:",i)}}zN();
