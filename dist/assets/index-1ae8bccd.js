(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();/*!
 * pixi.js - v7.3.2
 * Compiled Fri, 20 Oct 2023 15:28:31 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var gs=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(gs||{}),Ry=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(Ry||{}),Fu=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Fu||{}),dt=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(dt||{}),Ii=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Ii||{}),G=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(G||{}),Ys=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Ys||{}),lt=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(lt||{}),Q=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Q||{}),Yi=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Yi||{}),br=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(br||{}),Bi=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Bi||{}),Ue=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(Ue||{}),Ai=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Ai||{}),bd=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(bd||{}),Ke=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ke||{}),de=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(de||{}),le=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(le||{}),Ri=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(Ri||{});const t1={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var i;return(i=document.baseURI)!=null?i:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},tt={ADAPTER:t1,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var wl=/iPhone/i,Bf=/iPod/i,Ff=/iPad/i,Df=/\biOS-universal(?:.+)Mac\b/i,El=/\bAndroid(?:.+)Mobile\b/i,Lf=/Android/i,Es=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Go=/Silk/i,Ui=/Windows Phone/i,kf=/\bWindows(?:.+)ARM\b/i,Uf=/BlackBerry/i,Gf=/BB10/i,$f=/Opera Mini/i,Hf=/\b(CriOS|Chrome)(?:.+)Mobile/i,Xf=/Mobile(?:.+)Firefox\b/i,zf=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function e1(i){return function(t){return t.test(i)}}function Vf(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var s=e1(e),n={apple:{phone:s(wl)&&!s(Ui),ipod:s(Bf),tablet:!s(wl)&&(s(Ff)||zf(t))&&!s(Ui),universal:s(Df),device:(s(wl)||s(Bf)||s(Ff)||s(Df)||zf(t))&&!s(Ui)},amazon:{phone:s(Es),tablet:!s(Es)&&s(Go),device:s(Es)||s(Go)},android:{phone:!s(Ui)&&s(Es)||!s(Ui)&&s(El),tablet:!s(Ui)&&!s(Es)&&!s(El)&&(s(Go)||s(Lf)),device:!s(Ui)&&(s(Es)||s(Go)||s(El)||s(Lf))||s(/\bokhttp\b/i)},windows:{phone:s(Ui),tablet:s(kf),device:s(Ui)||s(kf)},other:{blackberry:s(Uf),blackberry10:s(Gf),opera:s($f),firefox:s(Xf),chrome:s(Hf),device:s(Uf)||s(Gf)||s($f)||s(Xf)||s(Hf)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}var Wf;const i1=(Wf=Vf.default)!=null?Wf:Vf,qi=i1(globalThis.navigator);tt.RETINA_PREFIX=/@([0-9\.]+)x/;tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function My(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Py={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,d,c){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||h,c),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],l,u;if(this._eventsCount===0)return h;for(u in l=this._events)t.call(l,u)&&h.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(l)):h},a.prototype.listeners=function(h){var l=e?e+h:h,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,c=u.length,f=new Array(c);d<c;d++)f[d]=u[d].fn;return f},a.prototype.listenerCount=function(h){var l=e?e+h:h,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,l,u,d,c,f){var p=e?e+h:h;if(!this._events[p])return!1;var m=this._events[p],g=arguments.length,y,_;if(m.fn){switch(m.once&&this.removeListener(h,m.fn,void 0,!0),g){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,l),!0;case 3:return m.fn.call(m.context,l,u),!0;case 4:return m.fn.call(m.context,l,u,d),!0;case 5:return m.fn.call(m.context,l,u,d,c),!0;case 6:return m.fn.call(m.context,l,u,d,c,f),!0}for(_=1,y=new Array(g-1);_<g;_++)y[_-1]=arguments[_];m.fn.apply(m.context,y)}else{var v=m.length,x;for(_=0;_<v;_++)switch(m[_].once&&this.removeListener(h,m[_].fn,void 0,!0),g){case 1:m[_].fn.call(m[_].context);break;case 2:m[_].fn.call(m[_].context,l);break;case 3:m[_].fn.call(m[_].context,l,u);break;case 4:m[_].fn.call(m[_].context,l,u,d);break;default:if(!y)for(x=1,y=new Array(g-1);x<g;x++)y[x-1]=arguments[x];m[_].fn.apply(m[_].context,y)}}return!0},a.prototype.on=function(h,l,u){return n(this,h,l,u,!1)},a.prototype.once=function(h,l,u){return n(this,h,l,u,!0)},a.prototype.removeListener=function(h,l,u,d){var c=e?e+h:h;if(!this._events[c])return this;if(!l)return o(this,c),this;var f=this._events[c];if(f.fn)f.fn===l&&(!d||f.once)&&(!u||f.context===u)&&o(this,c);else{for(var p=0,m=[],g=f.length;p<g;p++)(f[p].fn!==l||d&&!f[p].once||u&&f[p].context!==u)&&m.push(f[p]);m.length?this._events[c]=m.length===1?m[0]:m:o(this,c)}return this},a.prototype.removeAllListeners=function(h){var l;return h?(l=e?e+h:h,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(Py);var r1=Py.exports,To=My(r1),wd={exports:{}};wd.exports=zh;wd.exports.default=zh;function zh(i,t,e){e=e||2;var r=t&&t.length,s=r?t[0]*e:i.length,n=Ny(i,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var a,h,l,u,d,c,f;if(r&&(n=h1(i,t,n,e)),i.length>80*e){a=l=i[0],h=u=i[1];for(var p=e;p<s;p+=e)d=i[p],c=i[p+1],d<a&&(a=d),c<h&&(h=c),d>l&&(l=d),c>u&&(u=c);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return ho(n,o,e,a,h,f,0),o}function Ny(i,t,e,r,s){var n,o;if(s===ku(i,t,e,r)>0)for(n=t;n<e;n+=r)o=jf(n,i[n],i[n+1],o);else for(n=e-r;n>=t;n-=r)o=jf(n,i[n],i[n+1],o);return o&&Vh(o,o.next)&&(uo(o),o=o.next),o}function hs(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(Vh(e,e.next)||ee(e.prev,e,e.next)===0)){if(uo(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function ho(i,t,e,r,s,n,o){if(i){!o&&n&&f1(i,r,s,n);for(var a=i,h,l;i.prev!==i.next;){if(h=i.prev,l=i.next,n?n1(i,r,s,n):s1(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(l.i/e|0),uo(i),i=l.next,a=l.next;continue}if(i=l,i===a){o?o===1?(i=o1(hs(i),t,e),ho(i,t,e,r,s,n,2)):o===2&&a1(i,t,e,r,s,n):ho(hs(i),t,e,r,s,n,1);break}}}}function s1(i){var t=i.prev,e=i,r=i.next;if(ee(t,e,r)>=0)return!1;for(var s=t.x,n=e.x,o=r.x,a=t.y,h=e.y,l=r.y,u=s<n?s<o?s:o:n<o?n:o,d=a<h?a<l?a:l:h<l?h:l,c=s>n?s>o?s:o:n>o?n:o,f=a>h?a>l?a:l:h>l?h:l,p=r.next;p!==t;){if(p.x>=u&&p.x<=c&&p.y>=d&&p.y<=f&&Xs(s,a,n,h,o,l,p.x,p.y)&&ee(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function n1(i,t,e,r){var s=i.prev,n=i,o=i.next;if(ee(s,n,o)>=0)return!1;for(var a=s.x,h=n.x,l=o.x,u=s.y,d=n.y,c=o.y,f=a<h?a<l?a:l:h<l?h:l,p=u<d?u<c?u:c:d<c?d:c,m=a>h?a>l?a:l:h>l?h:l,g=u>d?u>c?u:c:d>c?d:c,y=Du(f,p,t,e,r),_=Du(m,g,t,e,r),v=i.prevZ,x=i.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==o&&Xs(a,u,h,d,l,c,v.x,v.y)&&ee(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==o&&Xs(a,u,h,d,l,c,x.x,x.y)&&ee(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==o&&Xs(a,u,h,d,l,c,v.x,v.y)&&ee(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==o&&Xs(a,u,h,d,l,c,x.x,x.y)&&ee(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function o1(i,t,e){var r=i;do{var s=r.prev,n=r.next.next;!Vh(s,n)&&Oy(s,r,r.next,n)&&lo(s,n)&&lo(n,s)&&(t.push(s.i/e|0),t.push(r.i/e|0),t.push(n.i/e|0),uo(r),uo(r.next),r=i=n),r=r.next}while(r!==i);return hs(r)}function a1(i,t,e,r,s,n){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&g1(o,a)){var h=By(o,a);o=hs(o,o.next),h=hs(h,h.next),ho(o,t,e,r,s,n,0),ho(h,t,e,r,s,n,0);return}a=a.next}o=o.next}while(o!==i)}function h1(i,t,e,r){var s=[],n,o,a,h,l;for(n=0,o=t.length;n<o;n++)a=t[n]*r,h=n<o-1?t[n+1]*r:i.length,l=Ny(i,a,h,r,!1),l===l.next&&(l.steiner=!0),s.push(m1(l));for(s.sort(l1),n=0;n<s.length;n++)e=u1(s[n],e);return e}function l1(i,t){return i.x-t.x}function u1(i,t){var e=c1(i,t);if(!e)return t;var r=By(e,i);return hs(r,r.next),hs(e,e.next)}function c1(i,t){var e=t,r=i.x,s=i.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>n&&(n=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,u=o.y,d=1/0,c;e=o;do r>=e.x&&e.x>=l&&r!==e.x&&Xs(s<u?r:n,s,l,u,s<u?n:r,s,e.x,e.y)&&(c=Math.abs(s-e.y)/(r-e.x),lo(e,i)&&(c<d||c===d&&(e.x>o.x||e.x===o.x&&d1(o,e)))&&(o=e,d=c)),e=e.next;while(e!==h);return o}function d1(i,t){return ee(i.prev,i,t.prev)<0&&ee(t.next,i,i.next)<0}function f1(i,t,e,r){var s=i;do s.z===0&&(s.z=Du(s.x,s.y,t,e,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,p1(s)}function p1(i){var t,e,r,s,n,o,a,h,l=1;do{for(e=i,i=null,n=null,o=0;e;){for(o++,r=e,a=0,t=0;t<l&&(a++,r=r.nextZ,!!r);t++);for(h=l;a>0||h>0&&r;)a!==0&&(h===0||!r||e.z<=r.z)?(s=e,e=e.nextZ,a--):(s=r,r=r.nextZ,h--),n?n.nextZ=s:i=s,s.prevZ=n,n=s;e=r}n.nextZ=null,l*=2}while(o>1);return i}function Du(i,t,e,r,s){return i=(i-e)*s|0,t=(t-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function m1(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Xs(i,t,e,r,s,n,o,a){return(s-o)*(t-a)>=(i-o)*(n-a)&&(i-o)*(r-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(s-o)*(r-a)}function g1(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!y1(i,t)&&(lo(i,t)&&lo(t,i)&&_1(i,t)&&(ee(i.prev,i,t.prev)||ee(i,t.prev,t))||Vh(i,t)&&ee(i.prev,i,i.next)>0&&ee(t.prev,t,t.next)>0)}function ee(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Vh(i,t){return i.x===t.x&&i.y===t.y}function Oy(i,t,e,r){var s=Ho(ee(i,t,e)),n=Ho(ee(i,t,r)),o=Ho(ee(e,r,i)),a=Ho(ee(e,r,t));return!!(s!==n&&o!==a||s===0&&$o(i,e,t)||n===0&&$o(i,r,t)||o===0&&$o(e,i,r)||a===0&&$o(e,t,r))}function $o(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Ho(i){return i>0?1:i<0?-1:0}function y1(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Oy(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function lo(i,t){return ee(i.prev,i,i.next)<0?ee(i,t,i.next)>=0&&ee(i,i.prev,t)>=0:ee(i,t,i.prev)<0||ee(i,i.next,t)<0}function _1(i,t){var e=i,r=!1,s=(i.x+t.x)/2,n=(i.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function By(i,t){var e=new Lu(i.i,i.x,i.y),r=new Lu(t.i,t.x,t.y),s=i.next,n=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,r.next=e,e.prev=r,n.next=r,r.prev=n,r}function jf(i,t,e,r){var s=new Lu(i,t,e);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function uo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Lu(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}zh.deviation=function(i,t,e,r){var s=t&&t.length,n=s?t[0]*e:i.length,o=Math.abs(ku(i,0,n,e));if(s)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:i.length;o-=Math.abs(ku(i,l,u,e))}var d=0;for(a=0;a<r.length;a+=3){var c=r[a]*e,f=r[a+1]*e,p=r[a+2]*e;d+=Math.abs((i[c]-i[p])*(i[f+1]-i[c+1])-(i[c]-i[f])*(i[p+1]-i[c+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function ku(i,t,e,r){for(var s=0,n=t,o=e-r;n<e;n+=r)s+=(i[o]-i[n])*(i[n+1]+i[o+1]),o=n;return s}zh.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,s=0;s<i.length;s++){for(var n=0;n<i[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(i[s][n][o]);s>0&&(r+=i[s-1].length,e.holes.push(r))}return e};var v1=wd.exports,x1=My(v1),th={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */th.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,n=typeof Tl=="object"&&Tl;(n.global===n||n.window===n||n.self===n)&&(e=n);var o,a=2147483647,h=36,l=1,u=26,d=38,c=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,b=Math.floor,M=String.fromCharCode,S;function A(I){throw RangeError(v[I])}function R(I,C){for(var z=I.length,ht=[];z--;)ht[z]=C(I[z]);return ht}function L(I,C){var z=I.split("@"),ht="";z.length>1&&(ht=z[0]+"@",I=z[1]),I=I.replace(_,".");var ot=I.split("."),pt=R(ot,C).join(".");return ht+pt}function B(I){for(var C=[],z=0,ht=I.length,ot,pt;z<ht;)ot=I.charCodeAt(z++),ot>=55296&&ot<=56319&&z<ht?(pt=I.charCodeAt(z++),(pt&64512)==56320?C.push(((ot&1023)<<10)+(pt&1023)+65536):(C.push(ot),z--)):C.push(ot);return C}function P(I){return R(I,function(C){var z="";return C>65535&&(C-=65536,z+=M(C>>>10&1023|55296),C=56320|C&1023),z+=M(C),z}).join("")}function E(I){return I-48<10?I-22:I-65<26?I-65:I-97<26?I-97:h}function N(I,C){return I+22+75*(I<26)-((C!=0)<<5)}function q(I,C,z){var ht=0;for(I=z?b(I/c):I>>1,I+=b(I/C);I>x*u>>1;ht+=h)I=b(I/x);return b(ht+(x+1)*I/(I+d))}function Y(I){var C=[],z=I.length,ht,ot=0,pt=p,vt=f,Ct,Dt,qt,$t,xt,At,Tt,Qt,T;for(Ct=I.lastIndexOf(m),Ct<0&&(Ct=0),Dt=0;Dt<Ct;++Dt)I.charCodeAt(Dt)>=128&&A("not-basic"),C.push(I.charCodeAt(Dt));for(qt=Ct>0?Ct+1:0;qt<z;){for($t=ot,xt=1,At=h;qt>=z&&A("invalid-input"),Tt=E(I.charCodeAt(qt++)),(Tt>=h||Tt>b((a-ot)/xt))&&A("overflow"),ot+=Tt*xt,Qt=At<=vt?l:At>=vt+u?u:At-vt,!(Tt<Qt);At+=h)T=h-Qt,xt>b(a/T)&&A("overflow"),xt*=T;ht=C.length+1,vt=q(ot-$t,ht,$t==0),b(ot/ht)>a-pt&&A("overflow"),pt+=b(ot/ht),ot%=ht,C.splice(ot++,0,pt)}return P(C)}function et(I){var C,z,ht,ot,pt,vt,Ct,Dt,qt,$t,xt,At=[],Tt,Qt,T,$e;for(I=B(I),Tt=I.length,C=p,z=0,pt=f,vt=0;vt<Tt;++vt)xt=I[vt],xt<128&&At.push(M(xt));for(ht=ot=At.length,ot&&At.push(m);ht<Tt;){for(Ct=a,vt=0;vt<Tt;++vt)xt=I[vt],xt>=C&&xt<Ct&&(Ct=xt);for(Qt=ht+1,Ct-C>b((a-z)/Qt)&&A("overflow"),z+=(Ct-C)*Qt,C=Ct,vt=0;vt<Tt;++vt)if(xt=I[vt],xt<C&&++z>a&&A("overflow"),xt==C){for(Dt=z,qt=h;$t=qt<=pt?l:qt>=pt+u?u:qt-pt,!(Dt<$t);qt+=h)$e=Dt-$t,T=h-$t,At.push(M(N($t+$e%T,0))),Dt=b($e/T);At.push(M(N(Dt,0))),pt=q(z,Qt,ht==ot),z=0,++ht}++z,++C}return At.join("")}function ut(I){return L(I,function(C){return g.test(C)?Y(C.slice(4).toLowerCase()):C})}function yt(I){return L(I,function(C){return y.test(C)?"xn--"+et(C):C})}if(o={version:"1.3.2",ucs2:{decode:B,encode:P},decode:Y,encode:et,toASCII:yt,toUnicode:ut},r&&s)if(i.exports==r)s.exports=o;else for(S in o)o.hasOwnProperty(S)&&(r[S]=o[S]);else e.punycode=o})(Tl)})(th,th.exports);var b1=th.exports,w1={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},co={};function E1(i,t){return Object.prototype.hasOwnProperty.call(i,t)}var T1=function(i,t,e,r){t=t||"&",e=e||"=";var s={};if(typeof i!="string"||i.length===0)return s;var n=/\+/g;i=i.split(t);var o=1e3;r&&typeof r.maxKeys=="number"&&(o=r.maxKeys);var a=i.length;o>0&&a>o&&(a=o);for(var h=0;h<a;++h){var l=i[h].replace(n,"%20"),u=l.indexOf(e),d,c,f,p;u>=0?(d=l.substr(0,u),c=l.substr(u+1)):(d=l,c=""),f=decodeURIComponent(d),p=decodeURIComponent(c),E1(s,f)?Array.isArray(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s},In=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},A1=function(i,t,e,r){return t=t||"&",e=e||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(s){var n=encodeURIComponent(In(s))+e;return Array.isArray(i[s])?i[s].map(function(o){return n+encodeURIComponent(In(o))}).join(t):n+encodeURIComponent(In(i[s]))}).join(t):r?encodeURIComponent(In(r))+e+encodeURIComponent(In(i)):""};co.decode=co.parse=T1;co.encode=co.stringify=A1;var S1=b1,Vi=w1;function Ji(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var I1=/^([a-z0-9.+-]+:)/i,C1=/:[0-9]*$/,R1=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,M1=["<",">",'"',"`"," ","\r",`
`,"	"],P1=["{","}","|","\\","^","`"].concat(M1),Uu=["'"].concat(P1),Yf=["%","/","?",";","#"].concat(Uu),qf=["/","?","#"],N1=255,Kf=/^[+a-z0-9A-Z_-]{0,63}$/,O1=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,B1={javascript:!0,"javascript:":!0},Gu={javascript:!0,"javascript:":!0},qs={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},$u=co;function F1(i,t,e){if(i&&Vi.isObject(i)&&i instanceof Ji)return i;var r=new Ji;return r.parse(i,t,e),r}Ji.prototype.parse=function(i,t,e){if(!Vi.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),s=r!==-1&&r<i.indexOf("#")?"?":"#",n=i.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),i=n.join(s);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var h=R1.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=$u.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=I1.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var d=a.substr(0,2)==="//";d&&!(l&&Gu[l])&&(a=a.substr(2),this.slashes=!0)}if(!Gu[l]&&(d||l&&!qs[l])){for(var c=-1,f=0;f<qf.length;f++){var p=a.indexOf(qf[f]);p!==-1&&(c===-1||p<c)&&(c=p)}var m,g;c===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",c),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),c=-1;for(var f=0;f<Yf.length;f++){var p=a.indexOf(Yf[f]);p!==-1&&(c===-1||p<c)&&(c=p)}c===-1&&(c=a.length),this.host=a.slice(0,c),a=a.slice(c),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),f=0,v=_.length;f<v;f++){var x=_[f];if(x&&!x.match(Kf)){for(var b="",M=0,S=x.length;M<S;M++)x.charCodeAt(M)>127?b+="x":b+=x[M];if(!b.match(Kf)){var A=_.slice(0,f),R=_.slice(f+1),L=x.match(O1);L&&(A.push(L[1]),R.unshift(L[2])),R.length&&(a="/"+R.join(".")+a),this.hostname=A.join(".");break}}}this.hostname.length>N1?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=S1.toASCII(this.hostname));var B=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+B,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!B1[u])for(var f=0,v=Uu.length;f<v;f++){var E=Uu[f];if(a.indexOf(E)!==-1){var N=encodeURIComponent(E);N===E&&(N=escape(E)),a=a.split(E).join(N)}}var q=a.indexOf("#");q!==-1&&(this.hash=a.substr(q),a=a.slice(0,q));var Y=a.indexOf("?");if(Y!==-1?(this.search=a.substr(Y),this.query=a.substr(Y+1),t&&(this.query=$u.parse(this.query)),a=a.slice(0,Y)):t&&(this.search="",this.query={}),a&&(this.pathname=a),qs[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",et=this.search||"";this.path=B+et}return this.href=this.format(),this};Ji.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=i+this.host:this.hostname&&(s=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&Vi.isObject(this.query)&&Object.keys(this.query).length&&(n=$u.stringify(this.query));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||qs[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+s+e+o+r};Ji.prototype.resolve=function(i){return this.resolveObject(F1(i,!1,!0)).format()};Ji.prototype.resolveObject=function(i){if(Vi.isString(i)){var t=new Ji;t.parse(i,!1,!0),i=t}for(var e=new Ji,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];e[n]=this[n]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=i[h])}return qs[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!qs[i.protocol]){for(var l=Object.keys(i),u=0;u<l.length;u++){var d=l[u];e[d]=i[d]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Gu[i.protocol]){for(var v=(i.pathname||"").split("/");v.length&&!(i.host=v.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),v[0]!==""&&v.unshift(""),v.length<2&&v.unshift(""),e.pathname=v.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var c=e.pathname||"",f=e.search||"";e.path=c+f}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",m=i.host||i.pathname&&i.pathname.charAt(0)==="/",g=m||p||e.host&&i.pathname,y=g,_=e.pathname&&e.pathname.split("/")||[],v=i.pathname&&i.pathname.split("/")||[],x=e.protocol&&!qs[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(_[0]===""?_[0]=e.host:_.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(v[0]===""?v[0]=i.host:v.unshift(i.host)),i.host=null),g=g&&(v[0]===""||_[0]==="")),m)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,_=v;else if(v.length)_||(_=[]),_.pop(),_=_.concat(v),e.search=i.search,e.query=i.query;else if(!Vi.isNullOrUndefined(i.search)){if(x){e.hostname=e.host=_.shift();var b=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;b&&(e.auth=b.shift(),e.host=e.hostname=b.shift())}return e.search=i.search,e.query=i.query,(!Vi.isNull(e.pathname)||!Vi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!_.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var M=_.slice(-1)[0],S=(e.host||i.host||_.length>1)&&(M==="."||M==="..")||M==="",A=0,R=_.length;R>=0;R--)M=_[R],M==="."?_.splice(R,1):M===".."?(_.splice(R,1),A++):A&&(_.splice(R,1),A--);if(!g&&!y)for(;A--;A)_.unshift("..");g&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),S&&_.join("/").substr(-1)!=="/"&&_.push("");var L=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(x){e.hostname=e.host=L?"":_.length?_.shift():"";var b=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;b&&(e.auth=b.shift(),e.host=e.hostname=b.shift())}return g=g||e.host&&_.length,g&&!L&&_.unshift(""),_.length?e.pathname=_.join("/"):(e.pathname=null,e.path=null),(!Vi.isNull(e.pathname)||!Vi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};Ji.prototype.parseHost=function(){var i=this.host,t=C1.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const Zf={};function Mt(i,t,e=3){if(Zf[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),Zf[t]=!0}function ri(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function Cn(i){return i.split("?")[0].split("#")[0]}function D1(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L1(i,t,e){return i.replace(new RegExp(D1(t),"g"),e)}function k1(i,t){let e="",r=0,s=-1,n=0,o=-1;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",r=0):(e=e.slice(0,h),r=e.length-1-e.lastIndexOf("/")),s=a,n=0;continue}}else if(e.length===2||e.length===1){e="",r=0,s=a,n=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(s+1,a)}`:e=i.slice(s+1,a),r=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return e}const ge={toPosix(i){return L1(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){ri(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(ri(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=Cn(this.toPosix(t??tt.ADAPTER.getBaseUrl())),s=Cn(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?ge.join(s,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(ri(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=k1(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return ri(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){var t;if(i.length===0)return".";let e;for(let r=0;r<i.length;++r){const s=i[r];if(ri(s),s.length>0)if(e===void 0)e=s;else{const n=(t=i[r-1])!=null?t:"";this.extname(n)?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(i){if(ri(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,s=!0;const n=this.getProtocol(i),o=i;i=i.slice(n.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!s){r=a;break}}else s=!1;return r===-1?e?"/":this.isUrl(o)?n+i:n:e&&r===1?"//":n+i.slice(0,r)},rootname(i){ri(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){ri(i),t&&ri(t),i=Cn(this.toPosix(i));let e=0,r=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(n=i.length-1;n>=0;--n){const h=i.charCodeAt(n);if(h===47){if(!s){e=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(n=i.length-1;n>=0;--n)if(i.charCodeAt(n)===47){if(!s){e=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":i.slice(e,r)},extname(i){ri(i),i=Cn(this.toPosix(i));let t=-1,e=0,r=-1,s=!0,n=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!s){e=o+1;break}continue}r===-1&&(s=!1,r=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||r===-1||n===0||n===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){ri(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=Cn(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let s;t.root=this.rootname(i),r||this.hasProtocol(i)?s=1:s=0;let n=-1,o=0,a=-1,h=!0,l=i.length-1,u=0;for(;l>=s;--l){if(e=i.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?n===-1?n=l:u!==1&&(u=1):n!==-1&&(u=-1)}return n===-1||a===-1||u===0||u===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&r?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(o,a)):(o===0&&r?(t.name=i.slice(1,n),t.base=i.slice(1,a)):(t.name=i.slice(o,n),t.base=i.slice(o,a)),t.ext=i.slice(n,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};let Al;async function U1(){return Al!=null||(Al=(async()=>{var i;const t=document.createElement("canvas").getContext("webgl");if(!t)return Ue.UNPACK;const e=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!e)return Ue.UNPACK;const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const n=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(s),t.deleteTexture(r),(i=t.getExtension("WEBGL_lose_context"))==null||i.loseContext(),n[0]<=n[3]?Ue.PMA:Ue.UNPACK})()),Al}let Sl;function G1(){return typeof Sl>"u"&&(Sl=function(){var i;const t={stencil:!0,failIfMajorPerformanceCaveat:tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!tt.ADAPTER.getWebGLRenderingContext())return!1;const e=tt.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const s=!!((i=r==null?void 0:r.getContextAttributes())!=null&&i.stencil);if(r){const n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,s}catch{return!1}}()),Sl}var $1={grad:.9,turn:360,rad:360/(2*Math.PI)},Gi=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},be=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Ze=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},Fy=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Qf=function(i){return{r:Ze(i.r,0,255),g:Ze(i.g,0,255),b:Ze(i.b,0,255),a:Ze(i.a)}},Il=function(i){return{r:be(i.r),g:be(i.g),b:be(i.b),a:be(i.a,3)}},H1=/^#([0-9a-f]{3,8})$/i,Xo=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},Dy=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=Math.max(t,e,r),o=n-Math.min(t,e,r),a=o?n===t?(e-r)/o:n===e?2+(r-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},Ly=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),o=r*(1-e),a=r*(1-(t-n)*e),h=r*(1-(1-t+n)*e),l=n%6;return{r:255*[r,a,o,o,h,r][l],g:255*[h,r,r,a,o,o][l],b:255*[o,o,h,r,r,a][l],a:s}},Jf=function(i){return{h:Fy(i.h),s:Ze(i.s,0,100),l:Ze(i.l,0,100),a:Ze(i.a)}},tp=function(i){return{h:be(i.h),s:be(i.s),l:be(i.l),a:be(i.a,3)}},ep=function(i){return Ly((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},io=function(i){return{h:(t=Dy(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},X1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,z1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,V1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,W1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Hu={string:[[function(i){var t=H1.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?be(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?be(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=V1.exec(i)||W1.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Qf({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=X1.exec(i)||z1.exec(i);if(!t)return null;var e,r,s=Jf({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*($1[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return ep(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=s===void 0?1:s;return Gi(t)&&Gi(e)&&Gi(r)?Qf({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,n=s===void 0?1:s;if(!Gi(t)||!Gi(e)||!Gi(r))return null;var o=Jf({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return ep(o)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,n=s===void 0?1:s;if(!Gi(t)||!Gi(e)||!Gi(r))return null;var o=function(a){return{h:Fy(a.h),s:Ze(a.s,0,100),v:Ze(a.v,0,100),a:Ze(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return Ly(o)},"hsv"]]},ip=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},j1=function(i){return typeof i=="string"?ip(i.trim(),Hu.string):typeof i=="object"&&i!==null?ip(i,Hu.object):[null,void 0]},Cl=function(i,t){var e=io(i);return{h:e.h,s:Ze(e.s+100*t,0,100),l:e.l,a:e.a}},Rl=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},rp=function(i,t){var e=io(i);return{h:e.h,s:e.s,l:Ze(e.l+100*t,0,100),a:e.a}},Xu=function(){function i(t){this.parsed=j1(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return be(Rl(this.rgba),2)},i.prototype.isDark=function(){return Rl(this.rgba)<.5},i.prototype.isLight=function(){return Rl(this.rgba)>=.5},i.prototype.toHex=function(){return t=Il(this.rgba),e=t.r,r=t.g,s=t.b,o=(n=t.a)<1?Xo(be(255*n)):"","#"+Xo(e)+Xo(r)+Xo(s)+o;var t,e,r,s,n,o},i.prototype.toRgb=function(){return Il(this.rgba)},i.prototype.toRgbString=function(){return t=Il(this.rgba),e=t.r,r=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+s+", "+n+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,n},i.prototype.toHsl=function(){return tp(io(this.rgba))},i.prototype.toHslString=function(){return t=tp(io(this.rgba)),e=t.h,r=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+n+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,n},i.prototype.toHsv=function(){return t=Dy(this.rgba),{h:be(t.h),s:be(t.s),v:be(t.v),a:be(t.a,3)};var t},i.prototype.invert=function(){return vi({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),vi(Cl(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),vi(Cl(this.rgba,-t))},i.prototype.grayscale=function(){return vi(Cl(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),vi(rp(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),vi(rp(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?vi({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):be(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=io(this.rgba);return typeof t=="number"?vi({h:t,s:e.s,l:e.l,a:e.a}):be(e.h)},i.prototype.isEqual=function(t){return this.toHex()===vi(t).toHex()},i}(),vi=function(i){return i instanceof Xu?i:new Xu(i)},sp=[],Y1=function(i){i.forEach(function(t){sp.indexOf(t)<0&&(t(Xu,Hu),sp.push(t))})};function q1(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var n={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=r[this.toHex()];if(l)return l;if(o!=null&&o.closest){var u=this.toRgb(),d=1/0,c="black";if(!n.length)for(var f in e)n[f]=new i(e[f]).toRgb();for(var p in e){var m=(a=u,h=n[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<d&&(d=m,c=p)}return c}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new i(h).toRgb():null},"name"])}var K1=Object.defineProperty,np=Object.getOwnPropertySymbols,Z1=Object.prototype.hasOwnProperty,Q1=Object.prototype.propertyIsEnumerable,op=(i,t,e)=>t in i?K1(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,J1=(i,t)=>{for(var e in t||(t={}))Z1.call(t,e)&&op(i,e,t[e]);if(np)for(var e of np(t))Q1.call(t,e)&&op(i,e,t[e]);return i};Y1([q1]);const Os=class Pa{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Pa)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?J1({},t):t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,r,s]=this._components;return{r:t,g:e,b:r,a:s}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,r,s]=this._components;return t[0]=e,t[1]=r,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,s,n]=Pa.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,s,n]=this._components;return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}normalize(t){let e,r,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,r=(o>>8&255)/255,s=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,s,n=255]=t,e/=255,r/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Pa.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=vi(t);o.isValid()&&({r:e,g:r,b:s,a:n}=o.rgba,e/=255,r/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),r)}),t)}};Os.shared=new Os,Os.temp=new Os,Os.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Zt=Os;function tb(i){return Mt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Zt.shared.setValue(i).toHex()}function eb(i){return Mt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Zt.shared.setValue(i).toNumber()}function ib(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[dt.NORMAL_NPM]=dt.NORMAL,i[dt.ADD_NPM]=dt.ADD,i[dt.SCREEN_NPM]=dt.SCREEN,t[dt.NORMAL]=dt.NORMAL_NPM,t[dt.ADD]=dt.ADD_NPM,t[dt.SCREEN]=dt.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const ky=ib();function Uy(i,t){return ky[t?1:0][i]}function rb(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,s=0;r<e;r+=6,s+=4)t[r+0]=s+0,t[r+1]=s+1,t[r+2]=s+2,t[r+3]=s+0,t[r+4]=s+2,t[r+5]=s+3;return t}function Gy(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function eh(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function ap(i){return!(i&i-1)&&!!i}function hp(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Ks(i,t,e){const r=i.length;let s;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(s=t;s<n;++s)i[s]=i[s+e];i.length=n}function gr(i){return i===0?0:i<0?-1:1}let sb=0;function ls(){return++sb}const zu=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};zu.EMPTY=new zu(0,0,0,0);let lp=zu;const up={},xi=Object.create(null),lr=Object.create(null);class nb{constructor(t,e,r){this._canvas=tt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||tt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function cp(i,t,e){for(let r=0,s=4*e*t;r<t;++r,s+=4)if(i[s+3]!==0)return!1;return!0}function dp(i,t,e,r,s){const n=4*t;for(let o=r,a=r*n+4*e;o<=s;++o,a+=n)if(i[a+3]!==0)return!1;return!0}function ob(i){const{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const s=r.getImageData(0,0,t,e).data;let n=0,o=0,a=t-1,h=e-1;for(;o<e&&cp(s,t,o);)++o;if(o===e)return lp.EMPTY;for(;cp(s,t,h);)--h;for(;dp(s,t,n,o,h);)++n;for(;dp(s,t,a,o,h);)--a;return++a,++h,new lp(n,o,a,h)}function ab(i){const t=ob(i),{width:e,height:r}=t;let s=null;if(!t.isEmpty()){const n=i.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:s}}function hb(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function rr(i,t=1){var e;const r=(e=tt.RETINA_PREFIX)==null?void 0:e.exec(i);return r?parseFloat(r[1]):t}var lb=Object.defineProperty,ub=Object.defineProperties,cb=Object.getOwnPropertyDescriptors,fp=Object.getOwnPropertySymbols,db=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,pp=(i,t,e)=>t in i?lb(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,mp=(i,t)=>{for(var e in t||(t={}))db.call(t,e)&&pp(i,e,t[e]);if(fp)for(var e of fp(t))fb.call(t,e)&&pp(i,e,t[e]);return i},pb=(i,t)=>ub(i,cb(t)),W=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(W||{});const Vu=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");const t=typeof i.extension!="object"?{type:i.extension}:i.extension;i=pb(mp({},t),{ref:i})}if(typeof i=="object")i=mp({},i);else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},gp=(i,t)=>{var e;return(e=Vu(i).priority)!=null?e:t},nt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(Vu).forEach(t=>{t.type.forEach(e=>{var r,s;return(s=(r=this._removeHandlers)[e])==null?void 0:s.call(r,t)})}),this},add(...i){return i.map(Vu).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,s=this._queue;r[e]?r[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;const n=this._queue;return n[i]&&(n[i].forEach(o=>t(o)),delete n[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,n)=>gp(n,e)-gp(s,e)))},r=>{const s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};let Wu=class{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}};const mb=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function gb(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function yb(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=mb.replace(/%forloop%/gi,gb(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Ml=0,Pl=1,Nl=2,Ol=3,Bl=4,Fl=5;let Ar=class $y{constructor(){this.data=0,this.blendMode=dt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Ml)}set blend(t){!!(this.data&1<<Ml)!==t&&(this.data^=1<<Ml)}get offsets(){return!!(this.data&1<<Pl)}set offsets(t){!!(this.data&1<<Pl)!==t&&(this.data^=1<<Pl)}get culling(){return!!(this.data&1<<Nl)}set culling(t){!!(this.data&1<<Nl)!==t&&(this.data^=1<<Nl)}get depthTest(){return!!(this.data&1<<Ol)}set depthTest(t){!!(this.data&1<<Ol)!==t&&(this.data^=1<<Ol)}get depthMask(){return!!(this.data&1<<Fl)}set depthMask(t){!!(this.data&1<<Fl)!==t&&(this.data^=1<<Fl)}get clockwiseFrontFace(){return!!(this.data&1<<Bl)}set clockwiseFrontFace(t){!!(this.data&1<<Bl)!==t&&(this.data^=1<<Bl)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==dt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new $y;return t.depthTest=!1,t.blend=!0,t}};Ar.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const ju=[];function Hy(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=ju.length-1;r>=0;--r){const s=ju[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}let di=class{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,n,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let d=0,c=u.length;d<c;d++)u[d][l](t,e,r,s,n,o,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(di.prototype,{dispatch:{value:di.prototype.emit},run:{value:di.prototype.emit}});let fo=class{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new di("setRealSize"),this.onUpdate=new di("update"),this.onError=new di("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}},Wh=class extends fo{constructor(t,e){var r;const{width:s,height:n}=e||{};if(!s||!n)throw new Error("BufferResource width or height invalid");super(s,n),this.data=t,this.unpackAlignment=(r=e.unpackAlignment)!=null?r:4}upload(t,e,r){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ue.UNPACK);const n=e.realWidth,o=e.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(e.target,0,0,0,n,o,e.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(e.target,0,r.internalFormat,n,o,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}};var _b=Object.defineProperty,yp=Object.getOwnPropertySymbols,vb=Object.prototype.hasOwnProperty,xb=Object.prototype.propertyIsEnumerable,_p=(i,t,e)=>t in i?_b(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,bb=(i,t)=>{for(var e in t||(t={}))vb.call(t,e)&&_p(i,e,t[e]);if(yp)for(var e of yp(t))xb.call(t,e)&&_p(i,e,t[e]);return i};const wb={scaleMode:Yi.NEAREST,alphaMode:Ue.NPM},Yu=class Bs extends To{constructor(t=null,e=null){super(),e=Object.assign({},Bs.defaultOptions,e);const{alphaMode:r,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:d,target:c,resolution:f,resourceOptions:p}=e;t&&!(t instanceof fo)&&(t=Hy(t,p),t.internal=!0),this.resolution=f||tt.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=d,this.target=c,this.alphaMode=r,this.uid=ls(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ap(this.realWidth)&&ap(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete lr[this.cacheId],delete xi[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Bs.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=tt.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${ls()}`}n=t._pixiId}let o=lr[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new Bs(t,e),o.cacheId=n,Bs.addToCache(o,n)),o}static fromBuffer(t,e,r,s){t=t||new Float32Array(e*r*4);const n=new Wh(t,bb({width:e,height:r},s==null?void 0:s.resourceOptions));let o,a;return t instanceof Float32Array?(o=G.RGBA,a=lt.FLOAT):t instanceof Int32Array?(o=G.RGBA_INTEGER,a=lt.INT):t instanceof Uint32Array?(o=G.RGBA_INTEGER,a=lt.UNSIGNED_INT):t instanceof Int16Array?(o=G.RGBA_INTEGER,a=lt.SHORT):t instanceof Uint16Array?(o=G.RGBA_INTEGER,a=lt.UNSIGNED_SHORT):t instanceof Int8Array?(o=G.RGBA,a=lt.BYTE):(o=G.RGBA,a=lt.UNSIGNED_BYTE),n.internal=!0,new Bs(n,Object.assign({},wb,{type:a,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),lr[e]&&lr[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),lr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=lr[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete lr[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete lr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Yu.defaultOptions={mipmap:Bi.POW2,anisotropicLevel:0,scaleMode:Yi.LINEAR,wrapMode:br.CLAMP,alphaMode:Ue.UNPACK,target:Ys.TEXTURE_2D,format:G.RGBA,type:lt.UNSIGNED_BYTE},Yu._globalBatch=0;let bt=Yu,qu=class{constructor(){this.texArray=null,this.blend=0,this.type=Ii.TRIANGLES,this.start=0,this.size=0,this.data=null}},Eb=0,pe=class Xy{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Eb++,this.disposeRunner=new di("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Ri.ELEMENT_ARRAY_BUFFER:Ri.ARRAY_BUFFER}get index(){return this.type===Ri.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Xy(t)}},vp=class zy{constructor(t,e=0,r=!1,s=lt.FLOAT,n,o,a,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,s,n){return new zy(t,e,r,s,n)}};const Tb={Float32Array,Uint32Array,Int32Array,Uint8Array};function Ab(i,t){let e=0,r=0;const s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;const n=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<i.length;h++){const l=t[h],u=i[h],d=Gy(u);s[d]||(s[d]=new Tb[d](n)),o=s[d];for(let c=0;c<u.length;c++){const f=(c/l|0)*r+a,p=c%l;o[f+p]=u[c]}a+=l}return new Float32Array(n)}const xp={5126:4,5123:2,5121:1};let Sb=0;const Ib={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};let Ao=class Ku{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Sb++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new di("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,n,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof pe||(e instanceof Array&&(e=new Float32Array(e)),e=new pe(e));const l=t.split("|");if(l.length>1){for(let d=0;d<l.length;d++)this.addAttribute(l[d],e,r,s,n);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new vp(u,r,s,n,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof pe||(t instanceof Array&&(t=new Uint16Array(t)),t=new pe(t)),t.type=Ri.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new pe;let s;for(s in this.attributes){const n=this.attributes[s],o=this.buffers[n.buffer];t.push(o.data),e.push(n.size*xp[n.type]/4),n.buffer=0}for(r.data=Ab(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ku;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new pe(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new vp(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Ri.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ku,r=[],s=[],n=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)s[h]=s[h]||0,s[h]+=o.buffers[h].data.length,n[h]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new Ib[Gy(o.buffers[a].data)](s[a]),e.buffers[a]=new pe(r[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)r[h].set(o.buffers[h].data,n[h]),n[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=Ri.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let d=0;d<o.buffers.length;d++)if(o.buffers[d]!==o.indexBuffer){u=d;break}for(const d in o.attributes){const c=o.attributes[d];(c.buffer|0)===u&&(h+=c.size*xp[c.type]/4)}for(let d=0;d<t.length;d++){const c=t[d].indexBuffer.data;for(let f=0;f<c.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[d].buffers[u].data.length/h,l+=c.length}}return e}},Vy=class extends Ao{constructor(t=!1){super(),this._buffer=new pe(null,t,!1),this._indexBuffer=new pe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,lt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,lt.FLOAT).addAttribute("aColor",this._buffer,4,!0,lt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,lt.FLOAT).addIndex(this._indexBuffer)}};const ih=Math.PI*2,Cb=180/Math.PI,Rb=Math.PI/180;var Te=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(Te||{});let Ot=class Wy{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Wy(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}};Ot.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const zo=[new Ot,new Ot,new Ot,new Ot];let It=class Zu{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=Te.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Zu(0,0,0,0)}clone(){return new Zu(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const A=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=A)return!1;const R=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>R}const r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;const a=zo[0].set(t.left,t.top),h=zo[1].set(t.left,t.bottom),l=zo[2].set(t.right,t.top),u=zo[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(d===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=r||Math.min(a.x,h.x,l.x,u.x)>=s||Math.max(a.y,h.y,l.y,u.y)<=n||Math.min(a.y,h.y,l.y,u.y)>=o))return!1;const c=d*(h.y-a.y),f=d*(a.x-h.x),p=c*r+f*n,m=c*s+f*n,g=c*r+f*o,y=c*s+f*o;if(Math.max(p,m,g,y)<=c*a.x+f*a.y||Math.min(p,m,g,y)>=c*u.x+f*u.y)return!1;const _=d*(a.y-l.y),v=d*(l.x-a.x),x=_*r+v*n,b=_*s+v*n,M=_*r+v*o,S=_*s+v*o;return!(Math.max(x,b,M,S)<=_*a.x+v*a.y||Math.min(x,b,M,S)>=_*u.x+v*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=n-s,this}};It.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class So{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=Te.CIRC}clone(){return new So(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let s=this.x-t,n=this.y-e;return s*=s,n*=n,s+n<=r}getBounds(){return new It(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}So.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class jh{constructor(t=0,e=0,r=0,s=0){this.x=t,this.y=e,this.width=r,this.height=s,this.type=Te.ELIP}clone(){return new jh(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,s=(e-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new It(this.x-this.width,this.y-this.height,this.width,this.height)}}jh.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class is{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let s=0,n=e.length;s<n;s++)r.push(e[s].x,e[s].y);e=r}this.points=e,this.type=Te.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new is(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){const a=this.points[n*2],h=this.points[n*2+1],l=this.points[o*2],u=this.points[o*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(r=!r)}return r}}is.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,t)=>`${i}, ${t}`,"")}]`};class Yh{constructor(t=0,e=0,r=0,s=0,n=20){this.x=t,this.y=e,this.width=r,this.height=s,this.radius=n,this.type=Te.RREC}clone(){return new Yh(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let s=t-(this.x+r),n=e-(this.y+r);const o=r*r;if(s*s+n*n<=o||(s=t-(this.x+this.width-r),s*s+n*n<=o)||(n=e-(this.y+this.height-r),s*s+n*n<=o)||(s=t-(this.x+r),s*s+n*n<=o))return!0}return!1}}Yh.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};let ne=class Na{constructor(t=1,e=0,r=0,s=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,n,o){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Ot;const r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Ot;const r=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this}append(t){const e=this.a,r=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,s,n,o,a,h,l){return this.a=Math.cos(a+l)*n,this.b=Math.sin(a+l)*n,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,s=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-s,n),h=Math.atan2(r,e),l=Math.abs(a+h);return l<1e-5||Math.abs(ih-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*r+o.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,s=this.d,n=this.tx,o=t*s-e*r;return this.a=s/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(t*this.ty-e*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Na;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Na}static get TEMP_MATRIX(){return new Na}};ne.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Dr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Lr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],kr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ur=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Qu=[],jy=[],Vo=Math.sign;function Mb(){for(let i=0;i<16;i++){const t=[];Qu.push(t);for(let e=0;e<16;e++){const r=Vo(Dr[i]*Dr[e]+kr[i]*Lr[e]),s=Vo(Lr[i]*Dr[e]+Ur[i]*Lr[e]),n=Vo(Dr[i]*kr[e]+kr[i]*Ur[e]),o=Vo(Lr[i]*kr[e]+Ur[i]*Ur[e]);for(let a=0;a<16;a++)if(Dr[a]===r&&Lr[a]===s&&kr[a]===n&&Ur[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new ne;t.set(Dr[i],Lr[i],kr[i],Ur[i],0,0),jy.push(t)}}Mb();const Jt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Dr[i],uY:i=>Lr[i],vX:i=>kr[i],vY:i=>Ur[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Qu[i][t],sub:(i,t)=>Qu[i][Jt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Jt.S:Jt.N:Math.abs(t)*2<=Math.abs(i)?i>0?Jt.E:Jt.W:t>0?i>0?Jt.SE:Jt.SW:i>0?Jt.NE:Jt.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const s=jy[Jt.inv(t)];s.tx=e,s.ty=r,i.append(s)}};let Qr=class Yy{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Yy(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}};Qr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Ju=class{constructor(){this.worldTransform=new ne,this.localTransform=new ne,this.position=new Qr(this.onChange,this,0,0),this.scale=new Qr(this.onChange,this,1,1),this.pivot=new Qr(this.onChange,this,0,0),this.skew=new Qr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const r=t.worldTransform,s=this.worldTransform;s.a=e.a*r.a+e.b*r.c,s.b=e.a*r.b+e.b*r.d,s.c=e.c*r.a+e.d*r.c,s.d=e.c*r.b+e.d*r.d,s.tx=e.tx*r.a+e.ty*r.c+r.tx,s.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};Ju.IDENTITY=new Ju;let Ed=Ju;Ed.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Pb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Nb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function bp(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function Dl(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function qy(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Dl(2*t);case"bvec3":return Dl(3*t);case"bvec4":return Dl(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Zs=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],Ob={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Bb={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Fb(i,t){var e;const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in i.uniforms){const n=t[s];if(!n){((e=i.uniforms[s])==null?void 0:e.group)===!0&&(i.uniforms[s].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}const o=i.uniforms[s];let a=!1;for(let h=0;h<Zs.length;h++)if(Zs[h].test(n,o)){r.push(Zs[h].code(s,o)),a=!0;break}if(!a){const h=(n.size===1&&!n.isArray?Ob:Bb)[n.type].replace("location",`ud["${s}"].location`);r.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}const Ky={};let Rn=Ky;function Db(){if(Rn===Ky||Rn!=null&&Rn.isContextLost()){const i=tt.ADAPTER.createCanvas();let t;tt.PREFER_ENV>=gs.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Rn=t}return Rn}let Wo;function Lb(){if(!Wo){Wo=Ke.MEDIUM;const i=Db();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(Wo=t.precision?Ke.HIGH:Ke.MEDIUM)}}return Wo}function wp(i,t){const e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),s=r.split(`
`),n={},o=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function kb(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||wp(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||wp(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const Ub={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Zy(i){return Ub[i]}let jo=null;const Ep={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Qy(i,t){if(!jo){const e=Object.keys(Ep);jo={};for(let r=0;r<e.length;++r){const s=e[r];jo[i[s]]=Ep[s]}}return jo[t]}function Tp(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Ke.HIGH&&e!==Ke.HIGH&&(r=Ke.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Ke.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Mn;function Gb(){if(typeof Mn=="boolean")return Mn;try{Mn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Mn=!1}return Mn}let $b=0;const Yo={},tc=class Fs{constructor(t,e,r="pixi-shader",s={}){this.extra={},this.id=$b++,this.vertexSrc=t||Fs.defaultVertexSrc,this.fragmentSrc=e||Fs.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Yo[r]?(Yo[r]++,r+=`-${Yo[r]}`):Yo[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Tp(this.vertexSrc,Fs.defaultVertexPrecision,Ke.HIGH),this.fragmentSrc=Tp(this.fragmentSrc,Fs.defaultFragmentPrecision,Lb())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Nb}static get defaultFragmentSrc(){return Pb}static from(t,e,r){const s=t+e;let n=up[s];return n||(up[s]=n=new Fs(t,e,r)),n}};tc.defaultVertexPrecision=Ke.HIGH,tc.defaultFragmentPrecision=qi.apple.device?Ke.HIGH:Ke.MEDIUM;let Ki=tc,Hb=0,rs=class Oa{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Hb++,this.static=!!e,this.ubo=!!r,t instanceof pe?(this.buffer=t,this.buffer.type=Ri.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new pe(new Float32Array(1)),this.buffer.type=Ri.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new Oa(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new Oa(t,e,r)}static uboFrom(t,e){return new Oa(t,e??!0,!0)}},wr=class Jy{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof rs?this.uniformGroup=e:this.uniformGroup=new rs(e):this.uniformGroup=new rs({}),this.disposeRunner=new di("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const s=e.uniforms[r];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const s=Ki.from(t,e);return new Jy(s,r)}},Xb=class{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=rs.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ki(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ne,default:this.defaultGroupCache[t]};return new wr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}},ec=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}};function zb(){return!qi.apple.device}function Vb(i){let t=!0;const e=tt.ADAPTER.getNavigator();if(qi.tablet||qi.phone){if(qi.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(qi.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}let qh=class{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}};var Wb=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,jb=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const $n=class oi extends qh{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Vy,this.vertexSize=6,this.state=Ar.for2d(),this.size=oi.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var t;return this._defaultMaxTextures=(t=this._defaultMaxTextures)!=null?t:Vb(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){var t;return this._canUploadSameBuffer=(t=this._canUploadSameBuffer)!=null?t:zb(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Mt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return jb}static get defaultFragmentTemplate(){return Wb}setShaderGenerator({vertex:t=oi.defaultVertexSrc,fragment:e=oi.defaultFragmentTemplate}={}){this.shaderGenerator=new Xb(t,e)}contextChange(){const t=this.renderer.gl;tt.PREFER_ENV===gs.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),oi.defaultMaxTextures),this.maxTextures=yb(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=oi,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new qu);for(;e.length<s;)e.push(new ec);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=oi._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++bt._globalBatch,h=0,l=r[0],u=0;s.copyBoundTextures(n,e);for(let d=0;d<this._bufferSize;++d){const c=t[d];t[d]=null,c._batchEnabled!==a&&(l.count>=e&&(s.boundArray(l,n,a,e),this.buildDrawCalls(l,u,d),u=d,l=r[++h],++a),c._batchEnabled=a,c.touched=o,l.elements[l.count++]=c)}l.count>0&&(s.boundArray(l,n,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let d=0;d<n.length;d++)n[d]=null;bt._globalBatch=a}buildDrawCalls(t,e,r){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,h=oi._drawCallPool;let l=this._dcIndex,u=this._aIndex,d=this._iIndex,c=h[l];c.start=this._iIndex,c.texArray=t;for(let f=e;f<r;++f){const p=s[f],m=p._texture.baseTexture,g=ky[m.alphaMode?1:0][p.blendMode];s[f]=null,e<f&&c.blend!==g&&(c.size=d-c.start,e=f,c=h[++l],c.texArray=t,c.start=d),this.packInterleavedGeometry(p,n,o,u,d),u+=p.vertexData.length/2*a,d+=p.indices.length,c.blend=g}e<r&&(c.size=d-c.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=d}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;oi.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,s=oi._drawCallPool;let n=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:u,blend:d}=s[o];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=d,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),oi.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=eh(Math.ceil(t/8)),r=hp(e),s=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new Wu(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=eh(Math.ceil(t/12)),r=hp(e),s=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,r,s,n){const{uint32View:o,float32View:a}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,d=t.vertexData,c=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=Zt.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let m=0;m<d.length;m+=2)a[s++]=d[m],a[s++]=d[m+1],a[s++]=l[m],a[s++]=l[m+1],o[s++]=p,a[s++]=c;for(let m=0;m<u.length;m++)r[n++]=h+u[m]}};$n.defaultBatchSize=4096,$n.extension={name:"batch",type:W.RendererPlugin},$n._drawCallPool=[],$n._textureArrayPool=[];let Gr=$n;nt.add(Gr);var Yb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,qb=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const ic=class Hn extends wr{constructor(t,e,r){const s=Ki.from(t||Hn.defaultVertexSrc,e||Hn.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=Hn.defaultResolution,this.multisample=Hn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Ar}apply(t,e,r,s,n){t.applyFilter(this,e,r,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return qb}static get defaultFragmentSrc(){return Yb}};ic.defaultResolution=1,ic.defaultMultisample=le.NONE;let Fe=ic,rh=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Zt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:s}=t,n=r??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}};rh.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},rh.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"background"};nt.add(rh);let t0=class{constructor(t){this.renderer=t,this.emptyRenderer=new qh(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){const{elements:n,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const u=n[l],d=u._batchLocation;if(d>=0&&d<s&&e[d]===u){o[l]=d;continue}for(;h<s;){const c=e[h];if(c&&c._batchEnabled===r&&c._batchLocation===h){h++;continue}o[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}};t0.extension={type:W.RendererSystem,name:"batch"};nt.add(t0);let Ap=0,sh=class{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Ap++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Ap++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(tt.PREFER_ENV>=gs.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};sh.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},sh.extension={type:W.RendererSystem,name:"context"};nt.add(sh);let rc=class{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new di("disposeFramebuffer"),this.multisample=le.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new bt(null,{scaleMode:Yi.NEAREST,resolution:1,mipmap:Bi.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new bt(null,{scaleMode:Yi.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Bi.OFF,format:G.DEPTH_COMPONENT,type:lt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}},e0=class extends bt{constructor(t={}){var e,r;if(typeof t=="number"){const s=arguments[0],n=arguments[1],o=arguments[2],a=arguments[3];t={width:s,height:n,scaleMode:o,resolution:a}}t.width=(e=t.width)!=null?e:100,t.height=(r=t.height)!=null?r:100,t.multisample!=null||(t.multisample=le.NONE),super(null,t),this.mipmap=Bi.OFF,this.valid=!0,this._clear=new Zt([0,0,0,0]),this.framebuffer=new rc(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}},Er=class extends fo{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=hb(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){const n=t.gl,o=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ue.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}},i0=class extends Er{constructor(t,e){var r;if(e=e||{},typeof t=="string"){const s=new Image;Er.crossOrigin(s,t,e.crossorigin),s.src=t,t=s}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((r=e.createBitmap)!=null?r:tt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ue.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const o in n){const a=n[o];if(a!==r&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}},Td=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const s=e.width,n=e.height;if(r){const o=t.width/2/s,a=t.height/2/n,h=t.x/s+o,l=t.y/n+a;r=Jt.add(r,Jt.NW),this.x0=h+o*Jt.uX(r),this.y0=l+a*Jt.uY(r),r=Jt.add(r,2),this.x1=h+o*Jt.uX(r),this.y1=l+a*Jt.uY(r),r=Jt.add(r,2),this.x2=h+o*Jt.uX(r),this.y2=l+a*Jt.uY(r),r=Jt.add(r,2),this.x3=h+o*Jt.uX(r),this.y3=l+a*Jt.uY(r)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}};Td.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Sp=new Td;function qo(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}let Bt=class Kt extends To{constructor(t,e,r,s,n,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new It(0,0,1,1)),t instanceof Kt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Sp,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Ot(o.x,o.y):new Ot(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&xi[e.url]&&Kt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Kt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var t;const e=this._frame.clone(),r=this._frame===this.orig?e:this.orig.clone(),s=new Kt(this.baseTexture,!this.noFrame&&e,r,(t=this.trim)==null?void 0:t.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(s._frame=e),s}updateUvs(){this._uvs===Sp&&(this._uvs=new Td),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=tt.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof bt){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${ls()}`,bt.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${ls()}`}n=t._pixiId}let o=xi[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof bt)?(e.resolution||(e.resolution=rr(t)),o=new Kt(new bt(t,e)),o.baseTexture.cacheId=n,bt.addToCache(o.baseTexture,n),Kt.addToCache(o,n)):!o&&t instanceof bt&&(o=new Kt(t),Kt.addToCache(o,n)),o}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),s=Kt.from(t,Object.assign({resourceOptions:r},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new Kt(bt.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){const n=new bt(t,Object.assign({scaleMode:bt.defaultOptions.scaleMode,resolution:rr(e)},s)),{resource:o}=n;o instanceof i0&&(o.url=e);const a=new Kt(n);return r||(r=e),bt.addToCache(a.baseTexture,r),Kt.addToCache(a,r),r!==e&&(bt.addToCache(a.baseTexture,e),Kt.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),xi[e]&&xi[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),xi[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=xi[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete xi[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)xi[t.textureCacheIds[e]]===t&&delete xi[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:s,height:n}=t,o=e+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Kt._EMPTY||(Kt._EMPTY=new Kt(new bt),qo(Kt._EMPTY),qo(Kt._EMPTY.baseTexture)),Kt._EMPTY}static get WHITE(){if(!Kt._WHITE){const t=tt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Kt._WHITE=new Kt(bt.from(t)),qo(Kt._WHITE),qo(Kt._WHITE.baseTexture)}return Kt._WHITE}},Io=class r0 extends Bt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new r0(new e0(t))}},s0=class{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=le.NONE){const s=new e0(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Io(s)}getOptimalTexture(t,e,r=1,s=le.NONE){let n;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=eh(t),e=eh(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(t,e,r){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||le.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}};s0.SCREEN_KEY=-1;let Kb=class extends Ao{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}},n0=class extends Ao{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new pe(this.vertices),this.uvBuffer=new pe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}},Zb=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=le.NONE,this.sourceFrame=new It,this.destinationFrame=new It,this.bindingSourceFrame=new It,this.bindingDestinationFrame=new It,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};const Ko=[new Ot,new Ot,new Ot,new Ot],Ll=new ne;let o0=class{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new s0,this.statePool=[],this.quad=new Kb,this.quadUv=new n0,this.tempRect=new It,this.activeState={},this.globalUniforms=new rs({outputFrame:new It,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){var r,s,n,o;const a=this.renderer,h=this.defaultFilterStack,l=this.statePool.pop()||new Zb,u=a.renderTexture;let d,c;if(u.current){const x=u.current;d=x.resolution,c=x.multisample}else d=a.resolution,c=a.multisample;let f=e[0].resolution||d,p=(r=e[0].multisample)!=null?r:c,m=e[0].padding,g=e[0].autoFit,y=(s=e[0].legacy)!=null?s:!0;for(let x=1;x<e.length;x++){const b=e[x];f=Math.min(f,b.resolution||d),p=Math.min(p,(n=b.multisample)!=null?n:c),m=this.useMaxPadding?Math.max(m,b.padding):m+b.padding,g=g&&b.autoFit,y=y||((o=b.legacy)!=null?o:!0)}h.length===1&&(this.defaultFilterStack[0].renderTexture=u.current),h.push(l),l.resolution=f,l.multisample=p,l.legacy=y,l.target=t,l.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),l.sourceFrame.pad(m);const _=this.tempRect.copyFrom(u.sourceFrame);a.projection.transform&&this.transformAABB(Ll.copyFrom(a.projection.transform).invert(),_),g?(l.sourceFrame.fit(_),(l.sourceFrame.width<=0||l.sourceFrame.height<=0)&&(l.sourceFrame.width=0,l.sourceFrame.height=0)):l.sourceFrame.intersects(_)||(l.sourceFrame.width=0,l.sourceFrame.height=0),this.roundFrame(l.sourceFrame,u.current?u.current.resolution:a.resolution,u.sourceFrame,u.destinationFrame,a.projection.transform),l.renderTexture=this.getOptimalFilterTexture(l.sourceFrame.width,l.sourceFrame.height,f,p),l.filters=e,l.destinationFrame.width=l.renderTexture.width,l.destinationFrame.height=l.renderTexture.height;const v=this.tempRect;v.x=0,v.y=0,v.width=l.sourceFrame.width,v.height=l.sourceFrame.height,l.renderTexture.filterFrame=l.sourceFrame,l.bindingSourceFrame.copyFrom(u.sourceFrame),l.bindingDestinationFrame.copyFrom(u.destinationFrame),l.transform=a.projection.transform,a.projection.transform=null,u.bind(l.renderTexture,l.sourceFrame,v),a.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*n[2]-.5*o[2],a[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){const l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,Ai.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let d=0;for(d=0;d<r.length-1;++d){d===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[d].apply(this,l,u,Ai.CLEAR,e);const c=l;l=u,u=c}r[d].apply(this,l,h.renderTexture,Ai.BLEND,e),d>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Ai.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,r.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===Ai.CLEAR||e===Ai.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Ii.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Ii.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=e._texture,o=t.set(s.width,0,0,s.height,r.x,r.y),a=e.worldTransform.copyTo(ne.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=le.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||le.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Ko[0],s=Ko[1],n=Ko[2],o=Ko[3];r.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(n,n),t.apply(o,o);const a=Math.min(r.x,s.x,n.x,o.x),h=Math.min(r.y,s.y,n.y,o.y),l=Math.max(r.x,s.x,n.x,o.x),u=Math.max(r.y,s.y,n.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,r,s,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a:o,b:a,c:h,d:l}=n;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}n=n?Ll.copyFrom(n):Ll.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}};o0.extension={type:W.RendererSystem,name:"filter"};nt.add(o0);let Qb=class{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=le.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};const Jb=new It;let a0=class{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new rc(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new It,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;tt.PREFER_ENV===gs.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>r,a=e.height>>r,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>r,a=t.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=r,n.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,n=Fu.COLOR|Fu.DEPTH){const{gl:o}=this;o.clearColor(t,e,r,s),o.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new Qb(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=s[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=le.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=le.NONE),r}blit(t,e,r){const{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new rc(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=Jb,e.width=s.width,e.height=s.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,s=t.height,n=this.gl,o=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,r,s):n.renderbufferStorage(n.RENDERBUFFER,h,r,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new It}destroy(){this.renderer=null}};a0.extension={type:W.RendererSystem,name:"framebuffer"};nt.add(a0);const kl={5126:4,5123:2,5121:1};let h0=class{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;tt.PREFER_ENV===gs.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,o,a,h)=>r.drawElementsInstancedANGLE(s,n,o,a,h),t.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const o=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){const r=t.attributes,s=e.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const r=t.attributes,s=e.attributeData,n=["g",t.id];for(const o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(t,e,r=!0){const s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[a.id]=u,u;const d=t.buffers,c=t.attributes,f={},p={};for(const m in d)f[m]=0,p[m]=0;for(const m in c)!c[m].size&&a.attributeData[m]?c[m].size=a.attributeData[m].size:c[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[c[m].buffer]+=c[m].size*kl[c[m].type];for(const m in c){const g=c[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*kl[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*kl[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<d.length;m++){const g=d[m];o.bind(g),r&&g._glBuffers[n].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,s.bindVertexArray(null),o.unbind(Ri.ARRAY_BUFFER),u}disposeGeometry(t,e){var r;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const s=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=t.buffers,a=(r=this.renderer)==null?void 0:r.buffer;if(t.disposeRunner.remove(this),!!s){if(a)for(let h=0;h<o.length;h++){const l=o[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&a.dispose(o[h],e))}if(!e){for(const h in s)if(h[0]==="g"){const l=s[h];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in a){const u=a[l],d=o[u.buffer],c=d._glBuffers[s];if(e.attributeData[l]){h!==c&&(n.bind(d),h=c);const f=e.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(r||0)*a,s||1):n.drawElements(t,e||o.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,r,e||o.getSize(),s||1):n.drawArrays(t,r,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};h0.extension={type:W.RendererSystem,name:"geometry"};nt.add(h0);const Ip=new ne;let l0=class{constructor(t,e){this._texture=t,this.mapCoord=new ne,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],o=t[s+1];e[s]=n*r.a+o*r.c+r.tx,e[s+1]=n*r.b+o*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(Ip.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ip));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}};var tw=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,ew=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;let iw=class extends Fe{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||ew,e||tw,r),this.maskSprite=s,this.maskMatrix=new ne}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new l0(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}},rw=class{constructor(t=null){this.type=de.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Fe.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=de.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}},u0=class{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const n=this.maskDataPool.pop()||new rw;n.pooled=!0,n.maskObject=e,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==de.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case de.SCISSOR:this.renderer.scissor.push(r);break;case de.STENCIL:this.renderer.stencil.push(r);break;case de.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case de.COLOR:this.pushColorMask(r);break}r.type===de.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case de.SCISSOR:this.renderer.scissor.pop(e);break;case de.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case de.SPRITE:this.popSpriteMask(e);break;case de.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===de.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=de.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=de.SCISSOR:t.type=de.STENCIL:t.type=de.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new iw])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};u0.extension={type:W.RendererSystem,name:"mask"};nt.add(u0);let c0=class{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};const Cp=new ne,Rp=[],d0=class Ba extends c0{constructor(t){super(t),this.glConst=tt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){var e;if(t._scissorRectLocal)return;const r=t._scissorRect,{maskObject:s}=t,{renderer:n}=this,o=n.renderTexture,a=s.getBounds(!0,(e=Rp.pop())!=null?e:new It);this.roundFrameToPixels(a,o.current?o.current.resolution:n.resolution,o.sourceFrame,o.destinationFrame,n.projection.transform),r&&a.fit(r),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:s,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Ba.isMatrixRotated(e.worldTransform)||Ba.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,s,n){Ba.isMatrixRotated(n)||(n=n?Cp.copyFrom(n):Cp.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Rp.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};d0.extension={type:W.RendererSystem,name:"scissor"};let sw=d0;nt.add(sw);let f0=class extends c0{constructor(t){super(t),this.glConst=tt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}};f0.extension={type:W.RendererSystem,name:"stencil"};nt.add(f0);let p0=class{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Mt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Mt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Mt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}};p0.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_plugin"};nt.add(p0);let m0=class{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ne,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){const n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}};m0.extension={type:W.RendererSystem,name:"projection"};nt.add(m0);var Mp=Object.getOwnPropertySymbols,nw=Object.prototype.hasOwnProperty,ow=Object.prototype.propertyIsEnumerable,aw=(i,t)=>{var e={};for(var r in i)nw.call(i,r)&&t.indexOf(r)<0&&(e[r]=i[r]);if(i!=null&&Mp)for(var r of Mp(i))t.indexOf(r)<0&&ow.call(i,r)&&(e[r]=i[r]);return e};const hw=new Ed,Pp=new It;let g0=class{constructor(t){this.renderer=t,this._tempMatrix=new ne}generateTexture(t,e){const r=e||{},{region:s}=r,n=aw(r,["region"]),o=(s==null?void 0:s.copyTo(Pp))||t.getLocalBounds(Pp,!0),a=n.resolution||this.renderer.resolution;o.width=Math.max(o.width,1/a),o.height=Math.max(o.height,1/a),n.width=o.width,n.height=o.height,n.resolution=a,n.multisample!=null||(n.multisample=this.renderer.multisample);const h=Io.create(n);this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const l=t.transform;return t.transform=hw,this.renderer.render(t,{renderTexture:h,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=l,h}destroy(){}};g0.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"textureGenerator"};nt.add(g0);const Or=new It,Pn=new It;let y0=class{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new It,this.destinationFrame=new It,this.viewportFrame=new It}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(t=null,e,r){const s=this.renderer;this.current=t;let n,o,a;t?(n=t.baseTexture,a=n.resolution,e||(Or.width=t.frame.width,Or.height=t.frame.height,e=Or),r||(Pn.x=t.frame.x,Pn.y=t.frame.y,Pn.width=e.width,Pn.height=e.height,r=Pn),o=n.framebuffer):(a=s.resolution,e||(Or.width=s._view.screen.width,Or.height=s._view.screen.height,e=Or),r||(r=Or,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(r,e,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=Zt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:h,y:l,width:u,height:d}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),d=Math.round(d),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,d)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};y0.extension={type:W.RendererSystem,name:"renderTexture"};nt.add(y0);let lw=class{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function uw(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=t.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;const o=Qy(t,n.type),a={type:o,name:n.name,size:Zy(o),location:t.getAttribLocation(i,n.name)};e[n.name]=a}return e}function cw(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=t.getActiveUniform(i,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),h=Qy(t,n.type);e[o]={name:o,index:s,type:h,size:n.size,isArray:a,value:qy(h,n.size)}}return e}function dw(i,t){var e;const r=bp(i,i.VERTEX_SHADER,t.vertexSrc),s=bp(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,r),i.attachShader(n,s);const o=(e=t.extra)==null?void 0:e.transformFeedbackVaryings;if(o&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,o.names,o.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||kb(i,n,r,s),t.attributeData=uw(n,i),t.uniformData=cw(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,i.bindAttribLocation(n,l,h[l]);i.linkProgram(n)}i.deleteShader(r),i.deleteShader(s);const a={};for(const h in t.uniformData){const l=t.uniformData[h];a[h]={location:i.getUniformLocation(n,h),value:qy(l.type,l.size)}}return new lw(n,a)}function fw(i,t,e,r,s){e.buffer.update(s)}const pw={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},_0={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function mw(i){const t=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,r=0,s=0;for(let n=0;n<t.length;n++){const o=t[n];if(e=_0[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,r%e!==0&&r<16){const a=r%e%16;r+=a,s+=a}r+e>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=e,r=e):(o.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function gw(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function yw(i,t){if(!i.autoManage)return{size:0,syncFunc:fw};const e=gw(i.uniforms,t),{uboElements:r,size:s}=mw(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){const a=r[o],h=i.uniforms[a.data.name],l=a.data.name;let u=!1;for(let d=0;d<Zs.length;d++){const c=Zs[d];if(c.codeUbo&&c.test(a.data,h)){n.push(`offset = ${a.offset/4};`,Zs[d].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){const d=Zy(a.data.type),c=Math.max(_0[a.data.type]/16,1),f=d/c,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*c}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const d=pw[a.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${d};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let _w=0;const Zo={textureCount:0,uboCount:0};let v0=class{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=_w++}systemCheck(){if(!Gb())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(Zo.textureCount=0,Zo.uboCount=0,this.syncUniformGroup(t.uniformGroup,Zo)),s}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Fb(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,Zo,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=yw(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const s=t.uniforms,n=[`${r}-`];for(const o in s)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,s=dw(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};v0.extension={type:W.RendererSystem,name:"shader"};nt.add(v0);let nh=class{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}};nh.defaultOptions={hello:!1},nh.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"startup"};nt.add(nh);function vw(i,t=[]){return t[dt.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.ADD]=[i.ONE,i.ONE],t[dt.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.NONE]=[0,0],t[dt.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[dt.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[dt.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[dt.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[dt.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[dt.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[dt.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[dt.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[dt.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[dt.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[dt.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const xw=0,bw=1,ww=2,Ew=3,Tw=4,Aw=5,x0=class sc{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=dt.NONE,this._blendEq=!1,this.map=[],this.map[xw]=this.setBlend,this.map[bw]=this.setOffset,this.map[ww]=this.setCullFace,this.map[Ew]=this.setDepthTest,this.map[Tw]=this.setFrontFace,this.map[Aw]=this.setDepthMask,this.checks=[],this.defaultState=new Ar,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=vw(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(sc.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(sc.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};x0.extension={type:W.RendererSystem,name:"state"};let Sw=x0;nt.add(Sw);let Iw=class extends To{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var e;this.addRunners(...t.runners);const r=((e=t.priority)!=null?e:[]).filter(n=>t.systems[n]),s=[...r,...Object.keys(t.systems).filter(n=>!r.includes(n))];for(const n of s)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new di(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=r.find(o=>this._systemsHash[o]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};const Xn=class Fa{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Fa.defaultMaxIdle,this.checkCountMax=Fa.defaultCheckCountMax,this.mode=Fa.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==bd.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Xn.defaultMode=bd.AUTO,Xn.defaultMaxIdle=60*60,Xn.defaultCheckCountMax=60*10,Xn.extension={type:W.RendererSystem,name:"textureGC"};let $r=Xn;nt.add($r);let Ul=class{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=lt.UNSIGNED_BYTE,this.internalFormat=G.RGBA,this.samplerType=0}};function Cw(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:Q.FLOAT,[i.RGBA]:Q.FLOAT,[i.ALPHA]:Q.FLOAT,[i.LUMINANCE]:Q.FLOAT,[i.LUMINANCE_ALPHA]:Q.FLOAT,[i.R8]:Q.FLOAT,[i.R8_SNORM]:Q.FLOAT,[i.RG8]:Q.FLOAT,[i.RG8_SNORM]:Q.FLOAT,[i.RGB8]:Q.FLOAT,[i.RGB8_SNORM]:Q.FLOAT,[i.RGB565]:Q.FLOAT,[i.RGBA4]:Q.FLOAT,[i.RGB5_A1]:Q.FLOAT,[i.RGBA8]:Q.FLOAT,[i.RGBA8_SNORM]:Q.FLOAT,[i.RGB10_A2]:Q.FLOAT,[i.RGB10_A2UI]:Q.FLOAT,[i.SRGB8]:Q.FLOAT,[i.SRGB8_ALPHA8]:Q.FLOAT,[i.R16F]:Q.FLOAT,[i.RG16F]:Q.FLOAT,[i.RGB16F]:Q.FLOAT,[i.RGBA16F]:Q.FLOAT,[i.R32F]:Q.FLOAT,[i.RG32F]:Q.FLOAT,[i.RGB32F]:Q.FLOAT,[i.RGBA32F]:Q.FLOAT,[i.R11F_G11F_B10F]:Q.FLOAT,[i.RGB9_E5]:Q.FLOAT,[i.R8I]:Q.INT,[i.R8UI]:Q.UINT,[i.R16I]:Q.INT,[i.R16UI]:Q.UINT,[i.R32I]:Q.INT,[i.R32UI]:Q.UINT,[i.RG8I]:Q.INT,[i.RG8UI]:Q.UINT,[i.RG16I]:Q.INT,[i.RG16UI]:Q.UINT,[i.RG32I]:Q.INT,[i.RG32UI]:Q.UINT,[i.RGB8I]:Q.INT,[i.RGB8UI]:Q.UINT,[i.RGB16I]:Q.INT,[i.RGB16UI]:Q.UINT,[i.RGB32I]:Q.INT,[i.RGB32UI]:Q.UINT,[i.RGBA8I]:Q.INT,[i.RGBA8UI]:Q.UINT,[i.RGBA16I]:Q.INT,[i.RGBA16UI]:Q.UINT,[i.RGBA32I]:Q.INT,[i.RGBA32UI]:Q.UINT,[i.DEPTH_COMPONENT16]:Q.FLOAT,[i.DEPTH_COMPONENT24]:Q.FLOAT,[i.DEPTH_COMPONENT32F]:Q.FLOAT,[i.DEPTH_STENCIL]:Q.FLOAT,[i.DEPTH24_STENCIL8]:Q.FLOAT,[i.DEPTH32F_STENCIL8]:Q.FLOAT}:t={[i.RGB]:Q.FLOAT,[i.RGBA]:Q.FLOAT,[i.ALPHA]:Q.FLOAT,[i.LUMINANCE]:Q.FLOAT,[i.LUMINANCE_ALPHA]:Q.FLOAT,[i.DEPTH_STENCIL]:Q.FLOAT},t}function Rw(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[lt.UNSIGNED_BYTE]:{[G.RGBA]:i.RGBA8,[G.RGB]:i.RGB8,[G.RG]:i.RG8,[G.RED]:i.R8,[G.RGBA_INTEGER]:i.RGBA8UI,[G.RGB_INTEGER]:i.RGB8UI,[G.RG_INTEGER]:i.RG8UI,[G.RED_INTEGER]:i.R8UI,[G.ALPHA]:i.ALPHA,[G.LUMINANCE]:i.LUMINANCE,[G.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[lt.BYTE]:{[G.RGBA]:i.RGBA8_SNORM,[G.RGB]:i.RGB8_SNORM,[G.RG]:i.RG8_SNORM,[G.RED]:i.R8_SNORM,[G.RGBA_INTEGER]:i.RGBA8I,[G.RGB_INTEGER]:i.RGB8I,[G.RG_INTEGER]:i.RG8I,[G.RED_INTEGER]:i.R8I},[lt.UNSIGNED_SHORT]:{[G.RGBA_INTEGER]:i.RGBA16UI,[G.RGB_INTEGER]:i.RGB16UI,[G.RG_INTEGER]:i.RG16UI,[G.RED_INTEGER]:i.R16UI,[G.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[lt.SHORT]:{[G.RGBA_INTEGER]:i.RGBA16I,[G.RGB_INTEGER]:i.RGB16I,[G.RG_INTEGER]:i.RG16I,[G.RED_INTEGER]:i.R16I},[lt.UNSIGNED_INT]:{[G.RGBA_INTEGER]:i.RGBA32UI,[G.RGB_INTEGER]:i.RGB32UI,[G.RG_INTEGER]:i.RG32UI,[G.RED_INTEGER]:i.R32UI,[G.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[lt.INT]:{[G.RGBA_INTEGER]:i.RGBA32I,[G.RGB_INTEGER]:i.RGB32I,[G.RG_INTEGER]:i.RG32I,[G.RED_INTEGER]:i.R32I},[lt.FLOAT]:{[G.RGBA]:i.RGBA32F,[G.RGB]:i.RGB32F,[G.RG]:i.RG32F,[G.RED]:i.R32F,[G.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[lt.HALF_FLOAT]:{[G.RGBA]:i.RGBA16F,[G.RGB]:i.RGB16F,[G.RG]:i.RG16F,[G.RED]:i.R16F},[lt.UNSIGNED_SHORT_5_6_5]:{[G.RGB]:i.RGB565},[lt.UNSIGNED_SHORT_4_4_4_4]:{[G.RGBA]:i.RGBA4},[lt.UNSIGNED_SHORT_5_5_5_1]:{[G.RGBA]:i.RGB5_A1},[lt.UNSIGNED_INT_2_10_10_10_REV]:{[G.RGBA]:i.RGB10_A2,[G.RGBA_INTEGER]:i.RGB10_A2UI},[lt.UNSIGNED_INT_10F_11F_11F_REV]:{[G.RGB]:i.R11F_G11F_B10F},[lt.UNSIGNED_INT_5_9_9_9_REV]:{[G.RGB]:i.RGB9_E5},[lt.UNSIGNED_INT_24_8]:{[G.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[lt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[G.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[lt.UNSIGNED_BYTE]:{[G.RGBA]:i.RGBA,[G.RGB]:i.RGB,[G.ALPHA]:i.ALPHA,[G.LUMINANCE]:i.LUMINANCE,[G.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[lt.UNSIGNED_SHORT_5_6_5]:{[G.RGB]:i.RGB},[lt.UNSIGNED_SHORT_4_4_4_4]:{[G.RGBA]:i.RGBA},[lt.UNSIGNED_SHORT_5_5_5_1]:{[G.RGBA]:i.RGBA}},t}let b0=class{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new bt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Rw(t),this.samplerTypes=Cw(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new Ul(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ul(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=t-1;n>=0;--n){const o=e[n];o&&o._glTextures[s].samplerType!==Q.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new Ul(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r,s,n;e.internalFormat=(s=(r=this.internalFormats[t.type])==null?void 0:r[t.format])!=null?s:t.format,e.samplerType=(n=this.samplerTypes[e.internalFormat])!=null?n:Q.FLOAT,this.webGLVersion===2&&t.type===lt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var e;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const s=this.renderer;if(this.initTextureType(t,r),(e=t.resource)!=null&&e.upload(s,t,r))r.samplerType!==Q.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,o=t.realHeight,a=s.gl;(r.width!==n||r.height!==o||r.dirtyId<0)&&(r.width=n,r.height=o,a.texImage2D(t.target,0,r.internalFormat,n,o,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&Ks(this.managedTextures,s,1)}}updateTextureStyle(t){var e;const r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===Bi.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=br.CLAMP:r.wrapMode=t.wrapMode,(e=t.resource)!=null&&e.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==Bi.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Yi.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Yi.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Yi.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===Yi.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};b0.extension={type:W.RendererSystem,name:"texture"};nt.add(b0);let w0=class{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(a,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};w0.extension={type:W.RendererSystem,name:"transformFeedback"};nt.add(w0);let oh=class{constructor(t){this.renderer=t}init(t){this.screen=new It(0,0,t.width,t.height),this.element=t.view||tt.ADAPTER.createCanvas(),this.resolution=t.resolution||tt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}};oh.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},oh.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_view"};nt.add(oh);var Mw=Object.defineProperty,Np=Object.getOwnPropertySymbols,Pw=Object.prototype.hasOwnProperty,Nw=Object.prototype.propertyIsEnumerable,Op=(i,t,e)=>t in i?Mw(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Qo=(i,t)=>{for(var e in t||(t={}))Pw.call(t,e)&&Op(i,e,t[e]);if(Np)for(var e of Np(t))Nw.call(t,e)&&Op(i,e,t[e]);return i};tt.PREFER_ENV=gs.WEBGL2;tt.STRICT_TEXTURE_CACHE=!1;tt.RENDER_OPTIONS=Qo(Qo(Qo(Qo({},sh.defaultOptions),rh.defaultOptions),oh.defaultOptions),nh.defaultOptions);Object.defineProperties(tt,{WRAP_MODE:{get(){return bt.defaultOptions.wrapMode},set(i){Mt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),bt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return bt.defaultOptions.scaleMode},set(i){Mt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),bt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return bt.defaultOptions.mipmap},set(i){Mt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),bt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return bt.defaultOptions.anisotropicLevel},set(i){Mt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),bt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return Mt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Fe.defaultResolution},set(i){Fe.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return Mt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Fe.defaultMultisample},set(i){Fe.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return Gr.defaultMaxTextures},set(i){Mt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Gr.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return Gr.defaultBatchSize},set(i){Mt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Gr.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return Gr.canUploadSameBuffer},set(i){Mt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Gr.canUploadSameBuffer=i}},GC_MODE:{get(){return $r.defaultMode},set(i){Mt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),$r.defaultMode=i}},GC_MAX_IDLE:{get(){return $r.defaultMaxIdle},set(i){Mt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),$r.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return $r.defaultCheckCountMax},set(i){Mt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),$r.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return Ki.defaultVertexPrecision},set(i){Mt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ki.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return Ki.defaultFragmentPrecision},set(i){Mt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ki.defaultFragmentPrecision=i}}});var us=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(us||{});let Gl=class{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}};const E0=class He{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Gl(null,null,1/0),this.deltaMS=1/He.targetFPMS,this.elapsedMS=1/He.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=us.NORMAL){return this._addListener(new Gl(t,e,r))}addOnce(t,e,r=us.NORMAL){return this._addListener(new Gl(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*He.targetFPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,He.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!He._shared){const t=He._shared=new He;t.autoStart=!0,t._protected=!0}return He._shared}static get system(){if(!He._system){const t=He._system=new He;t.autoStart=!0,t._protected=!0}return He._system}};E0.targetFPMS=.06;let We=E0;Object.defineProperties(tt,{TARGET_FPMS:{get(){return We.targetFPMS},set(i){Mt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),We.targetFPMS=i}}});let T0=class{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,us.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?We.shared:new We,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}};T0.extension=W.Application;nt.add(T0);const A0=[];nt.handleByList(W.Renderer,A0);function Ow(i){for(const t of A0)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var Bw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Fw=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Dw=Bw,S0=Fw;let I0=class{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=le.HIGH?this.multisample=le.HIGH:e>=le.MEDIUM?this.multisample=le.MEDIUM:e>=le.LOW?this.multisample=le.LOW:this.multisample=le.NONE}destroy(){}};I0.extension={type:W.RendererSystem,name:"_multisample"};nt.add(I0);let Lw=class{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}},C0=class{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const o=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new Lw(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}};C0.extension={type:W.RendererSystem,name:"buffer"};nt.add(C0);let R0=class{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let s,n,o,a;if(e&&(s=e.renderTexture,n=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};R0.extension={type:W.RendererSystem,name:"objectRenderer"};nt.add(R0);const Da=class nc extends Iw{constructor(t){super(),this.type=Ry.WEBGL,t=Object.assign({},tt.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new rs({projectionMatrix:new ne},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:nc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Mt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=nc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:G1()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Mt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Mt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Mt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Mt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Mt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Mt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Mt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Mt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Da.extension={type:W.Renderer,priority:1},Da.__plugins={},Da.__systems={};let Ad=Da;nt.handleByMap(W.RendererPlugin,Ad.__plugins);nt.handleByMap(W.RendererSystem,Ad.__systems);nt.add(Ad);let M0=class extends fo{constructor(t,e){const{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const o=new bt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof fo?this.addResourceAt(t[r],r):this.addResourceAt(Hy(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}},kw=class extends M0{constructor(t,e){const{width:r,height:s}=e||{};let n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:r,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Ys.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let h=0;h<s;h++){const l=o[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}},Uw=class extends Er{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}};const P0=class zn extends M0{constructor(t,e){const{width:r,height:s,autoLoad:n,linkBaseTexture:o}=e||{};if(t&&t.length!==zn.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:s});for(let a=0;a<zn.SIDES;a++)this.items[a].target=Ys.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=Ys.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Ys.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const s=this.itemDirtyIds;for(let n=0;n<zn.SIDES;n++){const o=this.items[n];(s[n]<o.dirtyId||r.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,r),s[n]=o.dirtyId):s[n]<-1&&(t.gl.texImage2D(o.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===zn.SIDES}};P0.SIDES=6;let Gw=P0,$w=class Vn extends Er{constructor(t,e){var r,s;e=e||{};let n,o,a;typeof t=="string"?(n=Vn.EMPTY,o=t,a=!0):(n=t,o=null,a=!1),super(n),this.url=o,this.crossOrigin=(r=e.crossOrigin)!=null?r:!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=(s=e.ownsImageBitmap)!=null?s:a,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await tt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ue.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){var t;return Vn._EMPTY=(t=Vn._EMPTY)!=null?t:tt.ADAPTER.createCanvas(0,0),Vn._EMPTY}};const oc=class La extends Er{constructor(t,e){e=e||{},super(tt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},La.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Er.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),s=Math.round(s),n=Math.round(n);const o=this.source;o.width=s,o.height=n,o._pixiId=`canvas_${ls()}`,o.getContext("2d").drawImage(t,0,0,e,r,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=La.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&La.SVG_XML.test(t)}};oc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,oc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let ac=oc;const hc=class lc extends Er{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const s=t[0].src||t[0];Er.crossOrigin(r,s,e.crossorigin);for(let n=0;n<t.length;++n){const o=document.createElement("source");let{src:a,mime:h}=t[n];if(a=a||t[n],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||lc.MIME_TYPES[u]||`video/${u}`}o.src=a,h&&(o.type=h),r.appendChild(o)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=We.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(We.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(We.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(We.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||lc.TYPES.includes(e)}};hc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],hc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let N0=hc;ju.push($w,i0,Uw,N0,ac,Wh,Gw,kw);let ah=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?It.EMPTY:(t=t||new It(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:s,c:n,d:o,tx:a,ty:h}=t,l=r*e.x+n*e.y+a,u=s*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[2],a=t[3],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[4],a=t[5],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[6],a=t[7],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(t,e,r,s,n){this.addFrameMatrix(t.worldTransform,e,r,s,n)}addFrameMatrix(t,e,r,s,n){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,d=t.ty;let c=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*e+h*r+u,y=a*e+l*r+d;c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+h*r+u,y=a*s+l*r+d,c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*e+h*n+u,y=a*e+l*n+d,c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+h*n+u,y=a*s+l*n+d,c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=c,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];s=l<s?l:s,n=u<n?u:n,o=l>o?l:o,a=u>a?u:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,n=0,o=n){const a=t.a,h=t.b,l=t.c,u=t.d,d=t.tx,c=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=r;y<s;y+=2){const _=e[y],v=e[y+1],x=a*_+l*v+d,b=u*v+h*_+c;f=Math.min(f,x-n),m=Math.max(m,x+n),p=Math.min(p,b-o),g=Math.max(g,b+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&s<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=o>u?o:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&s<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=o>u?o:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,n,o){t-=n,e-=o,r+=n,s+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}},oe=class O0 extends To{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ed,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ah,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const s=e[r];Object.defineProperty(O0.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new It),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){var e;t||(this._localBoundsRect||(this._localBoundsRect=new It),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ah);const r=this.transform,s=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(e=s==null?void 0:s.worldAlpha)!=null?e:1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=s,this.transform=r,this._bounds=n,this._bounds.updateID+=this._boundsID-o,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,n=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Hw),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Cb}set angle(t){this.transform.rotation=t*Rb}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},Hw=class extends oe{constructor(){super(...arguments),this.sortDirty=null}};oe.prototype.displayObjectUpdateTransform=oe.prototype.updateTransform;const Xw=new ne;function zw(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const B0=class uc extends oe{constructor(){super(),this.children=[],this.sortableChildren=uc.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t,this.onChildrenChange(r<s?r:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Ks(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,Ks(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Ks(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,s=e,n=s-r;let o;if(n>0&&n<=s){o=this.children.splice(r,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(zw),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const o=this.children[s];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==uc.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=Xw.copyFrom(s),s.prepend(n)):s=n),r&&e.intersects(r,s))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let r=0,s=this.children.length;r<s;++r)this.children[r].render(t)}}renderAdvanced(t){var e,r,s;const n=this.filters,o=this._mask;if(n){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<n.length;h++)n[h].enabled&&this._enabledFilters.push(n[h])}const a=n&&((e=this._enabledFilters)==null?void 0:e.length)||o&&(!o.isMaskData||o.enabled&&(o.autoDetect||o.type!==de.NONE));if(a&&t.batch.flush(),n&&(r=this._enabledFilters)!=null&&r.length&&t.filter.push(this,this._enabledFilters),o&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}a&&t.batch.flush(),o&&t.mask.pop(this),n&&(s=this._enabledFilters)!=null&&s.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,r=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<r.length;++s)r[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};B0.defaultSortableChildren=!1;let Ee=B0;Ee.prototype.containerUpdateTransform=Ee.prototype.updateTransform;Object.defineProperties(tt,{SORTABLE_CHILDREN:{get(){return Ee.defaultSortableChildren},set(i){Mt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ee.defaultSortableChildren=i}}});const Nn=new Ot,Vw=new Uint16Array([0,1,2,0,2,3]);class tr extends Ee{constructor(t){super(),this._anchor=new Qr(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Zt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=dt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Bt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Vw,this.pluginName="batch",this.isSprite=!0,this._roundPixels=tt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=gr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=gr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,d=t.orig,c=this._anchor;let f=0,p=0,m=0,g=0;if(u?(p=u.x-c._x*d.width,f=p+u.width,g=u.y-c._y*d.height,m=g+u.height):(p=-c._x*d.width,f=p+d.width,g=-c._y*d.height,m=g+d.height),l[0]=r*p+n*g+a,l[1]=o*g+s*p+h,l[2]=r*f+n*g+a,l[3]=o*g+s*f+h,l[4]=r*f+n*m+a,l[5]=o*m+s*f+h,l[6]=r*p+n*m+a,l[7]=o*m+s*p+h,this._roundPixels){const y=tt.RESOLUTION;for(let _=0;_<l.length;++_)l[_]=Math.round(l[_]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,h=n.c,l=n.d,u=n.tx,d=n.ty,c=-s._x*r.width,f=c+r.width,p=-s._y*r.height,m=p+r.height;if(e[0]=o*c+h*p+u,e[1]=l*p+a*c+d,e[2]=o*f+h*p+u,e[3]=l*p+a*f+d,e[4]=o*f+h*m+u,e[5]=l*m+a*f+d,e[6]=o*c+h*m+u,e[7]=l*m+a*c+d,this._roundPixels){const g=tt.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*g)/g}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new ah),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new It),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Nn);const e=this._texture.orig.width,r=this._texture.orig.height,s=-e*this.anchor.x;let n=0;return Nn.x>=s&&Nn.x<s+e&&(n=-r*this.anchor.y,Nn.y>=n&&Nn.y<n+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof Bt?t:Bt.from(t,e);return new tr(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=gr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=gr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Bt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const F0=new ne;oe.prototype._cacheAsBitmap=!1;oe.prototype._cacheData=null;oe.prototype._cacheAsBitmapResolution=null;oe.prototype._cacheAsBitmapMultisample=null;class Ww{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(oe.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new Ww),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});oe.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};oe.prototype._initCachedDisplayObject=function(i){var t,e,r;if((t=this._cacheData)!=null&&t.sprite)return;const s=this.alpha;this.alpha=1,i.batch.flush();const n=this.getLocalBounds(new It,!0);if((e=this.filters)!=null&&e.length){const m=this.filters[0].padding;n.pad(m)}const o=this.cacheAsBitmapResolution||i.resolution;n.ceil(o),n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o);const a=i.renderTexture.current,h=i.renderTexture.sourceFrame.clone(),l=i.renderTexture.destinationFrame.clone(),u=i.projection.transform,d=Io.create({width:n.width,height:n.height,resolution:o,multisample:(r=this.cacheAsBitmapMultisample)!=null?r:i.multisample}),c=`cacheAsBitmap_${ls()}`;this._cacheData.textureCacheId=c,bt.addToCache(d.baseTexture,c),Bt.addToCache(d,c);const f=this.transform.localTransform.copyTo(F0).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:d,clear:!0,transform:f,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=u,i.renderTexture.bind(a,h,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const p=new tr(d);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-(n.x/n.width),p.anchor.y=-(n.y/n.height),p.alpha=s,p._bounds=this._bounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=p.containsPoint.bind(p)};oe.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};oe.prototype._initCachedDisplayObjectCanvas=function(i){var t;if((t=this._cacheData)!=null&&t.sprite)return;const e=this.getLocalBounds(new It,!0),r=this.alpha;this.alpha=1;const s=i.canvasContext.activeContext,n=i._projTransform,o=this.cacheAsBitmapResolution||i.resolution;e.ceil(o),e.width=Math.max(e.width,1/o),e.height=Math.max(e.height,1/o);const a=Io.create({width:e.width,height:e.height,resolution:o}),h=`cacheAsBitmap_${ls()}`;this._cacheData.textureCacheId=h,bt.addToCache(a.baseTexture,h),Bt.addToCache(a,h);const l=F0;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),i.canvasContext.activeContext=s,i._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const u=new tr(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)};oe.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};oe.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};oe.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,bt.removeFromCache(this._cacheData.textureCacheId),Bt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};oe.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};oe.prototype.name=null;Ee.prototype.getChildByName=function(i,t){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===i)return this.children[e];if(t)for(let e=0,r=this.children.length;e<r;e++){const s=this.children[e];if(!s.getChildByName)continue;const n=s.getChildByName(i,!0);if(n)return n}return null};oe.prototype.getGlobalPosition=function(i=new Ot,t=!1){return this.parent?this.parent.toGlobal(this.position,i,t):(i.x=this.position.x,i.y=this.position.y),i};var jw=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class Yw extends Fe{constructor(t=1){super(Dw,jw,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const qw={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Kw=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Zw(i){const t=qw[i],e=t.length;let r=Kw,s="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<i;a++){let h=n.replace("%index%",a.toString());o=a,a>=e&&(o=i-a-1),h=h.replace("%value%",t[o].toString()),s+=h,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}const Qw=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Jw(i,t){const e=Math.ceil(i/2);let r=Qw,s="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<i;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),s+=a,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}class cc extends Fe{constructor(t,e=8,r=4,s=Fe.defaultResolution,n=5){const o=Jw(n,t),a=Zw(n);super(o,a),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,s);else{const n=t.getFilterTexture(),o=t.renderer;let a=e,h=n;this.state.blend=!1,t.applyFilter(this,a,h,Ai.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,Ai.BLIT),this.uniforms.uSampler=h;const u=h;h=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,r,s),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class tE extends Fe{constructor(t=8,e=4,r=Fe.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new cc(!0,t,e,r,s),this.blurYFilter=new cc(!1,t,e,r,s),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,s){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Ai.CLEAR),this.blurYFilter.apply(t,a,r,s),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,r,s):this.blurXFilter.apply(t,e,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var eE=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class dc extends Fe{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(S0,eE,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,s,n]=Zt.shared.setValue(t).toArray(),o=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),s=Math.sin(t),n=Math.sqrt,o=1/3,a=n(o),h=r+(1-r)*o,l=o*(1-r)-a*s,u=o*(1-r)+a*s,d=o*(1-r)+a*s,c=r+o*(1-r),f=o*(1-r)-a*s,p=o*(1-r)-a*s,m=o*(1-r)+a*s,g=r+o*(1-r),y=[h,l,u,0,0,d,c,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const r=(t||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const r=t*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,s,n){t=t||.2,e=e||.15,r=r||16770432,s=s||3375104;const o=Zt.shared,[a,h,l]=o.setValue(r).toArray(),[u,d,c]=o.setValue(s).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,u,d,c,e,0,a-u,h-d,l-c,0,0];this._loadMatrix(f,n)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}dc.prototype.grayscale=dc.prototype.greyscale;var iE=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,rE=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class sE extends Fe{constructor(t,e){const r=new ne;t.renderable=!1,super(rE,iE,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new Ot(e,e)}apply(t,e,r,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,e,r,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var nE=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,oE=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class aE extends Fe{constructor(){super(oE,nE)}}var hE=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class lE extends Fe{constructor(t=.5,e=Math.random()){super(S0,hE,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Bp={AlphaFilter:Yw,BlurFilter:tE,BlurFilterPass:cc,ColorMatrixFilter:dc,DisplacementFilter:sE,FXAAFilter:aE,NoiseFilter:lE};Object.entries(Bp).forEach(([i,t])=>{Object.defineProperty(Bp,i,{get(){return Mt("7.1.0",`filters.${i} has moved to ${i}`),t}})});class uE{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(We.system.add(this.tickerUpdate,this,us.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(We.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const mr=new uE;class Co{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Co.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ot,this.page=new Ot,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class hh extends Co{constructor(){super(...arguments),this.client=new Ot,this.movement=new Ot,this.offset=new Ot,this.global=new Ot,this.screen=new Ot}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,s,n,o,a,h,l,u,d,c,f,p,m){throw new Error("Method not implemented.")}}class ai extends hh{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Qs extends hh{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Qs.DOM_DELTA_PIXEL=0,Qs.DOM_DELTA_LINE=1,Qs.DOM_DELTA_PAGE=2;const cE=2048,dE=new Ot,$l=new Ot;class fE{constructor(t){this.dispatch=new To,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,s)=>r.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,s=e.length;r<s;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){mr.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[r](this.rootTarget,this.rootTarget.eventMode,dE.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(t.currentTarget=r[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(t.currentTarget=r[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const s=Array.isArray(e)?e:[e];for(let n=r.length-1;n>=0;n--)s.forEach(o=>{t.currentTarget=r[n],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let r=0;r<cE&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,s,n,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(mr.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let d=u.length-1;d>=0;d--){const c=u[d],f=this.hitTestMoveRecursive(c,this._isInteractive(e)?e:c.eventMode,r,s,n,o||n(t,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!n(t,r)&&s(t,r)?l?[t]:[]:null}hitTestRecursive(t,e,r,s,n){if(this._interactivePrune(t)||n(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(mr.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const u=h[l],d=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,r,s,n);if(d){if(d.length>0&&!d[d.length-1].parent)continue;const c=t.isInteractive();return(d.length>0||c)&&d.push(t),d}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&s(t,r)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var r;if(t.hitArea&&(t.worldTransform.applyInverse(e,$l),!t.hitArea.contains($l.x,$l.y)))return!0;if(t._mask){const s=t._mask.isMaskData?t._mask.maskObject:t._mask;if(s&&!((r=s.containsPoint)!=null&&r.call(s,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var r,s;e=e??t.type;const n=`on${e}`;(s=(r=t.currentTarget)[n])==null||s.call(r,t);const o=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,o),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof ai)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,r,s;if(!(t instanceof ai)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const n=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const o=n.pointerType==="mouse"||n.pointerType==="pen",a=this.trackingData(t.pointerId),h=this.findMountedTarget(a.overTargets);if(((e=a.overTargets)==null?void 0:e.length)>0&&h!==n.target){const d=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,d,h);if(this.dispatchEvent(c,"pointerout"),o&&this.dispatchEvent(c,"mouseout"),!n.composedPath().includes(h)){const f=this.createPointerEvent(t,"pointerleave",h);for(f.eventPhase=f.AT_TARGET;f.target&&!n.composedPath().includes(f.target);)f.currentTarget=f.target,this.notifyTarget(f),o&&this.notifyTarget(f,"mouseleave"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}if(h!==n.target){const d=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(n,d);this.dispatchEvent(c,"pointerover"),o&&this.dispatchEvent(c,"mouseover");let f=h==null?void 0:h.parent;for(;f&&f!==this.rootTarget.parent&&f!==n.target;)f=f.parent;if(!f||f===this.rootTarget.parent){const p=this.clonePointerEvent(n,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==h&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),o&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(c)}const l=[],u=(r=this.enableGlobalMoveEvents)!=null?r:!0;this.moveOnAll?l.push("pointermove"):this.dispatchEvent(n,"pointermove"),u&&l.push("globalpointermove"),n.pointerType==="touch"&&(this.moveOnAll?l.splice(1,0,"touchmove"):this.dispatchEvent(n,"touchmove"),u&&l.push("globaltouchmove")),o&&(this.moveOnAll?l.splice(1,0,"mousemove"):this.dispatchEvent(n,"mousemove"),u&&l.push("globalmousemove"),this.cursor=(s=n.target)==null?void 0:s.cursor),l.length>0&&this.all(n,l),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=n.composedPath(),this.freeEvent(n)}mapPointerOver(t){var e;if(!(t instanceof ai)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),s=this.createPointerEvent(t),n=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),n&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=(e=s.target)==null?void 0:e.cursor);const o=this.clonePointerEvent(s,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;r.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof ai)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof ai)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}const s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]);let o=n;if(n&&!r.composedPath().includes(n)){let a=n;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.notifyTarget(r,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=s.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof ai)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof Qs)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){var s;const n=this.allocateEvent(ai);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=(s=r??this.hitTest(n.global.x,n.global.y))!=null?s:this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Qs);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(ai);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof ai&&e instanceof ai&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof hh&&e instanceof hh&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let s=0,n=r.length;s<n&&!t.propagationImmediatelyStopped;s++)r[s].once&&t.currentTarget.removeListener(e,r[s].fn,void 0,!0),r[s].fn.call(r[s].context,t)}}var pE=Object.defineProperty,Fp=Object.getOwnPropertySymbols,mE=Object.prototype.hasOwnProperty,gE=Object.prototype.propertyIsEnumerable,Dp=(i,t,e)=>t in i?pE(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,yE=(i,t)=>{for(var e in t||(t={}))mE.call(t,e)&&Dp(i,e,t[e]);if(Fp)for(var e of Fp(t))gE.call(t,e)&&Dp(i,e,t[e]);return i};const _E=1,vE={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},fc=class pc{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new fE(null),mr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new ai(null),this.rootWheelEvent=new Qs(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(yE({},pc.defaultEventFeatures),{set:(e,r,s)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[r]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){var e,r;const{view:s,resolution:n}=this.renderer;this.setTargetElement(s),this.resolution=n,pc._defaultEventMode=(e=t.eventMode)!=null?e:"auto",Object.assign(this.features,(r=t.eventFeatures)!=null?r:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,s=e.length;r<s;r++){const n=e[r],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,mr.pointerMoved();const e=this.normalizeToPointerData(t);for(let r=0,s=e.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let n=0,o=s.length;n<o;n++){const a=this.bootstrapEvent(this.rootPointerEvent,s[n]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let r=0,s=e.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,mr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;mr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;mr.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*n,t.y=(r-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,s=t.changedTouches.length;r<s;r++){const n=t.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=_E),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=vE[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};fc.extension={name:"events",type:[W.RendererSystem,W.CanvasRendererSystem]},fc.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let mc=fc;nt.add(mc);function Lp(i){return i==="dynamic"||i==="static"}const xE={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var i;return(i=this._internalInteractive)!=null?i:Lp(mc.defaultEventMode)},set interactive(i){Mt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){var i;return(i=this._internalEventMode)!=null?i:mc.defaultEventMode},set eventMode(i){this._internalInteractive=Lp(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,s)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,s)},dispatchEvent(i){if(!(i instanceof Co))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};oe.mixin(xE);const bE={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};oe.mixin(bE);const wE=9,Jo=100,EE=0,TE=0,kp=2,Up=1,AE=-1e3,SE=-1e3,IE=2;class D0{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(qi.tablet||qi.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Jo}px`,e.style.height=`${Jo}px`,e.style.position="absolute",e.style.top=`${EE}px`,e.style.left=`${TE}px`,e.style.zIndex=kp.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Up}px`,t.style.height=`${Up}px`,t.style.position="absolute",t.style.top=`${AE}px`,t.style.left=`${SE}px`,t.style.zIndex=IE.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(qi.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=s/o*h,u=n/a*h;let d=this.div;d.style.left=`${e}px`,d.style.top=`${r}px`,d.style.width=`${o}px`,d.style.height=`${a}px`;for(let c=0;c<this.children.length;c++){const f=this.children[c];if(f.renderId!==this.renderId)f._accessibleActive=!1,Ks(this.children,c,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,c--;else{d=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(d.style.left=`${(m.tx+p.x*m.a)*l}px`,d.style.top=`${(m.ty+p.y*m.d)*u}px`,d.style.width=`${p.width*m.a*l}px`,d.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),d.style.left=`${p.x*l}px`,d.style.top=`${p.y*u}px`,d.style.width=`${p.width*l}px`,d.style.height=`${p.height*u}px`,d.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(d.title=f.accessibleTitle),d.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&d.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==d.title||f.tabIndex!==d.tabIndex)&&(d.title=f.accessibleTitle,d.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Jo}px`,e.style.height=`${Jo}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=kp.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,s=this.renderer.events.rootBoundary,n=Object.assign(new Co(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>s.dispatchEvent(n,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===wE&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}D0.extension={name:"accessibility",type:[W.RendererPlugin,W.CanvasRendererPlugin]};nt.add(D0);const L0=class gc{constructor(t){this.stage=new Ee,t=Object.assign({forceCanvas:!1},t),this.renderer=Ow(t),gc._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const r=gc._plugins.slice(0);r.reverse(),r.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};L0._plugins=[];let k0=L0;nt.handleByList(W.Application,k0._plugins);class U0{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,r=n}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}U0.extension=W.Application;nt.add(U0);const Gp={loader:W.LoadParser,resolver:W.ResolveParser,cache:W.CacheParser,detection:W.DetectionParser};nt.handle(W.Asset,i=>{const t=i.ref;Object.entries(Gp).filter(([e])=>!!t[e]).forEach(([e,r])=>{var s;return nt.add(Object.assign(t[e],{extension:(s=t[e].extension)!=null?s:r}))})},i=>{const t=i.ref;Object.keys(Gp).filter(e=>!!t[e]).forEach(e=>nt.remove(t[e]))});class CE{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function yn(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function Sr(i,t){const e=i.split("?")[0],r=ge.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const ui=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i),yc=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i};function G0(i,t,e,r,s){const n=t[e];for(let o=0;o<n.length;o++){const a=n[o];e<t.length-1?G0(i.replace(r[e],a),t,e+1,r,s):s.push(i.replace(r[e],a))}}function RE(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const s=[];e.forEach(n=>{const o=n.substring(1,n.length-1).split(",");s.push(o)}),G0(i,s,0,e,r)}else r.push(i);return r}const lh=i=>!Array.isArray(i);class ME{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=ui(t);let s;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){s=h.getCacheableAssets(r,e);break}}s||(s={},r.forEach(a=>{s[a]=e}));const n=Object.keys(s),o={cacheKeys:n,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof Bt){const a=e;r.forEach(h=>{a.baseTexture!==Bt.EMPTY.baseTexture&&bt.addToCache(a.baseTexture,h),Bt.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const qr=new ME;var PE=Object.defineProperty,NE=Object.defineProperties,OE=Object.getOwnPropertyDescriptors,$p=Object.getOwnPropertySymbols,BE=Object.prototype.hasOwnProperty,FE=Object.prototype.propertyIsEnumerable,Hp=(i,t,e)=>t in i?PE(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,DE=(i,t)=>{for(var e in t||(t={}))BE.call(t,e)&&Hp(i,e,t[e]);if($p)for(var e of $p(t))FE.call(t,e)&&Hp(i,e,t[e]);return i},LE=(i,t)=>NE(i,OE(t));class kE{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var s,n;let o=null,a=null;if(e.loadParser&&(a=this._parserHash[e.loadParser],a||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!a){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&(s=l.test)!=null&&s.call(l,t,e,this)){a=l;break}}if(!a)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await a.load(t,e,this),r.parser=a;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((n=l.testParse)==null?void 0:n.call(l,o,e,this))&&(o=await l.parse(o,e,this)||o,r.parser=l)}return o})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const s={},n=lh(t),o=ui(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{const u=ge.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),s[l.src]=await this.promiseCache[u].promise,e&&e(++r/a)}catch(d){throw delete this.promiseCache[u],delete s[l.src],new Error(`[Loader.load] Failed to load ${u}.
${d}`)}});return await Promise.all(h),n?s[o[0].src]:s}async unload(t){const e=ui(t,r=>({alias:[r],src:r})).map(async r=>{var s,n;const o=ge.toAbsolute(r.src),a=this.promiseCache[o];if(a){const h=await a.promise;delete this.promiseCache[o],(n=(s=a.parser)==null?void 0:s.unload)==null||n.call(s,h,r,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),LE(DE({},t),{[e.name]:e})),{})}}var pi=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(pi||{});const UE=".json",GE="application/json",$E={extension:{type:W.LoadParser,priority:pi.Low},name:"loadJson",test(i){return yn(i,GE)||Sr(i,UE)},async load(i){return await(await tt.ADAPTER.fetch(i)).json()}};nt.add($E);const HE=".txt",XE="text/plain",zE={name:"loadTxt",extension:{type:W.LoadParser,priority:pi.Low},test(i){return yn(i,XE)||Sr(i,HE)},async load(i){return await(await tt.ADAPTER.fetch(i)).text()}};nt.add(zE);var VE=Object.defineProperty,WE=Object.defineProperties,jE=Object.getOwnPropertyDescriptors,Xp=Object.getOwnPropertySymbols,YE=Object.prototype.hasOwnProperty,qE=Object.prototype.propertyIsEnumerable,zp=(i,t,e)=>t in i?VE(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,KE=(i,t)=>{for(var e in t||(t={}))YE.call(t,e)&&zp(i,e,t[e]);if(Xp)for(var e of Xp(t))qE.call(t,e)&&zp(i,e,t[e]);return i},ZE=(i,t)=>WE(i,jE(t));const QE=["normal","bold","100","200","300","400","500","600","700","800","900"],JE=[".ttf",".otf",".woff",".woff2"],tT=["font/ttf","font/otf","font/woff","font/woff2"],eT=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function iT(i){const t=ge.extname(i),e=ge.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let r=e.length>0;for(const n of e)if(!n.match(eT)){r=!1;break}let s=e.join(" ");return r||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const rT=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function sT(i){return rT.test(i)?i:encodeURI(i)}const nT={extension:{type:W.LoadParser,priority:pi.Low},name:"loadWebFont",test(i){return yn(i,tT)||Sr(i,JE)},async load(i,t){var e,r,s,n,o,a;const h=tt.ADAPTER.getFontFaceSet();if(h){const l=[],u=(r=(e=t.data)==null?void 0:e.family)!=null?r:iT(i),d=(o=(n=(s=t.data)==null?void 0:s.weights)==null?void 0:n.filter(f=>QE.includes(f)))!=null?o:["normal"],c=(a=t.data)!=null?a:{};for(let f=0;f<d.length;f++){const p=d[f],m=new FontFace(u,`url(${sT(i)})`,ZE(KE({},c),{weight:p}));await m.load(),h.add(m),l.push(m)}return l.length===1?l[0]:l}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>tt.ADAPTER.getFontFaceSet().delete(t))}};nt.add(nT);let Vp=0,Hl;const oT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",aT={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${oT}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},hT={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Xl;class lT{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([aT.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(e),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Hl===void 0&&(Hl=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Hl&&(Xl||(Xl=URL.createObjectURL(new Blob([hT.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Xl),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((s,n)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:n})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[Vp]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Vp++,id:r})}}const Wp=new lT;function Ro(i,t,e){i.resource.internal=!0;const r=new Bt(i),s=()=>{delete t.promiseCache[e],qr.has(e)&&qr.remove(e)};return r.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),r}var uT=Object.defineProperty,jp=Object.getOwnPropertySymbols,cT=Object.prototype.hasOwnProperty,dT=Object.prototype.propertyIsEnumerable,Yp=(i,t,e)=>t in i?uT(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,qp=(i,t)=>{for(var e in t||(t={}))cT.call(t,e)&&Yp(i,e,t[e]);if(jp)for(var e of jp(t))dT.call(t,e)&&Yp(i,e,t[e]);return i};const fT=[".jpeg",".jpg",".png",".webp",".avif"],pT=["image/jpeg","image/png","image/webp","image/avif"];async function mT(i){const t=await tt.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const Kh={name:"loadTextures",extension:{type:W.LoadParser,priority:pi.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return yn(i,pT)||Sr(i,fT)},async load(i,t,e){var r;const s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;s?this.config.preferWorkers&&await Wp.isImageBitmapSupported()?n=await Wp.loadImageBitmap(i):n=await mT(i):n=await new Promise((h,l)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=i,u.complete?h(u):(u.onload=()=>h(u),u.onerror=d=>l(d))});const o=qp({},t.data);o.resolution!=null||(o.resolution=rr(i)),s&&((r=o.resourceOptions)==null?void 0:r.ownsImageBitmap)===void 0&&(o.resourceOptions=qp({},o.resourceOptions),o.resourceOptions.ownsImageBitmap=!0);const a=new bt(n,o);return a.resource.src=i,Ro(a,e,i)},unload(i){i.destroy(!0)}};nt.add(Kh);var gT=Object.defineProperty,Kp=Object.getOwnPropertySymbols,yT=Object.prototype.hasOwnProperty,_T=Object.prototype.propertyIsEnumerable,Zp=(i,t,e)=>t in i?gT(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,vT=(i,t)=>{for(var e in t||(t={}))yT.call(t,e)&&Zp(i,e,t[e]);if(Kp)for(var e of Kp(t))_T.call(t,e)&&Zp(i,e,t[e]);return i};const xT=".svg",bT="image/svg+xml",wT={extension:{type:W.LoadParser,priority:pi.High},name:"loadSVG",test(i){return yn(i,bT)||Sr(i,xT)},async testParse(i){return ac.test(i)},async parse(i,t,e){var r;const s=new ac(i,(r=t==null?void 0:t.data)==null?void 0:r.resourceOptions);await s.load();const n=new bt(s,vT({resolution:rr(i)},t==null?void 0:t.data));return n.resource.src=t.src,Ro(n,e,t.src)},async load(i,t){return(await tt.ADAPTER.fetch(i)).text()},unload:Kh.unload};nt.add(wT);var ET=Object.defineProperty,Qp=Object.getOwnPropertySymbols,TT=Object.prototype.hasOwnProperty,AT=Object.prototype.propertyIsEnumerable,Jp=(i,t,e)=>t in i?ET(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,tm=(i,t)=>{for(var e in t||(t={}))TT.call(t,e)&&Jp(i,e,t[e]);if(Qp)for(var e of Qp(t))AT.call(t,e)&&Jp(i,e,t[e]);return i};const ST=[".mp4",".m4v",".webm",".ogv"],IT=["video/mp4","video/webm","video/ogg"],CT={name:"loadVideo",extension:{type:W.LoadParser,priority:pi.High},config:{defaultAutoPlay:!0},test(i){return yn(i,IT)||Sr(i,ST)},async load(i,t,e){var r;let s;const n=await(await tt.ADAPTER.fetch(i)).blob(),o=URL.createObjectURL(n);try{const a=tm({autoPlay:this.config.defaultAutoPlay},(r=t==null?void 0:t.data)==null?void 0:r.resourceOptions),h=new N0(o,a);await h.load();const l=new bt(h,tm({alphaMode:await U1(),resolution:rr(i)},t==null?void 0:t.data));l.resource.src=i,s=Ro(l,e,i),s.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(a){throw URL.revokeObjectURL(o),a}return s},unload(i){i.destroy(!0)}};nt.add(CT);var RT=Object.defineProperty,MT=Object.defineProperties,PT=Object.getOwnPropertyDescriptors,em=Object.getOwnPropertySymbols,NT=Object.prototype.hasOwnProperty,OT=Object.prototype.propertyIsEnumerable,im=(i,t,e)=>t in i?RT(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Ts=(i,t)=>{for(var e in t||(t={}))NT.call(t,e)&&im(i,e,t[e]);if(em)for(var e of em(t))OT.call(t,e)&&im(i,e,t[e]);return i},rm=(i,t)=>MT(i,PT(t));class BT{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var e,r,s;if(this._bundleIdConnector=(e=t.connector)!=null?e:this._bundleIdConnector,this._createBundleAssetId=(r=t.createBundleAssetId)!=null?r:this._createBundleAssetId,this._extractAssetIdFromBundle=(s=t.extractAssetIdFromBundle)!=null?s:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,name:r,src:s,srcs:n}=t;return ui(e||r||s||n,o=>{var a;return typeof o=="string"?o:Array.isArray(o)?o.map(h=>{var l,u;return(u=(l=h==null?void 0:h.src)!=null?l:h==null?void 0:h.srcs)!=null?u:h}):o!=null&&o.src||o!=null&&o.srcs?(a=o.src)!=null?a:o.srcs:o},!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(s=>{var n,o;const a=(n=s.src)!=null?n:s.srcs,h=(o=s.alias)!=null?o:s.name;let l;if(typeof h=="string"){const u=this._createBundleAssetId(t,h);r.push(u),l=[h,u]}else{const u=h.map(d=>this._createBundleAssetId(t,d));r.push(...u),l=[...h,...u]}this.add(rm(Ts({},s),{alias:l,src:a}))}):Object.keys(e).forEach(s=>{var n;const o=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:o,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:o,src:e[s]});else{const a=e[s],h=(n=a.src)!=null?n:a.srcs;this.add(rm(Ts({},a),{alias:o,src:Array.isArray(h)?h:[h]}))}r.push(...o)}),this._bundles[t]=r}add(t,e,r,s,n){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(Mt("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:r,format:s,loadParser:n})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},ui(o).forEach(h=>{const{src:l,srcs:u}=h;let{data:d,format:c,loadParser:f}=h;const p=ui(l||u).map(y=>typeof y=="string"?RE(y):Array.isArray(y)?y:[y]),m=this.getAlias(h);Array.isArray(m)?m.forEach(a):a(m);const g=[];p.forEach(y=>{y.forEach(_=>{var v,x,b;let M={};if(typeof _!="object"){M.src=_;for(let S=0;S<this._parsers.length;S++){const A=this._parsers[S];if(A.test(_)){M=A.parse(_);break}}}else d=(v=_.data)!=null?v:d,c=(x=_.format)!=null?x:c,f=(b=_.loadParser)!=null?b:f,M=Ts(Ts({},M),_);if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${M.src}`);M=this.buildResolvedAsset(M,{aliases:m,data:d,format:c,loadParser:f}),g.push(M)})}),m.forEach(y=>{this._assetMap[y]=g})})}resolveBundle(t){const e=lh(t);t=ui(t);const r={};return t.forEach(s=>{const n=this._bundles[s];if(n){const o=this.resolve(n),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(s,h)]=l}r[s]=a}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const s in e)r[s]=e[s].src;return r}return e.src}resolve(t){const e=lh(t);t=ui(t);const r={};return t.forEach(s=>{var n;if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s];const a=o[0],h=this._getPreferredOrder(o);h==null||h.priority.forEach(l=>{h.params[l].forEach(u=>{const d=o.filter(c=>c[l]?c[l]===u:!1);d.length&&(o=d)})}),this._resolverHash[s]=(n=o[0])!=null?n:a}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});r[s]=this._resolverHash[s]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){var r;const{aliases:s,data:n,loadParser:o,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=ge.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=(r=s??t.alias)!=null?r:[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data=Ts(Ts({},n||{}),t.data),t.loadParser=o??t.loadParser,t.format=a??ge.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class FT{constructor(){this._detections=[],this._initialized=!1,this.resolver=new BT,this.loader=new kE,this.cache=qr,this._backgroundLoader=new CE(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var e,r,s;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const n=(r=(e=t.texturePreference)==null?void 0:e.resolution)!=null?r:1,o=typeof n=="number"?[n]:n,a=await this._detectFormats({preferredFormats:(s=t.texturePreference)==null?void 0:s.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:a,resolution:o}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,s,n){this.resolver.add(t,e,r,s,n)}async load(t,e){this._initialized||await this.init();const r=lh(t),s=ui(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(s),o=await this._mapLoadToResolve(n,e);return r?o[s[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const s=this.resolver.resolveBundle(t),n={},o=Object.keys(s);let a=0,h=0;const l=()=>{e==null||e(++a/h)},u=o.map(d=>{const c=s[d];return h+=Object.keys(c).length,this._mapLoadToResolve(c,l).then(f=>{n[d]=f})});return await Promise.all(u),r?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return qr.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=qr.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(r,e);this._backgroundLoader.active=!0;const o={};return r.forEach((a,h)=>{const l=n[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[s[h]]=l,qr.set(u,l)}),o}async unload(t){this._initialized||await this.init();const e=ui(t).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=ui(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{qr.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,s)=>e.indexOf(r)===s),e}get detections(){return this._detections}get preferWorkers(){return Kh.config.preferWorkers}set preferWorkers(t){Mt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const ta=new FT;nt.handleByList(W.LoadParser,ta.loader.parsers).handleByList(W.ResolveParser,ta.resolver.parsers).handleByList(W.CacheParser,ta.cache.parsers).handleByList(W.DetectionParser,ta.detections);const DT={extension:W.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof Bt),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((s,n)=>{e[r+(n===0?"":n+1)]=s})}),e}};nt.add(DT);async function $0(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const LT={extension:{type:W.DetectionParser,priority:1},test:async()=>$0("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};nt.add(LT);const kT={extension:{type:W.DetectionParser,priority:0},test:async()=>$0("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};nt.add(kT);const sm=["png","jpg","jpeg"],UT={extension:{type:W.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...sm],remove:async i=>i.filter(t=>!sm.includes(t))};nt.add(UT);const GT="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Sd(i){return GT?!1:document.createElement("video").canPlayType(i)!==""}const $T={extension:{type:W.DetectionParser,priority:0},test:async()=>Sd("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")};nt.add($T);const HT={extension:{type:W.DetectionParser,priority:0},test:async()=>Sd("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")};nt.add(HT);const XT={extension:{type:W.DetectionParser,priority:0},test:async()=>Sd("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")};nt.add(XT);const zT={extension:W.ResolveParser,test:Kh.test,parse:i=>{var t,e;return{resolution:parseFloat((e=(t=tt.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?e:"1"),format:ge.extname(i).slice(1),src:i}}};nt.add(zT);var ze=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(ze||{});const uh={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let zi,Ds;function nm(){Ds={s3tc:zi.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:zi.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:zi.getExtension("WEBGL_compressed_texture_etc"),etc1:zi.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:zi.getExtension("WEBGL_compressed_texture_pvrtc")||zi.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:zi.getExtension("WEBGL_compressed_texture_atc"),astc:zi.getExtension("WEBGL_compressed_texture_astc")}}const VT={extension:{type:W.DetectionParser,priority:2},test:async()=>{const i=tt.ADAPTER.createCanvas().getContext("webgl");return i?(zi=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{Ds||nm();const t=[];for(const e in Ds)Ds[e]&&t.push(e);return[...t,...i]},remove:async i=>(Ds||nm(),i.filter(t=>!(t in Ds)))};nt.add(VT);class WT extends Wh{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,s;typeof t=="string"?(r=t,s=new Uint8Array):(r=null,s=t),super(s,e),this.origin=r,this.buffer=s?new Wu(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Wu(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class ss extends WT{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=ss._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||ss._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let n=0,o=this.levels;n<o;n++){const{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[n];s.compressedTexImage2D(s.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=ss._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,s,n,o,a){const h=new Array(r);let l=t.byteOffset,u=o,d=a,c=u+s-1&~(s-1),f=d+n-1&~(n-1),p=c*f*uh[e];for(let m=0;m<r;m++)h[m]={levelID:m,levelWidth:r>1?u:c,levelHeight:r>1?d:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,d=d>>1||1,c=u+s-1&~(s-1),f=d+n-1&~(n-1),p=c*f*uh[e];return h}}const zl=4,ea=124,jT=32,om=20,YT=542327876,ia={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},qT={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},ra={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},KT=1,ZT=2,QT=4,JT=64,tA=512,eA=131072,iA=827611204,rA=861165636,sA=894720068,nA=808540228,oA=4,aA={[iA]:ze.COMPRESSED_RGBA_S3TC_DXT1_EXT,[rA]:ze.COMPRESSED_RGBA_S3TC_DXT3_EXT,[sA]:ze.COMPRESSED_RGBA_S3TC_DXT5_EXT},hA={70:ze.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ze.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ze.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ze.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ze.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ze.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ze.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ze.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ze.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function lA(i){const t=new Uint32Array(i);if(t[0]!==YT)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(i,0,ea/Uint32Array.BYTES_PER_ELEMENT),r=e[ia.HEIGHT],s=e[ia.WIDTH],n=e[ia.MIPMAP_COUNT],o=new Uint32Array(i,ia.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,jT/Uint32Array.BYTES_PER_ELEMENT),a=o[KT];if(a&QT){const h=o[qT.FOURCC];if(h!==nA){const _=aA[h],v=zl+ea,x=new Uint8Array(i,v);return[new ss(x,{format:_,width:s,height:r,levels:n})]}const l=zl+ea,u=new Uint32Array(t.buffer,l,om/Uint32Array.BYTES_PER_ELEMENT),d=u[ra.DXGI_FORMAT],c=u[ra.RESOURCE_DIMENSION],f=u[ra.MISC_FLAG],p=u[ra.ARRAY_SIZE],m=hA[d];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(f===oA)throw new Error("DDSParser does not support cubemap textures");if(c===6)throw new Error("DDSParser does not supported 3D texture data");const g=new Array,y=zl+ea+om;if(p===1)g.push(new Uint8Array(i,y));else{const _=uh[m];let v=0,x=s,b=r;for(let S=0;S<n;S++){const A=Math.max(1,x+3&-4),R=Math.max(1,b+3&-4),L=A*R*_;v+=L,x=x>>>1,b=b>>>1}let M=y;for(let S=0;S<p;S++)g.push(new Uint8Array(i,M,v)),M+=v}return g.map(_=>new ss(_,{format:m,width:s,height:r,levels:n}))}throw a&JT?new Error("DDSParser does not support uncompressed texture data."):a&tA?new Error("DDSParser does not supported YUV uncompressed texture data."):a&eA?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&ZT?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const am=[171,75,84,88,32,49,49,187,13,10,26,10],uA=67305985,si={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},_c=64,hm={[lt.UNSIGNED_BYTE]:1,[lt.UNSIGNED_SHORT]:2,[lt.INT]:4,[lt.UNSIGNED_INT]:4,[lt.FLOAT]:4,[lt.HALF_FLOAT]:8},cA={[G.RGBA]:4,[G.RGB]:3,[G.RG]:2,[G.RED]:1,[G.LUMINANCE]:1,[G.LUMINANCE_ALPHA]:2,[G.ALPHA]:1},dA={[lt.UNSIGNED_SHORT_4_4_4_4]:2,[lt.UNSIGNED_SHORT_5_5_5_1]:2,[lt.UNSIGNED_SHORT_5_6_5]:2};function fA(i,t,e=!1){const r=new DataView(t);if(!pA(i,r))return null;const s=r.getUint32(si.ENDIANNESS,!0)===uA,n=r.getUint32(si.GL_TYPE,s),o=r.getUint32(si.GL_FORMAT,s),a=r.getUint32(si.GL_INTERNAL_FORMAT,s),h=r.getUint32(si.PIXEL_WIDTH,s),l=r.getUint32(si.PIXEL_HEIGHT,s)||1,u=r.getUint32(si.PIXEL_DEPTH,s)||1,d=r.getUint32(si.NUMBER_OF_ARRAY_ELEMENTS,s)||1,c=r.getUint32(si.NUMBER_OF_FACES,s),f=r.getUint32(si.NUMBER_OF_MIPMAP_LEVELS,s),p=r.getUint32(si.BYTES_OF_KEY_VALUE_DATA,s);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(c!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(d!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,y=h+3&-4,_=l+3&-4,v=new Array(d);let x=h*l;n===0&&(x=y*_);let b;if(n!==0?hm[n]?b=hm[n]*cA[o]:b=dA[n]:b=uh[a],b===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const M=e?gA(r,p,s):null;let S=x*b,A=h,R=l,L=y,B=_,P=_c+p;for(let E=0;E<f;E++){const N=r.getUint32(P,s);let q=P+4;for(let Y=0;Y<d;Y++){let et=v[Y];et||(et=v[Y]=new Array(f)),et[E]={levelID:E,levelWidth:f>1||n!==0?A:L,levelHeight:f>1||n!==0?R:B,levelBuffer:new Uint8Array(t,q,S)},q+=S}P+=N+4,P=P%4!==0?P+4-P%4:P,A=A>>1||1,R=R>>1||1,L=A+m-1&~(m-1),B=R+g-1&~(g-1),S=L*B*b}return n!==0?{uncompressed:v.map(E=>{let N=E[0].levelBuffer,q=!1;return n===lt.FLOAT?N=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):n===lt.UNSIGNED_INT?(q=!0,N=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):n===lt.INT&&(q=!0,N=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new Wh(N,{width:E[0].levelWidth,height:E[0].levelHeight}),type:n,format:q?mA(o):o}}),kvData:M}:{compressed:v.map(E=>new ss(null,{format:a,width:h,height:l,levels:f,levelBuffers:E})),kvData:M}}function pA(i,t){for(let e=0;e<am.length;e++)if(t.getUint8(e)!==am[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function mA(i){switch(i){case G.RGBA:return G.RGBA_INTEGER;case G.RGB:return G.RGB_INTEGER;case G.RG:return G.RG_INTEGER;case G.RED:return G.RED_INTEGER;default:return i}}function gA(i,t,e){const r=new Map;let s=0;for(;s<t;){const n=i.getUint32(_c+s,e),o=_c+s+4,a=3-(n+3)%4;if(n===0||n>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&i.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(i.buffer,o,h)),u=new DataView(i.buffer,o+h+1,n-h-1);r.set(l,u),s+=4+n+a}return r}var yA=Object.defineProperty,lm=Object.getOwnPropertySymbols,_A=Object.prototype.hasOwnProperty,vA=Object.prototype.propertyIsEnumerable,um=(i,t,e)=>t in i?yA(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,xA=(i,t)=>{for(var e in t||(t={}))_A.call(t,e)&&um(i,e,t[e]);if(lm)for(var e of lm(t))vA.call(t,e)&&um(i,e,t[e]);return i};const bA={extension:{type:W.LoadParser,priority:pi.High},name:"loadDDS",test(i){return Sr(i,".dds")},async load(i,t,e){const r=await(await tt.ADAPTER.fetch(i)).arrayBuffer(),s=lA(r).map(n=>{const o=new bt(n,xA({mipmap:Bi.OFF,alphaMode:Ue.NO_PREMULTIPLIED_ALPHA,resolution:rr(i)},t.data));return Ro(o,e,i)});return s.length===1?s[0]:s},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};nt.add(bA);var wA=Object.defineProperty,cm=Object.getOwnPropertySymbols,EA=Object.prototype.hasOwnProperty,TA=Object.prototype.propertyIsEnumerable,dm=(i,t,e)=>t in i?wA(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,AA=(i,t)=>{for(var e in t||(t={}))EA.call(t,e)&&dm(i,e,t[e]);if(cm)for(var e of cm(t))TA.call(t,e)&&dm(i,e,t[e]);return i};const SA={extension:{type:W.LoadParser,priority:pi.High},name:"loadKTX",test(i){return Sr(i,".ktx")},async load(i,t,e){const r=await(await tt.ADAPTER.fetch(i)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:o}=fA(i,r),a=s??n,h=AA({mipmap:Bi.OFF,alphaMode:Ue.NO_PREMULTIPLIED_ALPHA,resolution:rr(i)},t.data),l=a.map(u=>{var d;a===n&&Object.assign(h,{type:u.type,format:u.format});const c=(d=u.resource)!=null?d:u,f=new bt(c,h);return f.ktxKeyValueData=o,Ro(f,e,i)});return l.length===1?l[0]:l},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};nt.add(SA);const IA={extension:W.ResolveParser,test:i=>{const t=ge.extname(i).slice(1);return["basis","ktx","dds"].includes(t)},parse:i=>{var t,e,r,s;const n=ge.extname(i).slice(1);if(n==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(a=>i.endsWith(a)))return{resolution:parseFloat((e=(t=tt.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?e:"1"),format:o.find(a=>i.endsWith(a)),src:i}}return{resolution:parseFloat((s=(r=tt.RETINA_PREFIX.exec(i))==null?void 0:r[1])!=null?s:"1"),format:n,src:i}}};nt.add(IA);const sa=new It,CA=4,H0=class Wn{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(t,e,r,s){const n=new Image;return n.src=await this.base64(t,e,r,s),n}async base64(t,e,r,s){const n=this.canvas(t,s);if(n.toBlob!==void 0)return new Promise((o,a)=>{n.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(h)},e,r)});if(n.toDataURL!==void 0)return n.toDataURL(e,r);if(n.convertToBlob!==void 0){const o=await n.convertToBlob({type:e,quality:r});return new Promise((a,h)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&Wn._flipY(r,s,n),a&&Wn._unpremultiplyAlpha(r);const h=new nb(s,n,1),l=new ImageData(new Uint8ClampedArray(r.buffer),s,n);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:r,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&Wn._flipY(r,s,n),a&&Wn._unpremultiplyAlpha(r),r}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let s,n=!1,o=!1,a,h=!1;t&&(t instanceof Io?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),h=!0,e&&(sa.width=e.width,sa.height=e.height,e=sa)));const l=r.gl;if(a){if(s=a.baseTexture.resolution,e=e??a.frame,n=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===G.RGBA,!h){r.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[r.CONTEXT_UID];f.blitFramebuffer&&r.framebuffer.bind(f.blitFramebuffer)}}else s=r.resolution,e||(e=sa,e.width=r.width/s,e.height=r.height/s),n=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const u=Math.max(Math.round(e.width*s),1),d=Math.max(Math.round(e.height*s),1),c=new Uint8Array(CA*u*d);return l.readPixels(Math.round(e.x*s),Math.round(e.y*s),u,d,l.RGBA,l.UNSIGNED_BYTE,c),h&&(a==null||a.destroy(!0)),{pixels:c,width:u,height:d,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const s=e<<2,n=r>>1,o=new Uint8Array(s);for(let a=0;a<n;a++){const h=a*s,l=(r-a-1)*s;o.set(t.subarray(h,h+s)),t.copyWithin(h,l,l+s),t.set(o,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const s=t[r+3];if(s!==0){const n=255.001/s;t[r]=t[r]*n+.5,t[r+1]=t[r+1]*n+.5,t[r+2]=t[r+2]*n+.5}}}};H0.extension={name:"extract",type:W.RendererSystem};let RA=H0;nt.add(RA);const ch={build(i){const t=i.points;let e,r,s,n,o,a;if(i.type===Te.CIRC){const p=i.shape;e=p.x,r=p.y,o=a=p.radius,s=n=0}else if(i.type===Te.ELIP){const p=i.shape;e=p.x,r=p.y,o=p.width,a=p.height,s=n=0}else{const p=i.shape,m=p.width/2,g=p.height/2;e=p.x+m,r=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-o,n=g-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(s?4:0)+(n?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=r+n,t[2]=t[4]=e-s,t[5]=t[7]=r-n;return}let u=0,d=h*4+(s?2:0)+2,c=d,f=l;{const p=s+o,m=n,g=e+p,y=e-p,_=r+m;if(t[u++]=g,t[u++]=_,t[--d]=_,t[--d]=y,n){const v=r-m;t[c++]=y,t[c++]=v,t[--f]=v,t[--f]=g}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),g=s+Math.cos(m)*o,y=n+Math.sin(m)*a,_=e+g,v=e-g,x=r+y,b=r-y;t[u++]=_,t[u++]=x,t[--d]=x,t[--d]=v,t[c++]=v,t[c++]=b,t[--f]=b,t[--f]=_}{const p=s,m=n+a,g=e+p,y=e-p,_=r+m,v=r-m;t[u++]=g,t[u++]=_,t[--f]=v,t[--f]=g,s&&(t[u++]=y,t[u++]=_,t[--f]=v,t[--f]=y)}},triangulate(i,t){const e=i.points,r=t.points,s=t.indices;if(e.length===0)return;let n=r.length/2;const o=n;let a,h;if(i.type!==Te.RREC){const u=i.shape;a=u.x,h=u.y}else{const u=i.shape;a=u.x+u.width/2,h=u.y+u.height/2}const l=i.matrix;r.push(i.matrix?l.a*a+l.c*h+l.tx:a,i.matrix?l.b*a+l.d*h+l.ty:h),n++,r.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)r.push(e[u],e[u+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function fm(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let s=0,n=i[e-2],o=i[e-1];s<e;s+=2){const a=i[s],h=i[s+1];r+=(a-n)*(h+o),n=a,o=h}if(!t&&r>0||t&&r<=0){const s=e/2;for(let n=s+s%2;n<e;n+=2){const o=e-n-2,a=e-n-1,h=n,l=n+1;[i[o],i[h]]=[i[h],i[o]],[i[a],i[l]]=[i[l],i[a]]}}}const X0={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,s=t.points,n=t.indices;if(e.length>=6){fm(e,!1);const o=[];for(let l=0;l<r.length;l++){const u=r[l];fm(u.points,!0),o.push(e.length/2),e=e.concat(u.points)}const a=x1(e,o,2);if(!a)return;const h=s.length/2;for(let l=0;l<a.length;l+=3)n.push(a[l]+h),n.push(a[l+1]+h),n.push(a[l+2]+h);for(let l=0;l<e.length;l++)s.push(e[l])}}},MA={build(i){const t=i.shape,e=t.x,r=t.y,s=t.width,n=t.height,o=i.points;o.length=0,s>=0&&n>=0&&o.push(e,r,e+s,r,e+s,r+n,e,r+n)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const s=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},PA={build(i){ch.build(i)},triangulate(i,t){ch.triangulate(i,t)}};var qe=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(qe||{}),yr=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(yr||{});const an={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class pm{static curveTo(t,e,r,s,n,o){const a=o[o.length-2],h=o[o.length-1]-e,l=a-t,u=s-e,d=r-t,c=Math.abs(h*d-l*u);if(c<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=h*h+l*l,p=u*u+d*d,m=h*u+l*d,g=n*Math.sqrt(f)/c,y=n*Math.sqrt(p)/c,_=g*m/f,v=y*m/p,x=g*d+y*l,b=g*u+y*h,M=l*(y+_),S=h*(y+_),A=d*(g+v),R=u*(g+v),L=Math.atan2(S-b,M-x),B=Math.atan2(R-b,A-x);return{cx:x+t,cy:b+e,radius:n,startAngle:L,endAngle:B,anticlockwise:l*u>d*h}}static arc(t,e,r,s,n,o,a,h,l){const u=a-o,d=an._segmentsCount(Math.abs(u)*n,Math.ceil(Math.abs(u)/ih)*40),c=u/(d*2),f=c*2,p=Math.cos(c),m=Math.sin(c),g=d-1,y=g%1/g;for(let _=0;_<=g;++_){const v=_+y*_,x=c+o+f*v,b=Math.cos(x),M=-Math.sin(x);l.push((p*b+m*M)*n+r,(p*-M+m*b)*n+s)}}}class NA{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Id{static curveLength(t,e,r,s,n,o,a,h){let l=0,u=0,d=0,c=0,f=0,p=0,m=0,g=0,y=0,_=0,v=0,x=t,b=e;for(let M=1;M<=10;++M)u=M/10,d=u*u,c=d*u,f=1-u,p=f*f,m=p*f,g=m*t+3*p*u*r+3*f*d*n+c*a,y=m*e+3*p*u*s+3*f*d*o+c*h,_=x-g,v=b-y,x=g,b=y,l+=Math.sqrt(_*_+v*v);return l}static curveTo(t,e,r,s,n,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const u=an._segmentsCount(Id.curveLength(h,l,t,e,r,s,n,o));let d=0,c=0,f=0,p=0,m=0;a.push(h,l);for(let g=1,y=0;g<=u;++g)y=g/u,d=1-y,c=d*d,f=c*d,p=y*y,m=p*y,a.push(f*h+3*c*y*t+3*d*p*r+m*n,f*l+3*c*y*e+3*d*p*s+m*o)}}function mm(i,t,e,r,s,n,o,a){const h=i-e*s,l=t-r*s,u=i+e*n,d=t+r*n;let c,f;o?(c=r,f=-e):(c=-r,f=e);const p=h+c,m=l+f,g=u+c,y=d+f;return a.push(p,m,g,y),2}function Br(i,t,e,r,s,n,o,a){const h=e-i,l=r-t;let u=Math.atan2(h,l),d=Math.atan2(s-i,n-t);a&&u<d?u+=Math.PI*2:!a&&u>d&&(d+=Math.PI*2);let c=u;const f=d-u,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(c+=y,a){o.push(i,t,e,r);for(let _=1,v=c;_<g;_++,v+=y)o.push(i,t,i+Math.sin(v)*m,t+Math.cos(v)*m);o.push(i,t,s,n)}else{o.push(e,r,i,t);for(let _=1,v=c;_<g;_++,v+=y)o.push(i+Math.sin(v)*m,t+Math.cos(v)*m,i,t);o.push(s,n,i,t)}return g*2}function OA(i,t){const e=i.shape;let r=i.points||e.points.slice();const s=t.closePointEps;if(r.length===0)return;const n=i.lineStyle,o=new Ot(r[0],r[1]),a=new Ot(r[r.length-2],r[r.length-1]),h=e.type!==Te.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(h){r=r.slice(),l&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const et=(o.x+a.x)*.5,ut=(a.y+o.y)*.5;r.unshift(et,ut),r.push(et,ut)}const u=t.points,d=r.length/2;let c=r.length;const f=u.length/2,p=n.width/2,m=p*p,g=n.miterLimit*n.miterLimit;let y=r[0],_=r[1],v=r[2],x=r[3],b=0,M=0,S=-(_-x),A=y-v,R=0,L=0,B=Math.sqrt(S*S+A*A);S/=B,A/=B,S*=p,A*=p;const P=n.alignment,E=(1-P)*2,N=P*2;h||(n.cap===yr.ROUND?c+=Br(y-S*(E-N)*.5,_-A*(E-N)*.5,y-S*E,_-A*E,y+S*N,_+A*N,u,!0)+2:n.cap===yr.SQUARE&&(c+=mm(y,_,S,A,E,N,!0,u))),u.push(y-S*E,_-A*E,y+S*N,_+A*N);for(let et=1;et<d-1;++et){y=r[(et-1)*2],_=r[(et-1)*2+1],v=r[et*2],x=r[et*2+1],b=r[(et+1)*2],M=r[(et+1)*2+1],S=-(_-x),A=y-v,B=Math.sqrt(S*S+A*A),S/=B,A/=B,S*=p,A*=p,R=-(x-M),L=v-b,B=Math.sqrt(R*R+L*L),R/=B,L/=B,R*=p,L*=p;const ut=v-y,yt=_-x,I=v-b,C=M-x,z=ut*I+yt*C,ht=yt*I-C*ut,ot=ht<0;if(Math.abs(ht)<.001*Math.abs(z)){u.push(v-S*E,x-A*E,v+S*N,x+A*N),z>=0&&(n.join===qe.ROUND?c+=Br(v,x,v-S*E,x-A*E,v-R*E,x-L*E,u,!1)+4:c+=2,u.push(v-R*N,x-L*N,v+R*E,x+L*E));continue}const pt=(-S+y)*(-A+x)-(-S+v)*(-A+_),vt=(-R+b)*(-L+x)-(-R+v)*(-L+M),Ct=(ut*vt-I*pt)/ht,Dt=(C*pt-yt*vt)/ht,qt=(Ct-v)*(Ct-v)+(Dt-x)*(Dt-x),$t=v+(Ct-v)*E,xt=x+(Dt-x)*E,At=v-(Ct-v)*N,Tt=x-(Dt-x)*N,Qt=Math.min(ut*ut+yt*yt,I*I+C*C),T=ot?E:N,$e=Qt+T*T*m,Se=qt<=$e;let Li=n.join;if(Li===qe.MITER&&qt/m>g&&(Li=qe.BEVEL),Se)switch(Li){case qe.MITER:{u.push($t,xt,At,Tt);break}case qe.BEVEL:{ot?u.push($t,xt,v+S*N,x+A*N,$t,xt,v+R*N,x+L*N):u.push(v-S*E,x-A*E,At,Tt,v-R*E,x-L*E,At,Tt),c+=2;break}case qe.ROUND:{ot?(u.push($t,xt,v+S*N,x+A*N),c+=Br(v,x,v+S*N,x+A*N,v+R*N,x+L*N,u,!0)+4,u.push($t,xt,v+R*N,x+L*N)):(u.push(v-S*E,x-A*E,At,Tt),c+=Br(v,x,v-S*E,x-A*E,v-R*E,x-L*E,u,!1)+4,u.push(v-R*E,x-L*E,At,Tt));break}}else{switch(u.push(v-S*E,x-A*E,v+S*N,x+A*N),Li){case qe.MITER:{ot?u.push(At,Tt,At,Tt):u.push($t,xt,$t,xt),c+=2;break}case qe.ROUND:{ot?c+=Br(v,x,v+S*N,x+A*N,v+R*N,x+L*N,u,!0)+2:c+=Br(v,x,v-S*E,x-A*E,v-R*E,x-L*E,u,!1)+2;break}}u.push(v-R*E,x-L*E,v+R*N,x+L*N),c+=2}}y=r[(d-2)*2],_=r[(d-2)*2+1],v=r[(d-1)*2],x=r[(d-1)*2+1],S=-(_-x),A=y-v,B=Math.sqrt(S*S+A*A),S/=B,A/=B,S*=p,A*=p,u.push(v-S*E,x-A*E,v+S*N,x+A*N),h||(n.cap===yr.ROUND?c+=Br(v-S*(E-N)*.5,x-A*(E-N)*.5,v-S*E,x-A*E,v+S*N,x+A*N,u,!1)+2:n.cap===yr.SQUARE&&(c+=mm(v,x,S,A,E,N,!1,u)));const q=t.indices,Y=an.epsilon*an.epsilon;for(let et=f;et<c+f-2;++et)y=u[et*2],_=u[et*2+1],v=u[(et+1)*2],x=u[(et+1)*2+1],b=u[(et+2)*2],M=u[(et+2)*2+1],!(Math.abs(y*(x-M)+v*(M-_)+b*(_-x))<Y)&&q.push(et,et+1,et+2)}function BA(i,t){let e=0;const r=i.shape,s=i.points||r.points,n=r.type!==Te.POLY||r.closeStroke;if(s.length===0)return;const o=t.points,a=t.indices,h=s.length/2,l=o.length/2;let u=l;for(o.push(s[0],s[1]),e=1;e<h;e++)o.push(s[e*2],s[e*2+1]),a.push(u,u+1),u++;n&&a.push(u,l)}function gm(i,t){i.lineStyle.native?BA(i,t):OA(i,t)}class Cd{static curveLength(t,e,r,s,n,o){const a=t-2*r+n,h=e-2*s+o,l=2*r-2*t,u=2*s-2*e,d=4*(a*a+h*h),c=4*(a*l+h*u),f=l*l+u*u,p=2*Math.sqrt(d+c+f),m=Math.sqrt(d),g=2*d*m,y=2*Math.sqrt(f),_=c/m;return(g*p+m*c*(p-y)+(4*f*d-c*c)*Math.log((2*m+_+p)/(_+y)))/(4*g)}static curveTo(t,e,r,s,n){const o=n[n.length-2],a=n[n.length-1],h=an._segmentsCount(Cd.curveLength(o,a,t,e,r,s));let l=0,u=0;for(let d=1;d<=h;++d){const c=d/h;l=o+(t-o)*c,u=a+(e-a)*c,n.push(l+(t+(r-t)*c-l)*c,u+(e+(s-e)*c-u)*c)}}}const Vl={[Te.POLY]:X0,[Te.CIRC]:ch,[Te.ELIP]:ch,[Te.RECT]:MA,[Te.RREC]:PA},ym=[],na=[];class dh{constructor(t,e=null,r=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new dh(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const As=new Ot,z0=class V0 extends Vy{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ah,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),na.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),ym.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,s=null){const n=new dh(t,e,r,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new dh(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=s.lineStyle,s.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const s=e[r];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,As):As.copyFrom(t),s.shape.contains(As.x,As.y))){let n=!1;if(s.holes){for(let o=0;o<s.holes.length;o++)if(s.holes[o].shape.contains(As.x,As.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,s=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],s=r.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],u=l.fillStyle,d=l.lineStyle;Vl[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||d.visible)&&this.processHoles(l.holes);for(let c=0;c<2;c++){const f=c===0?u:d;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=br.REPEAT,c===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-g;y!==0&&(r&&!this._compareStyles(s,f)&&(r.end(m,g),r=null),r||(r=ym.pop()||new NA,r.begin(f,m,g),this.batches.push(r),s=f),this.addUvs(this.points,t,f.texture,g,y,f.matrix))}}const n=this.indices.length,o=this.points.length/2;if(r&&r.end(n,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const r=this.graphicsData[t],s=r.fillStyle,n=r.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const s=t[e];for(let n=0;n<s.size;n++){const o=s.start+n;this.indicesUint16[o]=this.indicesUint16[o]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<V0.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++bt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),na.push(this.drawCalls[d]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let s=na.pop();s||(s=new qu,s.texArray=new ec),s.texArray.count=0,s.start=0,s.size=0,s.type=Ii.TRIANGLES;let n=0,o=null,a=0,h=!1,l=Ii.TRIANGLES,u=0;this.drawCalls.push(s);for(let d=0;d<this.batches.length;d++){const c=this.batches[d],f=8,p=c.style,m=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?Ii.LINES:Ii.TRIANGLES,o=null,n=f,t++),o!==m&&(o=m,m._batchEnabled!==t&&(n===f&&(t++,n=0,s.size>0&&(s=na.pop(),s||(s=new qu,s.texArray=new ec),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=n,m.wrapMode=br.REPEAT,s.texArray.elements[s.texArray.count++]=m,n++)),s.size+=c.size,u+=c.size,a=m._batchLocation,this.addColors(e,p.color,p.alpha,c.attribSize,c.attribStart),this.addTextureIds(r,a,c.attribSize,c.attribStart)}bt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,s=this.textureIds,n=new ArrayBuffer(t.length*3*4),o=new Float32Array(n),a=new Uint32Array(n);let h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=r[l],o[h++]=s[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?X0.triangulate(t,this):Vl[t.type].triangulate(t,this)}processLine(t){gm(t,this);for(let e=0;e<t.holes.length;e++)gm(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];Vl[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const s=t[r*2],n=t[r*2+1];t[r*2]=e.a*s+e.c*n+e.tx,t[r*2+1]=e.b*s+e.d*n+e.ty}}addColors(t,e,r,s,n=0){const o=Zt.shared.setValue(e).toLittleEndianNumber(),a=Zt.shared.setValue(o).toPremultiplied(r);t.length=Math.max(t.length,n+s);for(let h=0;h<s;h++)t[n+h]=a}addTextureIds(t,e,r,s=0){t.length=Math.max(t.length,s+r);for(let n=0;n<r;n++)t[s+n]=e}addUvs(t,e,r,s,n,o=null){let a=0;const h=e.length,l=r.frame;for(;a<n;){let d=t[(s+a)*2],c=t[(s+a)*2+1];if(o){const f=o.a*d+o.c*c+o.tx;c=o.b*d+o.d*c+o.ty,d=f}a++,e.push(d/l.width,c/l.height)}const u=r.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,r,h,n)}adjustUvs(t,e,r,s){const n=e.baseTexture,o=1e-6,a=r+s*2,h=e.frame,l=h.width/n.width,u=h.height/n.height;let d=h.x/h.width,c=h.y/h.height,f=Math.floor(t[r]+o),p=Math.floor(t[r+1]+o);for(let m=r+2;m<a;m+=2)f=Math.min(f,Math.floor(t[m]+o)),p=Math.min(p,Math.floor(t[m+1]+o));d-=f,c-=p;for(let m=r;m<a;m+=2)t[m]=(t[m]+d)*l,t[m+1]=(t[m+1]+c)*u}};z0.BATCHABLE_SIZE=100;let FA=z0;class Zh{constructor(){this.color=16777215,this.alpha=1,this.texture=Bt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Zh;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Bt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Rd extends Zh{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=yr.BUTT,this.join=qe.MITER,this.miterLimit=10}clone(){const t=new Rd;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=yr.BUTT,this.join=qe.MITER,this.miterLimit=10}}const Wl={},vc=class ka extends Ee{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Zh,this._lineStyle=new Rd,this._matrix=null,this._holeMode=!1,this.state=Ar.for2d(),this._geometry=t||new FA,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Zt(16777215),this.blendMode=dt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ka(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,s=.5,n=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:r,alignment:s,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Bt.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:yr.BUTT,join:qe.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new is,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new is,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,s=r[r.length-2],n=r[r.length-1];return(s!==t||n!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,s){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Cd.curveTo(t,e,r,s,n),this}bezierCurveTo(t,e,r,s,n,o){return this._initCurve(),Id.curveTo(t,e,r,s,n,o,this.currentPath.points),this}arcTo(t,e,r,s,n){this._initCurve(t,e);const o=this.currentPath.points,a=pm.curveTo(t,e,r,s,n,o);if(a){const{cx:h,cy:l,radius:u,startAngle:d,endAngle:c,anticlockwise:f}=a;this.arc(h,l,u,d,c,f)}return this}arc(t,e,r,s,n,o=!1){if(s===n)return this;if(!o&&n<=s?n+=ih:o&&s<=n&&(s+=ih),n-s===0)return this;const a=t+Math.cos(s)*r,h=e+Math.sin(s)*r,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const d=Math.abs(u[u.length-2]-a),c=Math.abs(u[u.length-1]-h);d<l&&c<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return pm.arc(a,h,t,e,r,s,n,o,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:Bt.WHITE,color:t,alpha:e})}normalizeColor(t){var e;const r=Zt.shared.setValue((e=t.color)!=null?e:0);t.color=r.toNumber(),t.alpha!=null||(t.alpha=r.alpha)}beginTextureFill(t){const e={texture:Bt.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,s){return this.drawShape(new It(t,e,r,s))}drawRoundedRect(t,e,r,s,n){return this.drawShape(new Yh(t,e,r,s,n))}drawCircle(t,e,r){return this.drawShape(new So(t,e,r))}drawEllipse(t,e,r,s){return this.drawShape(new jh(t,e,r,s))}drawPolygon(...t){let e,r=!0;const s=t[0];s.points?(r=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;const n=new is(e);return n.closeStroke=r,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===Te.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let s=0;s<r;s++){const n=t.batches[s],o=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:Zt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,s=this.worldAlpha,n=e.uniforms,o=r.drawCalls;n.translationMatrix=this.transform.worldTransform,Zt.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,r.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:r,type:s,size:n,start:o}=e,a=r.count;for(let h=0;h<a;h++)t.texture.bind(r.elements[h],h);t.geometry.draw(s,n,o)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!Wl[r]){const{maxTextures:s}=t.plugins[r],n=new Int32Array(s);for(let h=0;h<s;h++)n[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new ne,default:rs.from({uSamplers:n},!0)},a=t.plugins[r]._shader.program;Wl[r]=new wr(a,o)}e=Wl[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:s,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,r,s,n)}containsPoint(t){return this.worldTransform.applyInverse(t,ka._TEMP_POINT),this._geometry.containsPoint(ka._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Zt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData;let d=0;for(let c=0;c<l.length;c+=2){const f=l[c],p=l[c+1];u[d++]=r*f+n*p+a,u[d++]=o*p+s*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};vc.curves=an,vc._TEMP_POINT=new Ot;let fh=vc;class DA{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const jl=new Ot,_m=new is,W0=class j0 extends Ee{constructor(t,e,r,s=Ii.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||Ar.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=tt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Ii.TRIANGLES&&e.length<j0.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,h=s.d,l=s.tx,u=s.ty,d=this.vertexData;for(let c=0;c<d.length/2;c++){const f=e[c*2],p=e[c*2+1];d[c*2]=n*f+a*p+l,d[c*2+1]=o*f+h*p+u}if(this._roundPixels){const c=tt.RESOLUTION;for(let f=0;f<d.length;++f)d[f]=Math.round(d[f]*c)/c}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new DA(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,jl);const e=this.geometry.getBuffer("aVertexPosition").data,r=_m.points,s=this.geometry.getIndex().data,n=s.length,o=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=o){const h=s[a]*2,l=s[a+1]*2,u=s[a+2]*2;if(r[0]=e[h],r[1]=e[h+1],r[2]=e[l],r[3]=e[l+1],r[4]=e[u],r[5]=e[u+1],_m.contains(jl.x,jl.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};W0.BATCHABLE_SIZE=100;let vm=W0;class LA extends Ao{constructor(t,e,r){super();const s=new pe(t),n=new pe(e,!0),o=new pe(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,lt.FLOAT).addAttribute("aTextureCoord",n,2,!1,lt.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var kA=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,UA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class xm extends wr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:ne.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||Ki.from(UA,kA),r),this._colorDirty=!1,this.uvMatrix=new l0(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Zt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Zt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class bm{constructor(t,e,r){this.geometry=new Ao,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let n=t[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||lt.FLOAT,offset:n.offset},e[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new pe(rb(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new pe(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new pe(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===lt.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===lt.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,r){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(t,e,r,n.type===lt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(t,e,r,n.type===lt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var GA=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,$A=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Y0 extends qh{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new ne,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:lt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=wr.from($A,GA,{}),this.state=Ar.for2d()}render(t){const e=t.children,r=t._maxSize,s=t._batchSize,n=this.renderer;let o=e.length;if(o===0)return;o>r&&!t.autoResize&&(o=r);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=Uy(t.blendMode,l),n.state.set(this.state);const u=n.gl,d=t.worldTransform.copyTo(this.tempMatrix);d.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=Zt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let c=!1;for(let f=0,p=0;f<o;f+=s,p+=1){let m=o-f;m>s&&(m=s),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const g=a[p];g.uploadDynamic(e,f,m);const y=t._bufferUpdateIDs[p]||0;c=c||g._updateID<y,c&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),n.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,s=t._batchSize,n=t._properties;for(let o=0;o<r;o+=s)e.push(new bm(this.properties,n,s));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new bm(this.properties,r,e)}uploadVertices(t,e,r,s,n,o){let a=0,h=0,l=0,u=0;for(let d=0;d<r;++d){const c=t[e+d],f=c._texture,p=c.scale.x,m=c.scale.y,g=f.trim,y=f.orig;g?(h=g.x-c.anchor.x*y.width,a=h+g.width,u=g.y-c.anchor.y*y.height,l=u+g.height):(a=y.width*(1-c.anchor.x),h=y.width*-c.anchor.x,l=y.height*(1-c.anchor.y),u=y.height*-c.anchor.y),s[o]=h*p,s[o+1]=u*m,s[o+n]=a*p,s[o+n+1]=u*m,s[o+n*2]=a*p,s[o+n*2+1]=l*m,s[o+n*3]=h*p,s[o+n*3+1]=l*m,o+=n*4}}uploadPosition(t,e,r,s,n,o){for(let a=0;a<r;a++){const h=t[e+a].position;s[o]=h.x,s[o+1]=h.y,s[o+n]=h.x,s[o+n+1]=h.y,s[o+n*2]=h.x,s[o+n*2+1]=h.y,s[o+n*3]=h.x,s[o+n*3+1]=h.y,o+=n*4}}uploadRotation(t,e,r,s,n,o){for(let a=0;a<r;a++){const h=t[e+a].rotation;s[o]=h,s[o+n]=h,s[o+n*2]=h,s[o+n*3]=h,o+=n*4}}uploadUvs(t,e,r,s,n,o){for(let a=0;a<r;++a){const h=t[e+a]._texture._uvs;h?(s[o]=h.x0,s[o+1]=h.y0,s[o+n]=h.x1,s[o+n+1]=h.y1,s[o+n*2]=h.x2,s[o+n*2+1]=h.y2,s[o+n*3]=h.x3,s[o+n*3+1]=h.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(t,e,r,s,n,o){for(let a=0;a<r;++a){const h=t[e+a],l=Zt.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);s[o]=l,s[o+n]=l,s[o+n*2]=l,s[o+n*3]=l,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Y0.extension={name:"particle",type:W.RendererPlugin};nt.add(Y0);var Qh=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Qh||{});const oa={willReadFrequently:!0},bi=class at{static get experimentalLetterSpacingSupported(){let t=at._experimentalLetterSpacingSupported;if(t!==void 0){const e=tt.ADAPTER.getCanvasRenderingContext2D().prototype;t=at._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,s,n,o,a,h,l){this.text=t,this.style=e,this.width=r,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,r,s=at._canvas){r=r??e.wordWrap;const n=e.toFontString(),o=at.measureFont(n);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=s.getContext("2d",oa);a.font=n;const h=(r?at.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let u=0;for(let p=0;p<h.length;p++){const m=at._measureText(h[p],e.letterSpacing,a);l[p]=m,u=Math.max(u,m)}let d=u+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);const c=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(c,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(c+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new at(t,e,d,f,h,l,c+e.leading,u,o)}static _measureText(t,e,r){let s=!1;at.experimentalLetterSpacingSupported&&(at.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,s=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(t).width;return n>0&&(s?n-=e:n+=(at.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,r=at._canvas){const s=r.getContext("2d",oa);let n=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,d=at.collapseSpaces(u),c=at.collapseNewlines(u);let f=!d;const p=e.wordWrapWidth+l,m=at.tokenize(t);for(let g=0;g<m.length;g++){let y=m[g];if(at.isNewline(y)){if(!c){a+=at.addLine(o),f=!d,o="",n=0;continue}y=" "}if(d){const v=at.isBreakingSpace(y),x=at.isBreakingSpace(o[o.length-1]);if(v&&x)continue}const _=at.getFromCache(y,l,h,s);if(_>p)if(o!==""&&(a+=at.addLine(o),o="",n=0),at.canBreakWords(y,e.breakWords)){const v=at.wordWrapSplit(y);for(let x=0;x<v.length;x++){let b=v[x],M=b,S=1;for(;v[x+S];){const R=v[x+S];if(!at.canBreakChars(M,R,y,x,e.breakWords))b+=R;else break;M=R,S++}x+=S-1;const A=at.getFromCache(b,l,h,s);A+n>p&&(a+=at.addLine(o),f=!1,o="",n=0),o+=b,n+=A}}else{o.length>0&&(a+=at.addLine(o),o="",n=0);const v=g===m.length-1;a+=at.addLine(y,!v),f=!1,o="",n=0}else _+n>p&&(f=!1,a+=at.addLine(o),o="",n=0),(o.length>0||!at.isBreakingSpace(y)||f)&&(o+=y,n+=_)}return a+=at.addLine(o,!1),a}static addLine(t,e=!0){return t=at.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,s){let n=r[t];return typeof n!="number"&&(n=at._measureText(t,e,s)+e,r[t]=n),n}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!at.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:at._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:at._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){const n=t[s],o=t[s+1];if(at.isBreakingSpace(n,o)||at.isNewline(n)){r!==""&&(e.push(r),r=""),e.push(n);continue}r+=n}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,s,n){return!0}static wordWrapSplit(t){return at.graphemeSegmenter(t)}static measureFont(t){if(at._fonts[t])return at._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=at._canvas,s=at._context;s.font=t;const n=at.METRICS_STRING+at.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width);let a=Math.ceil(s.measureText(at.BASELINE_SYMBOL).width);const h=Math.ceil(at.HEIGHT_MULTIPLIER*a);if(a=a*at.BASELINE_MULTIPLIER|0,o===0||h===0)return at._fonts[t]=e,e;r.width=o,r.height=h,s.fillStyle="#f00",s.fillRect(0,0,o,h),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);const l=s.getImageData(0,0,o,h).data,u=l.length,d=o*4;let c=0,f=0,p=!1;for(c=0;c<a;++c){for(let m=0;m<d;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f+=d;else break}for(e.ascent=a-c,f=u-d,p=!1,c=h;c>a;--c){for(let m=0;m<d;m+=4)if(l[f+m]!==255){p=!0;break}if(!p)f-=d;else break}return e.descent=c-a,e.fontSize=e.ascent+e.descent,at._fonts[t]=e,e}static clearMetrics(t=""){t?delete at._fonts[t]:at._fonts={}}static get _canvas(){if(!at.__canvas){let t;try{const e=new OffscreenCanvas(0,0),r=e.getContext("2d",oa);if(r!=null&&r.measureText)return at.__canvas=e,e;t=tt.ADAPTER.createCanvas()}catch{t=tt.ADAPTER.createCanvas()}t.width=t.height=10,at.__canvas=t}return at.__canvas}static get _context(){return at.__context||(at.__context=at._canvas.getContext("2d",oa)),at.__context}};bi.METRICS_STRING="|q",bi.BASELINE_SYMBOL="M",bi.BASELINE_MULTIPLIER=1.4,bi.HEIGHT_MULTIPLIER=2,bi.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})(),bi.experimentalLetterSpacing=!1,bi._fonts={},bi._newlines=[10,13],bi._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Wi=bi;const HA=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],q0=class jn{constructor(t){this.styleID=0,this.reset(),ql(this,t,t)}clone(){const t={};return ql(t,this,jn.defaultStyle),new jn(t)}reset(){ql(this,jn.defaultStyle,jn.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Yl(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Yl(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){XA(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Yl(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let s=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!HA.includes(s)&&(s=`"${s}"`),e[r]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};q0.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Qh.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let sr=q0;function Yl(i){const t=Zt.shared,e=r=>{const s=t.setValue(r);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(i)?i.map(e):e(i)}function XA(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function ql(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const zA={texture:!0,children:!1,baseTexture:!0},K0=class xc extends tr{constructor(t,e,r){var s;let n=!1;r||(r=tt.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const o=Bt.from(r);o.orig=new It,o.trim=new It,super(o),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=(s=xc.defaultResolution)!=null?s:tt.RESOLUTION,this._autoResolution=xc.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Wi.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Mt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Wi.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,s=Wi.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,o=s.height,a=s.lines,h=s.lineHeight,l=s.lineWidths,u=s.maxLineWidth,d=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;let c,f;const p=e.dropShadow?2:1;for(let m=0;m<p;++m){const g=e.dropShadow&&m===0,y=g?Math.ceil(Math.max(1,o)+e.padding*2):0,_=y*this._resolution;if(g){r.fillStyle="black",r.strokeStyle="black";const x=e.dropShadowColor,b=e.dropShadowBlur*this._resolution,M=e.dropShadowDistance*this._resolution;r.shadowColor=Zt.shared.setValue(x).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=b,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*M,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*M+_}else r.fillStyle=this._generateFillStyle(e,a,s),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let v=(h-d.fontSize)/2;h-d.fontSize<0&&(v=0);for(let x=0;x<a.length;x++)c=e.strokeThickness/2,f=e.strokeThickness/2+x*h+d.ascent+v,e.align==="right"?c+=u-l[x]:e.align==="center"&&(c+=(u-l[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[x],c+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[x],c+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,r,s=!1){const n=this._style.letterSpacing;let o=!1;if(Wi.experimentalLetterSpacingSupported&&(Wi.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(t,e,r):this.context.fillText(t,e,r);return}let a=e;const h=Wi.graphemeSegmenter(t);let l=this.context.measureText(t).width,u=0;for(let d=0;d<h.length;++d){const c=h[d];s?this.context.strokeText(c,a,r):this.context.fillText(c,a,r);let f="";for(let p=d+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,a+=l-u+n,l=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=ab(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,r=this._style,s=r.trim?0:r.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,u=s.slice(),d=t.fillGradientStops.slice();if(!d.length){const c=u.length+1;for(let f=1;f<c;++f)d.push(f/c)}if(u.unshift(s[0]),d.unshift(0),u.push(s[s.length-1]),d.push(1),t.fillGradientType===Qh.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,a,h/2,l+a);const c=r.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=r.lineHeight*(f-1)+c,m=r.lineHeight*f;let g=m;f>0&&p>m&&(g=(m+p)/2);const y=m+c,_=r.lineHeight*(f+1);let v=y;f+1<e.length&&_<y&&(v=(y+_)/2);const x=(v-g)/l;for(let b=0;b<u.length;b++){let M=0;typeof d[b]=="number"?M=d[b]:M=b/u.length;let S=Math.min(1,Math.max(0,g/l+M*x));S=Number(S.toFixed(5)),n.addColorStop(S,u[b])}}}else{n=this.context.createLinearGradient(a,l/2,h+a,l/2);const c=u.length+1;let f=1;for(let p=0;p<u.length;p++){let m;typeof d[p]=="number"?m=d[p]:m=f/c,n.addColorStop(m,u[p]),f++}}return n}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},zA,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=gr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=gr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof sr?this._style=t:this._style=new sr(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};K0.defaultAutoResolution=!0;let Md=K0;class VA{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function WA(i,t){var e;let r=!1;if((e=i==null?void 0:i._textures)!=null&&e.length){for(let s=0;s<i._textures.length;s++)if(i._textures[s]instanceof Bt){const n=i._textures[s].baseTexture;t.includes(n)||(t.push(n),r=!0)}}return r}function jA(i,t){if(i.baseTexture instanceof bt){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function YA(i,t){if(i._texture&&i._texture instanceof Bt){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function qA(i,t){return t instanceof Md?(t.updateText(!0),!0):!1}function KA(i,t){if(t instanceof sr){const e=t.toFontString();return Wi.measureFont(e),!0}return!1}function ZA(i,t){if(i instanceof Md){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function QA(i,t){return i instanceof sr?(t.includes(i)||t.push(i),!0):!1}const Z0=class Q0{constructor(t){this.limiter=new VA(Q0.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(ZA),this.registerFindHook(QA),this.registerFindHook(WA),this.registerFindHook(jA),this.registerFindHook(YA),this.registerUploadHook(qA),this.registerUploadHook(KA)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,We.system.addOnce(this.tick,this,us.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,s=this.uploadHooks.length;r<s;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)We.system.addOnce(this.tick,this,us.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ee)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&We.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Z0.uploadsPerFrame=4;let bc=Z0;Object.defineProperties(tt,{UPLOADS_PER_FRAME:{get(){return bc.uploadsPerFrame},set(i){Mt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),bc.uploadsPerFrame=i}}});function J0(i,t){return t instanceof bt?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function JA(i,t){if(!(t instanceof fh))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let s=0;s<r.length;s++){const{texture:n}=r[s].style;n&&J0(i,n.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function tS(i,t){return i instanceof fh?(t.push(i),!0):!1}class t_ extends bc{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(tS),this.registerUploadHook(J0),this.registerUploadHook(JA)}}t_.extension={name:"prepare",type:W.RendererSystem};nt.add(t_);var eS=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,iS=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,rS=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,wm=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,sS=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const aa=new ne;class e_ extends qh{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new n0,this.state=Ar.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=wr.from(wm,sS,e),this.shader=t.context.webGLVersion>1?wr.from(iS,eS,e):wr.from(wm,rS,e)}render(t){const e=this.renderer,r=this.quad;let s=r.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,r.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,d=t.uvMatrix;let c=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;c&&(h._glTextures[e.CONTEXT_UID]?c=h.wrapMode!==br.CLAMP:h.wrapMode===br.CLAMP&&(h.wrapMode=br.REPEAT));const f=c?this.simpleShader:this.shader,p=a.width,m=a.height,g=t._width,y=t._height;aa.set(u.a*p/g,u.b*p/y,u.c*m/g,u.d*m/y,u.tx/g,u.ty/y),aa.invert(),c?aa.prepend(d.mapCoord):(f.uniforms.uMapCoord=d.mapCoord.toArray(!0),f.uniforms.uClampFrame=d.uClampFrame,f.uniforms.uClampOffset=d.uClampOffset),f.uniforms.uTransform=aa.toArray(!0),f.uniforms.uColor=Zt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=Uy(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}e_.extension={name:"tilingSprite",type:W.RendererPlugin};nt.add(e_);const i_=class Yn{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof Bt?t:null,this.baseTexture=t instanceof bt?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const s=this.baseTexture.resource;this.resolution=this._updateResolution(r||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=rr(t,null);return r===null&&(r=parseFloat(e??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Yn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=Yn.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const s=this._frameKeys[e],n=this._frames[s],o=n.frame;if(o){let a=null,h=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new It(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?a=new It(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new It(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new It(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[s]=new Bt(this.baseTexture,a,u,h,n.rotated?2:0,n.anchor,n.borders),Bt.addToCache(this.textures[s],s.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const s=t[e][r];this.animations[e].push(this.textures[s])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Yn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Yn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};i_.BATCH_SIZE=1e3;let Em=i_;const nS=["jpg","png","jpeg","avif","webp"];function r_(i,t,e){const r={};if(i.forEach(s=>{r[s]=t}),Object.keys(t.textures).forEach(s=>{r[s]=t.textures[s]}),!e){const s=ge.dirname(i[0]);t.linkedSheets.forEach((n,o)=>{const a=r_([`${s}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(r,a)})}return r}const oS={extension:W.Asset,cache:{test:i=>i instanceof Em,getCacheableAssets:(i,t)=>r_(i,t,!1)},resolver:{test:i=>{const t=i.split("?")[0].split("."),e=t.pop(),r=t.pop();return e==="json"&&nS.includes(r)},parse:i=>{var t,e;const r=i.split(".");return{resolution:parseFloat((e=(t=tt.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?e:"1"),format:r[r.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:W.LoadParser,priority:pi.Normal},async testParse(i,t){return ge.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var r,s;let n=ge.dirname(t.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let o=n+i.meta.image;o=yc(o,t.src);const a=(await e.load([o]))[o],h=new Em(a.baseTexture,i,t.src);await h.parse();const l=(r=i==null?void 0:i.meta)==null?void 0:r.related_multi_packs;if(Array.isArray(l)){const u=[];for(const c of l){if(typeof c!="string")continue;let f=n+c;(s=t.data)!=null&&s.ignoreMultiPack||(f=yc(f,t.src),u.push(e.load({src:f,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);h.linkedSheets=d,d.forEach(c=>{c.linkedSheets=[h].concat(h.linkedSheets.filter(f=>f!==c))})}return h},unload(i){i.destroy(!0)}}};nt.add(oS);class ph{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Ua{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const o=e[n].match(/^[a-z]+/gm)[0],a=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const u=a[l].split("="),d=u[0],c=u[1].replace(/"/gm,""),f=parseFloat(c),p=isNaN(f)?c:f;h[d]=p}r[o].push(h)}const s=new ph;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class wc{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new ph,r=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<r.length;l++)e.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(let l=0;l<s.length;l++)e.common.push({lineHeight:parseInt(s[l].getAttribute("lineHeight"),10)});for(let l=0;l<n.length;l++)e.page.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});for(let l=0;l<o.length;l++){const u=o[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}}class Ec{static test(t){return typeof t=="string"&&t.includes("<font>")?wc.test(tt.ADAPTER.parseXML(t)):!1}static parse(t){return wc.parse(tt.ADAPTER.parseXML(t))}}const Kl=[Ua,wc,Ec];function aS(i){for(let t=0;t<Kl.length;t++)if(Kl[t].test(i))return Kl[t];return null}function hS(i,t,e,r,s,n){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=i.width/r-h-l*2,d=i.height/r-h-l*2,c=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=c.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(c.unshift(o[0]),f.unshift(0),c.push(o[o.length-1]),f.push(1),e.fillGradientType===Qh.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,d+l);let p=0;const m=(n.fontProperties.fontSize+e.strokeThickness)/d;for(let g=0;g<s.length;g++){const y=n.lineHeight*g;for(let _=0;_<c.length;_++){let v=0;typeof f[_]=="number"?v=f[_]:v=_/c.length;const x=y/d+v*m;let b=Math.max(p,x);b=Math.min(b,1),a.addColorStop(b,c[_]),p=b}}}else{a=t.createLinearGradient(l,d/2,u+l,d/2);const p=c.length+1;let m=1;for(let g=0;g<c.length;g++){let y;typeof f[g]=="number"?y=f[g]:y=m/p,a.addColorStop(y,c[g]),m++}}return a}function lS(i,t,e,r,s,n,o){const a=e.text,h=e.fontProperties;t.translate(r,s),t.scale(n,n);const l=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=hS(i,t,o,n,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const d=o.dropShadowColor,c=o.dropShadowBlur*n,f=o.dropShadowDistance*n;t.shadowColor=Zt.shared.setValue(d).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=c,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),o.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Ga(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function s_(i){return Array.from?Array.from(i):i.split("")}function uS(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const s=i[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...s_(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}var cS=Object.defineProperty,mh=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,o_=Object.prototype.propertyIsEnumerable,Tm=(i,t,e)=>t in i?cS(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,dS=(i,t)=>{for(var e in t||(t={}))n_.call(t,e)&&Tm(i,e,t[e]);if(mh)for(var e of mh(t))o_.call(t,e)&&Tm(i,e,t[e]);return i},fS=(i,t)=>{var e={};for(var r in i)n_.call(i,r)&&t.indexOf(r)<0&&(e[r]=i[r]);if(i!=null&&mh)for(var r of mh(i))t.indexOf(r)<0&&o_.call(i,r)&&(e[r]=i[r]);return e};const dr=class wi{constructor(t,e,r){var s,n;const[o]=t.info,[a]=t.common,[h]=t.page,[l]=t.distanceField,u=rr(h.file),d={};this._ownsTextures=r,this.font=o.face,this.size=o.size,this.lineHeight=a.lineHeight/u,this.chars={},this.pageTextures=d;for(let c=0;c<t.page.length;c++){const{id:f,file:p}=t.page[c];d[f]=e instanceof Array?e[c]:e[p],l!=null&&l.fieldType&&l.fieldType!=="none"&&(d[f].baseTexture.alphaMode=Ue.NO_PREMULTIPLIED_ALPHA,d[f].baseTexture.mipmap=Bi.OFF)}for(let c=0;c<t.char.length;c++){const{id:f,page:p}=t.char[c];let{x:m,y:g,width:y,height:_,xoffset:v,yoffset:x,xadvance:b}=t.char[c];m/=u,g/=u,y/=u,_/=u,v/=u,x/=u,b/=u;const M=new It(m+d[p].frame.x/u,g+d[p].frame.y/u,y,_);this.chars[f]={xOffset:v,yOffset:x,xAdvance:b,kerning:{},texture:new Bt(d[p].baseTexture,M),page:p}}for(let c=0;c<t.kerning.length;c++){let{first:f,second:p,amount:m}=t.kerning[c];f/=u,p/=u,m/=u,this.chars[p]&&(this.chars[p].kerning[f]=m)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=(n=(s=l==null?void 0:l.fieldType)==null?void 0:s.toLowerCase())!=null?n:"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let s;if(t instanceof ph)s=t;else{const o=aS(t);if(!o)throw new Error("Unrecognized data format for font.");s=o.parse(t)}e instanceof Bt&&(e=[e]);const n=new wi(s,e,r);return wi.available[n.font]=n,n}static uninstall(t){const e=wi.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete wi.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const s=Object.assign({},wi.defaultOptions,r),{chars:n,padding:o,resolution:a,textureWidth:h,textureHeight:l}=s,u=fS(s,["chars","padding","resolution","textureWidth","textureHeight"]),d=uS(n),c=e instanceof sr?e:new sr(e),f=h,p=new ph;p.info[0]={face:c.fontFamily,size:c.fontSize},p.common[0]={lineHeight:c.fontSize};let m=0,g=0,y,_,v,x=0;const b=[];for(let S=0;S<d.length;S++){y||(y=tt.ADAPTER.createCanvas(),y.width=h,y.height=l,_=y.getContext("2d"),v=new bt(y,dS({resolution:a},u)),b.push(new Bt(v)),p.page.push({id:b.length-1,file:""}));const A=d[S],R=Wi.measureText(A,c,!1,y),L=R.width,B=Math.ceil(R.height),P=Math.ceil((c.fontStyle==="italic"?2:1)*L);if(g>=l-B*a){if(g===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${A}')`);--S,y=null,_=null,v=null,g=0,m=0,x=0;continue}if(x=Math.max(B+R.fontProperties.descent,x),P*a+m>=f){if(m===0)throw new Error(`[BitmapFont] textureWidth ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${A}')`);--S,g+=x*a,g=Math.ceil(g),m=0,x=0;continue}lS(y,_,R,m,g,a,c);const E=Ga(R.text);p.char.push({id:E,page:b.length-1,x:m/a,y:g/a,width:P,height:B,xoffset:0,yoffset:0,xadvance:L-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),m+=(P+2*o)*a,m=Math.ceil(m)}if(!(r!=null&&r.skipKerning))for(let S=0,A=d.length;S<A;S++){const R=d[S];for(let L=0;L<A;L++){const B=d[L],P=_.measureText(R).width,E=_.measureText(B).width,N=_.measureText(R+B).width-(P+E);N&&p.kerning.push({first:Ga(R),second:Ga(B),amount:N})}}const M=new wi(p,b,!0);return wi.available[t]!==void 0&&wi.uninstall(t),wi.available[t]=M,M}};dr.ALPHA=[["a","z"],["A","Z"]," "],dr.NUMERIC=[["0","9"]],dr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],dr.ASCII=[[" ","~"]],dr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:dr.ALPHANUMERIC},dr.available={};let fr=dr;var pS=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,mS=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Am=[],Sm=[],Im=[],gS=class a_ extends Ee{constructor(t,e={}){super();const{align:r,tint:s,maxWidth:n,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},a_.styleDefaults,e);if(!fr.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new Zt(s),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new Qr(()=>{this.dirty=!0},this,0,0),this._roundPixels=tt.ROUND_PIXELS,this.dirty=!0,this._resolution=tt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var t;const e=fr.available[this._fontName],r=this.fontSize,s=r/e.size,n=new Ot,o=[],a=[],h=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=s_(l),d=this._maxWidth*e.size/r,c=e.distanceFieldType==="none"?Am:Sm;let f=null,p=0,m=0,g=0,y=-1,_=0,v=0,x=0,b=0;for(let P=0;P<u.length;P++){const E=u[P],N=Ga(E);if(/(?:\s)/.test(E)&&(y=P,_=p,b++),E==="\r"||E===`
`){a.push(p),h.push(-1),m=Math.max(m,p),++g,++v,n.x=0,n.y+=e.lineHeight,f=null,b=0;continue}const q=e.chars[N];if(!q)continue;f&&q.kerning[f]&&(n.x+=q.kerning[f]);const Y=Im.pop()||{texture:Bt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ot};Y.texture=q.texture,Y.line=g,Y.charCode=N,Y.position.x=Math.round(n.x+q.xOffset+this._letterSpacing/2),Y.position.y=Math.round(n.y+q.yOffset),Y.prevSpaces=b,o.push(Y),p=Y.position.x+Math.max(q.xAdvance-q.xOffset,q.texture.orig.width),n.x+=q.xAdvance+this._letterSpacing,x=Math.max(x,q.yOffset+q.texture.height),f=N,y!==-1&&d>0&&n.x>d&&(++v,Ks(o,1+y-v,1+P-y),P=y,y=-1,a.push(_),h.push(o.length>0?o[o.length-1].prevSpaces:0),m=Math.max(m,_),g++,n.x=0,n.y+=e.lineHeight,f=null,b=0)}const M=u[u.length-1];M!=="\r"&&M!==`
`&&(/(?:\s)/.test(M)&&(p=_),a.push(p),m=Math.max(m,p),h.push(-1));const S=[];for(let P=0;P<=g;P++){let E=0;this._align==="right"?E=m-a[P]:this._align==="center"?E=(m-a[P])/2:this._align==="justify"&&(E=h[P]<0?0:(m-a[P])/h[P]),S.push(E)}const A=o.length,R={},L=[],B=this._activePagesMeshData;c.push(...B);for(let P=0;P<A;P++){const E=o[P].texture,N=E.baseTexture.uid;if(!R[N]){let q=c.pop();if(!q){const et=new LA;let ut,yt;e.distanceFieldType==="none"?(ut=new xm(Bt.EMPTY),yt=dt.NORMAL):(ut=new xm(Bt.EMPTY,{program:Ki.from(mS,pS),uniforms:{uFWidth:0}}),yt=dt.NORMAL_NPM);const I=new vm(et,ut);I.blendMode=yt,q={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:I,vertices:null,uvs:null,indices:null}}q.index=0,q.indexCount=0,q.vertexCount=0,q.uvsCount=0,q.total=0;const{_textureCache:Y}=this;Y[N]=Y[N]||new Bt(E.baseTexture),q.mesh.texture=Y[N],q.mesh.tint=this._tintColor.value,L.push(q),R[N]=q}R[N].total++}for(let P=0;P<B.length;P++)L.includes(B[P])||this.removeChild(B[P].mesh);for(let P=0;P<L.length;P++)L[P].mesh.parent!==this&&this.addChild(L[P].mesh);this._activePagesMeshData=L;for(const P in R){const E=R[P],N=E.total;if(!(((t=E.indices)==null?void 0:t.length)>6*N)||E.vertices.length<vm.BATCHABLE_SIZE*2)E.vertices=new Float32Array(4*2*N),E.uvs=new Float32Array(4*2*N),E.indices=new Uint16Array(6*N);else{const q=E.total,Y=E.vertices;for(let et=q*4*2;et<Y.length;et++)Y[et]=0}E.mesh.size=6*N}for(let P=0;P<A;P++){const E=o[P];let N=E.position.x+S[E.line]*(this._align==="justify"?E.prevSpaces:1);this._roundPixels&&(N=Math.round(N));const q=N*s,Y=E.position.y*s,et=E.texture,ut=R[et.baseTexture.uid],yt=et.frame,I=et._uvs,C=ut.index++;ut.indices[C*6+0]=0+C*4,ut.indices[C*6+1]=1+C*4,ut.indices[C*6+2]=2+C*4,ut.indices[C*6+3]=0+C*4,ut.indices[C*6+4]=2+C*4,ut.indices[C*6+5]=3+C*4,ut.vertices[C*8+0]=q,ut.vertices[C*8+1]=Y,ut.vertices[C*8+2]=q+yt.width*s,ut.vertices[C*8+3]=Y,ut.vertices[C*8+4]=q+yt.width*s,ut.vertices[C*8+5]=Y+yt.height*s,ut.vertices[C*8+6]=q,ut.vertices[C*8+7]=Y+yt.height*s,ut.uvs[C*8+0]=I.x0,ut.uvs[C*8+1]=I.y0,ut.uvs[C*8+2]=I.x1,ut.uvs[C*8+3]=I.y1,ut.uvs[C*8+4]=I.x2,ut.uvs[C*8+5]=I.y2,ut.uvs[C*8+6]=I.x3,ut.uvs[C*8+7]=I.y3}this._textWidth=m*s,this._textHeight=(n.y+e.lineHeight)*s;for(const P in R){const E=R[P];if(this.anchor.x!==0||this.anchor.y!==0){let et=0;const ut=this._textWidth*this.anchor.x,yt=this._textHeight*this.anchor.y;for(let I=0;I<E.total;I++)E.vertices[et++]-=ut,E.vertices[et++]-=yt,E.vertices[et++]-=ut,E.vertices[et++]-=yt,E.vertices[et++]-=ut,E.vertices[et++]-=yt,E.vertices[et++]-=ut,E.vertices[et++]-=yt}this._maxLineHeight=x*s;const N=E.mesh.geometry.getBuffer("aVertexPosition"),q=E.mesh.geometry.getBuffer("aTextureCoord"),Y=E.mesh.geometry.getIndex();N.data=E.vertices,q.data=E.uvs,Y.data=E.indices,N.update(),q.update(),Y.update()}for(let P=0;P<o.length;P++)Im.push(o[P]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:s}=fr.available[this._fontName];if(r!=="none"){const{a:n,b:o,c:a,d:h}=this.worldTransform,l=Math.sqrt(n*n+o*o),u=Math.sqrt(a*a+h*h),d=(Math.abs(l)+Math.abs(u))/2,c=this.fontSize/s,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=d*e*c*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=fr.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!fr.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){var t;return(t=this._fontSize)!=null?t:fr.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r=fr.available[this._fontName].distanceFieldType==="none"?Am:Sm;r.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=Bt.EMPTY});for(const s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};gS.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const yS=[".xml",".fnt"],_S={extension:{type:W.LoadParser,priority:pi.Normal},name:"loadBitmapFont",test(i){return yS.includes(ge.extname(i).toLowerCase())},async testParse(i){return Ua.test(i)||Ec.test(i)},async parse(i,t,e){const r=Ua.test(i)?Ua.parse(i):Ec.parse(i),{src:s}=t,{page:n}=r,o=[];for(let l=0;l<n.length;++l){const u=n[l].file;let d=ge.join(ge.dirname(s),u);d=yc(d,s),o.push(d)}const a=await e.load(o),h=o.map(l=>a[l]);return fr.install(r,h,!0)},async load(i,t){return(await tt.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};nt.add(_S);var vS=Object.defineProperty,xS=Object.defineProperties,bS=Object.getOwnPropertyDescriptors,Cm=Object.getOwnPropertySymbols,wS=Object.prototype.hasOwnProperty,ES=Object.prototype.propertyIsEnumerable,Rm=(i,t,e)=>t in i?vS(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,TS=(i,t)=>{for(var e in t||(t={}))wS.call(t,e)&&Rm(i,e,t[e]);if(Cm)for(var e of Cm(t))ES.call(t,e)&&Rm(i,e,t[e]);return i},AS=(i,t)=>xS(i,bS(t));const Tc=class Ls extends sr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Ls(Object.keys(Ls.defaultOptions).reduce((e,r)=>AS(TS({},e),{[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Ls.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=Ls;if(r[t]){const s=r[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return tt.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((n,o)=>{const a=URL.createObjectURL(s),h=new FileReader;h.onload=()=>n([a,h.result]),h.onerror=o,h.readAsDataURL(s)})).then(async([s,n])=>{const o=Object.assign({family:ge.basename(t,ge.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);r[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(r=>!this._overrides.includes(r));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(r=>this._overrides.includes(r));e.length>0&&(this._overrides=this._overrides.filter(r=>!e.includes(r)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=eb(t)),typeof t=="number"?tb(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const n=`${r}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,Ls.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=tt.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Tc.availableFonts={},Tc.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Zl=Tc;const ha=class ks extends tr{constructor(t="",e={}){var r;super(Bt.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const s=new Image,n=Bt.from(s,{scaleMode:tt.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new It,n.trim=new It,this.texture=n;const o="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",h=document.createElementNS(o,"svg"),l=document.createElementNS(o,"foreignObject"),u=document.createElementNS(a,"div"),d=document.createElementNS(a,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",h.appendChild(l),this.maxWidth=ks.defaultMaxWidth,this.maxHeight=ks.defaultMaxHeight,this._domElement=u,this._styleElement=d,this._svgRoot=h,this._foreignObject=l,this._foreignObject.appendChild(d),this._foreignObject.appendChild(u),this._image=s,this._loadImage=new Image,this._autoResolution=ks.defaultAutoResolution,this._resolution=(r=ks.defaultResolution)!=null?r:tt.RESOLUTION,this.text=t,this.style=e}measureText(t){var e,r;const{text:s,style:n,resolution:o}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:s,style:n.toCSS(o)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const a=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:h,height:l}=a;(h>this.maxWidth||l>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const u=Math.min(this.maxWidth,Math.ceil(h)),d=Math.min(this.maxHeight,Math.ceil(l));return this._svgRoot.setAttribute("width",u.toString()),this._svgRoot.setAttribute("height",d.toString()),s!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:(e=this._style)==null?void 0:e.toCSS(o)}),this._styleElement.textContent=(r=this._style)==null?void 0:r.toGlobalCSS()),{width:u+n.padding*2,height:d+n.padding*2}}async updateText(t=!0){const{style:e,_image:r,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:o}=this.measureText();r.width=s.width=Math.ceil(Math.max(1,n)),r.height=s.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(h=>{s.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),r.src=s.src,s.onload=null,s.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:s}=this,{padding:n}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=r.width/s,e.trim.height=e._frame.height=r.height/s,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(r.width,r.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var e,r,s,n,o;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},ks.defaultDestroyOptions,t),super.destroy(t);const a=null;this.ownsStyle&&((e=this._style)==null||e.cleanFonts()),this._style=a,(r=this._svgRoot)==null||r.remove(),this._svgRoot=a,(s=this._domElement)==null||s.remove(),this._domElement=a,(n=this._foreignObject)==null||n.remove(),this._foreignObject=a,(o=this._styleElement)==null||o.remove(),this._styleElement=a,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=a,this._image.src="",this._image=a}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=gr(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=gr(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Zl?(this.ownsStyle=!1,this._style=t):t instanceof sr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Zl.from(t)):(this.ownsStyle=!0,this._style=new Zl(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};ha.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},ha.defaultMaxWidth=2024,ha.defaultMaxHeight=2024,ha.defaultAutoResolution=!0;var ys=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(ys||{}),h_=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(h_||{}),Ac=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Ac||{}),gt=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(gt||{}),gh=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(gh||{}),j=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(j||{}),Js=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Js||{}),Rt=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(Rt||{}),J=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(J||{}),Zi=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Zi||{}),Pd=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Pd||{}),cs=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(cs||{}),_s=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(_s||{}),Hr=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Hr||{}),Nd=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(Nd||{}),Qe=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Qe||{}),fe=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(fe||{}),ue=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(ue||{}),Mi=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(Mi||{});const SS={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},Ut={ADAPTER:SS,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ql=/iPhone/i,Mm=/iPod/i,Pm=/iPad/i,Nm=/\biOS-universal(?:.+)Mac\b/i,Jl=/\bAndroid(?:.+)Mobile\b/i,Om=/Android/i,Ss=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,la=/Silk/i,$i=/Windows Phone/i,Bm=/\bWindows(?:.+)ARM\b/i,Fm=/BlackBerry/i,Dm=/BB10/i,Lm=/Opera Mini/i,km=/\b(CriOS|Chrome)(?:.+)Mobile/i,Um=/Mobile(?:.+)Firefox\b/i,Gm=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function IS(i){return function(t){return t.test(i)}}function $m(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var s=IS(e),n={apple:{phone:s(Ql)&&!s($i),ipod:s(Mm),tablet:!s(Ql)&&(s(Pm)||Gm(t))&&!s($i),universal:s(Nm),device:(s(Ql)||s(Mm)||s(Pm)||s(Nm)||Gm(t))&&!s($i)},amazon:{phone:s(Ss),tablet:!s(Ss)&&s(la),device:s(Ss)||s(la)},android:{phone:!s($i)&&s(Ss)||!s($i)&&s(Jl),tablet:!s($i)&&!s(Ss)&&!s(Jl)&&(s(la)||s(Om)),device:!s($i)&&(s(Ss)||s(la)||s(Jl)||s(Om))||s(/\bokhttp\b/i)},windows:{phone:s($i),tablet:s(Bm),device:s($i)||s(Bm)},other:{blackberry:s(Fm),blackberry10:s(Dm),opera:s(Lm),firefox:s(Um),chrome:s(km),device:s(Fm)||s(Dm)||s(Lm)||s(Um)||s(km)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const CS=$m.default??$m,zs=CS(globalThis.navigator);Ut.RETINA_PREFIX=/@([0-9\.]+)x/;Ut.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var $a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function RS(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var s=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return i[r]}})}),e}var l_={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,d,c){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||h,c),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)t.call(u,d)&&l.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=e?e+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var c=0,f=d.length,p=new Array(f);c<f;c++)p[c]=d[c].fn;return p},a.prototype.listenerCount=function(l){var u=e?e+l:l,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,u,d,c,f,p){var m=e?e+l:l;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,_,v;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,c),!0;case 5:return g.fn.call(g.context,u,d,c,f),!0;case 6:return g.fn.call(g.context,u,d,c,f,p),!0}for(v=1,_=new Array(y-1);v<y;v++)_[v-1]=arguments[v];g.fn.apply(g.context,_)}else{var x=g.length,b;for(v=0;v<x;v++)switch(g[v].once&&this.removeListener(l,g[v].fn,void 0,!0),y){case 1:g[v].fn.call(g[v].context);break;case 2:g[v].fn.call(g[v].context,u);break;case 3:g[v].fn.call(g[v].context,u,d);break;case 4:g[v].fn.call(g[v].context,u,d,c);break;default:if(!_)for(b=1,_=new Array(y-1);b<y;b++)_[b-1]=arguments[b];g[v].fn.apply(g[v].context,_)}}return!0},a.prototype.on=function(l,u,d){return n(this,l,u,d,!1)},a.prototype.once=function(l,u,d){return n(this,l,u,d,!0)},a.prototype.removeListener=function(l,u,d,c){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!c||p.once)&&(!d||p.context===d)&&o(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==u||c&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(l_);var MS=l_.exports;const tl=Jh(MS);var u_={exports:{}};u_.exports=el;u_.exports.default=el;function el(i,t,e){e=e||2;var r=t&&t.length,s=r?t[0]*e:i.length,n=c_(i,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var a,h,l,u,d,c,f;if(r&&(n=FS(i,t,n,e)),i.length>80*e){a=l=i[0],h=u=i[1];for(var p=e;p<s;p+=e)d=i[p],c=i[p+1],d<a&&(a=d),c<h&&(h=c),d>l&&(l=d),c>u&&(u=c);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return po(n,o,e,a,h,f,0),o}function c_(i,t,e,r,s){var n,o;if(s===Cc(i,t,e,r)>0)for(n=t;n<e;n+=r)o=Hm(n,i[n],i[n+1],o);else for(n=e-r;n>=t;n-=r)o=Hm(n,i[n],i[n+1],o);return o&&il(o,o.next)&&(go(o),o=o.next),o}function ds(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(il(e,e.next)||ie(e.prev,e,e.next)===0)){if(go(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function po(i,t,e,r,s,n,o){if(i){!o&&n&&GS(i,r,s,n);for(var a=i,h,l;i.prev!==i.next;){if(h=i.prev,l=i.next,n?NS(i,r,s,n):PS(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(l.i/e|0),go(i),i=l.next,a=l.next;continue}if(i=l,i===a){o?o===1?(i=OS(ds(i),t,e),po(i,t,e,r,s,n,2)):o===2&&BS(i,t,e,r,s,n):po(ds(i),t,e,r,s,n,1);break}}}}function PS(i){var t=i.prev,e=i,r=i.next;if(ie(t,e,r)>=0)return!1;for(var s=t.x,n=e.x,o=r.x,a=t.y,h=e.y,l=r.y,u=s<n?s<o?s:o:n<o?n:o,d=a<h?a<l?a:l:h<l?h:l,c=s>n?s>o?s:o:n>o?n:o,f=a>h?a>l?a:l:h>l?h:l,p=r.next;p!==t;){if(p.x>=u&&p.x<=c&&p.y>=d&&p.y<=f&&Vs(s,a,n,h,o,l,p.x,p.y)&&ie(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function NS(i,t,e,r){var s=i.prev,n=i,o=i.next;if(ie(s,n,o)>=0)return!1;for(var a=s.x,h=n.x,l=o.x,u=s.y,d=n.y,c=o.y,f=a<h?a<l?a:l:h<l?h:l,p=u<d?u<c?u:c:d<c?d:c,m=a>h?a>l?a:l:h>l?h:l,g=u>d?u>c?u:c:d>c?d:c,y=Sc(f,p,t,e,r),_=Sc(m,g,t,e,r),v=i.prevZ,x=i.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==o&&Vs(a,u,h,d,l,c,v.x,v.y)&&ie(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==o&&Vs(a,u,h,d,l,c,x.x,x.y)&&ie(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==o&&Vs(a,u,h,d,l,c,v.x,v.y)&&ie(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==o&&Vs(a,u,h,d,l,c,x.x,x.y)&&ie(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function OS(i,t,e){var r=i;do{var s=r.prev,n=r.next.next;!il(s,n)&&d_(s,r,r.next,n)&&mo(s,n)&&mo(n,s)&&(t.push(s.i/e|0),t.push(r.i/e|0),t.push(n.i/e|0),go(r),go(r.next),r=i=n),r=r.next}while(r!==i);return ds(r)}function BS(i,t,e,r,s,n){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&XS(o,a)){var h=f_(o,a);o=ds(o,o.next),h=ds(h,h.next),po(o,t,e,r,s,n,0),po(h,t,e,r,s,n,0);return}a=a.next}o=o.next}while(o!==i)}function FS(i,t,e,r){var s=[],n,o,a,h,l;for(n=0,o=t.length;n<o;n++)a=t[n]*r,h=n<o-1?t[n+1]*r:i.length,l=c_(i,a,h,r,!1),l===l.next&&(l.steiner=!0),s.push(HS(l));for(s.sort(DS),n=0;n<s.length;n++)e=LS(s[n],e);return e}function DS(i,t){return i.x-t.x}function LS(i,t){var e=kS(i,t);if(!e)return t;var r=f_(e,i);return ds(r,r.next),ds(e,e.next)}function kS(i,t){var e=t,r=i.x,s=i.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>n&&(n=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,u=o.y,d=1/0,c;e=o;do r>=e.x&&e.x>=l&&r!==e.x&&Vs(s<u?r:n,s,l,u,s<u?n:r,s,e.x,e.y)&&(c=Math.abs(s-e.y)/(r-e.x),mo(e,i)&&(c<d||c===d&&(e.x>o.x||e.x===o.x&&US(o,e)))&&(o=e,d=c)),e=e.next;while(e!==h);return o}function US(i,t){return ie(i.prev,i,t.prev)<0&&ie(t.next,i,i.next)<0}function GS(i,t,e,r){var s=i;do s.z===0&&(s.z=Sc(s.x,s.y,t,e,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,$S(s)}function $S(i){var t,e,r,s,n,o,a,h,l=1;do{for(e=i,i=null,n=null,o=0;e;){for(o++,r=e,a=0,t=0;t<l&&(a++,r=r.nextZ,!!r);t++);for(h=l;a>0||h>0&&r;)a!==0&&(h===0||!r||e.z<=r.z)?(s=e,e=e.nextZ,a--):(s=r,r=r.nextZ,h--),n?n.nextZ=s:i=s,s.prevZ=n,n=s;e=r}n.nextZ=null,l*=2}while(o>1);return i}function Sc(i,t,e,r,s){return i=(i-e)*s|0,t=(t-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function HS(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Vs(i,t,e,r,s,n,o,a){return(s-o)*(t-a)>=(i-o)*(n-a)&&(i-o)*(r-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(s-o)*(r-a)}function XS(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!zS(i,t)&&(mo(i,t)&&mo(t,i)&&VS(i,t)&&(ie(i.prev,i,t.prev)||ie(i,t.prev,t))||il(i,t)&&ie(i.prev,i,i.next)>0&&ie(t.prev,t,t.next)>0)}function ie(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function il(i,t){return i.x===t.x&&i.y===t.y}function d_(i,t,e,r){var s=ca(ie(i,t,e)),n=ca(ie(i,t,r)),o=ca(ie(e,r,i)),a=ca(ie(e,r,t));return!!(s!==n&&o!==a||s===0&&ua(i,e,t)||n===0&&ua(i,r,t)||o===0&&ua(e,i,r)||a===0&&ua(e,t,r))}function ua(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function ca(i){return i>0?1:i<0?-1:0}function zS(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&d_(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function mo(i,t){return ie(i.prev,i,i.next)<0?ie(i,t,i.next)>=0&&ie(i,i.prev,t)>=0:ie(i,t,i.prev)<0||ie(i,i.next,t)<0}function VS(i,t){var e=i,r=!1,s=(i.x+t.x)/2,n=(i.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function f_(i,t){var e=new Ic(i.i,i.x,i.y),r=new Ic(t.i,t.x,t.y),s=i.next,n=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,r.next=e,e.prev=r,n.next=r,r.prev=n,r}function Hm(i,t,e,r){var s=new Ic(i,t,e);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function go(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ic(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}el.deviation=function(i,t,e,r){var s=t&&t.length,n=s?t[0]*e:i.length,o=Math.abs(Cc(i,0,n,e));if(s)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:i.length;o-=Math.abs(Cc(i,l,u,e))}var d=0;for(a=0;a<r.length;a+=3){var c=r[a]*e,f=r[a+1]*e,p=r[a+2]*e;d+=Math.abs((i[c]-i[p])*(i[f+1]-i[c+1])-(i[c]-i[f])*(i[p+1]-i[c+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function Cc(i,t,e,r){for(var s=0,n=t,o=e-r;n<e;n+=r)s+=(i[o]-i[n])*(i[n+1]+i[o+1]),o=n;return s}el.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,s=0;s<i.length;s++){for(var n=0;n<i[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(i[s][n][o]);s>0&&(r+=i[s-1].length,e.holes.push(r))}return e};var yh={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */yh.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,n=typeof $a=="object"&&$a;(n.global===n||n.window===n||n.self===n)&&(e=n);var o,a=2147483647,h=36,l=1,u=26,d=38,c=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,b=Math.floor,M=String.fromCharCode,S;function A(I){throw new RangeError(v[I])}function R(I,C){for(var z=I.length,ht=[];z--;)ht[z]=C(I[z]);return ht}function L(I,C){var z=I.split("@"),ht="";z.length>1&&(ht=z[0]+"@",I=z[1]),I=I.replace(_,".");var ot=I.split("."),pt=R(ot,C).join(".");return ht+pt}function B(I){for(var C=[],z=0,ht=I.length,ot,pt;z<ht;)ot=I.charCodeAt(z++),ot>=55296&&ot<=56319&&z<ht?(pt=I.charCodeAt(z++),(pt&64512)==56320?C.push(((ot&1023)<<10)+(pt&1023)+65536):(C.push(ot),z--)):C.push(ot);return C}function P(I){return R(I,function(C){var z="";return C>65535&&(C-=65536,z+=M(C>>>10&1023|55296),C=56320|C&1023),z+=M(C),z}).join("")}function E(I){return I-48<10?I-22:I-65<26?I-65:I-97<26?I-97:h}function N(I,C){return I+22+75*(I<26)-((C!=0)<<5)}function q(I,C,z){var ht=0;for(I=z?b(I/c):I>>1,I+=b(I/C);I>x*u>>1;ht+=h)I=b(I/x);return b(ht+(x+1)*I/(I+d))}function Y(I){var C=[],z=I.length,ht,ot=0,pt=p,vt=f,Ct,Dt,qt,$t,xt,At,Tt,Qt,T;for(Ct=I.lastIndexOf(m),Ct<0&&(Ct=0),Dt=0;Dt<Ct;++Dt)I.charCodeAt(Dt)>=128&&A("not-basic"),C.push(I.charCodeAt(Dt));for(qt=Ct>0?Ct+1:0;qt<z;){for($t=ot,xt=1,At=h;qt>=z&&A("invalid-input"),Tt=E(I.charCodeAt(qt++)),(Tt>=h||Tt>b((a-ot)/xt))&&A("overflow"),ot+=Tt*xt,Qt=At<=vt?l:At>=vt+u?u:At-vt,!(Tt<Qt);At+=h)T=h-Qt,xt>b(a/T)&&A("overflow"),xt*=T;ht=C.length+1,vt=q(ot-$t,ht,$t==0),b(ot/ht)>a-pt&&A("overflow"),pt+=b(ot/ht),ot%=ht,C.splice(ot++,0,pt)}return P(C)}function et(I){var C,z,ht,ot,pt,vt,Ct,Dt,qt,$t,xt,At=[],Tt,Qt,T,$e;for(I=B(I),Tt=I.length,C=p,z=0,pt=f,vt=0;vt<Tt;++vt)xt=I[vt],xt<128&&At.push(M(xt));for(ht=ot=At.length,ot&&At.push(m);ht<Tt;){for(Ct=a,vt=0;vt<Tt;++vt)xt=I[vt],xt>=C&&xt<Ct&&(Ct=xt);for(Qt=ht+1,Ct-C>b((a-z)/Qt)&&A("overflow"),z+=(Ct-C)*Qt,C=Ct,vt=0;vt<Tt;++vt)if(xt=I[vt],xt<C&&++z>a&&A("overflow"),xt==C){for(Dt=z,qt=h;$t=qt<=pt?l:qt>=pt+u?u:qt-pt,!(Dt<$t);qt+=h)$e=Dt-$t,T=h-$t,At.push(M(N($t+$e%T,0))),Dt=b($e/T);At.push(M(N(Dt,0))),pt=q(z,Qt,ht==ot),z=0,++ht}++z,++C}return At.join("")}function ut(I){return L(I,function(C){return g.test(C)?Y(C.slice(4).toLowerCase()):C})}function yt(I){return L(I,function(C){return y.test(C)?"xn--"+et(C):C})}if(o={version:"1.4.1",ucs2:{decode:B,encode:P},decode:Y,encode:et,toASCII:yt,toUnicode:ut},r&&s)if(i.exports==r)s.exports=o;else for(S in o)o.hasOwnProperty(S)&&(r[S]=o[S]);else e.punycode=o})($a)})(yh,yh.exports);var WS=yh.exports,jS=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var n=Object.getOwnPropertySymbols(t);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0},Xm=typeof Symbol<"u"&&Symbol,YS=jS,qS=function(){return typeof Xm!="function"||typeof Symbol!="function"||typeof Xm("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:YS()},zm={foo:{}},KS=Object,ZS=function(){return{__proto__:zm}.foo===zm.foo&&!({__proto__:null}instanceof KS)},QS="Function.prototype.bind called on incompatible ",JS=Object.prototype.toString,tI=Math.max,eI="[object Function]",Vm=function(t,e){for(var r=[],s=0;s<t.length;s+=1)r[s]=t[s];for(var n=0;n<e.length;n+=1)r[n+t.length]=e[n];return r},iI=function(t,e){for(var r=[],s=e||0,n=0;s<t.length;s+=1,n+=1)r[n]=t[s];return r},rI=function(i,t){for(var e="",r=0;r<i.length;r+=1)e+=i[r],r+1<i.length&&(e+=t);return e},sI=function(t){var e=this;if(typeof e!="function"||JS.apply(e)!==eI)throw new TypeError(QS+e);for(var r=iI(arguments,1),s,n=function(){if(this instanceof s){var u=e.apply(this,Vm(r,arguments));return Object(u)===u?u:this}return e.apply(t,Vm(r,arguments))},o=tI(0,e.length-r.length),a=[],h=0;h<o;h++)a[h]="$"+h;if(s=Function("binder","return function ("+rI(a,",")+"){ return binder.apply(this,arguments); }")(n),e.prototype){var l=function(){};l.prototype=e.prototype,s.prototype=new l,l.prototype=null}return s},nI=sI,Od=Function.prototype.bind||nI,oI=Function.prototype.call,aI=Object.prototype.hasOwnProperty,hI=Od,lI=hI.call(oI,aI),Nt,hn=SyntaxError,p_=Function,tn=TypeError,tu=function(i){try{return p_('"use strict"; return ('+i+").constructor;")()}catch{}},ns=Object.getOwnPropertyDescriptor;if(ns)try{ns({},"")}catch{ns=null}var eu=function(){throw new tn},uI=ns?function(){try{return arguments.callee,eu}catch{try{return ns(arguments,"callee").get}catch{return eu}}}():eu,Is=qS(),cI=ZS(),xe=Object.getPrototypeOf||(cI?function(i){return i.__proto__}:null),Us={},dI=typeof Uint8Array>"u"||!xe?Nt:xe(Uint8Array),os={"%AggregateError%":typeof AggregateError>"u"?Nt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Nt:ArrayBuffer,"%ArrayIteratorPrototype%":Is&&xe?xe([][Symbol.iterator]()):Nt,"%AsyncFromSyncIteratorPrototype%":Nt,"%AsyncFunction%":Us,"%AsyncGenerator%":Us,"%AsyncGeneratorFunction%":Us,"%AsyncIteratorPrototype%":Us,"%Atomics%":typeof Atomics>"u"?Nt:Atomics,"%BigInt%":typeof BigInt>"u"?Nt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Nt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Nt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Nt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Nt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Nt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Nt:FinalizationRegistry,"%Function%":p_,"%GeneratorFunction%":Us,"%Int8Array%":typeof Int8Array>"u"?Nt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Nt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Nt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Is&&xe?xe(xe([][Symbol.iterator]())):Nt,"%JSON%":typeof JSON=="object"?JSON:Nt,"%Map%":typeof Map>"u"?Nt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Is||!xe?Nt:xe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Nt:Promise,"%Proxy%":typeof Proxy>"u"?Nt:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Nt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Nt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Is||!xe?Nt:xe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Nt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Is&&xe?xe(""[Symbol.iterator]()):Nt,"%Symbol%":Is?Symbol:Nt,"%SyntaxError%":hn,"%ThrowTypeError%":uI,"%TypedArray%":dI,"%TypeError%":tn,"%Uint8Array%":typeof Uint8Array>"u"?Nt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Nt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Nt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Nt:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Nt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Nt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Nt:WeakSet};if(xe)try{null.error}catch(i){var fI=xe(xe(i));os["%Error.prototype%"]=fI}var pI=function i(t){var e;if(t==="%AsyncFunction%")e=tu("async function () {}");else if(t==="%GeneratorFunction%")e=tu("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=tu("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=i("%AsyncGenerator%");s&&xe&&(e=xe(s.prototype))}return os[t]=e,e},Wm={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Mo=Od,_h=lI,mI=Mo.call(Function.call,Array.prototype.concat),gI=Mo.call(Function.apply,Array.prototype.splice),jm=Mo.call(Function.call,String.prototype.replace),vh=Mo.call(Function.call,String.prototype.slice),yI=Mo.call(Function.call,RegExp.prototype.exec),_I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,vI=/\\(\\)?/g,xI=function(t){var e=vh(t,0,1),r=vh(t,-1);if(e==="%"&&r!=="%")throw new hn("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new hn("invalid intrinsic syntax, expected opening `%`");var s=[];return jm(t,_I,function(n,o,a,h){s[s.length]=a?jm(h,vI,"$1"):o||n}),s},bI=function(t,e){var r=t,s;if(_h(Wm,r)&&(s=Wm[r],r="%"+s[0]+"%"),_h(os,r)){var n=os[r];if(n===Us&&(n=pI(r)),typeof n>"u"&&!e)throw new tn("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:r,value:n}}throw new hn("intrinsic "+t+" does not exist!")},vs=function(t,e){if(typeof t!="string"||t.length===0)throw new tn("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new tn('"allowMissing" argument must be a boolean');if(yI(/^%?[^%]*%?$/,t)===null)throw new hn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=xI(t),s=r.length>0?r[0]:"",n=bI("%"+s+"%",e),o=n.name,a=n.value,h=!1,l=n.alias;l&&(s=l[0],gI(r,mI([0,1],l)));for(var u=1,d=!0;u<r.length;u+=1){var c=r[u],f=vh(c,0,1),p=vh(c,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new hn("property names with quotes must have matching quotes");if((c==="constructor"||!d)&&(h=!0),s+="."+c,o="%"+s+"%",_h(os,o))a=os[o];else if(a!=null){if(!(c in a)){if(!e)throw new tn("base intrinsic for "+t+" exists, but the property is not available.");return}if(ns&&u+1>=r.length){var m=ns(a,c);d=!!m,d&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[c]}else d=_h(a,c),a=a[c];d&&!h&&(os[o]=a)}}return a},m_={exports:{}},wI=vs,Rc=wI("%Object.defineProperty%",!0),Mc=function(){if(Rc)try{return Rc({},"a",{value:1}),!0}catch{return!1}return!1};Mc.hasArrayLengthDefineBug=function(){if(!Mc())return null;try{return Rc([],"length",{value:1}).length!==1}catch{return!0}};var g_=Mc,EI=vs,Ha=EI("%Object.getOwnPropertyDescriptor%",!0);if(Ha)try{Ha([],"length")}catch{Ha=null}var y_=Ha,TI=g_(),Bd=vs,ro=TI&&Bd("%Object.defineProperty%",!0);if(ro)try{ro({},"a",{value:1})}catch{ro=!1}var AI=Bd("%SyntaxError%"),Cs=Bd("%TypeError%"),Ym=y_,SI=function(t,e,r){if(!t||typeof t!="object"&&typeof t!="function")throw new Cs("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Cs("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Cs("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Cs("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Cs("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Cs("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,h=!!Ym&&Ym(t,e);if(ro)ro(t,e,{configurable:o===null&&h?h.configurable:!o,enumerable:s===null&&h?h.enumerable:!s,value:r,writable:n===null&&h?h.writable:!n});else if(a||!s&&!n&&!o)t[e]=r;else throw new AI("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},__=vs,qm=SI,II=g_(),Km=y_,Zm=__("%TypeError%"),CI=__("%Math.floor%"),RI=function(t,e){if(typeof t!="function")throw new Zm("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||CI(e)!==e)throw new Zm("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in t&&Km){var o=Km(t,"length");o&&!o.configurable&&(s=!1),o&&!o.writable&&(n=!1)}return(s||n||!r)&&(II?qm(t,"length",e,!0,!0):qm(t,"length",e)),t};(function(i){var t=Od,e=vs,r=RI,s=e("%TypeError%"),n=e("%Function.prototype.apply%"),o=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||t.call(o,n),h=e("%Object.defineProperty%",!0),l=e("%Math.max%");if(h)try{h({},"a",{value:1})}catch{h=null}i.exports=function(c){if(typeof c!="function")throw new s("a function is required");var f=a(t,o,arguments);return r(f,1+l(0,c.length-(arguments.length-1)),!0)};var u=function(){return a(t,n,arguments)};h?h(i.exports,"apply",{value:u}):i.exports.apply=u})(m_);var MI=m_.exports,v_=vs,x_=MI,PI=x_(v_("String.prototype.indexOf")),NI=function(t,e){var r=v_(t,!!e);return typeof r=="function"&&PI(t,".prototype.")>-1?x_(r):r};const OI={},BI=Object.freeze(Object.defineProperty({__proto__:null,default:OI},Symbol.toStringTag,{value:"Module"})),FI=RS(BI);var Fd=typeof Map=="function"&&Map.prototype,iu=Object.getOwnPropertyDescriptor&&Fd?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,xh=Fd&&iu&&typeof iu.get=="function"?iu.get:null,Qm=Fd&&Map.prototype.forEach,Dd=typeof Set=="function"&&Set.prototype,ru=Object.getOwnPropertyDescriptor&&Dd?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,bh=Dd&&ru&&typeof ru.get=="function"?ru.get:null,Jm=Dd&&Set.prototype.forEach,DI=typeof WeakMap=="function"&&WeakMap.prototype,so=DI?WeakMap.prototype.has:null,LI=typeof WeakSet=="function"&&WeakSet.prototype,no=LI?WeakSet.prototype.has:null,kI=typeof WeakRef=="function"&&WeakRef.prototype,tg=kI?WeakRef.prototype.deref:null,UI=Boolean.prototype.valueOf,GI=Object.prototype.toString,$I=Function.prototype.toString,HI=String.prototype.match,Ld=String.prototype.slice,_r=String.prototype.replace,XI=String.prototype.toUpperCase,eg=String.prototype.toLowerCase,b_=RegExp.prototype.test,ig=Array.prototype.concat,Si=Array.prototype.join,zI=Array.prototype.slice,rg=Math.floor,Pc=typeof BigInt=="function"?BigInt.prototype.valueOf:null,su=Object.getOwnPropertySymbols,Nc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,ln=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Re=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===ln||"symbol")?Symbol.toStringTag:null,w_=Object.prototype.propertyIsEnumerable,sg=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function ng(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||b_.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-rg(-i):rg(i);if(r!==i){var s=String(r),n=Ld.call(t,s.length+1);return _r.call(s,e,"$&_")+"."+_r.call(_r.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _r.call(t,e,"$&_")}var Oc=FI,og=Oc.custom,ag=T_(og)?og:null,VI=function i(t,e,r,s){var n=e||{};if(pr(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(pr(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=pr(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(pr(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(pr(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=n.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return S_(t,n);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?ng(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?ng(t,l):l}var u=typeof n.depth>"u"?5:n.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof t=="object")return Bc(t)?"[Array]":"[Object]";var d=lC(n,r);if(typeof s>"u")s=[];else if(A_(s,t)>=0)return"[Circular]";function c(E,N,q){if(N&&(s=zI.call(s),s.push(N)),q){var Y={depth:n.depth};return pr(n,"quoteStyle")&&(Y.quoteStyle=n.quoteStyle),i(E,Y,r+1,s)}return i(E,n,r+1,s)}if(typeof t=="function"&&!hg(t)){var f=tC(t),p=da(t,c);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Si.call(p,", ")+" }":"")}if(T_(t)){var m=ln?_r.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Nc.call(t);return typeof t=="object"&&!ln?On(m):m}if(oC(t)){for(var g="<"+eg.call(String(t.nodeName)),y=t.attributes||[],_=0;_<y.length;_++)g+=" "+y[_].name+"="+E_(WI(y[_].value),"double",n);return g+=">",t.childNodes&&t.childNodes.length&&(g+="..."),g+="</"+eg.call(String(t.nodeName))+">",g}if(Bc(t)){if(t.length===0)return"[]";var v=da(t,c);return d&&!hC(v)?"["+Fc(v,d)+"]":"[ "+Si.call(v,", ")+" ]"}if(YI(t)){var x=da(t,c);return!("cause"in Error.prototype)&&"cause"in t&&!w_.call(t,"cause")?"{ ["+String(t)+"] "+Si.call(ig.call("[cause]: "+c(t.cause),x),", ")+" }":x.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Si.call(x,", ")+" }"}if(typeof t=="object"&&o){if(ag&&typeof t[ag]=="function"&&Oc)return Oc(t,{depth:u-r});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(eC(t)){var b=[];return Qm&&Qm.call(t,function(E,N){b.push(c(N,t,!0)+" => "+c(E,t))}),lg("Map",xh.call(t),b,d)}if(sC(t)){var M=[];return Jm&&Jm.call(t,function(E){M.push(c(E,t))}),lg("Set",bh.call(t),M,d)}if(iC(t))return nu("WeakMap");if(nC(t))return nu("WeakSet");if(rC(t))return nu("WeakRef");if(KI(t))return On(c(Number(t)));if(QI(t))return On(c(Pc.call(t)));if(ZI(t))return On(UI.call(t));if(qI(t))return On(c(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===$a)return"{ [object globalThis] }";if(!jI(t)&&!hg(t)){var S=da(t,c),A=sg?sg(t)===Object.prototype:t instanceof Object||t.constructor===Object,R=t instanceof Object?"":"null prototype",L=!A&&Re&&Object(t)===t&&Re in t?Ld.call(Ir(t),8,-1):R?"Object":"",B=A||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",P=B+(L||R?"["+Si.call(ig.call([],L||[],R||[]),": ")+"] ":"");return S.length===0?P+"{}":d?P+"{"+Fc(S,d)+"}":P+"{ "+Si.call(S,", ")+" }"}return String(t)};function E_(i,t,e){var r=(e.quoteStyle||t)==="double"?'"':"'";return r+i+r}function WI(i){return _r.call(String(i),/"/g,"&quot;")}function Bc(i){return Ir(i)==="[object Array]"&&(!Re||!(typeof i=="object"&&Re in i))}function jI(i){return Ir(i)==="[object Date]"&&(!Re||!(typeof i=="object"&&Re in i))}function hg(i){return Ir(i)==="[object RegExp]"&&(!Re||!(typeof i=="object"&&Re in i))}function YI(i){return Ir(i)==="[object Error]"&&(!Re||!(typeof i=="object"&&Re in i))}function qI(i){return Ir(i)==="[object String]"&&(!Re||!(typeof i=="object"&&Re in i))}function KI(i){return Ir(i)==="[object Number]"&&(!Re||!(typeof i=="object"&&Re in i))}function ZI(i){return Ir(i)==="[object Boolean]"&&(!Re||!(typeof i=="object"&&Re in i))}function T_(i){if(ln)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!Nc)return!1;try{return Nc.call(i),!0}catch{}return!1}function QI(i){if(!i||typeof i!="object"||!Pc)return!1;try{return Pc.call(i),!0}catch{}return!1}var JI=Object.prototype.hasOwnProperty||function(i){return i in this};function pr(i,t){return JI.call(i,t)}function Ir(i){return GI.call(i)}function tC(i){if(i.name)return i.name;var t=HI.call($I.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function A_(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function eC(i){if(!xh||!i||typeof i!="object")return!1;try{xh.call(i);try{bh.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function iC(i){if(!so||!i||typeof i!="object")return!1;try{so.call(i,so);try{no.call(i,no)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function rC(i){if(!tg||!i||typeof i!="object")return!1;try{return tg.call(i),!0}catch{}return!1}function sC(i){if(!bh||!i||typeof i!="object")return!1;try{bh.call(i);try{xh.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function nC(i){if(!no||!i||typeof i!="object")return!1;try{no.call(i,no);try{so.call(i,so)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function oC(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function S_(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return S_(Ld.call(i,0,t.maxStringLength),t)+r}var s=_r.call(_r.call(i,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,aC);return E_(s,"single",t)}function aC(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+XI.call(t.toString(16))}function On(i){return"Object("+i+")"}function nu(i){return i+" { ? }"}function lg(i,t,e,r){var s=r?Fc(e,r):Si.call(e,", ");return i+" ("+t+") {"+s+"}"}function hC(i){for(var t=0;t<i.length;t++)if(A_(i[t],`
`)>=0)return!1;return!0}function lC(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=Si.call(Array(i.indent+1)," ");else return null;return{base:e,prev:Si.call(Array(t+1),e)}}function Fc(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+Si.call(i,","+e)+`
`+t.prev}function da(i,t){var e=Bc(i),r=[];if(e){r.length=i.length;for(var s=0;s<i.length;s++)r[s]=pr(i,s)?t(i[s],i):""}var n=typeof su=="function"?su(i):[],o;if(ln){o={};for(var a=0;a<n.length;a++)o["$"+n[a]]=n[a]}for(var h in i)pr(i,h)&&(e&&String(Number(h))===h&&h<i.length||ln&&o["$"+h]instanceof Symbol||(b_.call(/[^\w$]/,h)?r.push(t(h,i)+": "+t(i[h],i)):r.push(h+": "+t(i[h],i))));if(typeof su=="function")for(var l=0;l<n.length;l++)w_.call(i,n[l])&&r.push("["+t(n[l])+"]: "+t(i[n[l]],i));return r}var kd=vs,_n=NI,uC=VI,cC=kd("%TypeError%"),fa=kd("%WeakMap%",!0),pa=kd("%Map%",!0),dC=_n("WeakMap.prototype.get",!0),fC=_n("WeakMap.prototype.set",!0),pC=_n("WeakMap.prototype.has",!0),mC=_n("Map.prototype.get",!0),gC=_n("Map.prototype.set",!0),yC=_n("Map.prototype.has",!0),Ud=function(i,t){for(var e=i,r;(r=e.next)!==null;e=r)if(r.key===t)return e.next=r.next,r.next=i.next,i.next=r,r},_C=function(i,t){var e=Ud(i,t);return e&&e.value},vC=function(i,t,e){var r=Ud(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},xC=function(i,t){return!!Ud(i,t)},bC=function(){var t,e,r,s={assert:function(n){if(!s.has(n))throw new cC("Side channel does not contain "+uC(n))},get:function(n){if(fa&&n&&(typeof n=="object"||typeof n=="function")){if(t)return dC(t,n)}else if(pa){if(e)return mC(e,n)}else if(r)return _C(r,n)},has:function(n){if(fa&&n&&(typeof n=="object"||typeof n=="function")){if(t)return pC(t,n)}else if(pa){if(e)return yC(e,n)}else if(r)return xC(r,n);return!1},set:function(n,o){fa&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new fa),fC(t,n,o)):pa?(e||(e=new pa),gC(e,n,o)):(r||(r={key:{},next:null}),vC(r,n,o))}};return s},wC=String.prototype.replace,EC=/%20/g,ou={RFC1738:"RFC1738",RFC3986:"RFC3986"},Gd={default:ou.RFC3986,formatters:{RFC1738:function(i){return wC.call(i,EC,"+")},RFC3986:function(i){return String(i)}},RFC1738:ou.RFC1738,RFC3986:ou.RFC3986},TC=Gd,au=Object.prototype.hasOwnProperty,Kr=Array.isArray,yi=function(){for(var i=[],t=0;t<256;++t)i.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return i}(),AC=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(Kr(r)){for(var s=[],n=0;n<r.length;++n)typeof r[n]<"u"&&s.push(r[n]);e.obj[e.prop]=s}}},I_=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)typeof t[s]<"u"&&(r[s]=t[s]);return r},SC=function i(t,e,r){if(!e)return t;if(typeof e!="object"){if(Kr(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!au.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var s=t;return Kr(t)&&!Kr(e)&&(s=I_(t,r)),Kr(t)&&Kr(e)?(e.forEach(function(n,o){if(au.call(t,o)){var a=t[o];a&&typeof a=="object"&&n&&typeof n=="object"?t[o]=i(a,n,r):t.push(n)}else t[o]=n}),t):Object.keys(e).reduce(function(n,o){var a=e[o];return au.call(n,o)?n[o]=i(n[o],a,r):n[o]=a,n},s)},IC=function(t,e){return Object.keys(e).reduce(function(r,s){return r[s]=e[s],r},t)},CC=function(i,t,e){var r=i.replace(/\+/g," ");if(e==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},RC=function(t,e,r,s,n){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;++h){var l=o.charCodeAt(h);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||n===TC.RFC1738&&(l===40||l===41)){a+=o.charAt(h);continue}if(l<128){a=a+yi[l];continue}if(l<2048){a=a+(yi[192|l>>6]+yi[128|l&63]);continue}if(l<55296||l>=57344){a=a+(yi[224|l>>12]+yi[128|l>>6&63]+yi[128|l&63]);continue}h+=1,l=65536+((l&1023)<<10|o.charCodeAt(h)&1023),a+=yi[240|l>>18]+yi[128|l>>12&63]+yi[128|l>>6&63]+yi[128|l&63]}return a},MC=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],s=0;s<e.length;++s)for(var n=e[s],o=n.obj[n.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],u=o[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(e.push({obj:o,prop:l}),r.push(u))}return AC(e),t},PC=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},NC=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},OC=function(t,e){return[].concat(t,e)},BC=function(t,e){if(Kr(t)){for(var r=[],s=0;s<t.length;s+=1)r.push(e(t[s]));return r}return e(t)},C_={arrayToObject:I_,assign:IC,combine:OC,compact:MC,decode:CC,encode:RC,isBuffer:NC,isRegExp:PC,maybeMap:BC,merge:SC},R_=bC,Xa=C_,oo=Gd,FC=Object.prototype.hasOwnProperty,ug={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},ji=Array.isArray,DC=Array.prototype.push,M_=function(i,t){DC.apply(i,ji(t)?t:[t])},LC=Date.prototype.toISOString,cg=oo.default,Ce={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Xa.encode,encodeValuesOnly:!1,format:cg,formatter:oo.formatters[cg],indices:!1,serializeDate:function(t){return LC.call(t)},skipNulls:!1,strictNullHandling:!1},kC=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},hu={},UC=function i(t,e,r,s,n,o,a,h,l,u,d,c,f,p,m,g){for(var y=t,_=g,v=0,x=!1;(_=_.get(hu))!==void 0&&!x;){var b=_.get(t);if(v+=1,typeof b<"u"){if(b===v)throw new RangeError("Cyclic object value");x=!0}typeof _.get(hu)>"u"&&(v=0)}if(typeof h=="function"?y=h(e,y):y instanceof Date?y=d(y):r==="comma"&&ji(y)&&(y=Xa.maybeMap(y,function(Y){return Y instanceof Date?d(Y):Y})),y===null){if(n)return a&&!p?a(e,Ce.encoder,m,"key",c):e;y=""}if(kC(y)||Xa.isBuffer(y)){if(a){var M=p?e:a(e,Ce.encoder,m,"key",c);return[f(M)+"="+f(a(y,Ce.encoder,m,"value",c))]}return[f(e)+"="+f(String(y))]}var S=[];if(typeof y>"u")return S;var A;if(r==="comma"&&ji(y))p&&a&&(y=Xa.maybeMap(y,a)),A=[{value:y.length>0?y.join(",")||null:void 0}];else if(ji(h))A=h;else{var R=Object.keys(y);A=l?R.sort(l):R}for(var L=s&&ji(y)&&y.length===1?e+"[]":e,B=0;B<A.length;++B){var P=A[B],E=typeof P=="object"&&typeof P.value<"u"?P.value:y[P];if(!(o&&E===null)){var N=ji(y)?typeof r=="function"?r(L,P):L:L+(u?"."+P:"["+P+"]");g.set(t,v);var q=R_();q.set(hu,g),M_(S,i(E,N,r,s,n,o,r==="comma"&&p&&ji(y)?null:a,h,l,u,d,c,f,p,m,q))}}return S},GC=function(t){if(!t)return Ce;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Ce.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=oo.default;if(typeof t.format<"u"){if(!FC.call(oo.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var s=oo.formatters[r],n=Ce.filter;return(typeof t.filter=="function"||ji(t.filter))&&(n=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Ce.addQueryPrefix,allowDots:typeof t.allowDots>"u"?Ce.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Ce.charsetSentinel,delimiter:typeof t.delimiter>"u"?Ce.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Ce.encode,encoder:typeof t.encoder=="function"?t.encoder:Ce.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Ce.encodeValuesOnly,filter:n,format:r,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Ce.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Ce.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Ce.strictNullHandling}},$C=function(i,t){var e=i,r=GC(t),s,n;typeof r.filter=="function"?(n=r.filter,e=n("",e)):ji(r.filter)&&(n=r.filter,s=n);var o=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in ug?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var h=ug[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=h==="comma"&&t&&t.commaRoundTrip;s||(s=Object.keys(e)),r.sort&&s.sort(r.sort);for(var u=R_(),d=0;d<s.length;++d){var c=s[d];r.skipNulls&&e[c]===null||M_(o,UC(e[c],c,h,l,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},un=C_,Dc=Object.prototype.hasOwnProperty,HC=Array.isArray,ve={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:un.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},XC=function(i){return i.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},P_=function(i,t){return i&&typeof i=="string"&&t.comma&&i.indexOf(",")>-1?i.split(","):i},zC="utf8=%26%2310003%3B",VC="utf8=%E2%9C%93",WC=function(t,e){var r={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,n=e.parameterLimit===1/0?void 0:e.parameterLimit,o=s.split(e.delimiter,n),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===VC?l="utf-8":o[h]===zC&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var u=o[h],d=u.indexOf("]="),c=d===-1?u.indexOf("="):d+1,f,p;c===-1?(f=e.decoder(u,ve.decoder,l,"key"),p=e.strictNullHandling?null:""):(f=e.decoder(u.slice(0,c),ve.decoder,l,"key"),p=un.maybeMap(P_(u.slice(c+1),e),function(m){return e.decoder(m,ve.decoder,l,"value")})),p&&e.interpretNumericEntities&&l==="iso-8859-1"&&(p=XC(p)),u.indexOf("[]=")>-1&&(p=HC(p)?[p]:p),Dc.call(r,f)?r[f]=un.combine(r[f],p):r[f]=p}return r},jC=function(i,t,e,r){for(var s=r?t:P_(t,e),n=i.length-1;n>=0;--n){var o,a=i[n];if(a==="[]"&&e.parseArrays)o=[].concat(s);else{o=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=parseInt(h,10);!e.parseArrays&&h===""?o={0:s}:!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&e.parseArrays&&l<=e.arrayLimit?(o=[],o[l]=s):h!=="__proto__"&&(o[h]=s)}s=o}return s},YC=function(t,e,r,s){if(t){var n=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=r.depth>0&&o.exec(n),l=h?n.slice(0,h.index):n,u=[];if(l){if(!r.plainObjects&&Dc.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var d=0;r.depth>0&&(h=a.exec(n))!==null&&d<r.depth;){if(d+=1,!r.plainObjects&&Dc.call(Object.prototype,h[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(h[1])}return h&&u.push("["+n.slice(h.index)+"]"),jC(u,e,r,s)}},qC=function(t){if(!t)return ve;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?ve.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?ve.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:ve.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:ve.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:ve.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ve.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:ve.comma,decoder:typeof t.decoder=="function"?t.decoder:ve.decoder,delimiter:typeof t.delimiter=="string"||un.isRegExp(t.delimiter)?t.delimiter:ve.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:ve.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:ve.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:ve.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:ve.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ve.strictNullHandling}},KC=function(i,t){var e=qC(t);if(i===""||i===null||typeof i>"u")return e.plainObjects?Object.create(null):{};for(var r=typeof i=="string"?WC(i,e):i,s=e.plainObjects?Object.create(null):{},n=Object.keys(r),o=0;o<n.length;++o){var a=n[o],h=YC(a,r[a],e,typeof i=="string");s=un.merge(s,h,e)}return e.allowSparse===!0?s:un.compact(s)},ZC=$C,QC=KC,JC=Gd,tR={formats:JC,parse:QC,stringify:ZC},eR=WS;function er(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var iR=/^([a-z0-9.+-]+:)/i,rR=/:[0-9]*$/,sR=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,nR=["<",">",'"',"`"," ","\r",`
`,"	"],oR=["{","}","|","\\","^","`"].concat(nR),Lc=["'"].concat(oR),dg=["%","/","?",";","#"].concat(Lc),fg=["/","?","#"],aR=255,pg=/^[+a-z0-9A-Z_-]{0,63}$/,hR=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,lR={javascript:!0,"javascript:":!0},kc={javascript:!0,"javascript:":!0},en={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Uc=tR;function uR(i,t,e){if(i&&typeof i=="object"&&i instanceof er)return i;var r=new er;return r.parse(i,t,e),r}er.prototype.parse=function(i,t,e){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),s=r!==-1&&r<i.indexOf("#")?"?":"#",n=i.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),i=n.join(s);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var h=sR.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Uc.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=iR.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var d=a.substr(0,2)==="//";d&&!(l&&kc[l])&&(a=a.substr(2),this.slashes=!0)}if(!kc[l]&&(d||l&&!en[l])){for(var c=-1,f=0;f<fg.length;f++){var p=a.indexOf(fg[f]);p!==-1&&(c===-1||p<c)&&(c=p)}var m,g;c===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",c),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),c=-1;for(var f=0;f<dg.length;f++){var p=a.indexOf(dg[f]);p!==-1&&(c===-1||p<c)&&(c=p)}c===-1&&(c=a.length),this.host=a.slice(0,c),a=a.slice(c),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),f=0,v=_.length;f<v;f++){var x=_[f];if(x&&!x.match(pg)){for(var b="",M=0,S=x.length;M<S;M++)x.charCodeAt(M)>127?b+="x":b+=x[M];if(!b.match(pg)){var A=_.slice(0,f),R=_.slice(f+1),L=x.match(hR);L&&(A.push(L[1]),R.unshift(L[2])),R.length&&(a="/"+R.join(".")+a),this.hostname=A.join(".");break}}}this.hostname.length>aR?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=eR.toASCII(this.hostname));var B=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+B,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!lR[u])for(var f=0,v=Lc.length;f<v;f++){var E=Lc[f];if(a.indexOf(E)!==-1){var N=encodeURIComponent(E);N===E&&(N=escape(E)),a=a.split(E).join(N)}}var q=a.indexOf("#");q!==-1&&(this.hash=a.substr(q),a=a.slice(0,q));var Y=a.indexOf("?");if(Y!==-1?(this.search=a.substr(Y),this.query=a.substr(Y+1),t&&(this.query=Uc.parse(this.query)),a=a.slice(0,Y)):t&&(this.search="",this.query={}),a&&(this.pathname=a),en[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",et=this.search||"";this.path=B+et}return this.href=this.format(),this};er.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=i+this.host:this.hostname&&(s=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=Uc.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||en[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+s+e+o+r};er.prototype.resolve=function(i){return this.resolveObject(uR(i,!1,!0)).format()};er.prototype.resolveObject=function(i){if(typeof i=="string"){var t=new er;t.parse(i,!1,!0),i=t}for(var e=new er,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];e[n]=this[n]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=i[h])}return en[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!en[i.protocol]){for(var l=Object.keys(i),u=0;u<l.length;u++){var d=l[u];e[d]=i[d]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!kc[i.protocol]){for(var v=(i.pathname||"").split("/");v.length&&!(i.host=v.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),v[0]!==""&&v.unshift(""),v.length<2&&v.unshift(""),e.pathname=v.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var c=e.pathname||"",f=e.search||"";e.path=c+f}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",m=i.host||i.pathname&&i.pathname.charAt(0)==="/",g=m||p||e.host&&i.pathname,y=g,_=e.pathname&&e.pathname.split("/")||[],v=i.pathname&&i.pathname.split("/")||[],x=e.protocol&&!en[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(_[0]===""?_[0]=e.host:_.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(v[0]===""?v[0]=i.host:v.unshift(i.host)),i.host=null),g=g&&(v[0]===""||_[0]==="")),m)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,_=v;else if(v.length)_||(_=[]),_.pop(),_=_.concat(v),e.search=i.search,e.query=i.query;else if(i.search!=null){if(x){e.host=_.shift(),e.hostname=e.host;var b=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;b&&(e.auth=b.shift(),e.hostname=b.shift(),e.host=e.hostname)}return e.search=i.search,e.query=i.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!_.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var M=_.slice(-1)[0],S=(e.host||i.host||_.length>1)&&(M==="."||M==="..")||M==="",A=0,R=_.length;R>=0;R--)M=_[R],M==="."?_.splice(R,1):M===".."?(_.splice(R,1),A++):A&&(_.splice(R,1),A--);if(!g&&!y)for(;A--;A)_.unshift("..");g&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),S&&_.join("/").substr(-1)!=="/"&&_.push("");var L=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(x){e.hostname=L?"":_.length?_.shift():"",e.host=e.hostname;var b=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;b&&(e.auth=b.shift(),e.hostname=b.shift(),e.host=e.hostname)}return g=g||e.host&&_.length,g&&!L&&_.unshift(""),_.length>0?e.pathname=_.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};er.prototype.parseHost=function(){var i=this.host,t=rR.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const mg={};function Ht(i,t,e=3){if(mg[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),mg[t]=!0}let lu;function cR(){return typeof lu>"u"&&(lu=function(){var t;const i={stencil:!0,failIfMajorPerformanceCaveat:Ut.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Ut.ADAPTER.getWebGLRenderingContext())return!1;const e=Ut.ADAPTER.createCanvas();let r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);const s=!!((t=r==null?void 0:r.getContextAttributes())!=null&&t.stencil);if(r){const n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,s}catch{return!1}}()),lu}var dR={grad:.9,turn:360,rad:360/(2*Math.PI)},Hi=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},we=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Je=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},N_=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},gg=function(i){return{r:Je(i.r,0,255),g:Je(i.g,0,255),b:Je(i.b,0,255),a:Je(i.a)}},uu=function(i){return{r:we(i.r),g:we(i.g),b:we(i.b),a:we(i.a,3)}},fR=/^#([0-9a-f]{3,8})$/i,ma=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},O_=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=Math.max(t,e,r),o=n-Math.min(t,e,r),a=o?n===t?(e-r)/o:n===e?2+(r-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},B_=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),o=r*(1-e),a=r*(1-(t-n)*e),h=r*(1-(1-t+n)*e),l=n%6;return{r:255*[r,a,o,o,h,r][l],g:255*[h,r,r,a,o,o][l],b:255*[o,o,h,r,r,a][l],a:s}},yg=function(i){return{h:N_(i.h),s:Je(i.s,0,100),l:Je(i.l,0,100),a:Je(i.a)}},_g=function(i){return{h:we(i.h),s:we(i.s),l:we(i.l),a:we(i.a,3)}},vg=function(i){return B_((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},ao=function(i){return{h:(t=O_(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},pR=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mR=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,gR=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,yR=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Gc={string:[[function(i){var t=fR.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?we(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?we(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=gR.exec(i)||yR.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:gg({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=pR.exec(i)||mR.exec(i);if(!t)return null;var e,r,s=yg({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(dR[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return vg(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=s===void 0?1:s;return Hi(t)&&Hi(e)&&Hi(r)?gg({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,n=s===void 0?1:s;if(!Hi(t)||!Hi(e)||!Hi(r))return null;var o=yg({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return vg(o)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,n=s===void 0?1:s;if(!Hi(t)||!Hi(e)||!Hi(r))return null;var o=function(a){return{h:N_(a.h),s:Je(a.s,0,100),v:Je(a.v,0,100),a:Je(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return B_(o)},"hsv"]]},xg=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},_R=function(i){return typeof i=="string"?xg(i.trim(),Gc.string):typeof i=="object"&&i!==null?xg(i,Gc.object):[null,void 0]},cu=function(i,t){var e=ao(i);return{h:e.h,s:Je(e.s+100*t,0,100),l:e.l,a:e.a}},du=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},bg=function(i,t){var e=ao(i);return{h:e.h,s:e.s,l:Je(e.l+100*t,0,100),a:e.a}},$c=function(){function i(t){this.parsed=_R(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return we(du(this.rgba),2)},i.prototype.isDark=function(){return du(this.rgba)<.5},i.prototype.isLight=function(){return du(this.rgba)>=.5},i.prototype.toHex=function(){return t=uu(this.rgba),e=t.r,r=t.g,s=t.b,o=(n=t.a)<1?ma(we(255*n)):"","#"+ma(e)+ma(r)+ma(s)+o;var t,e,r,s,n,o},i.prototype.toRgb=function(){return uu(this.rgba)},i.prototype.toRgbString=function(){return t=uu(this.rgba),e=t.r,r=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+s+", "+n+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,n},i.prototype.toHsl=function(){return _g(ao(this.rgba))},i.prototype.toHslString=function(){return t=_g(ao(this.rgba)),e=t.h,r=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+n+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,n},i.prototype.toHsv=function(){return t=O_(this.rgba),{h:we(t.h),s:we(t.s),v:we(t.v),a:we(t.a,3)};var t},i.prototype.invert=function(){return Ei({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),Ei(cu(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ei(cu(this.rgba,-t))},i.prototype.grayscale=function(){return Ei(cu(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),Ei(bg(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),Ei(bg(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?Ei({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):we(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=ao(this.rgba);return typeof t=="number"?Ei({h:t,s:e.s,l:e.l,a:e.a}):we(e.h)},i.prototype.isEqual=function(t){return this.toHex()===Ei(t).toHex()},i}(),Ei=function(i){return i instanceof $c?i:new $c(i)},wg=[],vR=function(i){i.forEach(function(t){wg.indexOf(t)<0&&(t($c,Gc),wg.push(t))})};function xR(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var n={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=r[this.toHex()];if(l)return l;if(o!=null&&o.closest){var u=this.toRgb(),d=1/0,c="black";if(!n.length)for(var f in e)n[f]=new i(e[f]).toRgb();for(var p in e){var m=(a=u,h=n[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));m<d&&(d=m,c=p)}return c}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new i(h).toRgb():null},"name"])}vR([xR]);const Gs=class za{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof za)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,r,s]=this._components;return{r:t,g:e,b:r,a:s}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,r,s]=this._components;return t[0]=e,t[1]=r,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,s,n]=za.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,s,n]=this._components;return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}normalize(t){let e,r,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,r=(o>>8&255)/255,s=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,s,n=255]=t,e/=255,r/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=za.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Ei(t);o.isValid()&&({r:e,g:r,b:s,a:n}=o.rgba,e/=255,r/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),r)}),t)}};Gs.shared=new Gs,Gs.temp=new Gs,Gs.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let rl=Gs;function bR(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[gt.NORMAL_NPM]=gt.NORMAL,i[gt.ADD_NPM]=gt.ADD,i[gt.SCREEN_NPM]=gt.SCREEN,t[gt.NORMAL]=gt.NORMAL_NPM,t[gt.ADD]=gt.ADD_NPM,t[gt.SCREEN]=gt.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const wR=bR();function F_(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function wh(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Eg(i){return!(i&i-1)&&!!i}function Tg(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Va(i,t,e){const r=i.length;let s;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(s=t;s<n;++s)i[s]=i[s+e];i.length=n}let ER=0;function yo(){return++ER}const Ag={},Ti=Object.create(null),ur=Object.create(null);function TR(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Sg(i,t=1){var r;const e=(r=Ut.RETINA_PREFIX)==null?void 0:r.exec(i);return e?parseFloat(e[1]):t}var Ft=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(Ft||{});const Hc=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Ig=(i,t)=>Hc(i).priority??t,zt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(Hc).forEach(t=>{t.type.forEach(e=>{var r,s;return(s=(r=this._removeHandlers)[e])==null?void 0:s.call(r,t)})}),this},add(...i){return i.map(Hc).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,s=this._queue;r[e]?r[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;const n=this._queue;return n[i]&&(n[i].forEach(o=>t(o)),delete n[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,n)=>Ig(n,e)-Ig(s,e)))},r=>{const s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};class AR{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const SR=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function IR(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function CR(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=SR.replace(/%forloop%/gi,IR(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const fu=0,pu=1,mu=2,gu=3,yu=4,_u=5;class vn{constructor(){this.data=0,this.blendMode=gt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<fu)}set blend(t){!!(this.data&1<<fu)!==t&&(this.data^=1<<fu)}get offsets(){return!!(this.data&1<<pu)}set offsets(t){!!(this.data&1<<pu)!==t&&(this.data^=1<<pu)}get culling(){return!!(this.data&1<<mu)}set culling(t){!!(this.data&1<<mu)!==t&&(this.data^=1<<mu)}get depthTest(){return!!(this.data&1<<gu)}set depthTest(t){!!(this.data&1<<gu)!==t&&(this.data^=1<<gu)}get depthMask(){return!!(this.data&1<<_u)}set depthMask(t){!!(this.data&1<<_u)!==t&&(this.data^=1<<_u)}get clockwiseFrontFace(){return!!(this.data&1<<yu)}set clockwiseFrontFace(t){!!(this.data&1<<yu)!==t&&(this.data^=1<<yu)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==gt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new vn;return t.depthTest=!1,t.blend=!0,t}}vn.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Xc=[];function D_(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=Xc.length-1;r>=0;--r){const s=Xc[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class fi{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,n,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let d=0,c=u.length;d<c;d++)u[d][l](t,e,r,s,n,o,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(fi.prototype,{dispatch:{value:fi.prototype.emit},run:{value:fi.prototype.emit}});class _o{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new fi("setRealSize"),this.onUpdate=new fi("update"),this.onError=new fi("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class L_ extends _o{constructor(t,e){const{width:r,height:s}=e||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_s.UNPACK);const n=e.realWidth,o=e.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(e.target,0,0,0,n,o,e.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(e.target,0,r.internalFormat,n,o,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const RR={scaleMode:Zi.NEAREST,alphaMode:_s.NPM},zc=class $s extends tl{constructor(t=null,e=null){super(),e=Object.assign({},$s.defaultOptions,e);const{alphaMode:r,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:d,target:c,resolution:f,resourceOptions:p}=e;t&&!(t instanceof _o)&&(t=D_(t,p),t.internal=!0),this.resolution=f||Ut.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=d,this.target=c,this.alphaMode=r,this.uid=yo(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Eg(this.realWidth)&&Eg(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ur[this.cacheId],delete Ti[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),$s.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=Ut.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${yo()}`}n=t._pixiId}let o=ur[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new $s(t,e),o.cacheId=n,$s.addToCache(o,n)),o}static fromBuffer(t,e,r,s){t=t||new Float32Array(e*r*4);const n=new L_(t,{width:e,height:r,...s==null?void 0:s.resourceOptions});let o,a;return t instanceof Float32Array?(o=j.RGBA,a=Rt.FLOAT):t instanceof Int32Array?(o=j.RGBA_INTEGER,a=Rt.INT):t instanceof Uint32Array?(o=j.RGBA_INTEGER,a=Rt.UNSIGNED_INT):t instanceof Int16Array?(o=j.RGBA_INTEGER,a=Rt.SHORT):t instanceof Uint16Array?(o=j.RGBA_INTEGER,a=Rt.UNSIGNED_SHORT):t instanceof Int8Array?(o=j.RGBA,a=Rt.BYTE):(o=j.RGBA,a=Rt.UNSIGNED_BYTE),n.internal=!0,new $s(n,Object.assign({},RR,{type:a,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ur[e]&&ur[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),ur[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=ur[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ur[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete ur[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};zc.defaultOptions={mipmap:cs.POW2,anisotropicLevel:0,scaleMode:Zi.LINEAR,wrapMode:Pd.CLAMP,alphaMode:_s.UNPACK,target:Js.TEXTURE_2D,format:j.RGBA,type:Rt.UNSIGNED_BYTE},zc._globalBatch=0;let Vt=zc;class MR{constructor(){this.texArray=null,this.blend=0,this.type=gh.TRIANGLES,this.start=0,this.size=0,this.data=null}}let PR=0;class Oe{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=PR++,this.disposeRunner=new fi("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Mi.ELEMENT_ARRAY_BUFFER:Mi.ARRAY_BUFFER}get index(){return this.type===Mi.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Oe(t)}}class Eh{constructor(t,e=0,r=!1,s=Rt.FLOAT,n,o,a,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,s,n){return new Eh(t,e,r,s,n)}}const NR={Float32Array,Uint32Array,Int32Array,Uint8Array};function OR(i,t){let e=0,r=0;const s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;const n=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<i.length;h++){const l=t[h],u=i[h],d=F_(u);s[d]||(s[d]=new NR[d](n)),o=s[d];for(let c=0;c<u.length;c++){const f=(c/l|0)*r+a,p=c%l;o[f+p]=u[c]}a+=l}return new Float32Array(n)}const Cg={5126:4,5123:2,5121:1};let BR=0;const FR={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class cn{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=BR++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new fi("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,n,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Oe||(e instanceof Array&&(e=new Float32Array(e)),e=new Oe(e));const l=t.split("|");if(l.length>1){for(let d=0;d<l.length;d++)this.addAttribute(l[d],e,r,s,n);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Eh(u,r,s,n,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Oe||(t instanceof Array&&(t=new Uint16Array(t)),t=new Oe(t)),t.type=Mi.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Oe;let s;for(s in this.attributes){const n=this.attributes[s],o=this.buffers[n.buffer];t.push(o.data),e.push(n.size*Cg[n.type]/4),n.buffer=0}for(r.data=OR(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new cn;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Oe(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Eh(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Mi.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new cn,r=[],s=[],n=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)s[h]=s[h]||0,s[h]+=o.buffers[h].data.length,n[h]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new FR[F_(o.buffers[a].data)](s[a]),e.buffers[a]=new Oe(r[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)r[h].set(o.buffers[h].data,n[h]),n[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=Mi.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let d=0;d<o.buffers.length;d++)if(o.buffers[d]!==o.indexBuffer){u=d;break}for(const d in o.attributes){const c=o.attributes[d];(c.buffer|0)===u&&(h+=c.size*Cg[c.type]/4)}for(let d=0;d<t.length;d++){const c=t[d].indexBuffer.data;for(let f=0;f<c.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[d].buffers[u].data.length/h,l+=c.length}}return e}}class DR extends cn{constructor(t=!1){super(),this._buffer=new Oe(null,t,!1),this._indexBuffer=new Oe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Rt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Rt.FLOAT).addAttribute("aColor",this._buffer,4,!0,Rt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Rt.FLOAT).addIndex(this._indexBuffer)}}const LR=Math.PI*2,kR=180/Math.PI,UR=Math.PI/180;var k_=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(k_||{});class kt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new kt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}kt.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const ga=[new kt,new kt,new kt,new kt];class Gt{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=k_.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Gt(0,0,0,0)}clone(){return new Gt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const A=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=A)return!1;const R=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>R}const r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;const a=ga[0].set(t.left,t.top),h=ga[1].set(t.left,t.bottom),l=ga[2].set(t.right,t.top),u=ga[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(d===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=r||Math.min(a.x,h.x,l.x,u.x)>=s||Math.max(a.y,h.y,l.y,u.y)<=n||Math.min(a.y,h.y,l.y,u.y)>=o))return!1;const c=d*(h.y-a.y),f=d*(a.x-h.x),p=c*r+f*n,m=c*s+f*n,g=c*r+f*o,y=c*s+f*o;if(Math.max(p,m,g,y)<=c*a.x+f*a.y||Math.min(p,m,g,y)>=c*u.x+f*u.y)return!1;const _=d*(a.y-l.y),v=d*(l.x-a.x),x=_*r+v*n,b=_*s+v*n,M=_*r+v*o,S=_*s+v*o;return!(Math.max(x,b,M,S)<=_*a.x+v*a.y||Math.min(x,b,M,S)>=_*u.x+v*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=n-s,this}}Gt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ye{constructor(t=1,e=0,r=0,s=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,n,o){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new kt;const r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new kt;const r=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this}append(t){const e=this.a,r=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,s,n,o,a,h,l){return this.a=Math.cos(a+l)*n,this.b=Math.sin(a+l)*n,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,s=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-s,n),h=Math.atan2(r,e),l=Math.abs(a+h);return l<1e-5||Math.abs(LR-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*r+o.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,s=this.d,n=this.tx,o=t*s-e*r;return this.a=s/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(t*this.ty-e*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new ye;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new ye}static get TEMP_MATRIX(){return new ye}}ye.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Xr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],zr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Vr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Wr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Vc=[],U_=[],ya=Math.sign;function GR(){for(let i=0;i<16;i++){const t=[];Vc.push(t);for(let e=0;e<16;e++){const r=ya(Xr[i]*Xr[e]+Vr[i]*zr[e]),s=ya(zr[i]*Xr[e]+Wr[i]*zr[e]),n=ya(Xr[i]*Vr[e]+Vr[i]*Wr[e]),o=ya(zr[i]*Vr[e]+Wr[i]*Wr[e]);for(let a=0;a<16;a++)if(Xr[a]===r&&zr[a]===s&&Vr[a]===n&&Wr[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new ye;t.set(Xr[i],zr[i],Vr[i],Wr[i],0,0),U_.push(t)}}GR();const te={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Xr[i],uY:i=>zr[i],vX:i=>Vr[i],vY:i=>Wr[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Vc[i][t],sub:(i,t)=>Vc[i][te.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?te.S:te.N:Math.abs(t)*2<=Math.abs(i)?i>0?te.E:te.W:t>0?i>0?te.SE:te.SW:i>0?te.NE:te.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const s=U_[te.inv(t)];s.tx=e,s.ty=r,i.append(s)}};class Jr{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Jr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}Jr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Wc=class{constructor(){this.worldTransform=new ye,this.localTransform=new ye,this.position=new Jr(this.onChange,this,0,0),this.scale=new Jr(this.onChange,this,1,1),this.pivot=new Jr(this.onChange,this,0,0),this.skew=new Jr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};Wc.IDENTITY=new Wc;let $d=Wc;$d.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var $R=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,HR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Rg(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function vu(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function G_(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return vu(2*t);case"bvec3":return vu(3*t);case"bvec4":return vu(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const rn=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],XR={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},zR={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function VR(i,t){var r;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in i.uniforms){const n=t[s];if(!n){((r=i.uniforms[s])==null?void 0:r.group)===!0&&(i.uniforms[s].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}const o=i.uniforms[s];let a=!1;for(let h=0;h<rn.length;h++)if(rn[h].test(n,o)){e.push(rn[h].code(s,o)),a=!0;break}if(!a){const h=(n.size===1&&!n.isArray?XR:zR)[n.type].replace("location",`ud["${s}"].location`);e.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const $_={};let Rs=$_;function WR(){if(Rs===$_||Rs!=null&&Rs.isContextLost()){const i=Ut.ADAPTER.createCanvas();let t;Ut.PREFER_ENV>=ys.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Rs=t}return Rs}let _a;function jR(){if(!_a){_a=Qe.MEDIUM;const i=WR();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(_a=t.precision?Qe.HIGH:Qe.MEDIUM)}}return _a}function Mg(i,t){const e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),s=r.split(`
`),n={},o=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function YR(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||Mg(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||Mg(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const qR={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function H_(i){return qR[i]}let va=null;const Pg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function X_(i,t){if(!va){const e=Object.keys(Pg);va={};for(let r=0;r<e.length;++r){const s=e[r];va[i[s]]=Pg[s]}}return va[t]}function Ng(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Qe.HIGH&&e!==Qe.HIGH&&(r=Qe.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Qe.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Bn;function KR(){if(typeof Bn=="boolean")return Bn;try{Bn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Bn=!1}return Bn}let ZR=0;const xa={},jc=class Hs{constructor(t,e,r="pixi-shader",s={}){this.extra={},this.id=ZR++,this.vertexSrc=t||Hs.defaultVertexSrc,this.fragmentSrc=e||Hs.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),xa[r]?(xa[r]++,r+=`-${xa[r]}`):xa[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Ng(this.vertexSrc,Hs.defaultVertexPrecision,Qe.HIGH),this.fragmentSrc=Ng(this.fragmentSrc,Hs.defaultFragmentPrecision,jR())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return HR}static get defaultFragmentSrc(){return $R}static from(t,e,r){const s=t+e;let n=Ag[s];return n||(Ag[s]=n=new Hs(t,e,r)),n}};jc.defaultVertexPrecision=Qe.HIGH,jc.defaultFragmentPrecision=zs.apple.device?Qe.HIGH:Qe.MEDIUM;let ts=jc,QR=0;class Pi{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=QR++,this.static=!!e,this.ubo=!!r,t instanceof Oe?(this.buffer=t,this.buffer.type=Mi.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Oe(new Float32Array(1)),this.buffer.type=Mi.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new Pi(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new Pi(t,e,r)}static uboFrom(t,e){return new Pi(t,e??!0,!0)}}class sl{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Pi?this.uniformGroup=e:this.uniformGroup=new Pi(e):this.uniformGroup=new Pi({}),this.disposeRunner=new fi("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const s=e.uniforms[r];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const s=ts.from(t,e);return new sl(s,r)}}class JR{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=Pi.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ts(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ye,default:this.defaultGroupCache[t]};return new sl(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class tM{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function eM(){return!zs.apple.device}function iM(i){let t=!0;const e=Ut.ADAPTER.getNavigator();if(zs.tablet||zs.phone){if(zs.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(zs.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class z_{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var rM=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,sM=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const qn=class hi extends z_{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=DR,this.vertexSize=6,this.state=vn.for2d(),this.size=hi.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??iM(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??eM(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Ht("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return sM}static get defaultFragmentTemplate(){return rM}setShaderGenerator({vertex:t=hi.defaultVertexSrc,fragment:e=hi.defaultFragmentTemplate}={}){this.shaderGenerator=new JR(t,e)}contextChange(){const t=this.renderer.gl;Ut.PREFER_ENV===ys.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),hi.defaultMaxTextures),this.maxTextures=CR(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=hi,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new MR);for(;e.length<s;)e.push(new tM);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=hi._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++Vt._globalBatch,h=0,l=r[0],u=0;s.copyBoundTextures(n,e);for(let d=0;d<this._bufferSize;++d){const c=t[d];t[d]=null,c._batchEnabled!==a&&(l.count>=e&&(s.boundArray(l,n,a,e),this.buildDrawCalls(l,u,d),u=d,l=r[++h],++a),c._batchEnabled=a,c.touched=o,l.elements[l.count++]=c)}l.count>0&&(s.boundArray(l,n,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let d=0;d<n.length;d++)n[d]=null;Vt._globalBatch=a}buildDrawCalls(t,e,r){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,h=hi._drawCallPool;let l=this._dcIndex,u=this._aIndex,d=this._iIndex,c=h[l];c.start=this._iIndex,c.texArray=t;for(let f=e;f<r;++f){const p=s[f],m=p._texture.baseTexture,g=wR[m.alphaMode?1:0][p.blendMode];s[f]=null,e<f&&c.blend!==g&&(c.size=d-c.start,e=f,c=h[++l],c.texArray=t,c.start=d),this.packInterleavedGeometry(p,n,o,u,d),u+=p.vertexData.length/2*a,d+=p.indices.length,c.blend=g}e<r&&(c.size=d-c.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=d}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;hi.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,s=hi._drawCallPool;let n=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:u,blend:d}=s[o];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=d,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),hi.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=wh(Math.ceil(t/8)),r=Tg(e),s=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new AR(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=wh(Math.ceil(t/12)),r=Tg(e),s=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,r,s,n){const{uint32View:o,float32View:a}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,d=t.vertexData,c=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=rl.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let m=0;m<d.length;m+=2)a[s++]=d[m],a[s++]=d[m+1],a[s++]=l[m],a[s++]=l[m+1],o[s++]=p,a[s++]=c;for(let m=0;m<u.length;m++)r[n++]=h+u[m]}};qn.defaultBatchSize=4096,qn.extension={name:"batch",type:Ft.RendererPlugin},qn._drawCallPool=[],qn._textureArrayPool=[];let jr=qn;zt.add(jr);var nM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,oM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Yc=class Kn extends sl{constructor(t,e,r){const s=ts.from(t||Kn.defaultVertexSrc,e||Kn.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=Kn.defaultResolution,this.multisample=Kn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new vn}apply(t,e,r,s,n){t.applyFilter(this,e,r,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return oM}static get defaultFragmentSrc(){return nM}};Yc.defaultResolution=1,Yc.defaultMultisample=ue.NONE;let Ws=Yc;class Th{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new rl(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:s}=t,n=r??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Th.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Th.extension={type:[Ft.RendererSystem,Ft.CanvasRendererSystem],name:"background"};zt.add(Th);class V_{constructor(t){this.renderer=t,this.emptyRenderer=new z_(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){const{elements:n,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const u=n[l],d=u._batchLocation;if(d>=0&&d<s&&e[d]===u){o[l]=d;continue}for(;h<s;){const c=e[h];if(c&&c._batchEnabled===r&&c._batchLocation===h){h++;continue}o[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}V_.extension={type:Ft.RendererSystem,name:"batch"};zt.add(V_);let Og=0;class Ah{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Og++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Og++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(Ut.PREFER_ENV>=ys.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ah.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Ah.extension={type:Ft.RendererSystem,name:"context"};zt.add(Ah);class qc{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new fi("disposeFramebuffer"),this.multisample=ue.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Vt(null,{scaleMode:Zi.NEAREST,resolution:1,mipmap:cs.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Vt(null,{scaleMode:Zi.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:cs.OFF,format:j.DEPTH_COMPONENT,type:Rt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class W_ extends Vt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:r,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=ue.NONE),super(null,t),this.mipmap=cs.OFF,this.valid=!0,this._clear=new rl([0,0,0,0]),this.framebuffer=new qc(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Tr extends _o{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=TR(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){const n=t.gl,o=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_s.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class j_ extends Tr{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Tr.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Ut.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===_s.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const o in n){const a=n[o];if(a!==r&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Hd{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const s=e.width,n=e.height;if(r){const o=t.width/2/s,a=t.height/2/n,h=t.x/s+o,l=t.y/n+a;r=te.add(r,te.NW),this.x0=h+o*te.uX(r),this.y0=l+a*te.uY(r),r=te.add(r,2),this.x1=h+o*te.uX(r),this.y1=l+a*te.uY(r),r=te.add(r,2),this.x2=h+o*te.uX(r),this.y2=l+a*te.uY(r),r=te.add(r,2),this.x3=h+o*te.uX(r),this.y3=l+a*te.uY(r)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Hd.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Bg=new Hd;function ba(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class Yt extends tl{constructor(t,e,r,s,n,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Gt(0,0,1,1)),t instanceof Yt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Bg,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new kt(o.x,o.y):new kt(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&Ti[e.url]&&Yt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Yt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var s;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Yt(this.baseTexture,!this.noFrame&&t,e,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Bg&&(this._uvs=new Hd),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=Ut.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof Vt){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${yo()}`,Vt.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${yo()}`}n=t._pixiId}let o=Ti[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof Vt)?(e.resolution||(e.resolution=Sg(t)),o=new Yt(new Vt(t,e)),o.baseTexture.cacheId=n,Vt.addToCache(o.baseTexture,n),Yt.addToCache(o,n)):!o&&t instanceof Vt&&(o=new Yt(t),Yt.addToCache(o,n)),o}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),s=Yt.from(t,Object.assign({resourceOptions:r},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new Yt(Vt.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){const n=new Vt(t,Object.assign({scaleMode:Vt.defaultOptions.scaleMode,resolution:Sg(e)},s)),{resource:o}=n;o instanceof j_&&(o.url=e);const a=new Yt(n);return r||(r=e),Vt.addToCache(a.baseTexture,r),Yt.addToCache(a,r),r!==e&&(Vt.addToCache(a.baseTexture,e),Yt.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ti[e]&&Ti[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ti[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Ti[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ti[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ti[t.textureCacheIds[e]]===t&&delete Ti[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:s,height:n}=t,o=e+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Yt._EMPTY||(Yt._EMPTY=new Yt(new Vt),ba(Yt._EMPTY),ba(Yt._EMPTY.baseTexture)),Yt._EMPTY}static get WHITE(){if(!Yt._WHITE){const t=Ut.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Yt._WHITE=new Yt(Vt.from(t)),ba(Yt._WHITE),ba(Yt._WHITE.baseTexture)}return Yt._WHITE}}class nl extends Yt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new nl(new W_(t))}}class Y_{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=ue.NONE){const s=new W_(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new nl(s)}getOptimalTexture(t,e,r=1,s=ue.NONE){let n;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=wh(t),e=wh(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(t,e,r){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||ue.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Y_.SCREEN_KEY=-1;let aM=class extends cn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};class hM extends cn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Oe(this.vertices),this.uvBuffer=new Oe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class lM{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ue.NONE,this.sourceFrame=new Gt,this.destinationFrame=new Gt,this.bindingSourceFrame=new Gt,this.bindingDestinationFrame=new Gt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const wa=[new kt,new kt,new kt,new kt],xu=new ye;class q_{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Y_,this.statePool=[],this.quad=new aM,this.quadUv=new hM,this.tempRect=new Gt,this.activeState={},this.globalUniforms=new Pi({outputFrame:new Gt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new lM,o=r.renderTexture;let a,h;if(o.current){const g=o.current;a=g.resolution,h=g.multisample}else a=r.resolution,h=r.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,d=e[0].padding,c=e[0].autoFit,f=e[0].legacy??!0;for(let g=1;g<e.length;g++){const y=e[g];l=Math.min(l,y.resolution||a),u=Math.min(u,y.multisample??h),d=this.useMaxPadding?Math.max(d,y.padding):d+y.padding,c=c&&y.autoFit,f=f||(y.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=l,n.multisample=u,n.legacy=f,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(d);const p=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(xu.copyFrom(r.projection.transform).invert(),p),c?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,u),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,m),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*n[2]-.5*o[2],a[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){const l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,Hr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let d=0;for(d=0;d<r.length-1;++d){d===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[d].apply(this,l,u,Hr.CLEAR,e);const c=l;l=u,u=c}r[d].apply(this,l,h.renderTexture,Hr.BLEND,e),d>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Hr.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,r.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===Hr.CLEAR||e===Hr.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(gh.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(gh.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=e._texture,o=t.set(s.width,0,0,s.height,r.x,r.y),a=e.worldTransform.copyTo(ye.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=ue.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||ue.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=wa[0],s=wa[1],n=wa[2],o=wa[3];r.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(n,n),t.apply(o,o);const a=Math.min(r.x,s.x,n.x,o.x),h=Math.min(r.y,s.y,n.y,o.y),l=Math.max(r.x,s.x,n.x,o.x),u=Math.max(r.y,s.y,n.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,r,s,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a:o,b:a,c:h,d:l}=n;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}n=n?xu.copyFrom(n):xu.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}q_.extension={type:Ft.RendererSystem,name:"filter"};zt.add(q_);class uM{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ue.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const cM=new Gt;class K_{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new qc(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Gt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Ut.PREFER_ENV===ys.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>r,a=e.height>>r,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>r,a=t.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=r,n.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,n=Ac.COLOR|Ac.DEPTH){const{gl:o}=this;o.clearColor(t,e,r,s),o.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new uM(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=s[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=ue.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=ue.NONE),r}blit(t,e,r){const{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new qc(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=cM,e.width=s.width,e.height=s.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,s=t.height,n=this.gl,o=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,r,s):n.renderbufferStorage(n.RENDERBUFFER,h,r,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Gt}destroy(){this.renderer=null}}K_.extension={type:Ft.RendererSystem,name:"framebuffer"};zt.add(K_);const bu={5126:4,5123:2,5121:1};class Z_{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;Ut.PREFER_ENV===ys.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,o,a,h)=>r.drawElementsInstancedANGLE(s,n,o,a,h),t.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const o=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){const r=t.attributes,s=e.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const r=t.attributes,s=e.attributeData,n=["g",t.id];for(const o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(t,e,r=!0){const s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[a.id]=u,u;const d=t.buffers,c=t.attributes,f={},p={};for(const m in d)f[m]=0,p[m]=0;for(const m in c)!c[m].size&&a.attributeData[m]?c[m].size=a.attributeData[m].size:c[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[c[m].buffer]+=c[m].size*bu[c[m].type];for(const m in c){const g=c[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*bu[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*bu[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<d.length;m++){const g=d[m];o.bind(g),r&&g._glBuffers[n].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,s.bindVertexArray(null),o.unbind(Mi.ARRAY_BUFFER),u}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!r){if(o)for(let h=0;h<n.length;h++){const l=n[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(n[h],e))}if(!e){for(const h in r)if(h[0]==="g"){const l=r[h];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in a){const u=a[l],d=o[u.buffer],c=d._glBuffers[s];if(e.attributeData[l]){h!==c&&(n.bind(d),h=c);const f=e.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(r||0)*a,s||1):n.drawElements(t,e||o.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,r,e||o.getSize(),s||1):n.drawArrays(t,r,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Z_.extension={type:Ft.RendererSystem,name:"geometry"};zt.add(Z_);const Fg=new ye;class dM{constructor(t,e){this._texture=t,this.mapCoord=new ye,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],o=t[s+1];e[s]=n*r.a+o*r.c+r.tx,e[s+1]=n*r.b+o*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(Fg.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Fg));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var fM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,pM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class mM extends Ws{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||pM,e||fM,r),this.maskSprite=s,this.maskMatrix=new ye}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new dM(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}}class gM{constructor(t=null){this.type=fe.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ws.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=fe.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Q_{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const n=this.maskDataPool.pop()||new gM;n.pooled=!0,n.maskObject=e,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==fe.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case fe.SCISSOR:this.renderer.scissor.push(r);break;case fe.STENCIL:this.renderer.stencil.push(r);break;case fe.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case fe.COLOR:this.pushColorMask(r);break}r.type===fe.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case fe.SCISSOR:this.renderer.scissor.pop(e);break;case fe.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case fe.SPRITE:this.popSpriteMask(e);break;case fe.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===fe.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=fe.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=fe.SCISSOR:t.type=fe.STENCIL:t.type=fe.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new mM])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Q_.extension={type:Ft.RendererSystem,name:"mask"};zt.add(Q_);class J_{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Dg=new ye,Lg=[],tv=class Wa extends J_{constructor(t){super(t),this.glConst=Ut.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:s}=this,n=s.renderTexture,o=r.getBounds(!0,Lg.pop()??new Gt);this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:s,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Wa.isMatrixRotated(e.worldTransform)||Wa.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,s,n){Wa.isMatrixRotated(n)||(n=n?Dg.copyFrom(n):Dg.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Lg.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};tv.extension={type:Ft.RendererSystem,name:"scissor"};let yM=tv;zt.add(yM);class ev extends J_{constructor(t){super(t),this.glConst=Ut.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}ev.extension={type:Ft.RendererSystem,name:"stencil"};zt.add(ev);class iv{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ht("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Ht("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Ht("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}iv.extension={type:[Ft.RendererSystem,Ft.CanvasRendererSystem],name:"_plugin"};zt.add(iv);class rv{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ye,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){const n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}rv.extension={type:Ft.RendererSystem,name:"projection"};zt.add(rv);const _M=new $d,kg=new Gt;class sv{constructor(t){this.renderer=t,this._tempMatrix=new ye}generateTexture(t,e){const{region:r,...s}=e||{},n=(r==null?void 0:r.copyTo(kg))||t.getLocalBounds(kg,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,s.multisample??(s.multisample=this.renderer.multisample);const a=nl.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=t.transform;return t.transform=_M,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}sv.extension={type:[Ft.RendererSystem,Ft.CanvasRendererSystem],name:"textureGenerator"};zt.add(sv);const Fr=new Gt,Fn=new Gt;class nv{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Gt,this.destinationFrame=new Gt,this.viewportFrame=new Gt}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const s=this.renderer;this.current=t;let n,o,a;t?(n=t.baseTexture,a=n.resolution,e||(Fr.width=t.frame.width,Fr.height=t.frame.height,e=Fr),r||(Fn.x=t.frame.x,Fn.y=t.frame.y,Fn.width=e.width,Fn.height=e.height,r=Fn),o=n.framebuffer):(a=s.resolution,e||(Fr.width=s._view.screen.width,Fr.height=s._view.screen.height,e=Fr),r||(r=Fr,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(r,e,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=rl.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:h,y:l,width:u,height:d}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),d=Math.round(d),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,d)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}nv.extension={type:Ft.RendererSystem,name:"renderTexture"};zt.add(nv);class vM{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function xM(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=t.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;const o=X_(t,n.type),a={type:o,name:n.name,size:H_(o),location:t.getAttribLocation(i,n.name)};e[n.name]=a}return e}function bM(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=t.getActiveUniform(i,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),h=X_(t,n.type);e[o]={name:o,index:s,type:h,size:n.size,isArray:a,value:G_(h,n.size)}}return e}function wM(i,t){var a;const e=Rg(i,i.VERTEX_SHADER,t.vertexSrc),r=Rg(i,i.FRAGMENT_SHADER,t.fragmentSrc),s=i.createProgram();i.attachShader(s,e),i.attachShader(s,r);const n=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(n&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||YR(i,s,e,r),t.attributeData=xM(s,i),t.uniformData=bM(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,i.bindAttribLocation(s,l,h[l]);i.linkProgram(s)}i.deleteShader(e),i.deleteShader(r);const o={};for(const h in t.uniformData){const l=t.uniformData[h];o[h]={location:i.getUniformLocation(s,h),value:G_(l.type,l.size)}}return new vM(s,o)}function EM(i,t,e,r,s){e.buffer.update(s)}const TM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ov={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function AM(i){const t=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,r=0,s=0;for(let n=0;n<t.length;n++){const o=t[n];if(e=ov[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,r%e!==0&&r<16){const a=r%e%16;r+=a,s+=a}r+e>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=e,r=e):(o.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function SM(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function IM(i,t){if(!i.autoManage)return{size:0,syncFunc:EM};const e=SM(i.uniforms,t),{uboElements:r,size:s}=AM(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){const a=r[o],h=i.uniforms[a.data.name],l=a.data.name;let u=!1;for(let d=0;d<rn.length;d++){const c=rn[d];if(c.codeUbo&&c.test(a.data,h)){n.push(`offset = ${a.offset/4};`,rn[d].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){const d=H_(a.data.type),c=Math.max(ov[a.data.type]/16,1),f=d/c,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*c}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const d=TM[a.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${d};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let CM=0;const Ea={textureCount:0,uboCount:0};class av{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=CM++}systemCheck(){if(!KR())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(Ea.textureCount=0,Ea.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ea)),s}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=VR(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,Ea,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=IM(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const s=t.uniforms,n=[`${r}-`];for(const o in s)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,s=wM(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}av.extension={type:Ft.RendererSystem,name:"shader"};zt.add(av);class Sh{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Sh.defaultOptions={hello:!1},Sh.extension={type:[Ft.RendererSystem,Ft.CanvasRendererSystem],name:"startup"};zt.add(Sh);function RM(i,t=[]){return t[gt.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.ADD]=[i.ONE,i.ONE],t[gt.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.NONE]=[0,0],t[gt.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[gt.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[gt.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[gt.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[gt.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[gt.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[gt.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[gt.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[gt.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[gt.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[gt.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const MM=0,PM=1,NM=2,OM=3,BM=4,FM=5,hv=class Kc{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=gt.NONE,this._blendEq=!1,this.map=[],this.map[MM]=this.setBlend,this.map[PM]=this.setOffset,this.map[NM]=this.setCullFace,this.map[OM]=this.setDepthTest,this.map[BM]=this.setFrontFace,this.map[FM]=this.setDepthMask,this.checks=[],this.defaultState=new vn,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=RM(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Kc.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Kc.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};hv.extension={type:Ft.RendererSystem,name:"state"};let DM=hv;zt.add(DM);class LM extends tl{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),r=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new fi(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=r.find(o=>this._systemsHash[o]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Zn=class ja{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=ja.defaultMaxIdle,this.checkCountMax=ja.defaultCheckCountMax,this.mode=ja.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Nd.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Zn.defaultMode=Nd.AUTO,Zn.defaultMaxIdle=60*60,Zn.defaultCheckCountMax=60*10,Zn.extension={type:Ft.RendererSystem,name:"textureGC"};let Yr=Zn;zt.add(Yr);class wu{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Rt.UNSIGNED_BYTE,this.internalFormat=j.RGBA,this.samplerType=0}}function kM(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:J.FLOAT,[i.RGBA]:J.FLOAT,[i.ALPHA]:J.FLOAT,[i.LUMINANCE]:J.FLOAT,[i.LUMINANCE_ALPHA]:J.FLOAT,[i.R8]:J.FLOAT,[i.R8_SNORM]:J.FLOAT,[i.RG8]:J.FLOAT,[i.RG8_SNORM]:J.FLOAT,[i.RGB8]:J.FLOAT,[i.RGB8_SNORM]:J.FLOAT,[i.RGB565]:J.FLOAT,[i.RGBA4]:J.FLOAT,[i.RGB5_A1]:J.FLOAT,[i.RGBA8]:J.FLOAT,[i.RGBA8_SNORM]:J.FLOAT,[i.RGB10_A2]:J.FLOAT,[i.RGB10_A2UI]:J.FLOAT,[i.SRGB8]:J.FLOAT,[i.SRGB8_ALPHA8]:J.FLOAT,[i.R16F]:J.FLOAT,[i.RG16F]:J.FLOAT,[i.RGB16F]:J.FLOAT,[i.RGBA16F]:J.FLOAT,[i.R32F]:J.FLOAT,[i.RG32F]:J.FLOAT,[i.RGB32F]:J.FLOAT,[i.RGBA32F]:J.FLOAT,[i.R11F_G11F_B10F]:J.FLOAT,[i.RGB9_E5]:J.FLOAT,[i.R8I]:J.INT,[i.R8UI]:J.UINT,[i.R16I]:J.INT,[i.R16UI]:J.UINT,[i.R32I]:J.INT,[i.R32UI]:J.UINT,[i.RG8I]:J.INT,[i.RG8UI]:J.UINT,[i.RG16I]:J.INT,[i.RG16UI]:J.UINT,[i.RG32I]:J.INT,[i.RG32UI]:J.UINT,[i.RGB8I]:J.INT,[i.RGB8UI]:J.UINT,[i.RGB16I]:J.INT,[i.RGB16UI]:J.UINT,[i.RGB32I]:J.INT,[i.RGB32UI]:J.UINT,[i.RGBA8I]:J.INT,[i.RGBA8UI]:J.UINT,[i.RGBA16I]:J.INT,[i.RGBA16UI]:J.UINT,[i.RGBA32I]:J.INT,[i.RGBA32UI]:J.UINT,[i.DEPTH_COMPONENT16]:J.FLOAT,[i.DEPTH_COMPONENT24]:J.FLOAT,[i.DEPTH_COMPONENT32F]:J.FLOAT,[i.DEPTH_STENCIL]:J.FLOAT,[i.DEPTH24_STENCIL8]:J.FLOAT,[i.DEPTH32F_STENCIL8]:J.FLOAT}:t={[i.RGB]:J.FLOAT,[i.RGBA]:J.FLOAT,[i.ALPHA]:J.FLOAT,[i.LUMINANCE]:J.FLOAT,[i.LUMINANCE_ALPHA]:J.FLOAT,[i.DEPTH_STENCIL]:J.FLOAT},t}function UM(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[Rt.UNSIGNED_BYTE]:{[j.RGBA]:i.RGBA8,[j.RGB]:i.RGB8,[j.RG]:i.RG8,[j.RED]:i.R8,[j.RGBA_INTEGER]:i.RGBA8UI,[j.RGB_INTEGER]:i.RGB8UI,[j.RG_INTEGER]:i.RG8UI,[j.RED_INTEGER]:i.R8UI,[j.ALPHA]:i.ALPHA,[j.LUMINANCE]:i.LUMINANCE,[j.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Rt.BYTE]:{[j.RGBA]:i.RGBA8_SNORM,[j.RGB]:i.RGB8_SNORM,[j.RG]:i.RG8_SNORM,[j.RED]:i.R8_SNORM,[j.RGBA_INTEGER]:i.RGBA8I,[j.RGB_INTEGER]:i.RGB8I,[j.RG_INTEGER]:i.RG8I,[j.RED_INTEGER]:i.R8I},[Rt.UNSIGNED_SHORT]:{[j.RGBA_INTEGER]:i.RGBA16UI,[j.RGB_INTEGER]:i.RGB16UI,[j.RG_INTEGER]:i.RG16UI,[j.RED_INTEGER]:i.R16UI,[j.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[Rt.SHORT]:{[j.RGBA_INTEGER]:i.RGBA16I,[j.RGB_INTEGER]:i.RGB16I,[j.RG_INTEGER]:i.RG16I,[j.RED_INTEGER]:i.R16I},[Rt.UNSIGNED_INT]:{[j.RGBA_INTEGER]:i.RGBA32UI,[j.RGB_INTEGER]:i.RGB32UI,[j.RG_INTEGER]:i.RG32UI,[j.RED_INTEGER]:i.R32UI,[j.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[Rt.INT]:{[j.RGBA_INTEGER]:i.RGBA32I,[j.RGB_INTEGER]:i.RGB32I,[j.RG_INTEGER]:i.RG32I,[j.RED_INTEGER]:i.R32I},[Rt.FLOAT]:{[j.RGBA]:i.RGBA32F,[j.RGB]:i.RGB32F,[j.RG]:i.RG32F,[j.RED]:i.R32F,[j.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[Rt.HALF_FLOAT]:{[j.RGBA]:i.RGBA16F,[j.RGB]:i.RGB16F,[j.RG]:i.RG16F,[j.RED]:i.R16F},[Rt.UNSIGNED_SHORT_5_6_5]:{[j.RGB]:i.RGB565},[Rt.UNSIGNED_SHORT_4_4_4_4]:{[j.RGBA]:i.RGBA4},[Rt.UNSIGNED_SHORT_5_5_5_1]:{[j.RGBA]:i.RGB5_A1},[Rt.UNSIGNED_INT_2_10_10_10_REV]:{[j.RGBA]:i.RGB10_A2,[j.RGBA_INTEGER]:i.RGB10_A2UI},[Rt.UNSIGNED_INT_10F_11F_11F_REV]:{[j.RGB]:i.R11F_G11F_B10F},[Rt.UNSIGNED_INT_5_9_9_9_REV]:{[j.RGB]:i.RGB9_E5},[Rt.UNSIGNED_INT_24_8]:{[j.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[Rt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[j.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[Rt.UNSIGNED_BYTE]:{[j.RGBA]:i.RGBA,[j.RGB]:i.RGB,[j.ALPHA]:i.ALPHA,[j.LUMINANCE]:i.LUMINANCE,[j.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Rt.UNSIGNED_SHORT_5_6_5]:{[j.RGB]:i.RGB},[Rt.UNSIGNED_SHORT_4_4_4_4]:{[j.RGBA]:i.RGBA},[Rt.UNSIGNED_SHORT_5_5_5_1]:{[j.RGBA]:i.RGBA}},t}class lv{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Vt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=UM(t),this.samplerTypes=kM(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new wu(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new wu(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=t-1;n>=0;--n){const o=e[n];o&&o._glTextures[s].samplerType!==J.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new wu(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r;e.internalFormat=((r=this.internalFormats[t.type])==null?void 0:r[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??J.FLOAT,this.webGLVersion===2&&t.type===Rt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var s;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),(s=t.resource)==null?void 0:s.upload(r,t,e))e.samplerType!==J.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,o=t.realHeight,a=r.gl;(e.width!==n||e.height!==o||e.dirtyId<0)&&(e.width=n,e.height=o,a.texImage2D(t.target,0,e.internalFormat,n,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&Va(this.managedTextures,s,1)}}updateTextureStyle(t){var r;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===cs.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Pd.CLAMP:e.wrapMode=t.wrapMode,(r=t.resource)!=null&&r.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==cs.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Zi.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Zi.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Zi.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===Zi.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}lv.extension={type:Ft.RendererSystem,name:"texture"};zt.add(lv);class uv{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(a,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}uv.extension={type:Ft.RendererSystem,name:"transformFeedback"};zt.add(uv);class Ih{constructor(t){this.renderer=t}init(t){this.screen=new Gt(0,0,t.width,t.height),this.element=t.view||Ut.ADAPTER.createCanvas(),this.resolution=t.resolution||Ut.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Ih.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Ih.extension={type:[Ft.RendererSystem,Ft.CanvasRendererSystem],name:"_view"};zt.add(Ih);Ut.PREFER_ENV=ys.WEBGL2;Ut.STRICT_TEXTURE_CACHE=!1;Ut.RENDER_OPTIONS={...Ah.defaultOptions,...Th.defaultOptions,...Ih.defaultOptions,...Sh.defaultOptions};Object.defineProperties(Ut,{WRAP_MODE:{get(){return Vt.defaultOptions.wrapMode},set(i){Ht("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Vt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return Vt.defaultOptions.scaleMode},set(i){Ht("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Vt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return Vt.defaultOptions.mipmap},set(i){Ht("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Vt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return Vt.defaultOptions.anisotropicLevel},set(i){Ht("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Vt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return Ht("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ws.defaultResolution},set(i){Ws.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return Ht("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ws.defaultMultisample},set(i){Ws.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return jr.defaultMaxTextures},set(i){Ht("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),jr.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return jr.defaultBatchSize},set(i){Ht("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),jr.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return jr.canUploadSameBuffer},set(i){Ht("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),jr.canUploadSameBuffer=i}},GC_MODE:{get(){return Yr.defaultMode},set(i){Ht("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Yr.defaultMode=i}},GC_MAX_IDLE:{get(){return Yr.defaultMaxIdle},set(i){Ht("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Yr.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return Yr.defaultCheckCountMax},set(i){Ht("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Yr.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return ts.defaultVertexPrecision},set(i){Ht("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ts.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return ts.defaultFragmentPrecision},set(i){Ht("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ts.defaultFragmentPrecision=i}}});var Ch=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Ch||{});class Eu{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const cv=class Xe{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Eu(null,null,1/0),this.deltaMS=1/Xe.targetFPMS,this.elapsedMS=1/Xe.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Ch.NORMAL){return this._addListener(new Eu(t,e,r))}addOnce(t,e,r=Ch.NORMAL){return this._addListener(new Eu(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Xe.targetFPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,Xe.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Xe._shared){const t=Xe._shared=new Xe;t.autoStart=!0,t._protected=!0}return Xe._shared}static get system(){if(!Xe._system){const t=Xe._system=new Xe;t.autoStart=!0,t._protected=!0}return Xe._system}};cv.targetFPMS=.06;let Qi=cv;Object.defineProperties(Ut,{TARGET_FPMS:{get(){return Qi.targetFPMS},set(i){Ht("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Qi.targetFPMS=i}}});class dv{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Ch.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Qi.shared:new Qi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}dv.extension=Ft.Application;zt.add(dv);const GM=[];zt.handleByList(Ft.Renderer,GM);class fv{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=ue.HIGH?this.multisample=ue.HIGH:e>=ue.MEDIUM?this.multisample=ue.MEDIUM:e>=ue.LOW?this.multisample=ue.LOW:this.multisample=ue.NONE}destroy(){}}fv.extension={type:Ft.RendererSystem,name:"_multisample"};zt.add(fv);class $M{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class pv{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const o=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new $M(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}pv.extension={type:Ft.RendererSystem,name:"buffer"};zt.add(pv);class mv{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let s,n,o,a;if(e&&(s=e.renderTexture,n=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}mv.extension={type:Ft.RendererSystem,name:"objectRenderer"};zt.add(mv);const Ya=class Zc extends LM{constructor(t){super(),this.type=h_.WEBGL,t=Object.assign({},Ut.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Pi({projectionMatrix:new ye},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Zc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Ht("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Zc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:cR()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ht("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ht("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ht("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ht("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Ht("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Ht("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Ht("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Ht("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Ya.extension={type:Ft.Renderer,priority:1},Ya.__plugins={},Ya.__systems={};let Xd=Ya;zt.handleByMap(Ft.RendererPlugin,Xd.__plugins);zt.handleByMap(Ft.RendererSystem,Xd.__systems);zt.add(Xd);class gv extends _o{constructor(t,e){const{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const o=new Vt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof _o?this.addResourceAt(t[r],r):this.addResourceAt(D_(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class HM extends gv{constructor(t,e){const{width:r,height:s}=e||{};let n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:r,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Js.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let h=0;h<s;h++){const l=o[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}}class XM extends Tr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const yv=class Qn extends gv{constructor(t,e){const{width:r,height:s,autoLoad:n,linkBaseTexture:o}=e||{};if(t&&t.length!==Qn.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:s});for(let a=0;a<Qn.SIDES;a++)this.items[a].target=Js.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=Js.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Js.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const s=this.itemDirtyIds;for(let n=0;n<Qn.SIDES;n++){const o=this.items[n];(s[n]<o.dirtyId||r.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,r),s[n]=o.dirtyId):s[n]<-1&&(t.gl.texImage2D(o.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Qn.SIDES}};yv.SIDES=6;let zM=yv;class js extends Tr{constructor(t,e){e=e||{};let r,s,n;typeof t=="string"?(r=js.EMPTY,s=t,n=!0):(r=t,s=null,n=!1),super(r),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await Ut.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===_s.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return js._EMPTY=js._EMPTY??Ut.ADAPTER.createCanvas(0,0),js._EMPTY}}const Qc=class qa extends Tr{constructor(t,e){e=e||{},super(Ut.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},qa.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Tr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),s=Math.round(s),n=Math.round(n);const o=this.source;o.width=s,o.height=n,o._pixiId=`canvas_${yo()}`,o.getContext("2d").drawImage(t,0,0,e,r,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=qa.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&qa.SVG_XML.test(t)}};Qc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Qc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let VM=Qc;const Jc=class td extends Tr{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const s=t[0].src||t[0];Tr.crossOrigin(r,s,e.crossorigin);for(let n=0;n<t.length;++n){const o=document.createElement("source");let{src:a,mime:h}=t[n];if(a=a||t[n],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||td.MIME_TYPES[u]||`video/${u}`}o.src=a,h&&(o.type=h),r.appendChild(o)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Qi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Qi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Qi.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Qi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||td.TYPES.includes(e)}};Jc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Jc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let WM=Jc;Xc.push(js,j_,XM,WM,VM,L_,zM,HM);class Ug{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Gt.EMPTY:(t=t||new Gt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:s,c:n,d:o,tx:a,ty:h}=t,l=r*e.x+n*e.y+a,u=s*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[2],a=t[3],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[4],a=t[5],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=t[6],a=t[7],e=o<e?o:e,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(t,e,r,s,n){this.addFrameMatrix(t.worldTransform,e,r,s,n)}addFrameMatrix(t,e,r,s,n){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,d=t.ty;let c=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*e+h*r+u,y=a*e+l*r+d;c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+h*r+u,y=a*s+l*r+d,c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*e+h*n+u,y=a*e+l*n+d,c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+h*n+u,y=a*s+l*n+d,c=g<c?g:c,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=c,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];s=l<s?l:s,n=u<n?u:n,o=l>o?l:o,a=u>a?u:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,n=0,o=n){const a=t.a,h=t.b,l=t.c,u=t.d,d=t.tx,c=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=r;y<s;y+=2){const _=e[y],v=e[y+1],x=a*_+l*v+d,b=u*v+h*_+c;f=Math.min(f,x-n),m=Math.max(m,x+n),p=Math.min(p,b-o),g=Math.max(g,b+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&s<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=o>u?o:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&s<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=o>u?o:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,n,o){t-=n,e-=o,r+=n,s+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class dn extends tl{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new $d,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ug,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const s=e[r];Object.defineProperty(dn.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Gt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Gt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ug);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,n=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new jM),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*kR}set angle(t){this.transform.rotation=t*UR}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class jM extends dn{constructor(){super(...arguments),this.sortDirty=null}}dn.prototype.displayObjectUpdateTransform=dn.prototype.updateTransform;const YM=new ye;function qM(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const _v=class ed extends dn{constructor(){super(),this.children=[],this.sortableChildren=ed.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t,this.onChildrenChange(r<s?r:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Va(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,Va(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Va(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,s=e,n=s-r;let o;if(n>0&&n<=s){o=this.children.splice(r,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(qM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const o=this.children[s];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==ed.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=YM.copyFrom(s),s.prepend(n)):s=n),r&&e.intersects(r,s))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let r=0,s=this.children.length;r<s;++r)this.children[r].render(t)}}renderAdvanced(t){var n,o,a;const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const s=e&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==fe.NONE));if(s&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}s&&t.batch.flush(),r&&t.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,r=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<r.length;++s)r[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};_v.defaultSortableChildren=!1;let vo=_v;vo.prototype.containerUpdateTransform=vo.prototype.updateTransform;Object.defineProperties(Ut,{SORTABLE_CHILDREN:{get(){return vo.defaultSortableChildren},set(i){Ht("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),vo.defaultSortableChildren=i}}});var KM=Object.defineProperty,ZM=(i,t,e)=>t in i?KM(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,O=(i,t,e)=>(ZM(i,typeof t!="symbol"?t+"":t,e),e);class ii{constructor(t){O(this,"parent"),O(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var QM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vv={exports:{}};(function(i,t){(function(){var e,r;r=function(s){return i.exports=s},e={linear:function(s,n,o,a){return o*s/a+n},easeInQuad:function(s,n,o,a){return o*(s/=a)*s+n},easeOutQuad:function(s,n,o,a){return-o*(s/=a)*(s-2)+n},easeInOutQuad:function(s,n,o,a){return(s/=a/2)<1?o/2*s*s+n:-o/2*(--s*(s-2)-1)+n},easeInCubic:function(s,n,o,a){return o*(s/=a)*s*s+n},easeOutCubic:function(s,n,o,a){return o*((s=s/a-1)*s*s+1)+n},easeInOutCubic:function(s,n,o,a){return(s/=a/2)<1?o/2*s*s*s+n:o/2*((s-=2)*s*s+2)+n},easeInQuart:function(s,n,o,a){return o*(s/=a)*s*s*s+n},easeOutQuart:function(s,n,o,a){return-o*((s=s/a-1)*s*s*s-1)+n},easeInOutQuart:function(s,n,o,a){return(s/=a/2)<1?o/2*s*s*s*s+n:-o/2*((s-=2)*s*s*s-2)+n},easeInQuint:function(s,n,o,a){return o*(s/=a)*s*s*s*s+n},easeOutQuint:function(s,n,o,a){return o*((s=s/a-1)*s*s*s*s+1)+n},easeInOutQuint:function(s,n,o,a){return(s/=a/2)<1?o/2*s*s*s*s*s+n:o/2*((s-=2)*s*s*s*s+2)+n},easeInSine:function(s,n,o,a){return-o*Math.cos(s/a*(Math.PI/2))+o+n},easeOutSine:function(s,n,o,a){return o*Math.sin(s/a*(Math.PI/2))+n},easeInOutSine:function(s,n,o,a){return-o/2*(Math.cos(Math.PI*s/a)-1)+n},easeInExpo:function(s,n,o,a){return s===0?n:o*Math.pow(2,10*(s/a-1))+n},easeOutExpo:function(s,n,o,a){return s===a?n+o:o*(-Math.pow(2,-10*s/a)+1)+n},easeInOutExpo:function(s,n,o,a){return(s/=a/2)<1?o/2*Math.pow(2,10*(s-1))+n:o/2*(-Math.pow(2,-10*--s)+2)+n},easeInCirc:function(s,n,o,a){return-o*(Math.sqrt(1-(s/=a)*s)-1)+n},easeOutCirc:function(s,n,o,a){return o*Math.sqrt(1-(s=s/a-1)*s)+n},easeInOutCirc:function(s,n,o,a){return(s/=a/2)<1?-o/2*(Math.sqrt(1-s*s)-1)+n:o/2*(Math.sqrt(1-(s-=2)*s)+1)+n},easeInElastic:function(s,n,o,a){var h,l,u;return u=1.70158,l=0,h=o,s===0||(s/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),-(h*Math.pow(2,10*(s-=1))*Math.sin((s*a-u)*(2*Math.PI)/l))+n},easeOutElastic:function(s,n,o,a){var h,l,u;return u=1.70158,l=0,h=o,s===0||(s/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),h*Math.pow(2,-10*s)*Math.sin((s*a-u)*(2*Math.PI)/l)+o+n},easeInOutElastic:function(s,n,o,a){var h,l,u;return u=1.70158,l=0,h=o,s===0||(s/=a/2),l||(l=a*(.3*1.5)),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),s<1?-.5*(h*Math.pow(2,10*(s-=1))*Math.sin((s*a-u)*(2*Math.PI)/l))+n:h*Math.pow(2,-10*(s-=1))*Math.sin((s*a-u)*(2*Math.PI)/l)*.5+o+n},easeInBack:function(s,n,o,a,h){return h===void 0&&(h=1.70158),o*(s/=a)*s*((h+1)*s-h)+n},easeOutBack:function(s,n,o,a,h){return h===void 0&&(h=1.70158),o*((s=s/a-1)*s*((h+1)*s+h)+1)+n},easeInOutBack:function(s,n,o,a,h){return h===void 0&&(h=1.70158),(s/=a/2)<1?o/2*(s*s*(((h*=1.525)+1)*s-h))+n:o/2*((s-=2)*s*(((h*=1.525)+1)*s+h)+2)+n},easeInBounce:function(s,n,o,a){var h;return h=e.easeOutBounce(a-s,0,o,a),o-h+n},easeOutBounce:function(s,n,o,a){return(s/=a)<1/2.75?o*(7.5625*s*s)+n:s<2/2.75?o*(7.5625*(s-=1.5/2.75)*s+.75)+n:s<2.5/2.75?o*(7.5625*(s-=2.25/2.75)*s+.9375)+n:o*(7.5625*(s-=2.625/2.75)*s+.984375)+n},easeInOutBounce:function(s,n,o,a){var h;return s<a/2?(h=e.easeInBounce(s*2,0,o,a),h*.5+n):(h=e.easeOutBounce(s*2-a,0,o,a),h*.5+o*.5+n)}},r(e)}).call(QM)})(vv);const Gg=vv.exports;function ol(i,t){if(i){if(typeof i=="function")return i;if(typeof i=="string")return Gg[i]}else return Gg[t]}const JM={removeOnInterrupt:!1,ease:"linear",time:1e3};class tP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"startX"),O(this,"startY"),O(this,"deltaX"),O(this,"deltaY"),O(this,"keepCenter"),O(this,"startWidth",null),O(this,"startHeight",null),O(this,"deltaWidth",null),O(this,"deltaHeight",null),O(this,"width",null),O(this,"height",null),O(this,"time",0),this.options=Object.assign({},JM,e),this.options.ease=ol(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new kt(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const r=this.parent.width,s=this.parent.height;this.complete(),(r!==this.parent.width||s!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const r=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const s=this.startWidth,n=this.deltaWidth;this.parent.fitWidth(s+n*r,this.keepCenter,this.height===null)}if(this.height!==null){const s=this.startHeight,n=this.deltaHeight;this.parent.fitHeight(s+n*r,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const s=this.startX,n=this.startY,o=this.deltaX,a=this.deltaY,h=new kt(this.parent.x,this.parent.y);this.parent.moveCenter(s+o*r,n+a*r),this.parent.emit("moved",{viewport:this.parent,original:h,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const eP={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class iP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"left"),O(this,"top"),O(this,"right"),O(this,"bottom"),O(this,"underflowX"),O(this,"underflowY"),O(this,"ease"),O(this,"toX"),O(this,"toY"),this.options=Object.assign({},eP,e),this.ease=ol(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const r=this.options.underflow.toLowerCase();r==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=r.indexOf("left")!==-1?-1:r.indexOf("right")!==-1?1:0,this.underflowY=r.indexOf("top")!==-1?-1:r.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,r=typeof t.y>"u"?0:t.y,s=typeof t.width>"u"?this.parent.worldWidth:t.width,n=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>s,top:this.parent.top<r,bottom:this.parent.bottom>n,topLeft:new kt(e*this.parent.scale.x,r*this.parent.scale.y),bottomRight:new kt(s*this.parent.scale.x-this.parent.screenWidth,n*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new kt(0,0),bottomRight:new kt(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let r,s=this.parent.plugins.get("decelerate",!0);s&&(s.x||s.y)&&(s.x&&s.percentChangeX===((t=s.options)==null?void 0:t.friction)||s.y&&s.percentChangeY===((e=s.options)==null?void 0:e.friction))&&(r=this.oob(),(r.left&&this.left||r.right&&this.right)&&(s.percentChangeX=this.options.friction),(r.top&&this.top||r.bottom&&this.bottom)&&(s.percentChangeY=this.options.friction));const n=this.parent.plugins.get("drag",!0)||{},o=this.parent.plugins.get("pinch",!0)||{};if(s=s||{},!(n!=null&&n.active)&&!(o!=null&&o.active)&&(!this.toX||!this.toY)&&(!s.x||!s.y)){r=r||this.oob();const a=r.topLeft,h=r.bottomRight;if(!this.toX&&!s.x){let l=null;r.left&&this.left?l=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-a.x:r.right&&this.right&&(l=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-h.x),l!==null&&this.parent.x!==l&&(this.toX={time:0,start:this.parent.x,delta:l-this.parent.x,end:l},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!s.y){let l=null;r.top&&this.top?l=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-a.y:r.bottom&&this.bottom&&(l=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-h.y),l!==null&&this.parent.y!==l&&(this.toY={time:0,start:this.parent.y,delta:l-this.parent.y,end:l},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const rP={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class sP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"last"),O(this,"noUnderflow"),O(this,"underflowX"),O(this,"underflowY"),this.options=Object.assign({},rP,e),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new kt(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,r=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,r=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,r=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,e.x=0,r=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,r=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,r=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,r=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,e.y=0,r=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const nP={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class oP extends ii{constructor(t,e={}){super(t),O(this,"options"),this.options=Object.assign({},nP,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&e<this.options.minHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&e>this.options.maxHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const n=this.options.minScale;t.x=typeof n.x>"u"?null:n.x,t.y=typeof n.y>"u"?null:n.y}if(typeof this.options.maxScale=="number")e.x=this.options.maxScale,e.y=this.options.maxScale;else if(this.options.maxScale!==null){const n=this.options.maxScale;e.x=typeof n.x>"u"?null:n.x,e.y=typeof n.y>"u"?null:n.y}let r=this.parent.scale.x,s=this.parent.scale.y;t.x!==null&&r<t.x&&(r=t.x),e.x!==null&&r>e.x&&(r=e.x),t.y!==null&&s<t.y&&(s=t.y),e.y!==null&&s>e.y&&(s=e.y),(r!==this.parent.scale.x||s!==this.parent.scale.y)&&(this.parent.scale.set(r,s),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const aP={friction:.98,bounce:.8,minSpeed:.01},cr=16;class hP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"x"),O(this,"y"),O(this,"percentChangeX"),O(this,"percentChangeY"),O(this,"saved"),O(this,"timeSinceRelease"),this.options=Object.assign({},aP,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",r=>this.handleMoved(r))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];t.type==="clamp-x"&&t.original?e.x===t.original.x&&(e.x=this.parent.x):t.type==="clamp-y"&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const r=t-e.time;this.x=(this.parent.x-e.x)/r,this.y=(this.parent.y-e.y)/r,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,r=this.timeSinceRelease,s=this.timeSinceRelease+t;if(this.x){const n=this.percentChangeX,o=Math.log(n);this.parent.x+=this.x*cr/o*(Math.pow(n,s/cr)-Math.pow(n,r/cr)),this.x*=Math.pow(this.percentChangeX,t/cr)}if(this.y){const n=this.percentChangeY,o=Math.log(n);this.parent.y+=this.y*cr/o*(Math.pow(n,s/cr)-Math.pow(n,r/cr)),this.y*=Math.pow(this.percentChangeY,t/cr)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const lP={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class uP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"moved"),O(this,"reverse"),O(this,"xDirection"),O(this,"yDirection"),O(this,"keyIsPressed"),O(this,"mouse"),O(this,"underflowX"),O(this,"underflowY"),O(this,"last"),O(this,"current"),O(this,"windowEventHandlers",[]),this.options=Object.assign({},lP,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const e=s=>{t.includes(s.code)&&(this.keyIsPressed=!0)},r=s=>{t.includes(s.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",r),this.addWindowEventHandler("keydown",e)}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e=t.pointerType==="mouse",r=this.parent.input.count();return!!((r===1||r>1&&!this.parent.plugins.get("pinch",!0))&&(!e||this.mouse[t.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,r=t.global.y,s=this.parent.input.count();if(s===1||s>1&&!this.parent.plugins.get("pinch",!0)){const n=e-this.last.x,o=r-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(n)||this.yDirection&&this.parent.input.checkThreshold(o)){const a={x:e,y:r};return this.xDirection&&(this.parent.x+=(a.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(a.y-this.last.y)*this.options.factor),this.last=a,this.moved||this.parent.emit("drag-start",{event:t,screen:new kt(this.last.x,this.last.y),world:this.parent.toWorld(new kt(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(e.length===1){const r=e[0];return r.last&&(this.last={x:r.last.x,y:r.last.y},this.current=r.id),this.moved=!1,!0}else if(this.last&&this.moved){const r=new kt(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:r,world:this.parent.toWorld(r),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const r=t.deltaMode?this.options.lineHeight:1,s=[t.deltaX,t.deltaY],[n,o]=this.options.wheelSwapAxes?s.reverse():s;return this.xDirection&&(this.parent.x+=n*r*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=o*r*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const cP={speed:0,acceleration:null,radius:null};class dP extends ii{constructor(t,e,r={}){super(t),O(this,"options"),O(this,"target"),O(this,"velocity"),this.target=e,this.options=Object.assign({},cP,r),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let r=this.target.x,s=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius){const a=Math.atan2(this.target.y-e.y,this.target.x-e.x);r=this.target.x-Math.cos(a)*this.options.radius,s=this.target.y-Math.sin(a)*this.options.radius}else return;const n=r-e.x,o=s-e.y;if(n||o)if(this.options.speed)if(this.options.acceleration){const a=Math.atan2(s-e.y,r-e.x),h=Math.sqrt(Math.pow(n,2)+Math.pow(o,2));if(h){const l=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);h>l?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const u=Math.cos(a)*this.velocity.x,d=Math.sin(a)*this.velocity.y,c=Math.abs(u)>Math.abs(n)?r:e.x+u,f=Math.abs(d)>Math.abs(o)?s:e.y+d;this.parent.moveCenter(c,f),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const a=Math.atan2(s-e.y,r-e.x),h=Math.cos(a)*this.options.speed,l=Math.sin(a)*this.options.speed,u=Math.abs(h)>Math.abs(n)?r:e.x+h,d=Math.abs(l)>Math.abs(o)?s:e.y+l;this.parent.moveCenter(u,d),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(r,s),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const fP={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class pP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"reverse"),O(this,"radiusSquared"),O(this,"left"),O(this,"top"),O(this,"right"),O(this,"bottom"),O(this,"horizontal"),O(this,"vertical"),this.options=Object.assign({},fP,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.pointerType!=="mouse"&&t.pointerId!==1||!this.options.allowButtons&&t.buttons!==0)return!1;const e=t.global.x,r=t.global.y;if(this.radiusSquared){const s=this.parent.toScreen(this.parent.center);if(Math.pow(s.x-e,2)+Math.pow(s.y-r,2)>=this.radiusSquared){const n=Math.atan2(s.y-r,s.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(n))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(n))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(n)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(n)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&r<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&r>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const mP={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};let gP=class extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"active",!1),O(this,"pinching",!1),O(this,"moved",!1),O(this,"lastCenter"),this.options=Object.assign({},mP,e)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,r=t.global.y,s=this.parent.input.touches;if(s.length>=2){const n=s[0],o=s[1],a=n.last&&o.last?Math.sqrt(Math.pow(o.last.x-n.last.x,2)+Math.pow(o.last.y-n.last.y,2)):null;if(n.id===t.pointerId?n.last={x:e,y:r,data:t}:o.id===t.pointerId&&(o.last={x:e,y:r,data:t}),a){let h;const l=new kt(n.last.x+(o.last.x-n.last.x)/2,n.last.y+(o.last.y-n.last.y)/2);this.options.center||(h=this.parent.toLocal(l));let u=Math.sqrt(Math.pow(o.last.x-n.last.x,2)+Math.pow(o.last.y-n.last.y,2));u=u===0?u=1e-10:u;const d=(1-a/u)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=d),this.isAxisY()&&(this.parent.scale.y+=d),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:l});const c=this.parent.plugins.get("clamp-zoom",!0);if(c&&c.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const f=this.parent.toGlobal(h);this.parent.x+=(l.x-f.x)*this.options.factor,this.parent.y+=(l.y-f.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(l.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(l.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=l,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}};const yP={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class _P extends ii{constructor(t,e,r,s={}){super(t),O(this,"options"),O(this,"ease"),O(this,"x"),O(this,"y"),O(this,"percent"),O(this,"snapping"),O(this,"deltaX"),O(this,"deltaY"),O(this,"startX"),O(this,"startY"),this.options=Object.assign({},yP,s),this.ease=ol(s.ease,"easeInOutSine"),this.x=e,this.y=r,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const e=this.snapping;e.time+=t;let r,s,n;const o=this.startX,a=this.startY,h=this.deltaX,l=this.deltaY;if(e.time>this.options.time)r=!0,s=o+h,n=a+l;else{const u=this.ease(e.time,0,1,this.options.time);s=o+h*u,n=a+l*u}this.options.topLeft?this.parent.moveCorner(s,n):this.parent.moveCenter(s,n),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),r&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const e=this.options.topLeft?this.parent.corner:this.parent.center;(e.x!==this.x||e.y!==this.y)&&this.snapStart()}}}const vP={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class xP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"ease"),O(this,"xScale"),O(this,"yScale"),O(this,"xIndependent"),O(this,"yIndependent"),O(this,"snapping"),this.options=Object.assign({},vP,e),this.ease=ol(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,r=this.parent.screenWidth/this.xScale,s=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:r-t,deltaY:s-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const r=this.snapping;if(r.time+=t,r.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const n=this.snapping,o=this.ease(n.time,n.startX,n.deltaX,this.options.time),a=this.ease(n.time,n.startY,n.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/o,this.parent.scale.y=this.parent.screenHeight/a}const s=this.parent.plugins.get("clamp-zoom",!0);s&&s.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}resume(){this.snapping=null,super.resume()}}const bP={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class wP extends ii{constructor(t,e={}){super(t),O(this,"options"),O(this,"smoothing"),O(this,"smoothingCenter"),O(this,"smoothingCount"),O(this,"keyIsPressed"),this.options=Object.assign({},bP,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let r;this.options.center||(r=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(r);this.parent.x+=t.x-n.x,this.parent.y+=t.y-n.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),r=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,s=Math.pow(2,(1+this.options.percent)*r);let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=s),this.isAxisY()&&(this.parent.scale.y*=s),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(n);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),r=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,s=Math.pow(2,(1+this.options.percent)*r);if(this.options.smooth){const n={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+n.x)*s-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+n.y)*s-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=s),this.isAxisY()&&(this.parent.scale.y*=s),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(n);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class EP{constructor(t){O(this,"viewport"),O(this,"clickedAvailable"),O(this,"isMouseDown"),O(this,"last"),O(this,"wheelFunction"),O(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new Gt(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.worldVisible)){if(t.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),this.count()===1){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),r=this.viewport.plugins.get("bounce",!0);(!e||!e.isActive())&&(!r||!r.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const r=t.global.x-this.last.x,s=t.global.y-this.last.y;(this.checkThreshold(r)||this.checkThreshold(s))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;t.pointerType==="mouse"&&(this.isMouseDown=!1),t.pointerType!=="mouse"&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new kt;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t){this.touches.splice(e,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}const Dn=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class TP{constructor(t){O(this,"plugins"),O(this,"list"),O(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,r=Dn.length){const s=this.plugins[t];s&&s.destroy(),this.plugins[t]=e;const n=Dn.indexOf(t);n!==-1&&Dn.splice(n,1),Dn.splice(r,0,t),this.sort()}get(t,e){var r;return e&&(r=this.plugins[t])!=null&&r.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&((e=this.plugins[t])==null||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;(e=this.plugins[t])==null||e.pause()}resume(t){var e;(e=this.plugins[t])==null||e.resume()}sort(){this.list=[];for(const t of Dn)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const r of this.list)r.down(t)&&(e=!0);return e}move(t){let e=!1;for(const r of this.viewport.plugins.list)r.move(t)&&(e=!0);return e}up(t){let e=!1;for(const r of this.list)r.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const r of this.list)r.wheel(t)&&(e=!0);return e}}const AP={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:Qi.shared,allowPreserveDragOutside:!1};class SP extends vo{constructor(t){super(),O(this,"moving"),O(this,"screenWidth"),O(this,"screenHeight"),O(this,"threshold"),O(this,"input"),O(this,"plugins"),O(this,"zooming"),O(this,"lastViewport"),O(this,"options"),O(this,"_dirty"),O(this,"_forceHitArea"),O(this,"_hitAreaDefault"),O(this,"_pause"),O(this,"tickerFunction"),O(this,"_worldWidth"),O(this,"_worldHeight"),O(this,"_disableOnContextMenu",e=>e.preventDefault()),this.options={...AP,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new EP(this),this.plugins=new TP(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new Gt(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,r,s){this.screenWidth=t,this.screenHeight=e,typeof r<"u"&&(this._worldWidth=r),typeof s<"u"&&(this._worldHeight=s),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new Gt(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return arguments.length===2?this.toLocal(new kt(t,e)):this.toLocal(t)}toScreen(t,e){return arguments.length===2?this.toGlobal(new kt(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new kt(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,r;typeof t[0]=="number"?(e=t[0],r=t[1]):(e=t[0].x,r=t[0].y);const s=(this.worldScreenWidth/2-e)*this.scale.x,n=(this.worldScreenHeight/2-r)*this.scale.y;return(this.x!==s||this.y!==n)&&(this.position.set(s,n),this.plugins.reset(),this.dirty=!0),this}get corner(){return new kt(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,r;return t.length===1?(e=-t[0].x*this.scale.x,r=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,r=-t[1]*this.scale.y),(e!==this.x||r!==this.y)&&(this.position.set(e,r),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const r=this.screenWidth/t,s=this.screenHeight/e;return Math.min(r,s)}findCover(t,e){const r=this.screenWidth/t,s=this.screenHeight/e;return Math.max(r,s)}fitWidth(t=this.worldWidth,e,r=!0,s){let n;e&&(n=this.center),this.scale.x=this.screenWidth/t,r&&(this.scale.y=this.scale.x);const o=this.plugins.get("clamp-zoom",!0);return!s&&o&&o.clamp(),e&&n&&this.moveCenter(n),this}fitHeight(t=this.worldHeight,e,r=!0,s){let n;e&&(n=this.center),this.scale.y=this.screenHeight/t,r&&(this.scale.x=this.scale.y);const o=this.plugins.get("clamp-zoom",!0);return!s&&o&&o.clamp(),e&&n&&this.moveCenter(n),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,r=this.worldHeight){let s;t&&(s=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/r,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&s&&this.moveCenter(s),this}setZoom(t,e){let r;e&&(r=this.center),this.scale.set(t);const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),e&&r&&this.moveCenter(r),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new xP(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new kt(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new Gt(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new uP(this,t)),this}clamp(t){return this.plugins.add("clamp",new sP(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new hP(this,t)),this}bounce(t){return this.plugins.add("bounce",new iP(this,t)),this}pinch(t){return this.plugins.add("pinch",new gP(this,t)),this}snap(t,e,r){return this.plugins.add("snap",new _P(this,t,e,r)),this}follow(t,e){return this.plugins.add("follow",new dP(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new wP(this,t)),this}animate(t){return this.plugins.add("animate",new tP(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new oP(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new pP(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,r,s,n){n&&(r>this.worldScreenWidth||s>this.worldScreenHeight)&&(this.fit(!0,r,s),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let o=!1;t<this.left?(this.left=t,o=!0):t+r>this.right&&(this.right=t+r,o=!0),e<this.top?(this.top=e,o=!0):e+s>this.bottom&&(this.bottom=e+s,o=!0),o&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}function sn(i,t){return i==null||t==null?NaN:i<t?-1:i>t?1:i>=t?0:NaN}function IP(i,t){return i==null||t==null?NaN:t<i?-1:t>i?1:t>=i?0:NaN}function xv(i){let t,e,r;i.length!==2?(t=sn,e=(a,h)=>sn(i(a),h),r=(a,h)=>i(a)-h):(t=i===sn||i===IP?i:CP,e=i,r=i);function s(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const d=l+u>>>1;e(a[d],h)<0?l=d+1:u=d}while(l<u)}return l}function n(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const d=l+u>>>1;e(a[d],h)<=0?l=d+1:u=d}while(l<u)}return l}function o(a,h,l=0,u=a.length){const d=s(a,h,l,u-1);return d>l&&r(a[d-1],h)>-r(a[d],h)?d-1:d}return{left:s,center:o,right:n}}function CP(){return 0}function RP(i){return i===null?NaN:+i}const MP=xv(sn),PP=MP.right;xv(RP).center;const NP=PP;function OP(i,t){let e,r;if(t===void 0)for(const s of i)s!=null&&(e===void 0?s>=s&&(e=r=s):(e>s&&(e=s),r<s&&(r=s)));else{let s=-1;for(let n of i)(n=t(n,++s,i))!=null&&(e===void 0?n>=n&&(e=r=n):(e>n&&(e=n),r<n&&(r=n)))}return[e,r]}class id extends Map{constructor(t,e=DP){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[r,s]of t)this.set(r,s)}get(t){return super.get($g(this,t))}has(t){return super.has($g(this,t))}set(t,e){return super.set(BP(this,t),e)}delete(t){return super.delete(FP(this,t))}}function $g({_intern:i,_key:t},e){const r=t(e);return i.has(r)?i.get(r):e}function BP({_intern:i,_key:t},e){const r=t(e);return i.has(r)?i.get(r):(i.set(r,e),e)}function FP({_intern:i,_key:t},e){const r=t(e);return i.has(r)&&(e=i.get(r),i.delete(r)),e}function DP(i){return i!==null&&typeof i=="object"?i.valueOf():i}function LP(i){return i}function kP(i,t,...e){return UP(i,LP,t,e)}function UP(i,t,e,r){return function s(n,o){if(o>=r.length)return e(n);const a=new id,h=r[o++];let l=-1;for(const u of n){const d=h(u,++l,n),c=a.get(d);c?c.push(u):a.set(d,[u])}for(const[u,d]of a)a.set(u,s(d,o));return t(a)}(i,0)}function GP(i,t){return Array.from(t,e=>i[e])}function $P(i,...t){if(typeof i[Symbol.iterator]!="function")throw new TypeError("values is not iterable");i=Array.from(i);let[e]=t;if(e&&e.length!==2||t.length>1){const r=Uint32Array.from(i,(s,n)=>n);return t.length>1?(t=t.map(s=>i.map(s)),r.sort((s,n)=>{for(const o of t){const a=rd(o[s],o[n]);if(a)return a}})):(e=i.map(e),r.sort((s,n)=>rd(e[s],e[n]))),GP(i,r)}return i.sort(HP(e))}function HP(i=sn){if(i===sn)return rd;if(typeof i!="function")throw new TypeError("compare is not a function");return(t,e)=>{const r=i(t,e);return r||r===0?r:(i(e,e)===0)-(i(t,t)===0)}}function rd(i,t){return(i==null||!(i>=i))-(t==null||!(t>=t))||(i<t?-1:i>t?1:0)}const XP=Math.sqrt(50),zP=Math.sqrt(10),VP=Math.sqrt(2);function Rh(i,t,e){const r=(t-i)/Math.max(0,e),s=Math.floor(Math.log10(r)),n=r/Math.pow(10,s),o=n>=XP?10:n>=zP?5:n>=VP?2:1;let a,h,l;return s<0?(l=Math.pow(10,-s)/o,a=Math.round(i*l),h=Math.round(t*l),a/l<i&&++a,h/l>t&&--h,l=-l):(l=Math.pow(10,s)*o,a=Math.round(i/l),h=Math.round(t/l),a*l<i&&++a,h*l>t&&--h),h<a&&.5<=e&&e<2?Rh(i,t,e*2):[a,h,l]}function WP(i,t,e){if(t=+t,i=+i,e=+e,!(e>0))return[];if(i===t)return[i];const r=t<i,[s,n,o]=r?Rh(t,i,e):Rh(i,t,e);if(!(n>=s))return[];const a=n-s+1,h=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)h[l]=(n-l)/-o;else for(let l=0;l<a;++l)h[l]=(n-l)*o;else if(o<0)for(let l=0;l<a;++l)h[l]=(s+l)/-o;else for(let l=0;l<a;++l)h[l]=(s+l)*o;return h}function sd(i,t,e){return t=+t,i=+i,e=+e,Rh(i,t,e)[2]}function jP(i,t,e){t=+t,i=+i,e=+e;const r=t<i,s=r?sd(t,i,e):sd(i,t,e);return(r?-1:1)*(s<0?1/-s:s)}function YP(i,t){let e;if(t===void 0)for(const r of i)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let s of i)(s=t(s,++r,i))!=null&&(e<s||e===void 0&&s>=s)&&(e=s)}return e}function _i(i,t){if(typeof i[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof t!="function")throw new TypeError("mapper is not a function");return Array.from(i,(e,r)=>t(e,r,i))}var qP={value:()=>{}};function zd(){for(var i=0,t=arguments.length,e={},r;i<t;++i){if(!(r=arguments[i]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new Ka(e)}function Ka(i){this._=i}function KP(i,t){return i.trim().split(/^|\s+/).map(function(e){var r="",s=e.indexOf(".");if(s>=0&&(r=e.slice(s+1),e=e.slice(0,s)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}Ka.prototype=zd.prototype={constructor:Ka,on:function(i,t){var e=this._,r=KP(i+"",e),s,n=-1,o=r.length;if(arguments.length<2){for(;++n<o;)if((s=(i=r[n]).type)&&(s=ZP(e[s],i.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++n<o;)if(s=(i=r[n]).type)e[s]=Hg(e[s],i.name,t);else if(t==null)for(s in e)e[s]=Hg(e[s],i.name,null);return this},copy:function(){var i={},t=this._;for(var e in t)i[e]=t[e].slice();return new Ka(i)},call:function(i,t){if((s=arguments.length-2)>0)for(var e=new Array(s),r=0,s,n;r<s;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(n=this._[i],r=0,s=n.length;r<s;++r)n[r].value.apply(t,e)},apply:function(i,t,e){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var r=this._[i],s=0,n=r.length;s<n;++s)r[s].value.apply(t,e)}};function ZP(i,t){for(var e=0,r=i.length,s;e<r;++e)if((s=i[e]).name===t)return s.value}function Hg(i,t,e){for(var r=0,s=i.length;r<s;++r)if(i[r].name===t){i[r]=qP,i=i.slice(0,r).concat(i.slice(r+1));break}return e!=null&&i.push({name:t,value:e}),i}var nd="http://www.w3.org/1999/xhtml";const Xg={svg:"http://www.w3.org/2000/svg",xhtml:nd,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function al(i){var t=i+="",e=t.indexOf(":");return e>=0&&(t=i.slice(0,e))!=="xmlns"&&(i=i.slice(e+1)),Xg.hasOwnProperty(t)?{space:Xg[t],local:i}:i}function QP(i){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===nd&&t.documentElement.namespaceURI===nd?t.createElement(i):t.createElementNS(e,i)}}function JP(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function bv(i){var t=al(i);return(t.local?JP:QP)(t)}function tN(){}function Vd(i){return i==null?tN:function(){return this.querySelector(i)}}function eN(i){typeof i!="function"&&(i=Vd(i));for(var t=this._groups,e=t.length,r=new Array(e),s=0;s<e;++s)for(var n=t[s],o=n.length,a=r[s]=new Array(o),h,l,u=0;u<o;++u)(h=n[u])&&(l=i.call(h,h.__data__,u,n))&&("__data__"in h&&(l.__data__=h.__data__),a[u]=l);return new Le(r,this._parents)}function wv(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function iN(){return[]}function Ev(i){return i==null?iN:function(){return this.querySelectorAll(i)}}function rN(i){return function(){return wv(i.apply(this,arguments))}}function sN(i){typeof i=="function"?i=rN(i):i=Ev(i);for(var t=this._groups,e=t.length,r=[],s=[],n=0;n<e;++n)for(var o=t[n],a=o.length,h,l=0;l<a;++l)(h=o[l])&&(r.push(i.call(h,h.__data__,l,o)),s.push(h));return new Le(r,s)}function Tv(i){return function(){return this.matches(i)}}function Av(i){return function(t){return t.matches(i)}}var nN=Array.prototype.find;function oN(i){return function(){return nN.call(this.children,i)}}function aN(){return this.firstElementChild}function hN(i){return this.select(i==null?aN:oN(typeof i=="function"?i:Av(i)))}var lN=Array.prototype.filter;function uN(){return Array.from(this.children)}function cN(i){return function(){return lN.call(this.children,i)}}function dN(i){return this.selectAll(i==null?uN:cN(typeof i=="function"?i:Av(i)))}function fN(i){typeof i!="function"&&(i=Tv(i));for(var t=this._groups,e=t.length,r=new Array(e),s=0;s<e;++s)for(var n=t[s],o=n.length,a=r[s]=[],h,l=0;l<o;++l)(h=n[l])&&i.call(h,h.__data__,l,n)&&a.push(h);return new Le(r,this._parents)}function Sv(i){return new Array(i.length)}function pN(){return new Le(this._enter||this._groups.map(Sv),this._parents)}function Mh(i,t){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=t}Mh.prototype={constructor:Mh,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,t){return this._parent.insertBefore(i,t)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function mN(i){return function(){return i}}function gN(i,t,e,r,s,n){for(var o=0,a,h=t.length,l=n.length;o<l;++o)(a=t[o])?(a.__data__=n[o],r[o]=a):e[o]=new Mh(i,n[o]);for(;o<h;++o)(a=t[o])&&(s[o]=a)}function yN(i,t,e,r,s,n,o){var a,h,l=new Map,u=t.length,d=n.length,c=new Array(u),f;for(a=0;a<u;++a)(h=t[a])&&(c[a]=f=o.call(h,h.__data__,a,t)+"",l.has(f)?s[a]=h:l.set(f,h));for(a=0;a<d;++a)f=o.call(i,n[a],a,n)+"",(h=l.get(f))?(r[a]=h,h.__data__=n[a],l.delete(f)):e[a]=new Mh(i,n[a]);for(a=0;a<u;++a)(h=t[a])&&l.get(c[a])===h&&(s[a]=h)}function _N(i){return i.__data__}function vN(i,t){if(!arguments.length)return Array.from(this,_N);var e=t?yN:gN,r=this._parents,s=this._groups;typeof i!="function"&&(i=mN(i));for(var n=s.length,o=new Array(n),a=new Array(n),h=new Array(n),l=0;l<n;++l){var u=r[l],d=s[l],c=d.length,f=xN(i.call(u,u&&u.__data__,l,r)),p=f.length,m=a[l]=new Array(p),g=o[l]=new Array(p),y=h[l]=new Array(c);e(u,d,m,g,y,f,t);for(var _=0,v=0,x,b;_<p;++_)if(x=m[_]){for(_>=v&&(v=_+1);!(b=g[v])&&++v<p;);x._next=b||null}}return o=new Le(o,r),o._enter=a,o._exit=h,o}function xN(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function bN(){return new Le(this._exit||this._groups.map(Sv),this._parents)}function wN(i,t,e){var r=this.enter(),s=this,n=this.exit();return typeof i=="function"?(r=i(r),r&&(r=r.selection())):r=r.append(i+""),t!=null&&(s=t(s),s&&(s=s.selection())),e==null?n.remove():e(n),r&&s?r.merge(s).order():s}function EN(i){for(var t=i.selection?i.selection():i,e=this._groups,r=t._groups,s=e.length,n=r.length,o=Math.min(s,n),a=new Array(s),h=0;h<o;++h)for(var l=e[h],u=r[h],d=l.length,c=a[h]=new Array(d),f,p=0;p<d;++p)(f=l[p]||u[p])&&(c[p]=f);for(;h<s;++h)a[h]=e[h];return new Le(a,this._parents)}function TN(){for(var i=this._groups,t=-1,e=i.length;++t<e;)for(var r=i[t],s=r.length-1,n=r[s],o;--s>=0;)(o=r[s])&&(n&&o.compareDocumentPosition(n)^4&&n.parentNode.insertBefore(o,n),n=o);return this}function AN(i){i||(i=SN);function t(d,c){return d&&c?i(d.__data__,c.__data__):!d-!c}for(var e=this._groups,r=e.length,s=new Array(r),n=0;n<r;++n){for(var o=e[n],a=o.length,h=s[n]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(h[u]=l);h.sort(t)}return new Le(s,this._parents).order()}function SN(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function IN(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function CN(){return Array.from(this)}function RN(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var r=i[t],s=0,n=r.length;s<n;++s){var o=r[s];if(o)return o}return null}function MN(){let i=0;for(const t of this)++i;return i}function PN(){return!this.node()}function NN(i){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var s=t[e],n=0,o=s.length,a;n<o;++n)(a=s[n])&&i.call(a,a.__data__,n,s);return this}function ON(i){return function(){this.removeAttribute(i)}}function BN(i){return function(){this.removeAttributeNS(i.space,i.local)}}function FN(i,t){return function(){this.setAttribute(i,t)}}function DN(i,t){return function(){this.setAttributeNS(i.space,i.local,t)}}function LN(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(i):this.setAttribute(i,e)}}function kN(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,e)}}function UN(i,t){var e=al(i);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((t==null?e.local?BN:ON:typeof t=="function"?e.local?kN:LN:e.local?DN:FN)(e,t))}function Iv(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function GN(i){return function(){this.style.removeProperty(i)}}function $N(i,t,e){return function(){this.style.setProperty(i,t,e)}}function HN(i,t,e){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(i):this.style.setProperty(i,r,e)}}function XN(i,t,e){return arguments.length>1?this.each((t==null?GN:typeof t=="function"?HN:$N)(i,t,e??"")):fn(this.node(),i)}function fn(i,t){return i.style.getPropertyValue(t)||Iv(i).getComputedStyle(i,null).getPropertyValue(t)}function zN(i){return function(){delete this[i]}}function VN(i,t){return function(){this[i]=t}}function WN(i,t){return function(){var e=t.apply(this,arguments);e==null?delete this[i]:this[i]=e}}function jN(i,t){return arguments.length>1?this.each((t==null?zN:typeof t=="function"?WN:VN)(i,t)):this.node()[i]}function Cv(i){return i.trim().split(/^|\s+/)}function Wd(i){return i.classList||new Rv(i)}function Rv(i){this._node=i,this._names=Cv(i.getAttribute("class")||"")}Rv.prototype={add:function(i){var t=this._names.indexOf(i);t<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var t=this._names.indexOf(i);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function Mv(i,t){for(var e=Wd(i),r=-1,s=t.length;++r<s;)e.add(t[r])}function Pv(i,t){for(var e=Wd(i),r=-1,s=t.length;++r<s;)e.remove(t[r])}function YN(i){return function(){Mv(this,i)}}function qN(i){return function(){Pv(this,i)}}function KN(i,t){return function(){(t.apply(this,arguments)?Mv:Pv)(this,i)}}function ZN(i,t){var e=Cv(i+"");if(arguments.length<2){for(var r=Wd(this.node()),s=-1,n=e.length;++s<n;)if(!r.contains(e[s]))return!1;return!0}return this.each((typeof t=="function"?KN:t?YN:qN)(e,t))}function QN(){this.textContent=""}function JN(i){return function(){this.textContent=i}}function tO(i){return function(){var t=i.apply(this,arguments);this.textContent=t??""}}function eO(i){return arguments.length?this.each(i==null?QN:(typeof i=="function"?tO:JN)(i)):this.node().textContent}function iO(){this.innerHTML=""}function rO(i){return function(){this.innerHTML=i}}function sO(i){return function(){var t=i.apply(this,arguments);this.innerHTML=t??""}}function nO(i){return arguments.length?this.each(i==null?iO:(typeof i=="function"?sO:rO)(i)):this.node().innerHTML}function oO(){this.nextSibling&&this.parentNode.appendChild(this)}function aO(){return this.each(oO)}function hO(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function lO(){return this.each(hO)}function uO(i){var t=typeof i=="function"?i:bv(i);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function cO(){return null}function dO(i,t){var e=typeof i=="function"?i:bv(i),r=t==null?cO:typeof t=="function"?t:Vd(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function fO(){var i=this.parentNode;i&&i.removeChild(this)}function pO(){return this.each(fO)}function mO(){var i=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function gO(){var i=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function yO(i){return this.select(i?gO:mO)}function _O(i){return arguments.length?this.property("__data__",i):this.node().__data__}function vO(i){return function(t){i.call(this,t,this.__data__)}}function xO(i){return i.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}})}function bO(i){return function(){var t=this.__on;if(t){for(var e=0,r=-1,s=t.length,n;e<s;++e)n=t[e],(!i.type||n.type===i.type)&&n.name===i.name?this.removeEventListener(n.type,n.listener,n.options):t[++r]=n;++r?t.length=r:delete this.__on}}}function wO(i,t,e){return function(){var r=this.__on,s,n=vO(t);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===i.type&&s.name===i.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=n,s.options=e),s.value=t;return}}this.addEventListener(i.type,n,e),s={type:i.type,name:i.name,value:t,listener:n,options:e},r?r.push(s):this.__on=[s]}}function EO(i,t,e){var r=xO(i+""),s,n=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,l=a.length,u;h<l;++h)for(s=0,u=a[h];s<n;++s)if((o=r[s]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?wO:bO,s=0;s<n;++s)this.each(a(r[s],t,e));return this}function Nv(i,t,e){var r=Iv(i),s=r.CustomEvent;typeof s=="function"?s=new s(t,e):(s=r.document.createEvent("Event"),e?(s.initEvent(t,e.bubbles,e.cancelable),s.detail=e.detail):s.initEvent(t,!1,!1)),i.dispatchEvent(s)}function TO(i,t){return function(){return Nv(this,i,t)}}function AO(i,t){return function(){return Nv(this,i,t.apply(this,arguments))}}function SO(i,t){return this.each((typeof t=="function"?AO:TO)(i,t))}function*IO(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var r=i[t],s=0,n=r.length,o;s<n;++s)(o=r[s])&&(yield o)}var jd=[null];function Le(i,t){this._groups=i,this._parents=t}function Po(){return new Le([[document.documentElement]],jd)}function CO(){return this}Le.prototype=Po.prototype={constructor:Le,select:eN,selectAll:sN,selectChild:hN,selectChildren:dN,filter:fN,data:vN,enter:pN,exit:bN,join:wN,merge:EN,selection:CO,order:TN,sort:AN,call:IN,nodes:CN,node:RN,size:MN,empty:PN,each:NN,attr:UN,style:XN,property:jN,classed:ZN,text:eO,html:nO,raise:aO,lower:lO,append:uO,insert:dO,remove:pO,clone:yO,datum:_O,on:EO,dispatch:SO,[Symbol.iterator]:IO};function re(i){return typeof i=="string"?new Le([[document.querySelector(i)]],[document.documentElement]):new Le([[i]],jd)}function Tu(i){return typeof i=="string"?new Le([document.querySelectorAll(i)],[document.documentElement]):new Le([wv(i)],jd)}function Yd(i,t,e){i.prototype=t.prototype=e,e.constructor=i}function Ov(i,t){var e=Object.create(i.prototype);for(var r in t)e[r]=t[r];return e}function No(){}var xo=.7,Ph=1/xo,nn="\\s*([+-]?\\d+)\\s*",bo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ni="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",RO=/^#([0-9a-f]{3,8})$/,MO=new RegExp(`^rgb\\(${nn},${nn},${nn}\\)$`),PO=new RegExp(`^rgb\\(${Ni},${Ni},${Ni}\\)$`),NO=new RegExp(`^rgba\\(${nn},${nn},${nn},${bo}\\)$`),OO=new RegExp(`^rgba\\(${Ni},${Ni},${Ni},${bo}\\)$`),BO=new RegExp(`^hsl\\(${bo},${Ni},${Ni}\\)$`),FO=new RegExp(`^hsla\\(${bo},${Ni},${Ni},${bo}\\)$`),zg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yd(No,fs,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Vg,formatHex:Vg,formatHex8:DO,formatHsl:LO,formatRgb:Wg,toString:Wg});function Vg(){return this.rgb().formatHex()}function DO(){return this.rgb().formatHex8()}function LO(){return Bv(this).formatHsl()}function Wg(){return this.rgb().formatRgb()}function fs(i){var t,e;return i=(i+"").trim().toLowerCase(),(t=RO.exec(i))?(e=t[1].length,t=parseInt(t[1],16),e===6?jg(t):e===3?new Ge(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Ta(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Ta(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=MO.exec(i))?new Ge(t[1],t[2],t[3],1):(t=PO.exec(i))?new Ge(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=NO.exec(i))?Ta(t[1],t[2],t[3],t[4]):(t=OO.exec(i))?Ta(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=BO.exec(i))?Kg(t[1],t[2]/100,t[3]/100,1):(t=FO.exec(i))?Kg(t[1],t[2]/100,t[3]/100,t[4]):zg.hasOwnProperty(i)?jg(zg[i]):i==="transparent"?new Ge(NaN,NaN,NaN,0):null}function jg(i){return new Ge(i>>16&255,i>>8&255,i&255,1)}function Ta(i,t,e,r){return r<=0&&(i=t=e=NaN),new Ge(i,t,e,r)}function kO(i){return i instanceof No||(i=fs(i)),i?(i=i.rgb(),new Ge(i.r,i.g,i.b,i.opacity)):new Ge}function od(i,t,e,r){return arguments.length===1?kO(i):new Ge(i,t,e,r??1)}function Ge(i,t,e,r){this.r=+i,this.g=+t,this.b=+e,this.opacity=+r}Yd(Ge,od,Ov(No,{brighter(i){return i=i==null?Ph:Math.pow(Ph,i),new Ge(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?xo:Math.pow(xo,i),new Ge(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new Ge(as(this.r),as(this.g),as(this.b),Nh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yg,formatHex:Yg,formatHex8:UO,formatRgb:qg,toString:qg}));function Yg(){return`#${es(this.r)}${es(this.g)}${es(this.b)}`}function UO(){return`#${es(this.r)}${es(this.g)}${es(this.b)}${es((isNaN(this.opacity)?1:this.opacity)*255)}`}function qg(){const i=Nh(this.opacity);return`${i===1?"rgb(":"rgba("}${as(this.r)}, ${as(this.g)}, ${as(this.b)}${i===1?")":`, ${i})`}`}function Nh(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function as(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function es(i){return i=as(i),(i<16?"0":"")+i.toString(16)}function Kg(i,t,e,r){return r<=0?i=t=e=NaN:e<=0||e>=1?i=t=NaN:t<=0&&(i=NaN),new ci(i,t,e,r)}function Bv(i){if(i instanceof ci)return new ci(i.h,i.s,i.l,i.opacity);if(i instanceof No||(i=fs(i)),!i)return new ci;if(i instanceof ci)return i;i=i.rgb();var t=i.r/255,e=i.g/255,r=i.b/255,s=Math.min(t,e,r),n=Math.max(t,e,r),o=NaN,a=n-s,h=(n+s)/2;return a?(t===n?o=(e-r)/a+(e<r)*6:e===n?o=(r-t)/a+2:o=(t-e)/a+4,a/=h<.5?n+s:2-n-s,o*=60):a=h>0&&h<1?0:o,new ci(o,a,h,i.opacity)}function GO(i,t,e,r){return arguments.length===1?Bv(i):new ci(i,t,e,r??1)}function ci(i,t,e,r){this.h=+i,this.s=+t,this.l=+e,this.opacity=+r}Yd(ci,GO,Ov(No,{brighter(i){return i=i==null?Ph:Math.pow(Ph,i),new ci(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?xo:Math.pow(xo,i),new ci(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,t=isNaN(i)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,s=2*e-r;return new Ge(Au(i>=240?i-240:i+120,s,r),Au(i,s,r),Au(i<120?i+240:i-120,s,r),this.opacity)},clamp(){return new ci(Zg(this.h),Aa(this.s),Aa(this.l),Nh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=Nh(this.opacity);return`${i===1?"hsl(":"hsla("}${Zg(this.h)}, ${Aa(this.s)*100}%, ${Aa(this.l)*100}%${i===1?")":`, ${i})`}`}}));function Zg(i){return i=(i||0)%360,i<0?i+360:i}function Aa(i){return Math.max(0,Math.min(1,i||0))}function Au(i,t,e){return(i<60?t+(e-t)*i/60:i<180?e:i<240?t+(e-t)*(240-i)/60:t)*255}const qd=i=>()=>i;function $O(i,t){return function(e){return i+e*t}}function HO(i,t,e){return i=Math.pow(i,e),t=Math.pow(t,e)-i,e=1/e,function(r){return Math.pow(i+r*t,e)}}function XO(i){return(i=+i)==1?Fv:function(t,e){return e-t?HO(t,e,i):qd(isNaN(t)?e:t)}}function Fv(i,t){var e=t-i;return e?$O(i,e):qd(isNaN(i)?t:i)}const Oh=function i(t){var e=XO(t);function r(s,n){var o=e((s=od(s)).r,(n=od(n)).r),a=e(s.g,n.g),h=e(s.b,n.b),l=Fv(s.opacity,n.opacity);return function(u){return s.r=o(u),s.g=a(u),s.b=h(u),s.opacity=l(u),s+""}}return r.gamma=i,r}(1);function zO(i,t){t||(t=[]);var e=i?Math.min(t.length,i.length):0,r=t.slice(),s;return function(n){for(s=0;s<e;++s)r[s]=i[s]*(1-n)+t[s]*n;return r}}function VO(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function WO(i,t){var e=t?t.length:0,r=i?Math.min(e,i.length):0,s=new Array(r),n=new Array(e),o;for(o=0;o<r;++o)s[o]=Kd(i[o],t[o]);for(;o<e;++o)n[o]=t[o];return function(a){for(o=0;o<r;++o)n[o]=s[o](a);return n}}function jO(i,t){var e=new Date;return i=+i,t=+t,function(r){return e.setTime(i*(1-r)+t*r),e}}function li(i,t){return i=+i,t=+t,function(e){return i*(1-e)+t*e}}function YO(i,t){var e={},r={},s;(i===null||typeof i!="object")&&(i={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in i?e[s]=Kd(i[s],t[s]):r[s]=t[s];return function(n){for(s in e)r[s]=e[s](n);return r}}var ad=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Su=new RegExp(ad.source,"g");function qO(i){return function(){return i}}function KO(i){return function(t){return i(t)+""}}function Dv(i,t){var e=ad.lastIndex=Su.lastIndex=0,r,s,n,o=-1,a=[],h=[];for(i=i+"",t=t+"";(r=ad.exec(i))&&(s=Su.exec(t));)(n=s.index)>e&&(n=t.slice(e,n),a[o]?a[o]+=n:a[++o]=n),(r=r[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,h.push({i:o,x:li(r,s)})),e=Su.lastIndex;return e<t.length&&(n=t.slice(e),a[o]?a[o]+=n:a[++o]=n),a.length<2?h[0]?KO(h[0].x):qO(t):(t=h.length,function(l){for(var u=0,d;u<t;++u)a[(d=h[u]).i]=d.x(l);return a.join("")})}function Kd(i,t){var e=typeof t,r;return t==null||e==="boolean"?qd(t):(e==="number"?li:e==="string"?(r=fs(t))?(t=r,Oh):Dv:t instanceof fs?Oh:t instanceof Date?jO:VO(t)?zO:Array.isArray(t)?WO:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?YO:li)(i,t)}function ZO(i,t){return i=+i,t=+t,function(e){return Math.round(i*(1-e)+t*e)}}var Qg=180/Math.PI,hd={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Lv(i,t,e,r,s,n){var o,a,h;return(o=Math.sqrt(i*i+t*t))&&(i/=o,t/=o),(h=i*e+t*r)&&(e-=i*h,r-=t*h),(a=Math.sqrt(e*e+r*r))&&(e/=a,r/=a,h/=a),i*r<t*e&&(i=-i,t=-t,h=-h,o=-o),{translateX:s,translateY:n,rotate:Math.atan2(t,i)*Qg,skewX:Math.atan(h)*Qg,scaleX:o,scaleY:a}}var Sa;function QO(i){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return t.isIdentity?hd:Lv(t.a,t.b,t.c,t.d,t.e,t.f)}function JO(i){return i==null||(Sa||(Sa=document.createElementNS("http://www.w3.org/2000/svg","g")),Sa.setAttribute("transform",i),!(i=Sa.transform.baseVal.consolidate()))?hd:(i=i.matrix,Lv(i.a,i.b,i.c,i.d,i.e,i.f))}function kv(i,t,e,r){function s(l){return l.length?l.pop()+" ":""}function n(l,u,d,c,f,p){if(l!==d||u!==c){var m=f.push("translate(",null,t,null,e);p.push({i:m-4,x:li(l,d)},{i:m-2,x:li(u,c)})}else(d||c)&&f.push("translate("+d+t+c+e)}function o(l,u,d,c){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),c.push({i:d.push(s(d)+"rotate(",null,r)-2,x:li(l,u)})):u&&d.push(s(d)+"rotate("+u+r)}function a(l,u,d,c){l!==u?c.push({i:d.push(s(d)+"skewX(",null,r)-2,x:li(l,u)}):u&&d.push(s(d)+"skewX("+u+r)}function h(l,u,d,c,f,p){if(l!==d||u!==c){var m=f.push(s(f)+"scale(",null,",",null,")");p.push({i:m-4,x:li(l,d)},{i:m-2,x:li(u,c)})}else(d!==1||c!==1)&&f.push(s(f)+"scale("+d+","+c+")")}return function(l,u){var d=[],c=[];return l=i(l),u=i(u),n(l.translateX,l.translateY,u.translateX,u.translateY,d,c),o(l.rotate,u.rotate,d,c),a(l.skewX,u.skewX,d,c),h(l.scaleX,l.scaleY,u.scaleX,u.scaleY,d,c),l=u=null,function(f){for(var p=-1,m=c.length,g;++p<m;)d[(g=c[p]).i]=g.x(f);return d.join("")}}}var tB=kv(QO,"px, ","px)","deg)"),eB=kv(JO,", ",")",")"),pn=0,Jn=0,Ln=0,Uv=1e3,Bh,to,Fh=0,ps=0,hl=0,wo=typeof performance=="object"&&performance.now?performance:Date,Gv=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Zd(){return ps||(Gv(iB),ps=wo.now()+hl)}function iB(){ps=0}function Dh(){this._call=this._time=this._next=null}Dh.prototype=Qd.prototype={constructor:Dh,restart:function(i,t,e){if(typeof i!="function")throw new TypeError("callback is not a function");e=(e==null?Zd():+e)+(t==null?0:+t),!this._next&&to!==this&&(to?to._next=this:Bh=this,to=this),this._call=i,this._time=e,ld()},stop:function(){this._call&&(this._call=null,this._time=1/0,ld())}};function Qd(i,t,e){var r=new Dh;return r.restart(i,t,e),r}function rB(){Zd(),++pn;for(var i=Bh,t;i;)(t=ps-i._time)>=0&&i._call.call(void 0,t),i=i._next;--pn}function Jg(){ps=(Fh=wo.now())+hl,pn=Jn=0;try{rB()}finally{pn=0,nB(),ps=0}}function sB(){var i=wo.now(),t=i-Fh;t>Uv&&(hl-=t,Fh=i)}function nB(){for(var i,t=Bh,e,r=1/0;t;)t._call?(r>t._time&&(r=t._time),i=t,t=t._next):(e=t._next,t._next=null,t=i?i._next=e:Bh=e);to=i,ld(r)}function ld(i){if(!pn){Jn&&(Jn=clearTimeout(Jn));var t=i-ps;t>24?(i<1/0&&(Jn=setTimeout(Jg,i-wo.now()-hl)),Ln&&(Ln=clearInterval(Ln))):(Ln||(Fh=wo.now(),Ln=setInterval(sB,Uv)),pn=1,Gv(Jg))}}function ty(i,t,e){var r=new Dh;return t=t==null?0:+t,r.restart(s=>{r.stop(),i(s+t)},t,e),r}var oB=zd("start","end","cancel","interrupt"),aB=[],$v=0,ey=1,ud=2,Za=3,iy=4,cd=5,Qa=6;function ll(i,t,e,r,s,n){var o=i.__transition;if(!o)i.__transition={};else if(e in o)return;hB(i,e,{name:t,index:r,group:s,on:oB,tween:aB,time:n.time,delay:n.delay,duration:n.duration,ease:n.ease,timer:null,state:$v})}function Jd(i,t){var e=mi(i,t);if(e.state>$v)throw new Error("too late; already scheduled");return e}function Di(i,t){var e=mi(i,t);if(e.state>Za)throw new Error("too late; already running");return e}function mi(i,t){var e=i.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function hB(i,t,e){var r=i.__transition,s;r[t]=e,e.timer=Qd(n,0,e.time);function n(l){e.state=ey,e.timer.restart(o,e.delay,e.time),e.delay<=l&&o(l-e.delay)}function o(l){var u,d,c,f;if(e.state!==ey)return h();for(u in r)if(f=r[u],f.name===e.name){if(f.state===Za)return ty(o);f.state===iy?(f.state=Qa,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete r[u]):+u<t&&(f.state=Qa,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete r[u])}if(ty(function(){e.state===Za&&(e.state=iy,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=ud,e.on.call("start",i,i.__data__,e.index,e.group),e.state===ud){for(e.state=Za,s=new Array(c=e.tween.length),u=0,d=-1;u<c;++u)(f=e.tween[u].value.call(i,i.__data__,e.index,e.group))&&(s[++d]=f);s.length=d+1}}function a(l){for(var u=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(h),e.state=cd,1),d=-1,c=s.length;++d<c;)s[d].call(i,u);e.state===cd&&(e.on.call("end",i,i.__data__,e.index,e.group),h())}function h(){e.state=Qa,e.timer.stop(),delete r[t];for(var l in r)return;delete i.__transition}}function lB(i,t){var e=i.__transition,r,s,n=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((r=e[o]).name!==t){n=!1;continue}s=r.state>ud&&r.state<cd,r.state=Qa,r.timer.stop(),r.on.call(s?"interrupt":"cancel",i,i.__data__,r.index,r.group),delete e[o]}n&&delete i.__transition}}function uB(i){return this.each(function(){lB(this,i)})}function cB(i,t){var e,r;return function(){var s=Di(this,i),n=s.tween;if(n!==e){r=e=n;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}s.tween=r}}function dB(i,t,e){var r,s;if(typeof e!="function")throw new Error;return function(){var n=Di(this,i),o=n.tween;if(o!==r){s=(r=o).slice();for(var a={name:t,value:e},h=0,l=s.length;h<l;++h)if(s[h].name===t){s[h]=a;break}h===l&&s.push(a)}n.tween=s}}function fB(i,t){var e=this._id;if(i+="",arguments.length<2){for(var r=mi(this.node(),e).tween,s=0,n=r.length,o;s<n;++s)if((o=r[s]).name===i)return o.value;return null}return this.each((t==null?cB:dB)(e,i,t))}function tf(i,t,e){var r=i._id;return i.each(function(){var s=Di(this,r);(s.value||(s.value={}))[t]=e.apply(this,arguments)}),function(s){return mi(s,r).value[t]}}function Hv(i,t){var e;return(typeof t=="number"?li:t instanceof fs?Oh:(e=fs(t))?(t=e,Oh):Dv)(i,t)}function pB(i){return function(){this.removeAttribute(i)}}function mB(i){return function(){this.removeAttributeNS(i.space,i.local)}}function gB(i,t,e){var r,s=e+"",n;return function(){var o=this.getAttribute(i);return o===s?null:o===r?n:n=t(r=o,e)}}function yB(i,t,e){var r,s=e+"",n;return function(){var o=this.getAttributeNS(i.space,i.local);return o===s?null:o===r?n:n=t(r=o,e)}}function _B(i,t,e){var r,s,n;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(i):(o=this.getAttribute(i),h=a+"",o===h?null:o===r&&h===s?n:(s=h,n=t(r=o,a)))}}function vB(i,t,e){var r,s,n;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(i.space,i.local):(o=this.getAttributeNS(i.space,i.local),h=a+"",o===h?null:o===r&&h===s?n:(s=h,n=t(r=o,a)))}}function xB(i,t){var e=al(i),r=e==="transform"?eB:Hv;return this.attrTween(i,typeof t=="function"?(e.local?vB:_B)(e,r,tf(this,"attr."+i,t)):t==null?(e.local?mB:pB)(e):(e.local?yB:gB)(e,r,t))}function bB(i,t){return function(e){this.setAttribute(i,t.call(this,e))}}function wB(i,t){return function(e){this.setAttributeNS(i.space,i.local,t.call(this,e))}}function EB(i,t){var e,r;function s(){var n=t.apply(this,arguments);return n!==r&&(e=(r=n)&&wB(i,n)),e}return s._value=t,s}function TB(i,t){var e,r;function s(){var n=t.apply(this,arguments);return n!==r&&(e=(r=n)&&bB(i,n)),e}return s._value=t,s}function AB(i,t){var e="attr."+i;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var r=al(i);return this.tween(e,(r.local?EB:TB)(r,t))}function SB(i,t){return function(){Jd(this,i).delay=+t.apply(this,arguments)}}function IB(i,t){return t=+t,function(){Jd(this,i).delay=t}}function CB(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?SB:IB)(t,i)):mi(this.node(),t).delay}function RB(i,t){return function(){Di(this,i).duration=+t.apply(this,arguments)}}function MB(i,t){return t=+t,function(){Di(this,i).duration=t}}function PB(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?RB:MB)(t,i)):mi(this.node(),t).duration}function NB(i,t){if(typeof t!="function")throw new Error;return function(){Di(this,i).ease=t}}function OB(i){var t=this._id;return arguments.length?this.each(NB(t,i)):mi(this.node(),t).ease}function BB(i,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;Di(this,i).ease=e}}function FB(i){if(typeof i!="function")throw new Error;return this.each(BB(this._id,i))}function DB(i){typeof i!="function"&&(i=Tv(i));for(var t=this._groups,e=t.length,r=new Array(e),s=0;s<e;++s)for(var n=t[s],o=n.length,a=r[s]=[],h,l=0;l<o;++l)(h=n[l])&&i.call(h,h.__data__,l,n)&&a.push(h);return new nr(r,this._parents,this._name,this._id)}function LB(i){if(i._id!==this._id)throw new Error;for(var t=this._groups,e=i._groups,r=t.length,s=e.length,n=Math.min(r,s),o=new Array(r),a=0;a<n;++a)for(var h=t[a],l=e[a],u=h.length,d=o[a]=new Array(u),c,f=0;f<u;++f)(c=h[f]||l[f])&&(d[f]=c);for(;a<r;++a)o[a]=t[a];return new nr(o,this._parents,this._name,this._id)}function kB(i){return(i+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function UB(i,t,e){var r,s,n=kB(t)?Jd:Di;return function(){var o=n(this,i),a=o.on;a!==r&&(s=(r=a).copy()).on(t,e),o.on=s}}function GB(i,t){var e=this._id;return arguments.length<2?mi(this.node(),e).on.on(i):this.each(UB(e,i,t))}function $B(i){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==i)return;t&&t.removeChild(this)}}function HB(){return this.on("end.remove",$B(this._id))}function XB(i){var t=this._name,e=this._id;typeof i!="function"&&(i=Vd(i));for(var r=this._groups,s=r.length,n=new Array(s),o=0;o<s;++o)for(var a=r[o],h=a.length,l=n[o]=new Array(h),u,d,c=0;c<h;++c)(u=a[c])&&(d=i.call(u,u.__data__,c,a))&&("__data__"in u&&(d.__data__=u.__data__),l[c]=d,ll(l[c],t,e,c,l,mi(u,e)));return new nr(n,this._parents,t,e)}function zB(i){var t=this._name,e=this._id;typeof i!="function"&&(i=Ev(i));for(var r=this._groups,s=r.length,n=[],o=[],a=0;a<s;++a)for(var h=r[a],l=h.length,u,d=0;d<l;++d)if(u=h[d]){for(var c=i.call(u,u.__data__,d,h),f,p=mi(u,e),m=0,g=c.length;m<g;++m)(f=c[m])&&ll(f,t,e,m,c,p);n.push(c),o.push(u)}return new nr(n,o,t,e)}var VB=Po.prototype.constructor;function WB(){return new VB(this._groups,this._parents)}function jB(i,t){var e,r,s;return function(){var n=fn(this,i),o=(this.style.removeProperty(i),fn(this,i));return n===o?null:n===e&&o===r?s:s=t(e=n,r=o)}}function Xv(i){return function(){this.style.removeProperty(i)}}function YB(i,t,e){var r,s=e+"",n;return function(){var o=fn(this,i);return o===s?null:o===r?n:n=t(r=o,e)}}function qB(i,t,e){var r,s,n;return function(){var o=fn(this,i),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(i),fn(this,i))),o===h?null:o===r&&h===s?n:(s=h,n=t(r=o,a))}}function KB(i,t){var e,r,s,n="style."+t,o="end."+n,a;return function(){var h=Di(this,i),l=h.on,u=h.value[n]==null?a||(a=Xv(t)):void 0;(l!==e||s!==u)&&(r=(e=l).copy()).on(o,s=u),h.on=r}}function ZB(i,t,e){var r=(i+="")=="transform"?tB:Hv;return t==null?this.styleTween(i,jB(i,r)).on("end.style."+i,Xv(i)):typeof t=="function"?this.styleTween(i,qB(i,r,tf(this,"style."+i,t))).each(KB(this._id,i)):this.styleTween(i,YB(i,r,t),e).on("end.style."+i,null)}function QB(i,t,e){return function(r){this.style.setProperty(i,t.call(this,r),e)}}function JB(i,t,e){var r,s;function n(){var o=t.apply(this,arguments);return o!==s&&(r=(s=o)&&QB(i,o,e)),r}return n._value=t,n}function tF(i,t,e){var r="style."+(i+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,JB(i,t,e??""))}function eF(i){return function(){this.textContent=i}}function iF(i){return function(){var t=i(this);this.textContent=t??""}}function rF(i){return this.tween("text",typeof i=="function"?iF(tf(this,"text",i)):eF(i==null?"":i+""))}function sF(i){return function(t){this.textContent=i.call(this,t)}}function nF(i){var t,e;function r(){var s=i.apply(this,arguments);return s!==e&&(t=(e=s)&&sF(s)),t}return r._value=i,r}function oF(i){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(i==null)return this.tween(t,null);if(typeof i!="function")throw new Error;return this.tween(t,nF(i))}function aF(){for(var i=this._name,t=this._id,e=zv(),r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,h,l=0;l<a;++l)if(h=o[l]){var u=mi(h,t);ll(h,i,e,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new nr(r,this._parents,i,e)}function hF(){var i,t,e=this,r=e._id,s=e.size();return new Promise(function(n,o){var a={value:o},h={value:function(){--s===0&&n()}};e.each(function(){var l=Di(this,r),u=l.on;u!==i&&(t=(i=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),l.on=t}),s===0&&n()})}var lF=0;function nr(i,t,e,r){this._groups=i,this._parents=t,this._name=e,this._id=r}function zv(){return++lF}var Xi=Po.prototype;nr.prototype={constructor:nr,select:XB,selectAll:zB,selectChild:Xi.selectChild,selectChildren:Xi.selectChildren,filter:DB,merge:LB,selection:WB,transition:aF,call:Xi.call,nodes:Xi.nodes,node:Xi.node,size:Xi.size,empty:Xi.empty,each:Xi.each,on:GB,attr:xB,attrTween:AB,style:ZB,styleTween:tF,text:rF,textTween:oF,remove:HB,tween:fB,delay:CB,duration:PB,ease:OB,easeVarying:FB,end:hF,[Symbol.iterator]:Xi[Symbol.iterator]};function uF(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var cF={time:null,delay:0,duration:250,ease:uF};function dF(i,t){for(var e;!(e=i.__transition)||!(e=e[t]);)if(!(i=i.parentNode))throw new Error(`transition ${t} not found`);return e}function fF(i){var t,e;i instanceof nr?(t=i._id,i=i._name):(t=zv(),(e=cF).time=Zd(),i=i==null?null:i+"");for(var r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,h,l=0;l<a;++l)(h=o[l])&&ll(h,i,t,l,o,e||dF(h,t));return new nr(r,this._parents,i,t)}Po.prototype.interrupt=uB;Po.prototype.transition=fF;function pF(i){const t=+this._x.call(null,i),e=+this._y.call(null,i);return Vv(this.cover(t,e),t,e,i)}function Vv(i,t,e,r){if(isNaN(t)||isNaN(e))return i;var s,n=i._root,o={data:r},a=i._x0,h=i._y0,l=i._x1,u=i._y1,d,c,f,p,m,g,y,_;if(!n)return i._root=o,i;for(;n.length;)if((m=t>=(d=(a+l)/2))?a=d:l=d,(g=e>=(c=(h+u)/2))?h=c:u=c,s=n,!(n=n[y=g<<1|m]))return s[y]=o,i;if(f=+i._x.call(null,n.data),p=+i._y.call(null,n.data),t===f&&e===p)return o.next=n,s?s[y]=o:i._root=o,i;do s=s?s[y]=new Array(4):i._root=new Array(4),(m=t>=(d=(a+l)/2))?a=d:l=d,(g=e>=(c=(h+u)/2))?h=c:u=c;while((y=g<<1|m)===(_=(p>=c)<<1|f>=d));return s[_]=n,s[y]=o,i}function mF(i){var t,e,r=i.length,s,n,o=new Array(r),a=new Array(r),h=1/0,l=1/0,u=-1/0,d=-1/0;for(e=0;e<r;++e)isNaN(s=+this._x.call(null,t=i[e]))||isNaN(n=+this._y.call(null,t))||(o[e]=s,a[e]=n,s<h&&(h=s),s>u&&(u=s),n<l&&(l=n),n>d&&(d=n));if(h>u||l>d)return this;for(this.cover(h,l).cover(u,d),e=0;e<r;++e)Vv(this,o[e],a[e],i[e]);return this}function gF(i,t){if(isNaN(i=+i)||isNaN(t=+t))return this;var e=this._x0,r=this._y0,s=this._x1,n=this._y1;if(isNaN(e))s=(e=Math.floor(i))+1,n=(r=Math.floor(t))+1;else{for(var o=s-e||1,a=this._root,h,l;e>i||i>=s||r>t||t>=n;)switch(l=(t<r)<<1|i<e,h=new Array(4),h[l]=a,a=h,o*=2,l){case 0:s=e+o,n=r+o;break;case 1:e=s-o,n=r+o;break;case 2:s=e+o,r=n-o;break;case 3:e=s-o,r=n-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=r,this._x1=s,this._y1=n,this}function yF(){var i=[];return this.visit(function(t){if(!t.length)do i.push(t.data);while(t=t.next)}),i}function _F(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Be(i,t,e,r,s){this.node=i,this.x0=t,this.y0=e,this.x1=r,this.y1=s}function vF(i,t,e){var r,s=this._x0,n=this._y0,o,a,h,l,u=this._x1,d=this._y1,c=[],f=this._root,p,m;for(f&&c.push(new Be(f,s,n,u,d)),e==null?e=1/0:(s=i-e,n=t-e,u=i+e,d=t+e,e*=e);p=c.pop();)if(!(!(f=p.node)||(o=p.x0)>u||(a=p.y0)>d||(h=p.x1)<s||(l=p.y1)<n))if(f.length){var g=(o+h)/2,y=(a+l)/2;c.push(new Be(f[3],g,y,h,l),new Be(f[2],o,y,g,l),new Be(f[1],g,a,h,y),new Be(f[0],o,a,g,y)),(m=(t>=y)<<1|i>=g)&&(p=c[c.length-1],c[c.length-1]=c[c.length-1-m],c[c.length-1-m]=p)}else{var _=i-+this._x.call(null,f.data),v=t-+this._y.call(null,f.data),x=_*_+v*v;if(x<e){var b=Math.sqrt(e=x);s=i-b,n=t-b,u=i+b,d=t+b,r=f.data}}return r}function xF(i){if(isNaN(u=+this._x.call(null,i))||isNaN(d=+this._y.call(null,i)))return this;var t,e=this._root,r,s,n,o=this._x0,a=this._y0,h=this._x1,l=this._y1,u,d,c,f,p,m,g,y;if(!e)return this;if(e.length)for(;;){if((p=u>=(c=(o+h)/2))?o=c:h=c,(m=d>=(f=(a+l)/2))?a=f:l=f,t=e,!(e=e[g=m<<1|p]))return this;if(!e.length)break;(t[g+1&3]||t[g+2&3]||t[g+3&3])&&(r=t,y=g)}for(;e.data!==i;)if(s=e,!(e=e.next))return this;return(n=e.next)&&delete e.next,s?(n?s.next=n:delete s.next,this):t?(n?t[g]=n:delete t[g],(e=t[0]||t[1]||t[2]||t[3])&&e===(t[3]||t[2]||t[1]||t[0])&&!e.length&&(r?r[y]=e:this._root=e),this):(this._root=n,this)}function bF(i){for(var t=0,e=i.length;t<e;++t)this.remove(i[t]);return this}function wF(){return this._root}function EF(){var i=0;return this.visit(function(t){if(!t.length)do++i;while(t=t.next)}),i}function TF(i){var t=[],e,r=this._root,s,n,o,a,h;for(r&&t.push(new Be(r,this._x0,this._y0,this._x1,this._y1));e=t.pop();)if(!i(r=e.node,n=e.x0,o=e.y0,a=e.x1,h=e.y1)&&r.length){var l=(n+a)/2,u=(o+h)/2;(s=r[3])&&t.push(new Be(s,l,u,a,h)),(s=r[2])&&t.push(new Be(s,n,u,l,h)),(s=r[1])&&t.push(new Be(s,l,o,a,u)),(s=r[0])&&t.push(new Be(s,n,o,l,u))}return this}function AF(i){var t=[],e=[],r;for(this._root&&t.push(new Be(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var s=r.node;if(s.length){var n,o=r.x0,a=r.y0,h=r.x1,l=r.y1,u=(o+h)/2,d=(a+l)/2;(n=s[0])&&t.push(new Be(n,o,a,u,d)),(n=s[1])&&t.push(new Be(n,u,a,h,d)),(n=s[2])&&t.push(new Be(n,o,d,u,l)),(n=s[3])&&t.push(new Be(n,u,d,h,l))}e.push(r)}for(;r=e.pop();)i(r.node,r.x0,r.y0,r.x1,r.y1);return this}function SF(i){return i[0]}function IF(i){return arguments.length?(this._x=i,this):this._x}function CF(i){return i[1]}function RF(i){return arguments.length?(this._y=i,this):this._y}function ef(i,t,e){var r=new rf(t??SF,e??CF,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function rf(i,t,e,r,s,n){this._x=i,this._y=t,this._x0=e,this._y0=r,this._x1=s,this._y1=n,this._root=void 0}function ry(i){for(var t={data:i.data},e=t;i=i.next;)e=e.next={data:i.data};return t}var ke=ef.prototype=rf.prototype;ke.copy=function(){var i=new rf(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,e,r;if(!t)return i;if(!t.length)return i._root=ry(t),i;for(e=[{source:t,target:i._root=new Array(4)}];t=e.pop();)for(var s=0;s<4;++s)(r=t.source[s])&&(r.length?e.push({source:r,target:t.target[s]=new Array(4)}):t.target[s]=ry(r));return i};ke.add=pF;ke.addAll=mF;ke.cover=gF;ke.data=yF;ke.extent=_F;ke.find=vF;ke.remove=xF;ke.removeAll=bF;ke.root=wF;ke.size=EF;ke.visit=TF;ke.visitAfter=AF;ke.x=IF;ke.y=RF;function De(i){return function(){return i}}function vr(i){return(i()-.5)*1e-6}function MF(i){return i.x+i.vx}function PF(i){return i.y+i.vy}function NF(i){var t,e,r,s=1,n=1;typeof i!="function"&&(i=De(i==null?1:+i));function o(){for(var l,u=t.length,d,c,f,p,m,g,y=0;y<n;++y)for(d=ef(t,MF,PF).visitAfter(a),l=0;l<u;++l)c=t[l],m=e[c.index],g=m*m,f=c.x+c.vx,p=c.y+c.vy,d.visit(_);function _(v,x,b,M,S){var A=v.data,R=v.r,L=m+R;if(A){if(A.index>c.index){var B=f-A.x-A.vx,P=p-A.y-A.vy,E=B*B+P*P;E<L*L&&(B===0&&(B=vr(r),E+=B*B),P===0&&(P=vr(r),E+=P*P),E=(L-(E=Math.sqrt(E)))/E*s,c.vx+=(B*=E)*(L=(R*=R)/(g+R)),c.vy+=(P*=E)*L,A.vx-=B*(L=1-L),A.vy-=P*L)}return}return x>f+L||M<f-L||b>p+L||S<p-L}}function a(l){if(l.data)return l.r=e[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function h(){if(t){var l,u=t.length,d;for(e=new Array(u),l=0;l<u;++l)d=t[l],e[d.index]=+i(d,l,t)}}return o.initialize=function(l,u){t=l,r=u,h()},o.iterations=function(l){return arguments.length?(n=+l,o):n},o.strength=function(l){return arguments.length?(s=+l,o):s},o.radius=function(l){return arguments.length?(i=typeof l=="function"?l:De(+l),h(),o):i},o}function OF(i){return i.index}function sy(i,t){var e=i.get(t);if(!e)throw new Error("node not found: "+t);return e}function BF(i){var t=OF,e=d,r,s=De(30),n,o,a,h,l,u=1;i==null&&(i=[]);function d(g){return 1/Math.min(a[g.source.index],a[g.target.index])}function c(g){for(var y=0,_=i.length;y<u;++y)for(var v=0,x,b,M,S,A,R,L;v<_;++v)x=i[v],b=x.source,M=x.target,S=M.x+M.vx-b.x-b.vx||vr(l),A=M.y+M.vy-b.y-b.vy||vr(l),R=Math.sqrt(S*S+A*A),R=(R-n[v])/R*g*r[v],S*=R,A*=R,M.vx-=S*(L=h[v]),M.vy-=A*L,b.vx+=S*(L=1-L),b.vy+=A*L}function f(){if(o){var g,y=o.length,_=i.length,v=new Map(o.map((b,M)=>[t(b,M,o),b])),x;for(g=0,a=new Array(y);g<_;++g)x=i[g],x.index=g,typeof x.source!="object"&&(x.source=sy(v,x.source)),typeof x.target!="object"&&(x.target=sy(v,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(g=0,h=new Array(_);g<_;++g)x=i[g],h[g]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);r=new Array(_),p(),n=new Array(_),m()}}function p(){if(o)for(var g=0,y=i.length;g<y;++g)r[g]=+e(i[g],g,i)}function m(){if(o)for(var g=0,y=i.length;g<y;++g)n[g]=+s(i[g],g,i)}return c.initialize=function(g,y){o=g,l=y,f()},c.links=function(g){return arguments.length?(i=g,f(),c):i},c.id=function(g){return arguments.length?(t=g,c):t},c.iterations=function(g){return arguments.length?(u=+g,c):u},c.strength=function(g){return arguments.length?(e=typeof g=="function"?g:De(+g),p(),c):e},c.distance=function(g){return arguments.length?(s=typeof g=="function"?g:De(+g),m(),c):s},c}const FF=1664525,DF=1013904223,ny=4294967296;function LF(){let i=1;return()=>(i=(FF*i+DF)%ny)/ny}function kF(i){return i.x}function UF(i){return i.y}var GF=10,$F=Math.PI*(3-Math.sqrt(5));function HF(i){var t,e=1,r=.001,s=1-Math.pow(r,1/300),n=0,o=.6,a=new Map,h=Qd(d),l=zd("tick","end"),u=LF();i==null&&(i=[]);function d(){c(),l.call("tick",t),e<r&&(h.stop(),l.call("end",t))}function c(m){var g,y=i.length,_;m===void 0&&(m=1);for(var v=0;v<m;++v)for(e+=(n-e)*s,a.forEach(function(x){x(e)}),g=0;g<y;++g)_=i[g],_.fx==null?_.x+=_.vx*=o:(_.x=_.fx,_.vx=0),_.fy==null?_.y+=_.vy*=o:(_.y=_.fy,_.vy=0);return t}function f(){for(var m=0,g=i.length,y;m<g;++m){if(y=i[m],y.index=m,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var _=GF*Math.sqrt(.5+m),v=m*$F;y.x=_*Math.cos(v),y.y=_*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(m){return m.initialize&&m.initialize(i,u),m}return f(),t={tick:c,restart:function(){return h.restart(d),t},stop:function(){return h.stop(),t},nodes:function(m){return arguments.length?(i=m,f(),a.forEach(p),t):i},alpha:function(m){return arguments.length?(e=+m,t):e},alphaMin:function(m){return arguments.length?(r=+m,t):r},alphaDecay:function(m){return arguments.length?(s=+m,t):+s},alphaTarget:function(m){return arguments.length?(n=+m,t):n},velocityDecay:function(m){return arguments.length?(o=1-m,t):1-o},randomSource:function(m){return arguments.length?(u=m,a.forEach(p),t):u},force:function(m,g){return arguments.length>1?(g==null?a.delete(m):a.set(m,p(g)),t):a.get(m)},find:function(m,g,y){var _=0,v=i.length,x,b,M,S,A;for(y==null?y=1/0:y*=y,_=0;_<v;++_)S=i[_],x=m-S.x,b=g-S.y,M=x*x+b*b,M<y&&(A=S,y=M);return A},on:function(m,g){return arguments.length>1?(l.on(m,g),t):l.on(m)}}}function XF(){var i,t,e,r,s=De(-30),n,o=1,a=1/0,h=.81;function l(f){var p,m=i.length,g=ef(i,kF,UF).visitAfter(d);for(r=f,p=0;p<m;++p)t=i[p],g.visit(c)}function u(){if(i){var f,p=i.length,m;for(n=new Array(p),f=0;f<p;++f)m=i[f],n[m.index]=+s(m,f,i)}}function d(f){var p=0,m,g,y=0,_,v,x;if(f.length){for(_=v=x=0;x<4;++x)(m=f[x])&&(g=Math.abs(m.value))&&(p+=m.value,y+=g,_+=g*m.x,v+=g*m.y);f.x=_/y,f.y=v/y}else{m=f,m.x=m.data.x,m.y=m.data.y;do p+=n[m.data.index];while(m=m.next)}f.value=p}function c(f,p,m,g){if(!f.value)return!0;var y=f.x-t.x,_=f.y-t.y,v=g-p,x=y*y+_*_;if(v*v/h<x)return x<a&&(y===0&&(y=vr(e),x+=y*y),_===0&&(_=vr(e),x+=_*_),x<o&&(x=Math.sqrt(o*x)),t.vx+=y*f.value*r/x,t.vy+=_*f.value*r/x),!0;if(f.length||x>=a)return;(f.data!==t||f.next)&&(y===0&&(y=vr(e),x+=y*y),_===0&&(_=vr(e),x+=_*_),x<o&&(x=Math.sqrt(o*x)));do f.data!==t&&(v=n[f.data.index]*r/x,t.vx+=y*v,t.vy+=_*v);while(f=f.next)}return l.initialize=function(f,p){i=f,e=p,u()},l.strength=function(f){return arguments.length?(s=typeof f=="function"?f:De(+f),u(),l):s},l.distanceMin=function(f){return arguments.length?(o=f*f,l):Math.sqrt(o)},l.distanceMax=function(f){return arguments.length?(a=f*f,l):Math.sqrt(a)},l.theta=function(f){return arguments.length?(h=f*f,l):Math.sqrt(h)},l}function zF(i){var t=De(.1),e,r,s;typeof i!="function"&&(i=De(i==null?0:+i));function n(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vx+=(s[h]-u.x)*r[h]*a}function o(){if(e){var a,h=e.length;for(r=new Array(h),s=new Array(h),a=0;a<h;++a)r[a]=isNaN(s[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return n.initialize=function(a){e=a,o()},n.strength=function(a){return arguments.length?(t=typeof a=="function"?a:De(+a),o(),n):t},n.x=function(a){return arguments.length?(i=typeof a=="function"?a:De(+a),o(),n):i},n}function VF(i){var t=De(.1),e,r,s;typeof i!="function"&&(i=De(i==null?0:+i));function n(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vy+=(s[h]-u.y)*r[h]*a}function o(){if(e){var a,h=e.length;for(r=new Array(h),s=new Array(h),a=0;a<h;++a)r[a]=isNaN(s[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return n.initialize=function(a){e=a,o()},n.strength=function(a){return arguments.length?(t=typeof a=="function"?a:De(+a),o(),n):t},n.y=function(a){return arguments.length?(i=typeof a=="function"?a:De(+a),o(),n):i},n}function WF(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Lh(i,t){if((e=(i=t?i.toExponential(t-1):i.toExponential()).indexOf("e"))<0)return null;var e,r=i.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+i.slice(e+1)]}function mn(i){return i=Lh(Math.abs(i)),i?i[1]:NaN}function jF(i,t){return function(e,r){for(var s=e.length,n=[],o=0,a=i[0],h=0;s>0&&a>0&&(h+a+1>r&&(a=Math.max(1,r-h)),n.push(e.substring(s-=a,s+a)),!((h+=a+1)>r));)a=i[o=(o+1)%i.length];return n.reverse().join(t)}}function YF(i){return function(t){return t.replace(/[0-9]/g,function(e){return i[+e]})}}var qF=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function kh(i){if(!(t=qF.exec(i)))throw new Error("invalid format: "+i);var t;return new sf({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}kh.prototype=sf.prototype;function sf(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}sf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function KF(i){t:for(var t=i.length,e=1,r=-1,s;e<t;++e)switch(i[e]){case".":r=s=e;break;case"0":r===0&&(r=e),s=e;break;default:if(!+i[e])break t;r>0&&(r=0);break}return r>0?i.slice(0,r)+i.slice(s+1):i}var Wv;function ZF(i,t){var e=Lh(i,t);if(!e)return i+"";var r=e[0],s=e[1],n=s-(Wv=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=r.length;return n===o?r:n>o?r+new Array(n-o+1).join("0"):n>0?r.slice(0,n)+"."+r.slice(n):"0."+new Array(1-n).join("0")+Lh(i,Math.max(0,t+n-1))[0]}function oy(i,t){var e=Lh(i,t);if(!e)return i+"";var r=e[0],s=e[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const ay={"%":(i,t)=>(i*100).toFixed(t),b:i=>Math.round(i).toString(2),c:i=>i+"",d:WF,e:(i,t)=>i.toExponential(t),f:(i,t)=>i.toFixed(t),g:(i,t)=>i.toPrecision(t),o:i=>Math.round(i).toString(8),p:(i,t)=>oy(i*100,t),r:oy,s:ZF,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function hy(i){return i}var ly=Array.prototype.map,uy=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function QF(i){var t=i.grouping===void 0||i.thousands===void 0?hy:jF(ly.call(i.grouping,Number),i.thousands+""),e=i.currency===void 0?"":i.currency[0]+"",r=i.currency===void 0?"":i.currency[1]+"",s=i.decimal===void 0?".":i.decimal+"",n=i.numerals===void 0?hy:YF(ly.call(i.numerals,String)),o=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"":i.minus+"",h=i.nan===void 0?"NaN":i.nan+"";function l(d){d=kh(d);var c=d.fill,f=d.align,p=d.sign,m=d.symbol,g=d.zero,y=d.width,_=d.comma,v=d.precision,x=d.trim,b=d.type;b==="n"?(_=!0,b="g"):ay[b]||(v===void 0&&(v=12),x=!0,b="g"),(g||c==="0"&&f==="=")&&(g=!0,c="0",f="=");var M=m==="$"?e:m==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",S=m==="$"?r:/[%p]/.test(b)?o:"",A=ay[b],R=/[defgprs%]/.test(b);v=v===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function L(B){var P=M,E=S,N,q,Y;if(b==="c")E=A(B)+E,B="";else{B=+B;var et=B<0||1/B<0;if(B=isNaN(B)?h:A(Math.abs(B),v),x&&(B=KF(B)),et&&+B==0&&p!=="+"&&(et=!1),P=(et?p==="("?p:a:p==="-"||p==="("?"":p)+P,E=(b==="s"?uy[8+Wv/3]:"")+E+(et&&p==="("?")":""),R){for(N=-1,q=B.length;++N<q;)if(Y=B.charCodeAt(N),48>Y||Y>57){E=(Y===46?s+B.slice(N+1):B.slice(N))+E,B=B.slice(0,N);break}}}_&&!g&&(B=t(B,1/0));var ut=P.length+B.length+E.length,yt=ut<y?new Array(y-ut+1).join(c):"";switch(_&&g&&(B=t(yt+B,yt.length?y-E.length:1/0),yt=""),f){case"<":B=P+B+E+yt;break;case"=":B=P+yt+B+E;break;case"^":B=yt.slice(0,ut=yt.length>>1)+P+B+E+yt.slice(ut);break;default:B=yt+P+B+E;break}return n(B)}return L.toString=function(){return d+""},L}function u(d,c){var f=l((d=kh(d),d.type="f",d)),p=Math.max(-8,Math.min(8,Math.floor(mn(c)/3)))*3,m=Math.pow(10,-p),g=uy[8+p/3];return function(y){return f(m*y)+g}}return{format:l,formatPrefix:u}}var Ia,jv,Yv;JF({thousands:",",grouping:[3],currency:["$",""]});function JF(i){return Ia=QF(i),jv=Ia.format,Yv=Ia.formatPrefix,Ia}function tD(i){return Math.max(0,-mn(Math.abs(i)))}function eD(i,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(mn(t)/3)))*3-mn(Math.abs(i)))}function iD(i,t){return i=Math.abs(i),t=Math.abs(t)-i,Math.max(0,mn(t)-mn(i))+1}function rD(i){var t=0,e=i.children,r=e&&e.length;if(!r)t=1;else for(;--r>=0;)t+=e[r].value;i.value=t}function sD(){return this.eachAfter(rD)}function nD(i,t){let e=-1;for(const r of this)i.call(t,r,++e,this);return this}function oD(i,t){for(var e=this,r=[e],s,n,o=-1;e=r.pop();)if(i.call(t,e,++o,this),s=e.children)for(n=s.length-1;n>=0;--n)r.push(s[n]);return this}function aD(i,t){for(var e=this,r=[e],s=[],n,o,a,h=-1;e=r.pop();)if(s.push(e),n=e.children)for(o=0,a=n.length;o<a;++o)r.push(n[o]);for(;e=s.pop();)i.call(t,e,++h,this);return this}function hD(i,t){let e=-1;for(const r of this)if(i.call(t,r,++e,this))return r}function lD(i){return this.eachAfter(function(t){for(var e=+i(t.data)||0,r=t.children,s=r&&r.length;--s>=0;)e+=r[s].value;t.value=e})}function uD(i){return this.eachBefore(function(t){t.children&&t.children.sort(i)})}function cD(i){for(var t=this,e=dD(t,i),r=[t];t!==e;)t=t.parent,r.push(t);for(var s=r.length;i!==e;)r.splice(s,0,i),i=i.parent;return r}function dD(i,t){if(i===t)return i;var e=i.ancestors(),r=t.ancestors(),s=null;for(i=e.pop(),t=r.pop();i===t;)s=i,i=e.pop(),t=r.pop();return s}function fD(){for(var i=this,t=[i];i=i.parent;)t.push(i);return t}function pD(){return Array.from(this)}function mD(){var i=[];return this.eachBefore(function(t){t.children||i.push(t)}),i}function gD(){var i=this,t=[];return i.each(function(e){e!==i&&t.push({source:e.parent,target:e})}),t}function*yD(){var i=this,t,e=[i],r,s,n;do for(t=e.reverse(),e=[];i=t.pop();)if(yield i,r=i.children)for(s=0,n=r.length;s<n;++s)e.push(r[s]);while(e.length)}function qv(i,t){i instanceof Map?(i=[void 0,i],t===void 0&&(t=xD)):t===void 0&&(t=vD);for(var e=new Eo(i),r,s=[e],n,o,a,h;r=s.pop();)if((o=t(r.data))&&(h=(o=Array.from(o)).length))for(r.children=o,a=h-1;a>=0;--a)s.push(n=o[a]=new Eo(o[a])),n.parent=r,n.depth=r.depth+1;return e.eachBefore(Kv)}function _D(){return qv(this).eachBefore(bD)}function vD(i){return i.children}function xD(i){return Array.isArray(i)?i[1]:null}function bD(i){i.data.value!==void 0&&(i.value=i.data.value),i.data=i.data.data}function Kv(i){var t=0;do i.height=t;while((i=i.parent)&&i.height<++t)}function Eo(i){this.data=i,this.depth=this.height=0,this.parent=null}Eo.prototype=qv.prototype={constructor:Eo,count:sD,each:nD,eachAfter:aD,eachBefore:oD,find:hD,sum:lD,sort:uD,path:cD,ancestors:fD,descendants:pD,leaves:mD,links:gD,copy:_D,[Symbol.iterator]:yD};function Iu(i){return i==null?null:wD(i)}function wD(i){if(typeof i!="function")throw new Error;return i}var ED={depth:-1},cy={},Cu={};function TD(i){return i.id}function AD(i){return i.parentId}function SD(){var i=TD,t=AD,e;function r(s){var n=Array.from(s),o=i,a=t,h,l,u,d,c,f,p,m,g=new Map;if(e!=null){const y=n.map((x,b)=>ID(e(x,b,s))),_=y.map(dy),v=new Set(y).add("");for(const x of _)v.has(x)||(v.add(x),y.push(x),_.push(dy(x)),n.push(Cu));o=(x,b)=>y[b],a=(x,b)=>_[b]}for(u=0,h=n.length;u<h;++u)l=n[u],f=n[u]=new Eo(l),(p=o(l,u,s))!=null&&(p+="")&&(m=f.id=p,g.set(m,g.has(m)?cy:f)),(p=a(l,u,s))!=null&&(p+="")&&(f.parent=p);for(u=0;u<h;++u)if(f=n[u],p=f.parent){if(c=g.get(p),!c)throw new Error("missing: "+p);if(c===cy)throw new Error("ambiguous: "+p);c.children?c.children.push(f):c.children=[f],f.parent=c}else{if(d)throw new Error("multiple roots");d=f}if(!d)throw new Error("no root");if(e!=null){for(;d.data===Cu&&d.children.length===1;)d=d.children[0],--h;for(let y=n.length-1;y>=0&&(f=n[y],f.data===Cu);--y)f.data=null}if(d.parent=ED,d.eachBefore(function(y){y.depth=y.parent.depth+1,--h}).eachBefore(Kv),d.parent=null,h>0)throw new Error("cycle");return d}return r.id=function(s){return arguments.length?(i=Iu(s),r):i},r.parentId=function(s){return arguments.length?(t=Iu(s),r):t},r.path=function(s){return arguments.length?(e=Iu(s),r):e},r}function ID(i){i=`${i}`;let t=i.length;return dd(i,t-1)&&!dd(i,t-2)&&(i=i.slice(0,-1)),i[0]==="/"?i:`/${i}`}function dy(i){let t=i.length;if(t<2)return"";for(;--t>1&&!dd(i,t););return i.slice(0,t)}function dd(i,t){if(i[t]==="/"){let e=0;for(;t>0&&i[--t]==="\\";)++e;if(!(e&1))return!0}return!1}function Zv(i,t){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(t).domain(i);break}return this}const fy=Symbol("implicit");function Qv(){var i=new id,t=[],e=[],r=fy;function s(n){let o=i.get(n);if(o===void 0){if(r!==fy)return r;i.set(n,o=t.push(n)-1)}return e[o%e.length]}return s.domain=function(n){if(!arguments.length)return t.slice();t=[],i=new id;for(const o of n)i.has(o)||i.set(o,t.push(o)-1);return s},s.range=function(n){return arguments.length?(e=Array.from(n),s):e.slice()},s.unknown=function(n){return arguments.length?(r=n,s):r},s.copy=function(){return Qv(t,e).unknown(r)},Zv.apply(s,arguments),s}function CD(i){return function(){return i}}function RD(i){return+i}var py=[0,1];function xr(i){return i}function fd(i,t){return(t-=i=+i)?function(e){return(e-i)/t}:CD(isNaN(t)?NaN:.5)}function MD(i,t){var e;return i>t&&(e=i,i=t,t=e),function(r){return Math.max(i,Math.min(t,r))}}function PD(i,t,e){var r=i[0],s=i[1],n=t[0],o=t[1];return s<r?(r=fd(s,r),n=e(o,n)):(r=fd(r,s),n=e(n,o)),function(a){return n(r(a))}}function ND(i,t,e){var r=Math.min(i.length,t.length)-1,s=new Array(r),n=new Array(r),o=-1;for(i[r]<i[0]&&(i=i.slice().reverse(),t=t.slice().reverse());++o<r;)s[o]=fd(i[o],i[o+1]),n[o]=e(t[o],t[o+1]);return function(a){var h=NP(i,a,1,r)-1;return n[h](s[h](a))}}function OD(i,t){return t.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function BD(){var i=py,t=py,e=Kd,r,s,n,o=xr,a,h,l;function u(){var c=Math.min(i.length,t.length);return o!==xr&&(o=MD(i[0],i[c-1])),a=c>2?ND:PD,h=l=null,d}function d(c){return c==null||isNaN(c=+c)?n:(h||(h=a(i.map(r),t,e)))(r(o(c)))}return d.invert=function(c){return o(s((l||(l=a(t,i.map(r),li)))(c)))},d.domain=function(c){return arguments.length?(i=Array.from(c,RD),u()):i.slice()},d.range=function(c){return arguments.length?(t=Array.from(c),u()):t.slice()},d.rangeRound=function(c){return t=Array.from(c),e=ZO,u()},d.clamp=function(c){return arguments.length?(o=c?!0:xr,u()):o!==xr},d.interpolate=function(c){return arguments.length?(e=c,u()):e},d.unknown=function(c){return arguments.length?(n=c,d):n},function(c,f){return r=c,s=f,u()}}function FD(i,t,e,r){var s=jP(i,t,e),n;switch(r=kh(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(i),Math.abs(t));return r.precision==null&&!isNaN(n=eD(s,o))&&(r.precision=n),Yv(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(n=iD(s,Math.max(Math.abs(i),Math.abs(t))))&&(r.precision=n-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(n=tD(s))&&(r.precision=n-(r.type==="%")*2);break}}return jv(r)}function DD(i){var t=i.domain;return i.ticks=function(e){var r=t();return WP(r[0],r[r.length-1],e??10)},i.tickFormat=function(e,r){var s=t();return FD(s[0],s[s.length-1],e??10,r)},i.nice=function(e){e==null&&(e=10);var r=t(),s=0,n=r.length-1,o=r[s],a=r[n],h,l,u=10;for(a<o&&(l=o,o=a,a=l,l=s,s=n,n=l);u-- >0;){if(l=sd(o,a,e),l===h)return r[s]=o,r[n]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;h=l}return i},i}function my(i){return function(t){return t<0?-Math.pow(-t,i):Math.pow(t,i)}}function LD(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function kD(i){return i<0?-i*i:i*i}function UD(i){var t=i(xr,xr),e=1;function r(){return e===1?i(xr,xr):e===.5?i(LD,kD):i(my(e),my(1/e))}return t.exponent=function(s){return arguments.length?(e=+s,r()):e},DD(t)}function Jv(){var i=UD(BD());return i.copy=function(){return OD(i,Jv()).exponent(i.exponent())},Zv.apply(i,arguments),i}function GD(){return Jv.apply(null,arguments).exponent(.5)}function $D(i){for(var t=i.length/6|0,e=new Array(t),r=0;r<t;)e[r]="#"+i.slice(r*6,++r*6);return e}const HD=$D("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function eo(i,t,e){this.k=i,this.x=t,this.y=e}eo.prototype={constructor:eo,scale:function(i){return i===1?this:new eo(this.k*i,this.x,this.y)},translate:function(i,t){return i===0&t===0?this:new eo(this.k,this.x+this.k*i,this.y+this.k*t)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};eo.prototype;var nf={},of=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"},xn={},ul={};ul.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";ul.SYMBOL_SUPPORT=typeof Symbol<"u";var tx=ul,XD=tx.ARRAY_BUFFER_SUPPORT,zD=tx.SYMBOL_SUPPORT,af=function(t,e){var r,s,n,o,a;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||XD&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(n=0,o=t.length;n<o;n++)e(t[n],n);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(zD&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(r=t,n=0;a=r.next(),a.done!==!0;)e(a.value,n),n++;return}for(s in t)t.hasOwnProperty(s)&&e(t[s],s)},ex={};(function(i){var t=Math.pow(2,8)-1,e=Math.pow(2,16)-1,r=Math.pow(2,32)-1,s=Math.pow(2,7)-1,n=Math.pow(2,15)-1,o=Math.pow(2,31)-1;i.getPointerArray=function(h){var l=h-1;if(l<=t)return Uint8Array;if(l<=e)return Uint16Array;if(l<=r)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},i.getSignedPointerArray=function(h){var l=h-1;return l<=s?Int8Array:l<=n?Int16Array:l<=o?Int32Array:Float64Array},i.getNumberType=function(h){return h===(h|0)?Math.sign(h)===-1?h<=127&&h>=-128?Int8Array:h<=32767&&h>=-32768?Int16Array:Int32Array:h<=255?Uint8Array:h<=65535?Uint16Array:Uint32Array:Float64Array};var a={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};i.getMinimalRepresentation=function(h,l){var u=null,d=0,c,f,p,m,g;for(m=0,g=h.length;m<g;m++)p=l?l(h[m]):h[m],f=i.getNumberType(p),c=a[f.name],c>d&&(d=c,u=f);return u},i.isTypedArray=function(h){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(h)},i.concat=function(){var h=0,l,u,d;for(l=0,d=arguments.length;l<d;l++)h+=arguments[l].length;var c=new arguments[0].constructor(h);for(l=0,u=0;l<d;l++)c.set(arguments[l],u),u+=arguments[l].length;return c},i.indices=function(h){for(var l=i.getPointerArray(h),u=new l(h),d=0;d<h;d++)u[d]=d;return u}})(ex);var ix=af,rx=ex;function VD(i){return Array.isArray(i)||rx.isTypedArray(i)}function hf(i){if(typeof i.length=="number")return i.length;if(typeof i.size=="number")return i.size}function WD(i){var t=hf(i),e=typeof t=="number"?new Array(t):[],r=0;return ix(i,function(s){e[r++]=s}),e}function jD(i){var t=hf(i),e=typeof t=="number"?rx.getPointerArray(t):Array,r=typeof t=="number"?new Array(t):[],s=typeof t=="number"?new e(t):[],n=0;return ix(i,function(o){r[n]=o,s[n]=n++}),[r,s]}xn.isArrayLike=VD;xn.guessLength=hf;xn.toArray=WD;xn.toArrayWithIndices=jD;function Fi(i){if(typeof i!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=i}typeof Symbol<"u"&&(Fi.prototype[Symbol.iterator]=function(){return this});Fi.of=function(){var i=arguments,t=i.length,e=0;return new Fi(function(){return e>=t?{done:!0}:{done:!1,value:i[e++]}})};Fi.empty=function(){var i=new Fi(function(){return{done:!0}});return i};Fi.fromSequence=function(i){var t=0,e=i.length;return new Fi(function(){return t>=e?{done:!0}:{done:!1,value:i[t++]}})};Fi.is=function(i){return i instanceof Fi?!0:typeof i=="object"&&i!==null&&typeof i.next=="function"};var Oo=Fi;const ei=Jh(Oo);var Ru=xn,sx=Oo;function ae(i,t){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=i,this.capacity=t,this.items=new i(this.capacity),this.clear()}ae.prototype.clear=function(){this.start=0,this.size=0};ae.prototype.push=function(i){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var t=(this.start+this.size)%this.capacity;return this.items[t]=i,++this.size};ae.prototype.unshift=function(i){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=i,this.start=t,++this.size};ae.prototype.pop=function(){if(this.size===0)return;const i=(this.start+this.size-1)%this.capacity;return this.size--,this.items[i]};ae.prototype.shift=function(){if(this.size!==0){var i=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[i]}};ae.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};ae.prototype.peekLast=function(){if(this.size!==0){var i=this.start+this.size-1;return i>this.capacity&&(i-=this.capacity),this.items[i]}};ae.prototype.get=function(i){if(this.size!==0)return i=this.start+i,i>this.capacity&&(i-=this.capacity),this.items[i]};ae.prototype.forEach=function(i,t){t=arguments.length>1?t:this;for(var e=this.capacity,r=this.size,s=this.start,n=0;n<r;)i.call(t,this.items[s],n,this),s++,n++,s===e&&(s=0)};ae.prototype.toArray=function(){var i=this.start+this.size;if(i<this.capacity)return this.items.slice(this.start,i);for(var t=new this.ArrayClass(this.size),e=this.capacity,r=this.size,s=this.start,n=0;n<r;)t[n]=this.items[s],s++,n++,s===e&&(s=0);return t};ae.prototype.values=function(){var i=this.items,t=this.capacity,e=this.size,r=this.start,s=0;return new sx(function(){if(s>=e)return{done:!0};var n=i[r];return r++,s++,r===t&&(r=0),{value:n,done:!1}})};ae.prototype.entries=function(){var i=this.items,t=this.capacity,e=this.size,r=this.start,s=0;return new sx(function(){if(s>=e)return{done:!0};var n=i[r];return r++,r===t&&(r=0),{value:[s++,n],done:!1}})};typeof Symbol<"u"&&(ae.prototype[Symbol.iterator]=ae.prototype.values);ae.prototype.inspect=function(){var i=this.toArray();return i.type=this.ArrayClass.name,i.capacity=this.capacity,Object.defineProperty(i,"constructor",{value:ae,enumerable:!1}),i};typeof Symbol<"u"&&(ae.prototype[Symbol.for("nodejs.util.inspect.custom")]=ae.prototype.inspect);ae.from=function(i,t,e){if(arguments.length<3&&(e=Ru.guessLength(i),typeof e!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var r=new ae(t,e);if(Ru.isArrayLike(i)){var s,n;for(s=0,n=i.length;s<n;s++)r.items[s]=i[s];return r.size=n,r}return Ru.forEach(i,function(o){r.push(o)}),r};var YD=ae,qD=YD;function Cr(i){this.graph=i,this.queue=new qD(Array,i.order),this.seen=new Set,this.size=0}Cr.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};Cr.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};Cr.prototype.forEachNodeYetUnseen=function(i){var t=this.seen,e=this.graph;e.someNode(function(r,s){if(t.size===e.order)return!0;if(t.has(r))return!1;var n=i(r,s);return!!n})};Cr.prototype.has=function(i){return this.seen.has(i)};Cr.prototype.push=function(i){var t=this.seen.size;return this.seen.add(i),t===this.seen.size?!1:(this.queue.push(i),this.size++,!0)};Cr.prototype.pushWith=function(i,t){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.queue.push(t),this.size++,!0)};Cr.prototype.shift=function(){var i=this.queue.shift();return this.size=this.queue.size,i};var KD=Cr,lf={};function ZD(i,t,e){this.node=i,this.attributes=t,this.depth=e}function QD(i){return i[0].toUpperCase()+i.slice(1)}lf.TraversalRecord=ZD;lf.capitalize=QD;var JD=of,tL=KD,nx=lf,gy=nx.TraversalRecord,eL=nx.capitalize;function ox(i,t,e,r){if(r=r||{},!JD(i))throw new Error("graphology-traversal/bfs: expecting a graphology instance.");if(typeof e!="function")throw new Error("graphology-traversal/bfs: given callback is not a function.");if(i.order===0)return;var s=new tL(i),n=i["forEach"+eL(r.mode||"outbound")+"Neighbor"].bind(i),o;t===null?o=s.forEachNodeYetUnseen.bind(s):o=function(u){t=""+t,u(t,i.getNodeAttributes(t))};var a,h;function l(u,d){s.pushWith(u,new gy(u,d,a.depth+1))}o(function(u,d){for(s.pushWith(u,new gy(u,d,0));s.size!==0;)a=s.shift(),h=e(a.node,a.attributes,a.depth),h!==!0&&n(a.node,l)})}nf.bfs=function(i,t,e){return ox(i,null,t,e)};nf.bfsFromNode=ox;function xs(i){this.graph=i,this.stack=new Array(i.order),this.seen=new Set,this.size=0}xs.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};xs.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};xs.prototype.forEachNodeYetUnseen=function(i){var t=this.seen,e=this.graph;e.someNode(function(r,s){if(t.size===e.order)return!0;if(t.has(r))return!1;var n=i(r,s);return!!n})};xs.prototype.has=function(i){return this.seen.has(i)};xs.prototype.push=function(i){var t=this.seen.size;return this.seen.add(i),t===this.seen.size?!1:(this.stack[this.size++]=i,!0)};xs.prototype.pushWith=function(i,t){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.stack[this.size++]=t,!0)};xs.prototype.pop=function(){if(this.size!==0)return this.stack[--this.size]};var iL=nf,yy=iL.bfsFromNode,bn={},ax=Oo,rL=af;function he(){this.clear()}he.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};he.prototype.enqueue=function(i){return this.items.push(i),++this.size};he.prototype.dequeue=function(){if(this.size){var i=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,i}};he.prototype.peek=function(){if(this.size)return this.items[this.offset]};he.prototype.forEach=function(i,t){t=arguments.length>1?t:this;for(var e=this.offset,r=0,s=this.items.length;e<s;e++,r++)i.call(t,this.items[e],r,this)};he.prototype.toArray=function(){return this.items.slice(this.offset)};he.prototype.values=function(){var i=this.items,t=this.offset;return new ax(function(){if(t>=i.length)return{done:!0};var e=i[t];return t++,{value:e,done:!1}})};he.prototype.entries=function(){var i=this.items,t=this.offset,e=0;return new ax(function(){if(t>=i.length)return{done:!0};var r=i[t];return t++,{value:[e++,r],done:!1}})};typeof Symbol<"u"&&(he.prototype[Symbol.iterator]=he.prototype.values);he.prototype.toString=function(){return this.toArray().join(",")};he.prototype.toJSON=function(){return this.toArray()};he.prototype.inspect=function(){var i=this.toArray();return Object.defineProperty(i,"constructor",{value:he,enumerable:!1}),i};typeof Symbol<"u"&&(he.prototype[Symbol.for("nodejs.util.inspect.custom")]=he.prototype.inspect);he.from=function(i){var t=new he;return rL(i,function(e){t.enqueue(e)}),t};he.of=function(){return he.from(arguments)};var sL=he,nL=function(t,e){var r=e.length;if(r!==0){var s=t.length;t.length+=r;for(var n=0;n<r;n++)t[s+n]=e[n]}},uf=of,oL=sL,aL=nL;function hL(i,t,e){if(!uf(i))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<3)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 3.");if(!i.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');if(!i.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" target node does not exist in the given graph.');if(t=""+t,e=""+e,t===e)return[t];var r=i.inboundNeighbors.bind(i),s=i.outboundNeighbors.bind(i),n={},o={};n[t]=null,o[e]=null;var a=[t],h=[e],l,u,d,c,f,p,m,g,y=!1;t:for(;a.length&&h.length;)if(a.length<=h.length){for(l=a,a=[],f=0,m=l.length;f<m;f++)for(u=l[f],d=s(u),p=0,g=d.length;p<g;p++)if(c=d[p],c in n||(a.push(c),n[c]=u),c in o){y=!0;break t}}else for(l=h,h=[],f=0,m=l.length;f<m;f++)for(u=l[f],d=r(u),p=0,g=d.length;p<g;p++)if(c=d[p],c in o||(h.push(c),o[c]=u),c in n){y=!0;break t}if(!y)return null;for(var _=[];c;)_.unshift(c),c=n[c];for(c=o[_[_.length-1]];c;)_.push(c),c=o[c];return _.length?_:null}function lL(i,t){if(!uf(i))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<2)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 2.");if(!i.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');t=""+t;var e={},r={},s,n,o,a,h,l;for(e[t]=!0,r[t]=[t];Object.keys(e).length;){s=e,e={};for(o in s)for(n=i.outboundNeighbors(o),h=0,l=n.length;h<l;h++)a=n[h],r[a]||(r[a]=r[o].concat(a),e[a]=!0)}return r}function hx(i,t,e){if(!uf(t))throw new Error("graphology-shortest-path: invalid graphology instance.");if(!t.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" source node does not exist in the given graph.');e=""+e;var r=new Set,s={},n=0;s[e]=0;for(var o=[e],a,h,l;o.length!==0;){var u=[];for(a=0,h=o.length;a<h;a++)l=o[a],!r.has(l)&&(r.add(l),aL(u,t[i](l)),s[l]=n);n++,o=u}return s}var uL=hx.bind(null,"outboundNeighbors"),cL=hx.bind(null,"neighbors");function dL(i,t){t=""+t;var e=[],r={},s={},n=i.nodes(),o,a,h,l,u,d,c,f,p;for(d=0,f=n.length;d<f;d++)l=n[d],r[l]=[],s[l]=0;var m={};s[t]=1,m[t]=0;for(var g=oL.of(t);g.size;)for(l=g.dequeue(),e.push(l),o=m[l],a=s[l],h=i.outboundNeighbors(l),c=0,p=h.length;c<p;c++)u=h[c],u in m||(g.enqueue(u),m[u]=o+1),m[u]===o+1&&(s[u]+=a,r[u].push(l));return[e,r,s]}bn.bidirectional=hL;bn.singleSource=lL;bn.singleSourceLength=uL;bn.undirectedSingleSourceLength=cL;bn.brandes=dL;var cl={},dl={};function fL(i){return typeof i!="number"||isNaN(i)?1:i}function pL(i,t){var e={},r=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(r=t);var s=function(o){return r(o[i])},n=function(){return r(void 0)};return typeof i=="string"?(e.fromAttributes=s,e.fromGraph=function(o,a){return s(o.getNodeAttributes(a))},e.fromEntry=function(o,a){return s(a)}):typeof i=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){return r(i(a,o.getNodeAttributes(a)))},e.fromEntry=function(o,a){return r(i(o,a))}):(e.fromAttributes=n,e.fromGraph=n,e.fromEntry=n),e}function lx(i,t){var e={},r=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(r=t);var s=function(o){return r(o[i])},n=function(){return r(void 0)};return typeof i=="string"?(e.fromAttributes=s,e.fromGraph=function(o,a){return s(o.getEdgeAttributes(a))},e.fromEntry=function(o,a){return s(a)},e.fromPartialEntry=e.fromEntry,e.fromMinimalEntry=e.fromEntry):typeof i=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){var h=o.extremities(a);return r(i(a,o.getEdgeAttributes(a),h[0],h[1],o.getNodeAttributes(h[0]),o.getNodeAttributes(h[1]),o.isUndirected(a)))},e.fromEntry=function(o,a,h,l,u,d,c){return r(i(o,a,h,l,u,d,c))},e.fromPartialEntry=function(o,a,h,l){return r(i(o,a,h,l))},e.fromMinimalEntry=function(o,a){return r(i(o,a))}):(e.fromAttributes=n,e.fromGraph=n,e.fromEntry=n,e.fromMinimalEntry=n),e}dl.createNodeValueGetter=pL;dl.createEdgeValueGetter=lx;dl.createEdgeWeightGetter=function(i){return lx(i,fL)};var Bo={},mL=function(i,t){return i<t?-1:i>t?1:0},gL=function(i,t){return i<t?1:i>t?-1:0};function yL(i){return function(t,e){return i(e,t)}}function _L(i){return i===2?function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:t[1]<e[1]?-1:t[1]>e[1]?1:0}:function(t,e){for(var r=0;r<i;){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1;r++}return 0}}Bo.DEFAULT_COMPARATOR=mL;Bo.DEFAULT_REVERSE_COMPARATOR=gL;Bo.reverseComparator=yL;Bo.createTupleComparator=_L;var Uh=af,ux=Bo,Oi=xn,fl=ux.DEFAULT_COMPARATOR,cf=ux.reverseComparator;function df(i,t,e,r){for(var s=t[r],n,o;r>e;){if(n=r-1>>1,o=t[n],i(s,o)<0){t[r]=o,r=n;continue}break}t[r]=s}function Fo(i,t,e){for(var r=t.length,s=e,n=t[e],o=2*e+1,a;o<r;)a=o+1,a<r&&i(t[o],t[a])>=0&&(o=a),t[e]=t[o],e=o,o=2*e+1;t[e]=n,df(i,t,s,e)}function cx(i,t,e){t.push(e),df(i,t,0,t.length-1)}function ff(i,t){var e=t.pop();if(t.length!==0){var r=t[0];return t[0]=e,Fo(i,t,0),r}return e}function gn(i,t,e){if(t.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var r=t[0];return t[0]=e,Fo(i,t,0),r}function dx(i,t,e){var r;return t.length!==0&&i(t[0],e)<0&&(r=t[0],t[0]=e,e=r,Fo(i,t,0)),e}function ms(i,t){for(var e=t.length,r=e>>1,s=r;--s>=0;)Fo(i,t,s)}function pf(i,t){for(var e=t.length,r=0,s=new Array(e);r<e;)s[r++]=ff(i,t);return s}function vL(i,t,e){arguments.length===2&&(e=t,t=i,i=fl);var r=cf(i),s,n,o,a=1/0,h;if(t===1){if(Oi.isArrayLike(e)){for(s=0,n=e.length;s<n;s++)o=e[s],(a===1/0||i(o,a)<0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Uh(e,function(u){(a===1/0||i(u,a)<0)&&(a=u)}),[a]}if(Oi.isArrayLike(e)){if(t>=e.length)return e.slice().sort(i);for(h=e.slice(0,t),ms(r,h),s=t,n=e.length;s<n;s++)r(e[s],h[0])>0&&gn(r,h,e[s]);return h.sort(i)}var l=Oi.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),s=0,Uh(e,function(u){s<t?h[s]=u:(s===t&&ms(r,h),r(u,h[0])>0&&gn(r,h,u)),s++}),h.length>s&&(h.length=s),h.sort(i)}function xL(i,t,e){arguments.length===2&&(e=t,t=i,i=fl);var r=cf(i),s,n,o,a=-1/0,h;if(t===1){if(Oi.isArrayLike(e)){for(s=0,n=e.length;s<n;s++)o=e[s],(a===-1/0||i(o,a)>0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Uh(e,function(u){(a===-1/0||i(u,a)>0)&&(a=u)}),[a]}if(Oi.isArrayLike(e)){if(t>=e.length)return e.slice().sort(r);for(h=e.slice(0,t),ms(i,h),s=t,n=e.length;s<n;s++)i(e[s],h[0])>0&&gn(i,h,e[s]);return h.sort(r)}var l=Oi.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),s=0,Uh(e,function(u){s<t?h[s]=u:(s===t&&ms(i,h),i(u,h[0])>0&&gn(i,h,u)),s++}),h.length>s&&(h.length=s),h.sort(r)}function Xt(i){if(this.clear(),this.comparator=i||fl,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}Xt.prototype.clear=function(){this.items=[],this.size=0};Xt.prototype.push=function(i){return cx(this.comparator,this.items,i),++this.size};Xt.prototype.peek=function(){return this.items[0]};Xt.prototype.pop=function(){return this.size!==0&&this.size--,ff(this.comparator,this.items)};Xt.prototype.replace=function(i){return gn(this.comparator,this.items,i)};Xt.prototype.pushpop=function(i){return dx(this.comparator,this.items,i)};Xt.prototype.consume=function(){return this.size=0,pf(this.comparator,this.items)};Xt.prototype.toArray=function(){return pf(this.comparator,this.items.slice())};Xt.prototype.inspect=function(){var i=this.toArray();return Object.defineProperty(i,"constructor",{value:Xt,enumerable:!1}),i};typeof Symbol<"u"&&(Xt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Xt.prototype.inspect);function Gh(i){if(this.clear(),this.comparator=i||fl,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=cf(this.comparator)}Gh.prototype=Xt.prototype;Xt.from=function(i,t){var e=new Xt(t),r;return Oi.isArrayLike(i)?r=i.slice():r=Oi.toArray(i),ms(e.comparator,r),e.items=r,e.size=r.length,e};Gh.from=function(i,t){var e=new Gh(t),r;return Oi.isArrayLike(i)?r=i.slice():r=Oi.toArray(i),ms(e.comparator,r),e.items=r,e.size=r.length,e};Xt.siftUp=Fo;Xt.siftDown=df;Xt.push=cx;Xt.pop=ff;Xt.replace=gn;Xt.pushpop=dx;Xt.heapify=ms;Xt.consume=pf;Xt.nsmallest=vL;Xt.nlargest=xL;Xt.MinHeap=Xt;Xt.MaxHeap=Gh;var bL=Xt,fx=of,mf=dl.createEdgeWeightGetter,$h=bL,gf="weight";function pd(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:i[2]>t[2]?1:i[2]<t[2]?-1:0}function wL(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:i[2]>t[2]?1:i[2]<t[2]?-1:i[3]>t[3]?1:i[3]<t[3]?-1:0}function EL(i,t,e,r){if(t=""+t,e=""+e,!fx(i))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(t&&!i.hasNode(t))throw new Error('graphology-shortest-path/dijkstra: the "'+t+'" source node does not exist in the given graph.');if(e&&!i.hasNode(e))throw new Error('graphology-shortest-path/dijkstra: the "'+e+'" target node does not exist in the given graph.');if(r=mf(r||gf).fromMinimalEntry,t===e)return[0,[t]];var s=[{},{}],n=[{},{}],o=[new $h(pd),new $h(pd)],a=[{},{}];n[0][t]=[t],n[1][e]=[e],a[0][t]=0,a[1][e]=0;var h=[],l=1/0,u=0,d=1,c,f,p,m,g,y,_,v,x;for(o[0].push([0,u++,t]),o[1].push([0,u++,e]);o[0].size&&o[1].size;)if(d=1-d,c=o[d].pop(),m=c[0],g=c[2],!(g in s[d])){if(s[d][g]=m,g in s[1-d])return[l,h];for(f=d===1?i.inboundEdges(g):i.outboundEdges(g),v=0,x=f.length;v<x;v++){if(_=f[v],y=i.opposite(g,_),p=s[d][g]+r(_,i.getEdgeAttributes(_)),y in s[d]&&p<s[d][y])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(y in a[d])||p<a[d][y])&&(a[d][y]=p,o[d].push([p,u++,y]),n[d][y]=n[d][g].concat(y),y in a[0]&&y in a[1]&&(m=a[0][y]+a[1][y],(h.length===0||l>m)&&(l=m,h=n[0][y].concat(n[1][y].slice(0,-1).reverse()))))}}return[1/0,null]}function TL(i,t,e,r,s,n){if(!fx(i))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(s&&!i.hasNode(s))throw new Error('graphology-shortest-path/dijkstra: the "'+s+'" target node does not exist in the given graph.');e=mf(e||gf).fromMinimalEntry;var o={},a={},h=new $h(pd),l=0,u,d,c,f,p,m,g,y,_,v,x;for(y=0,v=t.length;y<v;y++)f=t[y],a[f]=0,h.push([0,l++,f]),n&&(n[f]=[f]);for(;h.size;)if(d=h.pop(),g=d[0],f=d[2],!(f in o)){if(o[f]=g,f===s)break;for(u=i.outboundEdges(f),_=0,x=u.length;_<x;_++)if(m=u[_],p=i.opposite(f,m),c=e(m,i.getEdgeAttributes(m))+o[f],!(r&&c>r)){if(p in o&&c<o[p])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(p in a)||c<a[p])&&(a[p]=c,h.push([c,l++,p]),n&&(n[p]=n[f].concat(p)))}}return o}function AL(i,t,e){var r={};return TL(i,[t],e,0,null,r),r}function SL(i,t,e,r){return EL(i,t,e,r)[1]}function IL(i,t,e){t=""+t,e=mf(e||gf).fromMinimalEntry;var r=[],s={},n={},o=i.nodes(),a,h,l,u,d,c,f,p,m,g;for(m=0,g=o.length;m<g;m++)c=o[m],s[c]=[],n[c]=0;var y={};n[t]=1;var _={};_[t]=0;var v=0,x=new $h(wL);for(x.push([0,v++,t,t]);x.size;)if(h=x.pop(),u=h[0],l=h[2],c=h[3],!(c in y))for(n[c]+=n[l],r.push(c),y[c]=u,a=i.outboundEdges(c),m=0,g=a.length;m<g;m++)p=a[m],f=i.opposite(c,p),d=u+e(p,i.getEdgeAttributes(p)),!(f in y)&&(!(f in _)||d<_[f])?(_[f]=d,x.push([d,v++,c,f]),n[f]=0,s[f]=[c]):d===_[f]&&(n[f]+=n[c],s[f].push(c));return[r,s,n]}cl.bidirectional=SL;cl.singleSource=AL;cl.brandes=IL;var Do=bn,CL=cl;Do.bidirectional;Do.singleSource;Do.singleSourceLength;Do.undirectedSingleSourceLength;Do.brandes;var yf={exports:{}},on=typeof Reflect=="object"?Reflect:null,_y=on&&typeof on.apply=="function"?on.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},Ja;on&&typeof on.ownKeys=="function"?Ja=on.ownKeys:Object.getOwnPropertySymbols?Ja=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ja=function(t){return Object.getOwnPropertyNames(t)};function RL(i){console&&console.warn&&console.warn(i)}var px=Number.isNaN||function(t){return t!==t};function Wt(){Wt.init.call(this)}yf.exports=Wt;yf.exports.once=OL;Wt.EventEmitter=Wt;Wt.prototype._events=void 0;Wt.prototype._eventsCount=0;Wt.prototype._maxListeners=void 0;var vy=10;function pl(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Wt,"defaultMaxListeners",{enumerable:!0,get:function(){return vy},set:function(i){if(typeof i!="number"||i<0||px(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");vy=i}});Wt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Wt.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||px(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function mx(i){return i._maxListeners===void 0?Wt.defaultMaxListeners:i._maxListeners}Wt.prototype.getMaxListeners=function(){return mx(this)};Wt.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var s=t==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=n[t];if(h===void 0)return!1;if(typeof h=="function")_y(h,this,e);else for(var l=h.length,u=xx(h,l),r=0;r<l;++r)_y(u[r],this,e);return!0};function gx(i,t,e,r){var s,n,o;if(pl(e),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),n=i._events),o=n[t]),o===void 0)o=n[t]=e,++i._eventsCount;else if(typeof o=="function"?o=n[t]=r?[e,o]:[o,e]:r?o.unshift(e):o.push(e),s=mx(i),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=t,a.count=o.length,RL(a)}return i}Wt.prototype.addListener=function(t,e){return gx(this,t,e,!1)};Wt.prototype.on=Wt.prototype.addListener;Wt.prototype.prependListener=function(t,e){return gx(this,t,e,!0)};function ML(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yx(i,t,e){var r={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},s=ML.bind(r);return s.listener=e,r.wrapFn=s,s}Wt.prototype.once=function(t,e){return pl(e),this.on(t,yx(this,t,e)),this};Wt.prototype.prependOnceListener=function(t,e){return pl(e),this.prependListener(t,yx(this,t,e)),this};Wt.prototype.removeListener=function(t,e){var r,s,n,o,a;if(pl(e),s=this._events,s===void 0)return this;if(r=s[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(n=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,n=o;break}if(n<0)return this;n===0?r.shift():PL(r,n),r.length===1&&(s[t]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};Wt.prototype.off=Wt.prototype.removeListener;Wt.prototype.removeAllListeners=function(t){var e,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var n=Object.keys(r),o;for(s=0;s<n.length;++s)o=n[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function _x(i,t,e){var r=i._events;if(r===void 0)return[];var s=r[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?NL(s):xx(s,s.length)}Wt.prototype.listeners=function(t){return _x(this,t,!0)};Wt.prototype.rawListeners=function(t){return _x(this,t,!1)};Wt.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):vx.call(i,t)};Wt.prototype.listenerCount=vx;function vx(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Wt.prototype.eventNames=function(){return this._eventsCount>0?Ja(this._events):[]};function xx(i,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=i[r];return e}function PL(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function NL(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function OL(i,t){return new Promise(function(e,r){function s(o){i.removeListener(t,n),r(o)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",s),e([].slice.call(arguments))}bx(i,t,n,{once:!0}),t!=="error"&&BL(i,s,{once:!0})})}function BL(i,t,e){typeof i.on=="function"&&bx(i,"error",t,e)}function bx(i,t,e,r){if(typeof i.on=="function")r.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function s(n){r.once&&i.removeEventListener(t,s),e(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var FL=yf.exports,DL=Oo,wx=ul,LL=wx.ARRAY_BUFFER_SUPPORT,kL=wx.SYMBOL_SUPPORT;function UL(i){return typeof i=="string"||Array.isArray(i)||LL&&ArrayBuffer.isView(i)?DL.fromSequence(i):typeof i!="object"||i===null?null:kL&&typeof i[Symbol.iterator]=="function"?i[Symbol.iterator]():typeof i.next=="function"?i:null}var Ex=function(t){var e=UL(t);if(!e)throw new Error("obliterator: target is not iterable nor a valid iterator.");return e},GL=Ex,$L=function(t,e){for(var r=arguments.length>1?e:1/0,s=r!==1/0?new Array(r):[],n,o=0,a=GL(t);;){if(o===r)return s;if(n=a.next(),n.done)return o!==e&&(s.length=o),s;s[o++]=n.value}};const Tx=Jh($L);var HL=Oo,XL=Ex,zL=function(){var t=arguments,e=null,r=-1;return new HL(function(){var n=null;do{if(e===null){if(r++,r>=t.length)return{done:!0};e=XL(t[r])}if(n=e.next(),n.done===!0){e=null;continue}break}while(!0);return n})};const ir=Jh(zL);function VL(){const i=arguments[0];for(let t=1,e=arguments.length;t<e;t++)if(arguments[t])for(const r in arguments[t])i[r]=arguments[t][r];return i}let me=VL;typeof Object.assign=="function"&&(me=Object.assign);function ti(i,t,e,r){const s=i._nodes.get(t);let n=null;return s&&(r==="mixed"?n=s.out&&s.out[e]||s.undirected&&s.undirected[e]:r==="directed"?n=s.out&&s.out[e]:n=s.undirected&&s.undirected[e]),n}function Ae(i){return typeof i=="object"&&i!==null}function Ax(i){let t;for(t in i)return!1;return!0}function Ye(i,t,e){Object.defineProperty(i,t,{enumerable:!1,configurable:!1,writable:!0,value:e})}function ni(i,t,e){const r={enumerable:!0,configurable:!0};typeof e=="function"?r.get=e:(r.value=e,r.writable=!1),Object.defineProperty(i,t,r)}function xy(i){return!(!Ae(i)||i.attributes&&!Array.isArray(i.attributes))}function WL(){let i=Math.floor(Math.random()*256)&255;return()=>i++}class _f extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class Z extends _f{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Z.prototype.constructor)}}class H extends _f{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,H.prototype.constructor)}}class ct extends _f{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ct.prototype.constructor)}}function Sx(i,t){this.key=i,this.attributes=t,this.clear()}Sx.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Ix(i,t){this.key=i,this.attributes=t,this.clear()}Ix.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Cx(i,t){this.key=i,this.attributes=t,this.clear()}Cx.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function wn(i,t,e,r,s){this.key=t,this.attributes=s,this.undirected=i,this.source=e,this.target=r}wn.prototype.attach=function(){let i="out",t="in";this.undirected&&(i=t="undirected");const e=this.source.key,r=this.target.key;this.source[i][r]=this,!(this.undirected&&e===r)&&(this.target[t][e]=this)};wn.prototype.attachMulti=function(){let i="out",t="in";const e=this.source.key,r=this.target.key;this.undirected&&(i=t="undirected");const s=this.source[i],n=s[r];if(typeof n>"u"){s[r]=this,this.undirected&&e===r||(this.target[t][e]=this);return}n.previous=this,this.next=n,s[r]=this,this.target[t][e]=this};wn.prototype.detach=function(){const i=this.source.key,t=this.target.key;let e="out",r="in";this.undirected&&(e=r="undirected"),delete this.source[e][t],delete this.target[r][i]};wn.prototype.detachMulti=function(){const i=this.source.key,t=this.target.key;let e="out",r="in";this.undirected&&(e=r="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[e][t],delete this.target[r][i]):(this.next.previous=void 0,this.source[e][t]=this.next,this.target[r][i]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Rx=0,Mx=1,jL=2,Px=3;function ar(i,t,e,r,s,n,o){let a,h,l,u;if(r=""+r,e===Rx){if(a=i._nodes.get(r),!a)throw new H(`Graph.${t}: could not find the "${r}" node in the graph.`);l=s,u=n}else if(e===Px){if(s=""+s,h=i._edges.get(s),!h)throw new H(`Graph.${t}: could not find the "${s}" edge in the graph.`);const d=h.source.key,c=h.target.key;if(r===d)a=h.target;else if(r===c)a=h.source;else throw new H(`Graph.${t}: the "${r}" node is not attached to the "${s}" edge (${d}, ${c}).`);l=n,u=o}else{if(h=i._edges.get(r),!h)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`);e===Mx?a=h.source:a=h.target,l=s,u=n}return[a,l,u]}function YL(i,t,e){i.prototype[t]=function(r,s,n){const[o,a]=ar(this,t,e,r,s,n);return o.attributes[a]}}function qL(i,t,e){i.prototype[t]=function(r,s){const[n]=ar(this,t,e,r,s);return n.attributes}}function KL(i,t,e){i.prototype[t]=function(r,s,n){const[o,a]=ar(this,t,e,r,s,n);return o.attributes.hasOwnProperty(a)}}function ZL(i,t,e){i.prototype[t]=function(r,s,n,o){const[a,h,l]=ar(this,t,e,r,s,n,o);return a.attributes[h]=l,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function QL(i,t,e){i.prototype[t]=function(r,s,n,o){const[a,h,l]=ar(this,t,e,r,s,n,o);if(typeof l!="function")throw new Z(`Graph.${t}: updater should be a function.`);const u=a.attributes,d=l(u[h]);return u[h]=d,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function JL(i,t,e){i.prototype[t]=function(r,s,n){const[o,a]=ar(this,t,e,r,s,n);return delete o.attributes[a],this.emit("nodeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:a}),this}}function tk(i,t,e){i.prototype[t]=function(r,s,n){const[o,a]=ar(this,t,e,r,s,n);if(!Ae(a))throw new Z(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=a,this.emit("nodeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function ek(i,t,e){i.prototype[t]=function(r,s,n){const[o,a]=ar(this,t,e,r,s,n);if(!Ae(a))throw new Z(`Graph.${t}: provided attributes are not a plain object.`);return me(o.attributes,a),this.emit("nodeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:a}),this}}function ik(i,t,e){i.prototype[t]=function(r,s,n){const[o,a]=ar(this,t,e,r,s,n);if(typeof a!="function")throw new Z(`Graph.${t}: provided updater is not a function.`);return o.attributes=a(o.attributes),this.emit("nodeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const rk=[{name:i=>`get${i}Attribute`,attacher:YL},{name:i=>`get${i}Attributes`,attacher:qL},{name:i=>`has${i}Attribute`,attacher:KL},{name:i=>`set${i}Attribute`,attacher:ZL},{name:i=>`update${i}Attribute`,attacher:QL},{name:i=>`remove${i}Attribute`,attacher:JL},{name:i=>`replace${i}Attributes`,attacher:tk},{name:i=>`merge${i}Attributes`,attacher:ek},{name:i=>`update${i}Attributes`,attacher:ik}];function sk(i){rk.forEach(function({name:t,attacher:e}){e(i,t("Node"),Rx),e(i,t("Source"),Mx),e(i,t("Target"),jL),e(i,t("Opposite"),Px)})}function nk(i,t,e){i.prototype[t]=function(r,s){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+s;if(s=arguments[2],n=ti(this,o,a,e),!n)throw new H(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return n.attributes[s]}}function ok(i,t,e){i.prototype[t]=function(r){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const n=""+r,o=""+arguments[1];if(s=ti(this,n,o,e),!s)throw new H(`Graph.${t}: could not find an edge for the given path ("${n}" - "${o}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return s.attributes}}function ak(i,t,e){i.prototype[t]=function(r,s){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+s;if(s=arguments[2],n=ti(this,o,a,e),!n)throw new H(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return n.attributes.hasOwnProperty(s)}}function hk(i,t,e){i.prototype[t]=function(r,s,n){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+r,h=""+s;if(s=arguments[2],n=arguments[3],o=ti(this,a,h,e),!o)throw new H(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,o=this._edges.get(r),!o)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return o.attributes[s]=n,this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:s}),this}}function lk(i,t,e){i.prototype[t]=function(r,s,n){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+r,h=""+s;if(s=arguments[2],n=arguments[3],o=ti(this,a,h,e),!o)throw new H(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,o=this._edges.get(r),!o)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(typeof n!="function")throw new Z(`Graph.${t}: updater should be a function.`);return o.attributes[s]=n(o.attributes[s]),this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:s}),this}}function uk(i,t,e){i.prototype[t]=function(r,s){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+s;if(s=arguments[2],n=ti(this,o,a,e),!n)throw new H(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return delete n.attributes[s],this.emit("edgeAttributesUpdated",{key:n.key,type:"remove",attributes:n.attributes,name:s}),this}}function ck(i,t,e){i.prototype[t]=function(r,s){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+s;if(s=arguments[2],n=ti(this,o,a,e),!n)throw new H(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(!Ae(s))throw new Z(`Graph.${t}: provided attributes are not a plain object.`);return n.attributes=s,this.emit("edgeAttributesUpdated",{key:n.key,type:"replace",attributes:n.attributes}),this}}function dk(i,t,e){i.prototype[t]=function(r,s){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+s;if(s=arguments[2],n=ti(this,o,a,e),!n)throw new H(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(!Ae(s))throw new Z(`Graph.${t}: provided attributes are not a plain object.`);return me(n.attributes,s),this.emit("edgeAttributesUpdated",{key:n.key,type:"merge",attributes:n.attributes,data:s}),this}}function fk(i,t,e){i.prototype[t]=function(r,s){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new ct(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ct(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+s;if(s=arguments[2],n=ti(this,o,a,e),!n)throw new H(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new ct(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new H(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(typeof s!="function")throw new Z(`Graph.${t}: provided updater is not a function.`);return n.attributes=s(n.attributes),this.emit("edgeAttributesUpdated",{key:n.key,type:"update",attributes:n.attributes}),this}}const pk=[{name:i=>`get${i}Attribute`,attacher:nk},{name:i=>`get${i}Attributes`,attacher:ok},{name:i=>`has${i}Attribute`,attacher:ak},{name:i=>`set${i}Attribute`,attacher:hk},{name:i=>`update${i}Attribute`,attacher:lk},{name:i=>`remove${i}Attribute`,attacher:uk},{name:i=>`replace${i}Attributes`,attacher:ck},{name:i=>`merge${i}Attributes`,attacher:dk},{name:i=>`update${i}Attributes`,attacher:fk}];function mk(i){pk.forEach(function({name:t,attacher:e}){e(i,t("Edge"),"mixed"),e(i,t("DirectedEdge"),"directed"),e(i,t("UndirectedEdge"),"undirected")})}const gk=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function yk(i,t,e,r){let s=!1;for(const n in t){if(n===r)continue;const o=t[n];if(s=e(o.key,o.attributes,o.source.key,o.target.key,o.source.attributes,o.target.attributes,o.undirected),i&&s)return o.key}}function _k(i,t,e,r){let s,n,o,a=!1;for(const h in t)if(h!==r){s=t[h];do{if(n=s.source,o=s.target,a=e(s.key,s.attributes,n.key,o.key,n.attributes,o.attributes,s.undirected),i&&a)return s.key;s=s.next}while(s!==void 0)}}function Mu(i,t){const e=Object.keys(i),r=e.length;let s,n=0;return new ei(function(){do if(s)s=s.next;else{if(n>=r)return{done:!0};const a=e[n++];if(a===t){s=void 0;continue}s=i[a]}while(!s);return{done:!1,value:{edge:s.key,attributes:s.attributes,source:s.source.key,target:s.target.key,sourceAttributes:s.source.attributes,targetAttributes:s.target.attributes,undirected:s.undirected}}})}function vk(i,t,e,r){const s=t[e];if(!s)return;const n=s.source,o=s.target;if(r(s.key,s.attributes,n.key,o.key,n.attributes,o.attributes,s.undirected)&&i)return s.key}function xk(i,t,e,r){let s=t[e];if(!s)return;let n=!1;do{if(n=r(s.key,s.attributes,s.source.key,s.target.key,s.source.attributes,s.target.attributes,s.undirected),i&&n)return s.key;s=s.next}while(s!==void 0)}function Pu(i,t){let e=i[t];return e.next!==void 0?new ei(function(){if(!e)return{done:!0};const r={edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected};return e=e.next,{done:!1,value:r}}):ei.of({edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected})}function bk(i,t){if(i.size===0)return[];if(t==="mixed"||t===i.type)return typeof Array.from=="function"?Array.from(i._edges.keys()):Tx(i._edges.keys(),i._edges.size);const e=t==="undirected"?i.undirectedSize:i.directedSize,r=new Array(e),s=t==="undirected",n=i._edges.values();let o=0,a,h;for(;a=n.next(),a.done!==!0;)h=a.value,h.undirected===s&&(r[o++]=h.key);return r}function Nx(i,t,e,r){if(t.size===0)return;const s=e!=="mixed"&&e!==t.type,n=e==="undirected";let o,a,h=!1;const l=t._edges.values();for(;o=l.next(),o.done!==!0;){if(a=o.value,s&&a.undirected!==n)continue;const{key:u,attributes:d,source:c,target:f}=a;if(h=r(u,d,c.key,f.key,c.attributes,f.attributes,a.undirected),i&&h)return u}}function wk(i,t){if(i.size===0)return ei.empty();const e=t!=="mixed"&&t!==i.type,r=t==="undirected",s=i._edges.values();return new ei(function(){let o,a;for(;;){if(o=s.next(),o.done)return o;if(a=o.value,!(e&&a.undirected!==r))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}})}function vf(i,t,e,r,s,n){const o=t?_k:yk;let a;if(e!=="undirected"&&(r!=="out"&&(a=o(i,s.in,n),i&&a)||r!=="in"&&(a=o(i,s.out,n,r?void 0:s.key),i&&a))||e!=="directed"&&(a=o(i,s.undirected,n),i&&a))return a}function Ek(i,t,e,r){const s=[];return vf(!1,i,t,e,r,function(n){s.push(n)}),s}function Tk(i,t,e){let r=ei.empty();return i!=="undirected"&&(t!=="out"&&typeof e.in<"u"&&(r=ir(r,Mu(e.in))),t!=="in"&&typeof e.out<"u"&&(r=ir(r,Mu(e.out,t?void 0:e.key)))),i!=="directed"&&typeof e.undirected<"u"&&(r=ir(r,Mu(e.undirected))),r}function xf(i,t,e,r,s,n,o){const a=e?xk:vk;let h;if(t!=="undirected"&&(typeof s.in<"u"&&r!=="out"&&(h=a(i,s.in,n,o),i&&h)||typeof s.out<"u"&&r!=="in"&&(r||s.key!==n)&&(h=a(i,s.out,n,o),i&&h))||t!=="directed"&&typeof s.undirected<"u"&&(h=a(i,s.undirected,n,o),i&&h))return h}function Ak(i,t,e,r,s){const n=[];return xf(!1,i,t,e,r,s,function(o){n.push(o)}),n}function Sk(i,t,e,r){let s=ei.empty();return i!=="undirected"&&(typeof e.in<"u"&&t!=="out"&&r in e.in&&(s=ir(s,Pu(e.in,r))),typeof e.out<"u"&&t!=="in"&&r in e.out&&(t||e.key!==r)&&(s=ir(s,Pu(e.out,r)))),i!=="directed"&&typeof e.undirected<"u"&&r in e.undirected&&(s=ir(s,Pu(e.undirected,r))),s}function Ik(i,t){const{name:e,type:r,direction:s}=t;i.prototype[e]=function(n,o){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return[];if(!arguments.length)return bk(this,r);if(arguments.length===1){n=""+n;const a=this._nodes.get(n);if(typeof a>"u")throw new H(`Graph.${e}: could not find the "${n}" node in the graph.`);return Ek(this.multi,r==="mixed"?this.type:r,s,a)}if(arguments.length===2){n=""+n,o=""+o;const a=this._nodes.get(n);if(!a)throw new H(`Graph.${e}:  could not find the "${n}" source node in the graph.`);if(!this._nodes.has(o))throw new H(`Graph.${e}:  could not find the "${o}" target node in the graph.`);return Ak(r,this.multi,s,a,o)}throw new Z(`Graph.${e}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Ck(i,t){const{name:e,type:r,direction:s}=t,n="forEach"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[n]=function(l,u,d){if(!(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)){if(arguments.length===1)return d=l,Nx(!1,this,r,d);if(arguments.length===2){l=""+l,d=u;const c=this._nodes.get(l);if(typeof c>"u")throw new H(`Graph.${n}: could not find the "${l}" node in the graph.`);return vf(!1,this.multi,r==="mixed"?this.type:r,s,c,d)}if(arguments.length===3){l=""+l,u=""+u;const c=this._nodes.get(l);if(!c)throw new H(`Graph.${n}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(u))throw new H(`Graph.${n}:  could not find the "${u}" target node in the graph.`);return xf(!1,r,this.multi,s,c,u,d)}throw new Z(`Graph.${n}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const o="map"+e[0].toUpperCase()+e.slice(1);i.prototype[o]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop();let d;if(l.length===0){let c=0;r!=="directed"&&(c+=this.undirectedSize),r!=="undirected"&&(c+=this.directedSize),d=new Array(c);let f=0;l.push((p,m,g,y,_,v,x)=>{d[f++]=u(p,m,g,y,_,v,x)})}else d=[],l.push((c,f,p,m,g,y,_)=>{d.push(u(c,f,p,m,g,y,_))});return this[n].apply(this,l),d};const a="filter"+e[0].toUpperCase()+e.slice(1);i.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop(),d=[];return l.push((c,f,p,m,g,y,_)=>{u(c,f,p,m,g,y,_)&&d.push(c)}),this[n].apply(this,l),d};const h="reduce"+e[0].toUpperCase()+e.slice(1);i.prototype[h]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new Z(`Graph.${h}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new Z(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let u,d;l.length===2?(u=l[0],d=l[1],l=[]):l.length===3?(u=l[1],d=l[2],l=[l[0]]):l.length===4&&(u=l[2],d=l[3],l=[l[0],l[1]]);let c=d;return l.push((f,p,m,g,y,_,v)=>{c=u(c,f,p,m,g,y,_,v)}),this[n].apply(this,l),c}}function Rk(i,t){const{name:e,type:r,direction:s}=t,n="find"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[n]=function(h,l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return!1;if(arguments.length===1)return u=h,Nx(!0,this,r,u);if(arguments.length===2){h=""+h,u=l;const d=this._nodes.get(h);if(typeof d>"u")throw new H(`Graph.${n}: could not find the "${h}" node in the graph.`);return vf(!0,this.multi,r==="mixed"?this.type:r,s,d,u)}if(arguments.length===3){h=""+h,l=""+l;const d=this._nodes.get(h);if(!d)throw new H(`Graph.${n}:  could not find the "${h}" source node in the graph.`);if(!this._nodes.has(l))throw new H(`Graph.${n}:  could not find the "${l}" target node in the graph.`);return xf(!0,r,this.multi,s,d,l,u)}throw new Z(`Graph.${n}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const o="some"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[o]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((d,c,f,p,m,g,y)=>l(d,c,f,p,m,g,y)),!!this[n].apply(this,h)};const a="every"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[a]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((d,c,f,p,m,g,y)=>!l(d,c,f,p,m,g,y)),!this[n].apply(this,h)}}function Mk(i,t){const{name:e,type:r,direction:s}=t,n=e.slice(0,-1)+"Entries";i.prototype[n]=function(o,a){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return ei.empty();if(!arguments.length)return wk(this,r);if(arguments.length===1){o=""+o;const h=this._nodes.get(o);if(!h)throw new H(`Graph.${n}: could not find the "${o}" node in the graph.`);return Tk(r,s,h)}if(arguments.length===2){o=""+o,a=""+a;const h=this._nodes.get(o);if(!h)throw new H(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new H(`Graph.${n}:  could not find the "${a}" target node in the graph.`);return Sk(r,s,h,a)}throw new Z(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Pk(i){gk.forEach(t=>{Ik(i,t),Ck(i,t),Rk(i,t),Mk(i,t)})}const Nk=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function ml(){this.A=null,this.B=null}ml.prototype.wrap=function(i){this.A===null?this.A=i:this.B===null&&(this.B=i)};ml.prototype.has=function(i){return this.A!==null&&i in this.A||this.B!==null&&i in this.B};function kn(i,t,e,r,s){for(const n in r){const o=r[n],a=o.source,h=o.target,l=a===e?h:a;if(t&&t.has(l.key))continue;const u=s(l.key,l.attributes);if(i&&u)return l.key}}function bf(i,t,e,r,s){if(t!=="mixed"){if(t==="undirected")return kn(i,null,r,r.undirected,s);if(typeof e=="string")return kn(i,null,r,r[e],s)}const n=new ml;let o;if(t!=="undirected"){if(e!=="out"){if(o=kn(i,null,r,r.in,s),i&&o)return o;n.wrap(r.in)}if(e!=="in"){if(o=kn(i,n,r,r.out,s),i&&o)return o;n.wrap(r.out)}}if(t!=="directed"&&(o=kn(i,n,r,r.undirected,s),i&&o))return o}function Ok(i,t,e){if(i!=="mixed"){if(i==="undirected")return Object.keys(e.undirected);if(typeof t=="string")return Object.keys(e[t])}const r=[];return bf(!1,i,t,e,function(s){r.push(s)}),r}function Un(i,t,e){const r=Object.keys(e),s=r.length;let n=0;return new ei(function(){let a=null;do{if(n>=s)return i&&i.wrap(e),{done:!0};const h=e[r[n++]],l=h.source,u=h.target;if(a=l===t?u:l,i&&i.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}})}function Bk(i,t,e){if(i!=="mixed"){if(i==="undirected")return Un(null,e,e.undirected);if(typeof t=="string")return Un(null,e,e[t])}let r=ei.empty();const s=new ml;return i!=="undirected"&&(t!=="out"&&(r=ir(r,Un(s,e,e.in))),t!=="in"&&(r=ir(r,Un(s,e,e.out)))),i!=="directed"&&(r=ir(r,Un(s,e,e.undirected))),r}function Fk(i,t){const{name:e,type:r,direction:s}=t;i.prototype[e]=function(n){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return[];n=""+n;const o=this._nodes.get(n);if(typeof o>"u")throw new H(`Graph.${e}: could not find the "${n}" node in the graph.`);return Ok(r==="mixed"?this.type:r,s,o)}}function Dk(i,t){const{name:e,type:r,direction:s}=t,n="forEach"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[n]=function(l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new H(`Graph.${n}: could not find the "${l}" node in the graph.`);bf(!1,r==="mixed"?this.type:r,s,d,u)};const o="map"+e[0].toUpperCase()+e.slice(1);i.prototype[o]=function(l,u){const d=[];return this[n](l,(c,f)=>{d.push(u(c,f))}),d};const a="filter"+e[0].toUpperCase()+e.slice(1);i.prototype[a]=function(l,u){const d=[];return this[n](l,(c,f)=>{u(c,f)&&d.push(c)}),d};const h="reduce"+e[0].toUpperCase()+e.slice(1);i.prototype[h]=function(l,u,d){if(arguments.length<3)throw new Z(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let c=d;return this[n](l,(f,p)=>{c=u(c,f,p)}),c}}function Lk(i,t){const{name:e,type:r,direction:s}=t,n=e[0].toUpperCase()+e.slice(1,-1),o="find"+n;i.prototype[o]=function(l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new H(`Graph.${o}: could not find the "${l}" node in the graph.`);return bf(!0,r==="mixed"?this.type:r,s,d,u)};const a="some"+n;i.prototype[a]=function(l,u){return!!this[o](l,u)};const h="every"+n;i.prototype[h]=function(l,u){return!this[o](l,(c,f)=>!u(c,f))}}function kk(i,t){const{name:e,type:r,direction:s}=t,n=e.slice(0,-1)+"Entries";i.prototype[n]=function(o){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return ei.empty();o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new H(`Graph.${n}: could not find the "${o}" node in the graph.`);return Bk(r==="mixed"?this.type:r,s,a)}}function Uk(i){Nk.forEach(t=>{Fk(i,t),Dk(i,t),Lk(i,t),kk(i,t)})}function Ca(i,t,e,r,s){const n=r._nodes.values(),o=r.type;let a,h,l,u,d,c,f;for(;a=n.next(),a.done!==!0;){let p=!1;if(h=a.value,o!=="undirected"){u=h.out;for(l in u){d=u[l];do{if(c=d.target,p=!0,f=s(h.key,c.key,h.attributes,c.attributes,d.key,d.attributes,d.undirected),i&&f)return d;d=d.next}while(d)}}if(o!=="directed"){u=h.undirected;for(l in u)if(!(t&&h.key>l)){d=u[l];do{if(c=d.target,c.key!==l&&(c=d.source),p=!0,f=s(h.key,c.key,h.attributes,c.attributes,d.key,d.attributes,d.undirected),i&&f)return d;d=d.next}while(d)}}if(e&&!p&&(f=s(h.key,null,h.attributes,null,null,null,null),i&&f))return null}}function Gk(i,t){const e={key:i};return Ax(t.attributes)||(e.attributes=me({},t.attributes)),e}function $k(i,t,e){const r={key:t,source:e.source.key,target:e.target.key};return Ax(e.attributes)||(r.attributes=me({},e.attributes)),i==="mixed"&&e.undirected&&(r.undirected=!0),r}function Hk(i){if(!Ae(i))throw new Z('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in i))throw new Z("Graph.import: serialized node is missing its key.");if("attributes"in i&&(!Ae(i.attributes)||i.attributes===null))throw new Z("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function Xk(i){if(!Ae(i))throw new Z('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in i))throw new Z("Graph.import: serialized edge is missing its source.");if(!("target"in i))throw new Z("Graph.import: serialized edge is missing its target.");if("attributes"in i&&(!Ae(i.attributes)||i.attributes===null))throw new Z("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in i&&typeof i.undirected!="boolean")throw new Z("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const zk=WL(),Vk=new Set(["directed","undirected","mixed"]),by=new Set(["domain","_events","_eventsCount","_maxListeners"]),Wk=[{name:i=>`${i}Edge`,generateKey:!0},{name:i=>`${i}DirectedEdge`,generateKey:!0,type:"directed"},{name:i=>`${i}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:i=>`${i}EdgeWithKey`},{name:i=>`${i}DirectedEdgeWithKey`,type:"directed"},{name:i=>`${i}UndirectedEdgeWithKey`,type:"undirected"}],jk={allowSelfLoops:!0,multi:!1,type:"mixed"};function Yk(i,t,e){if(e&&!Ae(e))throw new Z(`Graph.addNode: invalid attributes. Expecting an object but got "${e}"`);if(t=""+t,e=e||{},i._nodes.has(t))throw new ct(`Graph.addNode: the "${t}" node already exist in the graph.`);const r=new i.NodeDataClass(t,e);return i._nodes.set(t,r),i.emit("nodeAdded",{key:t,attributes:e}),r}function wy(i,t,e){const r=new i.NodeDataClass(t,e);return i._nodes.set(t,r),i.emit("nodeAdded",{key:t,attributes:e}),r}function Ox(i,t,e,r,s,n,o,a){if(!r&&i.type==="undirected")throw new ct(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(r&&i.type==="directed")throw new ct(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!Ae(a))throw new Z(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`);if(n=""+n,o=""+o,a=a||{},!i.allowSelfLoops&&n===o)throw new ct(`Graph.${t}: source & target are the same ("${n}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const h=i._nodes.get(n),l=i._nodes.get(o);if(!h)throw new H(`Graph.${t}: source node "${n}" not found.`);if(!l)throw new H(`Graph.${t}: target node "${o}" not found.`);const u={key:null,undirected:r,source:n,target:o,attributes:a};if(e)s=i._edgeKeyGenerator();else if(s=""+s,i._edges.has(s))throw new ct(`Graph.${t}: the "${s}" edge already exists in the graph.`);if(!i.multi&&(r?typeof h.undirected[o]<"u":typeof h.out[o]<"u"))throw new ct(`Graph.${t}: an edge linking "${n}" to "${o}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const d=new wn(r,s,h,l,a);i._edges.set(s,d);const c=n===o;return r?(h.undirectedDegree++,l.undirectedDegree++,c&&(h.undirectedLoops++,i._undirectedSelfLoopCount++)):(h.outDegree++,l.inDegree++,c&&(h.directedLoops++,i._directedSelfLoopCount++)),i.multi?d.attachMulti():d.attach(),r?i._undirectedSize++:i._directedSize++,u.key=s,i.emit("edgeAdded",u),s}function qk(i,t,e,r,s,n,o,a,h){if(!r&&i.type==="undirected")throw new ct(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(r&&i.type==="directed")throw new ct(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(h){if(typeof a!="function")throw new Z(`Graph.${t}: invalid updater function. Expecting a function but got "${a}"`)}else if(!Ae(a))throw new Z(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`)}n=""+n,o=""+o;let l;if(h&&(l=a,a=void 0),!i.allowSelfLoops&&n===o)throw new ct(`Graph.${t}: source & target are the same ("${n}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let u=i._nodes.get(n),d=i._nodes.get(o),c,f;if(!e&&(c=i._edges.get(s),c)){if((c.source.key!==n||c.target.key!==o)&&(!r||c.source.key!==o||c.target.key!==n))throw new ct(`Graph.${t}: inconsistency detected when attempting to merge the "${s}" edge with "${n}" source & "${o}" target vs. ("${c.source.key}", "${c.target.key}").`);f=c}if(!f&&!i.multi&&u&&(f=r?u.undirected[o]:u.out[o]),f){const _=[f.key,!1,!1,!1];if(h?!l:!a)return _;if(h){const v=f.attributes;f.attributes=l(v),i.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else me(f.attributes,a),i.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:a});return _}a=a||{},h&&l&&(a=l(a));const p={key:null,undirected:r,source:n,target:o,attributes:a};if(e)s=i._edgeKeyGenerator();else if(s=""+s,i._edges.has(s))throw new ct(`Graph.${t}: the "${s}" edge already exists in the graph.`);let m=!1,g=!1;u||(u=wy(i,n,{}),m=!0,n===o&&(d=u,g=!0)),d||(d=wy(i,o,{}),g=!0),c=new wn(r,s,u,d,a),i._edges.set(s,c);const y=n===o;return r?(u.undirectedDegree++,d.undirectedDegree++,y&&(u.undirectedLoops++,i._undirectedSelfLoopCount++)):(u.outDegree++,d.inDegree++,y&&(u.directedLoops++,i._directedSelfLoopCount++)),i.multi?c.attachMulti():c.attach(),r?i._undirectedSize++:i._directedSize++,p.key=s,i.emit("edgeAdded",p),[s,!0,m,g]}function Ms(i,t){i._edges.delete(t.key);const{source:e,target:r,attributes:s}=t,n=t.undirected,o=e===r;n?(e.undirectedDegree--,r.undirectedDegree--,o&&(e.undirectedLoops--,i._undirectedSelfLoopCount--)):(e.outDegree--,r.inDegree--,o&&(e.directedLoops--,i._directedSelfLoopCount--)),i.multi?t.detachMulti():t.detach(),n?i._undirectedSize--:i._directedSize--,i.emit("edgeDropped",{key:t.key,attributes:s,source:e.key,target:r.key,undirected:n})}class jt extends FL.EventEmitter{constructor(t){if(super(),t=me({},jk,t),typeof t.multi!="boolean")throw new Z(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!Vk.has(t.type))throw new Z(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new Z(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const e=t.type==="mixed"?Sx:t.type==="directed"?Ix:Cx;Ye(this,"NodeDataClass",e);const r="geid_"+zk()+"_";let s=0;const n=()=>{let o;do o=r+s++;while(this._edges.has(o));return o};Ye(this,"_attributes",{}),Ye(this,"_nodes",new Map),Ye(this,"_edges",new Map),Ye(this,"_directedSize",0),Ye(this,"_undirectedSize",0),Ye(this,"_directedSelfLoopCount",0),Ye(this,"_undirectedSelfLoopCount",0),Ye(this,"_edgeKeyGenerator",n),Ye(this,"_options",t),by.forEach(o=>Ye(this,o,this[o])),ni(this,"order",()=>this._nodes.size),ni(this,"size",()=>this._edges.size),ni(this,"directedSize",()=>this._directedSize),ni(this,"undirectedSize",()=>this._undirectedSize),ni(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),ni(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),ni(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),ni(this,"multi",this._options.multi),ni(this,"type",this._options.type),ni(this,"allowSelfLoops",this._options.allowSelfLoops),ni(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,e){if(this.type==="undirected")return!1;if(arguments.length===1){const r=""+t,s=this._edges.get(r);return!!s&&!s.undirected}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?r.out.hasOwnProperty(e):!1}throw new Z(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,e){if(this.type==="directed")return!1;if(arguments.length===1){const r=""+t,s=this._edges.get(r);return!!s&&s.undirected}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?r.undirected.hasOwnProperty(e):!1}throw new Z(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,e){if(arguments.length===1){const r=""+t;return this._edges.has(r)}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?typeof r.out<"u"&&r.out.hasOwnProperty(e)||typeof r.undirected<"u"&&r.undirected.hasOwnProperty(e):!1}throw new Z(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,e){if(this.type==="undirected")return;if(t=""+t,e=""+e,this.multi)throw new ct("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const r=this._nodes.get(t);if(!r)throw new H(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new H(`Graph.directedEdge: could not find the "${e}" target node in the graph.`);const s=r.out&&r.out[e]||void 0;if(s)return s.key}undirectedEdge(t,e){if(this.type==="directed")return;if(t=""+t,e=""+e,this.multi)throw new ct("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const r=this._nodes.get(t);if(!r)throw new H(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new H(`Graph.undirectedEdge: could not find the "${e}" target node in the graph.`);const s=r.undirected&&r.undirected[e]||void 0;if(s)return s.key}edge(t,e){if(this.multi)throw new ct("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new H(`Graph.edge: could not find the "${e}" target node in the graph.`);const s=r.out&&r.out[e]||r.undirected&&r.undirected[e]||void 0;if(s)return s.key}areDirectedNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.in||e in r.out}areOutNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.out}areInNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.in}areUndirectedNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:e in r.undirected}areNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(e in r.in||e in r.out)||this.type!=="directed"&&e in r.undirected}areInboundNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in r.in||this.type!=="directed"&&e in r.undirected}areOutboundNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new H(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in r.out||this.type!=="directed"&&e in r.undirected}inDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree}outDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree}directedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree}undirectedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree}inboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.inDegree),r}outboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.outDegree),r}degree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.degree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.inDegree+e.outDegree),r}inDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree-e.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree-e.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree-e.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree-e.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,s=0;return this.type!=="directed"&&(r+=e.undirectedDegree,s+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.inDegree,s+=e.directedLoops),r-s}outboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,s=0;return this.type!=="directed"&&(r+=e.undirectedDegree,s+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.outDegree,s+=e.directedLoops),r-s}degreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,s=0;return this.type!=="directed"&&(r+=e.undirectedDegree,s+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.inDegree+e.outDegree,s+=e.directedLoops*2),r-s}source(t){t=""+t;const e=this._edges.get(t);if(!e)throw new H(`Graph.source: could not find the "${t}" edge in the graph.`);return e.source.key}target(t){t=""+t;const e=this._edges.get(t);if(!e)throw new H(`Graph.target: could not find the "${t}" edge in the graph.`);return e.target.key}extremities(t){t=""+t;const e=this._edges.get(t);if(!e)throw new H(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[e.source.key,e.target.key]}opposite(t,e){t=""+t,e=""+e;const r=this._edges.get(e);if(!r)throw new H(`Graph.opposite: could not find the "${e}" edge in the graph.`);const s=r.source.key,n=r.target.key;if(t===s)return n;if(t===n)return s;throw new H(`Graph.opposite: the "${t}" node is not attached to the "${e}" edge (${s}, ${n}).`)}hasExtremity(t,e){t=""+t,e=""+e;const r=this._edges.get(t);if(!r)throw new H(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return r.source.key===e||r.target.key===e}isUndirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new H(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return e.undirected}isDirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new H(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!e.undirected}isSelfLoop(t){t=""+t;const e=this._edges.get(t);if(!e)throw new H(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return e.source===e.target}addNode(t,e){return Yk(this,t,e).key}mergeNode(t,e){if(e&&!Ae(e))throw new Z(`Graph.mergeNode: invalid attributes. Expecting an object but got "${e}"`);t=""+t,e=e||{};let r=this._nodes.get(t);return r?(e&&(me(r.attributes,e),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:r.attributes,data:e})),[t,!1]):(r=new this.NodeDataClass(t,e),this._nodes.set(t,r),this.emit("nodeAdded",{key:t,attributes:e}),[t,!0])}updateNode(t,e){if(e&&typeof e!="function")throw new Z(`Graph.updateNode: invalid updater function. Expecting a function but got "${e}"`);t=""+t;let r=this._nodes.get(t);if(r){if(e){const n=r.attributes;r.attributes=e(n),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:r.attributes})}return[t,!1]}const s=e?e({}):{};return r=new this.NodeDataClass(t,s),this._nodes.set(t,r),this.emit("nodeAdded",{key:t,attributes:s}),[t,!0]}dropNode(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new H(`Graph.dropNode: could not find the "${t}" node in the graph.`);let r;if(this.type!=="undirected"){for(const s in e.out){r=e.out[s];do Ms(this,r),r=r.next;while(r)}for(const s in e.in){r=e.in[s];do Ms(this,r),r=r.next;while(r)}}if(this.type!=="directed")for(const s in e.undirected){r=e.undirected[s];do Ms(this,r),r=r.next;while(r)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:e.attributes})}dropEdge(t){let e;if(arguments.length>1){const r=""+arguments[0],s=""+arguments[1];if(e=ti(this,r,s,this.type),!e)throw new H(`Graph.dropEdge: could not find the "${r}" -> "${s}" edge in the graph.`)}else if(t=""+t,e=this._edges.get(t),!e)throw new H(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return Ms(this,e),this}dropDirectedEdge(t,e){if(arguments.length<2)throw new ct("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ct("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,e=""+e;const r=ti(this,t,e,"directed");if(!r)throw new H(`Graph.dropDirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Ms(this,r),this}dropUndirectedEdge(t,e){if(arguments.length<2)throw new ct("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ct("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const r=ti(this,t,e,"undirected");if(!r)throw new H(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Ms(this,r),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let e;for(;e=t.next(),e.done!==!0;)e.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,e){return this._attributes[t]=e,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,e){if(typeof e!="function")throw new Z("Graph.updateAttribute: updater should be a function.");const r=this._attributes[t];return this._attributes[t]=e(r),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!Ae(t))throw new Z("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!Ae(t))throw new Z("Graph.mergeAttributes: provided attributes are not a plain object.");return me(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new Z("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,e){if(typeof t!="function")throw new Z("Graph.updateEachNodeAttributes: expecting an updater function.");if(e&&!xy(e))throw new Z("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const r=this._nodes.values();let s,n;for(;s=r.next(),s.done!==!0;)n=s.value,n.attributes=t(n.key,n.attributes);this.emit("eachNodeAttributesUpdated",{hints:e||null})}updateEachEdgeAttributes(t,e){if(typeof t!="function")throw new Z("Graph.updateEachEdgeAttributes: expecting an updater function.");if(e&&!xy(e))throw new Z("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const r=this._edges.values();let s,n,o,a;for(;s=r.next(),s.done!==!0;)n=s.value,o=n.source,a=n.target,n.attributes=t(n.key,n.attributes,o.key,a.key,o.attributes,a.attributes,n.undirected);this.emit("eachEdgeAttributesUpdated",{hints:e||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new Z("Graph.forEachAdjacencyEntry: expecting a callback.");Ca(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new Z("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");Ca(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new Z("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");Ca(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new Z("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");Ca(!1,!0,!0,this,t)}nodes(){return typeof Array.from=="function"?Array.from(this._nodes.keys()):Tx(this._nodes.keys(),this._nodes.size)}forEachNode(t){if(typeof t!="function")throw new Z("Graph.forEachNode: expecting a callback.");const e=this._nodes.values();let r,s;for(;r=e.next(),r.done!==!0;)s=r.value,t(s.key,s.attributes)}findNode(t){if(typeof t!="function")throw new Z("Graph.findNode: expecting a callback.");const e=this._nodes.values();let r,s;for(;r=e.next(),r.done!==!0;)if(s=r.value,t(s.key,s.attributes))return s.key}mapNodes(t){if(typeof t!="function")throw new Z("Graph.mapNode: expecting a callback.");const e=this._nodes.values();let r,s;const n=new Array(this.order);let o=0;for(;r=e.next(),r.done!==!0;)s=r.value,n[o++]=t(s.key,s.attributes);return n}someNode(t){if(typeof t!="function")throw new Z("Graph.someNode: expecting a callback.");const e=this._nodes.values();let r,s;for(;r=e.next(),r.done!==!0;)if(s=r.value,t(s.key,s.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new Z("Graph.everyNode: expecting a callback.");const e=this._nodes.values();let r,s;for(;r=e.next(),r.done!==!0;)if(s=r.value,!t(s.key,s.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new Z("Graph.filterNodes: expecting a callback.");const e=this._nodes.values();let r,s;const n=[];for(;r=e.next(),r.done!==!0;)s=r.value,t(s.key,s.attributes)&&n.push(s.key);return n}reduceNodes(t,e){if(typeof t!="function")throw new Z("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new Z("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let r=e;const s=this._nodes.values();let n,o;for(;n=s.next(),n.done!==!0;)o=n.value,r=t(r,o.key,o.attributes);return r}nodeEntries(){const t=this._nodes.values();return new ei(()=>{const e=t.next();if(e.done)return e;const r=e.value;return{value:{node:r.key,attributes:r.attributes},done:!1}})}export(){const t=new Array(this._nodes.size);let e=0;this._nodes.forEach((s,n)=>{t[e++]=Gk(n,s)});const r=new Array(this._edges.size);return e=0,this._edges.forEach((s,n)=>{r[e++]=$k(this.type,n,s)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:r}}import(t,e=!1){if(t instanceof jt)return t.forEachNode((h,l)=>{e?this.mergeNode(h,l):this.addNode(h,l)}),t.forEachEdge((h,l,u,d,c,f,p)=>{e?p?this.mergeUndirectedEdgeWithKey(h,u,d,l):this.mergeDirectedEdgeWithKey(h,u,d,l):p?this.addUndirectedEdgeWithKey(h,u,d,l):this.addDirectedEdgeWithKey(h,u,d,l)}),this;if(!Ae(t))throw new Z("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!Ae(t.attributes))throw new Z("Graph.import: invalid attributes. Expecting a plain object.");e?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let r,s,n,o,a;if(t.nodes){if(n=t.nodes,!Array.isArray(n))throw new Z("Graph.import: invalid nodes. Expecting an array.");for(r=0,s=n.length;r<s;r++){o=n[r],Hk(o);const{key:h,attributes:l}=o;e?this.mergeNode(h,l):this.addNode(h,l)}}if(t.edges){let h=!1;if(this.type==="undirected"&&(h=!0),n=t.edges,!Array.isArray(n))throw new Z("Graph.import: invalid edges. Expecting an array.");for(r=0,s=n.length;r<s;r++){a=n[r],Xk(a);const{source:l,target:u,attributes:d,undirected:c=h}=a;let f;"key"in a?(f=e?c?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:c?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,a.key,l,u,d)):(f=e?c?this.mergeUndirectedEdge:this.mergeDirectedEdge:c?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,u,d))}}return this}nullCopy(t){const e=new jt(me({},this._options,t));return e.replaceAttributes(me({},this.getAttributes())),e}emptyCopy(t){const e=this.nullCopy(t);return this._nodes.forEach((r,s)=>{const n=me({},r.attributes);r=new e.NodeDataClass(s,n),e._nodes.set(s,r)}),e}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new ct(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new ct("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new ct("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const e=this.emptyCopy(t),r=this._edges.values();let s,n;for(;s=r.next(),s.done!==!0;)n=s.value,Ox(e,"copy",!1,n.undirected,n.key,n.source.key,n.target.key,me({},n.attributes));return e}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((n,o)=>{t[o]=n.attributes});const e={},r={};this._edges.forEach((n,o)=>{const a=n.undirected?"--":"->";let h="",l=n.source.key,u=n.target.key,d;n.undirected&&l>u&&(d=l,l=u,u=d);const c=`(${l})${a}(${u})`;o.startsWith("geid_")?this.multi&&(typeof r[c]>"u"?r[c]=0:r[c]++,h+=`${r[c]}. `):h+=`[${o}]: `,h+=c,e[h]=n.attributes});const s={};for(const n in this)this.hasOwnProperty(n)&&!by.has(n)&&typeof this[n]!="function"&&typeof n!="symbol"&&(s[n]=this[n]);return s.attributes=this._attributes,s.nodes=t,s.edges=e,Ye(s,"constructor",this.constructor),s}}typeof Symbol<"u"&&(jt.prototype[Symbol.for("nodejs.util.inspect.custom")]=jt.prototype.inspect);Wk.forEach(i=>{["add","merge","update"].forEach(t=>{const e=i.name(t),r=t==="add"?Ox:qk;i.generateKey?jt.prototype[e]=function(s,n,o){return r(this,e,!0,(i.type||this.type)==="undirected",null,s,n,o,t==="update")}:jt.prototype[e]=function(s,n,o,a){return r(this,e,!1,(i.type||this.type)==="undirected",s,n,o,a,t==="update")}})});sk(jt);mk(jt);Pk(jt);Uk(jt);class Bx extends jt{constructor(t){const e=me({type:"directed"},t);if("multi"in e&&e.multi!==!1)throw new Z("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="directed")throw new Z('DirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class Fx extends jt{constructor(t){const e=me({type:"undirected"},t);if("multi"in e&&e.multi!==!1)throw new Z("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="undirected")throw new Z('UndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class Dx extends jt{constructor(t){const e=me({multi:!0},t);if("multi"in e&&e.multi!==!0)throw new Z("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(e)}}class Lx extends jt{constructor(t){const e=me({type:"directed",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new Z("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="directed")throw new Z('MultiDirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class kx extends jt{constructor(t){const e=me({type:"undirected",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new Z("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="undirected")throw new Z('MultiUndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}function En(i){i.from=function(t,e){const r=me({},t.options,e),s=new i(r);return s.import(t),s}}En(jt);En(Bx);En(Fx);En(Dx);En(Lx);En(kx);jt.Graph=jt;jt.DirectedGraph=Bx;jt.UndirectedGraph=Fx;jt.MultiGraph=Dx;jt.MultiDirectedGraph=Lx;jt.MultiUndirectedGraph=kx;jt.InvalidArgumentsGraphError=Z;jt.NotFoundGraphError=H;jt.UsageGraphError=ct;function Kk(i,t){const e={id:"ROOT"},r=[...new Set(i.filter(c=>c.SUBMODULE>t).map(c=>c.SUBMODULE))].filter(c=>c).map(c=>{const f=i.find(p=>p.SUBMODULE===c);return{id:"submodule-"+c,parent:"ROOT",NAME:f.SUBMODULE_NAME,type:"tier1"}}),s=[...new Set(i.filter(c=>c.SEGMENT&&c.SUBMODULE&&+c.SUBMODULE>t).map(c=>c.SUBMODULE+"_"+c.SEGMENT))].filter(c=>c!=="null_null").map(c=>{const f=i.find(p=>p.SUBMODULE===+c.split("_")[0]&&p.SEGMENT===+c.split("_")[1]);return{id:"segment-"+c,parent:"submodule-"+c.split("_")[0],NAME:f.SEGMENT_NAME,type:"tier2"}});let n=[e];i.forEach(c=>{let f;c.type==="tier1"?f="ROOT":c.type==="tier2"?f="submodule-"+c.SUBMODULE:f="segment-"+c.SUBMODULE+"_"+c.SEGMENT,n.push({parent:f,id:c.id,NAME:c.NAME,type:c.type})}),n=n.concat(r).concat(s);const o={},a=[];n.forEach(c=>{o[c.id]=c});for(const c in o)a.push(o[c]);n=a;function h(c,f){c.append("span").text(f.NAME),!(f.parent==="ROOT"||f.type==="tier1"||f.type==="tier2")&&c.append("input").attr("type","checkbox")}function l(c,f){const p=c.append("span").attr("class","list-label-"+f.depth);if(p.append("span").classed("arrow",!0),p.call(h,f.data),!f.hasOwnProperty("children"))return;const m=c.append("ul").style("list-style-type","none").selectAll("li").data(f.children,g=>g.NAME);m.exit().remove(),m.enter().append("li").attr("class","list-item-"+f.depth).style("cursor","pointer").merge(m).each(function(g){re(this).call(l,g)}),p.select(".arrow").text(" ")}function u(c){c.classed("viewport",!0).style("overflow-y","scroll").style("height","calc(100vh - 170px)").append("div").classed("body",!0).style("transform","scale(1.5)").style("transform-origin","top left")}function d(c,f){const p=SD().id(m=>m.id).parentId(m=>m.parent)(f);p.eachBefore(m=>{m.children&&m.children.sort((g,y)=>g.data.id.localeCompare(y.data.id))}),c.select(".body").call(l,p),c.select(".body > span").remove(),c.select(".body > ul").style("padding-left",0)}re("#view div").remove(),re("#view").append("div").call(u).call(d,n)}function or(i){return Array.isArray?Array.isArray(i):$x(i)==="[object Array]"}const Zk=1/0;function Qk(i){if(typeof i=="string")return i;let t=i+"";return t=="0"&&1/i==-Zk?"-0":t}function Jk(i){return i==null?"":Qk(i)}function Ci(i){return typeof i=="string"}function Ux(i){return typeof i=="number"}function tU(i){return i===!0||i===!1||eU(i)&&$x(i)=="[object Boolean]"}function Gx(i){return typeof i=="object"}function eU(i){return Gx(i)&&i!==null}function Ve(i){return i!=null}function Nu(i){return!i.trim().length}function $x(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}const iU="Incorrect 'index' type",rU=i=>`Invalid value for key ${i}`,sU=i=>`Pattern length exceeds max of ${i}.`,nU=i=>`Missing ${i} property in key`,oU=i=>`Property 'weight' in key '${i}' must be a positive integer`,Ey=Object.prototype.hasOwnProperty;class aU{constructor(t){this._keys=[],this._keyMap={};let e=0;t.forEach(r=>{let s=Hx(r);this._keys.push(s),this._keyMap[s.id]=s,e+=s.weight}),this._keys.forEach(r=>{r.weight/=e})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Hx(i){let t=null,e=null,r=null,s=1,n=null;if(Ci(i)||or(i))r=i,t=Ty(i),e=md(i);else{if(!Ey.call(i,"name"))throw new Error(nU("name"));const o=i.name;if(r=o,Ey.call(i,"weight")&&(s=i.weight,s<=0))throw new Error(oU(o));t=Ty(o),e=md(o),n=i.getFn}return{path:t,id:e,weight:s,src:r,getFn:n}}function Ty(i){return or(i)?i:i.split(".")}function md(i){return or(i)?i.join("."):i}function hU(i,t){let e=[],r=!1;const s=(n,o,a)=>{if(Ve(n))if(!o[a])e.push(n);else{let h=o[a];const l=n[h];if(!Ve(l))return;if(a===o.length-1&&(Ci(l)||Ux(l)||tU(l)))e.push(Jk(l));else if(or(l)){r=!0;for(let u=0,d=l.length;u<d;u+=1)s(l[u],o,a+1)}else o.length&&s(l,o,a+1)}};return s(i,Ci(t)?t.split("."):t,0),r?e:e[0]}const lU={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},uU={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(i,t)=>i.score===t.score?i.idx<t.idx?-1:1:i.score<t.score?-1:1},cU={location:0,threshold:.6,distance:100},dU={useExtendedSearch:!1,getFn:hU,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ft={...uU,...lU,...cU,...dU};const fU=/[^ ]+/g;function pU(i=1,t=3){const e=new Map,r=Math.pow(10,t);return{get(s){const n=s.match(fU).length;if(e.has(n))return e.get(n);const o=1/Math.pow(n,.5*i),a=parseFloat(Math.round(o*r)/r);return e.set(n,a),a},clear(){e.clear()}}}class wf{constructor({getFn:t=ft.getFn,fieldNormWeight:e=ft.fieldNormWeight}={}){this.norm=pU(e,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((e,r)=>{this._keysMap[e.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ci(this.docs[0])?this.docs.forEach((t,e)=>{this._addString(t,e)}):this.docs.forEach((t,e)=>{this._addObject(t,e)}),this.norm.clear())}add(t){const e=this.size();Ci(t)?this._addString(t,e):this._addObject(t,e)}removeAt(t){this.records.splice(t,1);for(let e=t,r=this.size();e<r;e+=1)this.records[e].i-=1}getValueForItemAtKeyId(t,e){return t[this._keysMap[e]]}size(){return this.records.length}_addString(t,e){if(!Ve(t)||Nu(t))return;let r={v:t,i:e,n:this.norm.get(t)};this.records.push(r)}_addObject(t,e){let r={i:e,$:{}};this.keys.forEach((s,n)=>{let o=s.getFn?s.getFn(t):this.getFn(t,s.path);if(Ve(o)){if(or(o)){let a=[];const h=[{nestedArrIndex:-1,value:o}];for(;h.length;){const{nestedArrIndex:l,value:u}=h.pop();if(Ve(u))if(Ci(u)&&!Nu(u)){let d={v:u,i:l,n:this.norm.get(u)};a.push(d)}else or(u)&&u.forEach((d,c)=>{h.push({nestedArrIndex:c,value:d})})}r.$[n]=a}else if(Ci(o)&&!Nu(o)){let a={v:o,n:this.norm.get(o)};r.$[n]=a}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Xx(i,t,{getFn:e=ft.getFn,fieldNormWeight:r=ft.fieldNormWeight}={}){const s=new wf({getFn:e,fieldNormWeight:r});return s.setKeys(i.map(Hx)),s.setSources(t),s.create(),s}function mU(i,{getFn:t=ft.getFn,fieldNormWeight:e=ft.fieldNormWeight}={}){const{keys:r,records:s}=i,n=new wf({getFn:t,fieldNormWeight:e});return n.setKeys(r),n.setIndexRecords(s),n}function Ra(i,{errors:t=0,currentLocation:e=0,expectedLocation:r=0,distance:s=ft.distance,ignoreLocation:n=ft.ignoreLocation}={}){const o=t/i.length;if(n)return o;const a=Math.abs(r-e);return s?o+a/s:a?1:o}function gU(i=[],t=ft.minMatchCharLength){let e=[],r=-1,s=-1,n=0;for(let o=i.length;n<o;n+=1){let a=i[n];a&&r===-1?r=n:!a&&r!==-1&&(s=n-1,s-r+1>=t&&e.push([r,s]),r=-1)}return i[n-1]&&n-r>=t&&e.push([r,n-1]),e}const Zr=32;function yU(i,t,e,{location:r=ft.location,distance:s=ft.distance,threshold:n=ft.threshold,findAllMatches:o=ft.findAllMatches,minMatchCharLength:a=ft.minMatchCharLength,includeMatches:h=ft.includeMatches,ignoreLocation:l=ft.ignoreLocation}={}){if(t.length>Zr)throw new Error(sU(Zr));const u=t.length,d=i.length,c=Math.max(0,Math.min(r,d));let f=n,p=c;const m=a>1||h,g=m?Array(d):[];let y;for(;(y=i.indexOf(t,p))>-1;){let S=Ra(t,{currentLocation:y,expectedLocation:c,distance:s,ignoreLocation:l});if(f=Math.min(S,f),p=y+u,m){let A=0;for(;A<u;)g[y+A]=1,A+=1}}p=-1;let _=[],v=1,x=u+d;const b=1<<u-1;for(let S=0;S<u;S+=1){let A=0,R=x;for(;A<R;)Ra(t,{errors:S,currentLocation:c+R,expectedLocation:c,distance:s,ignoreLocation:l})<=f?A=R:x=R,R=Math.floor((x-A)/2+A);x=R;let L=Math.max(1,c-R+1),B=o?d:Math.min(c+R,d)+u,P=Array(B+2);P[B+1]=(1<<S)-1;for(let N=B;N>=L;N-=1){let q=N-1,Y=e[i.charAt(q)];if(m&&(g[q]=+!!Y),P[N]=(P[N+1]<<1|1)&Y,S&&(P[N]|=(_[N+1]|_[N])<<1|1|_[N+1]),P[N]&b&&(v=Ra(t,{errors:S,currentLocation:q,expectedLocation:c,distance:s,ignoreLocation:l}),v<=f)){if(f=v,p=q,p<=c)break;L=Math.max(1,2*c-p)}}if(Ra(t,{errors:S+1,currentLocation:c,expectedLocation:c,distance:s,ignoreLocation:l})>f)break;_=P}const M={isMatch:p>=0,score:Math.max(.001,v)};if(m){const S=gU(g,a);S.length?h&&(M.indices=S):M.isMatch=!1}return M}function _U(i){let t={};for(let e=0,r=i.length;e<r;e+=1){const s=i.charAt(e);t[s]=(t[s]||0)|1<<r-e-1}return t}const Hh=String.prototype.normalize?i=>i.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):i=>i;class zx{constructor(t,{location:e=ft.location,threshold:r=ft.threshold,distance:s=ft.distance,includeMatches:n=ft.includeMatches,findAllMatches:o=ft.findAllMatches,minMatchCharLength:a=ft.minMatchCharLength,isCaseSensitive:h=ft.isCaseSensitive,ignoreDiacritics:l=ft.ignoreDiacritics,ignoreLocation:u=ft.ignoreLocation}={}){if(this.options={location:e,threshold:r,distance:s,includeMatches:n,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:h,ignoreDiacritics:l,ignoreLocation:u},t=h?t:t.toLowerCase(),t=l?Hh(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const d=(f,p)=>{this.chunks.push({pattern:f,alphabet:_U(f),startIndex:p})},c=this.pattern.length;if(c>Zr){let f=0;const p=c%Zr,m=c-p;for(;f<m;)d(this.pattern.substr(f,Zr),f),f+=Zr;if(p){const g=c-Zr;d(this.pattern.substr(g),g)}}else d(this.pattern,0)}searchIn(t){const{isCaseSensitive:e,ignoreDiacritics:r,includeMatches:s}=this.options;if(t=e?t:t.toLowerCase(),t=r?Hh(t):t,this.pattern===t){let m={isMatch:!0,score:0};return s&&(m.indices=[[0,t.length-1]]),m}const{location:n,distance:o,threshold:a,findAllMatches:h,minMatchCharLength:l,ignoreLocation:u}=this.options;let d=[],c=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:g,startIndex:y})=>{const{isMatch:_,score:v,indices:x}=yU(t,m,g,{location:n+y,distance:o,threshold:a,findAllMatches:h,minMatchCharLength:l,includeMatches:s,ignoreLocation:u});_&&(f=!0),c+=v,_&&x&&(d=[...d,...x])});let p={isMatch:f,score:f?c/this.chunks.length:1};return f&&s&&(p.indices=d),p}}class Rr{constructor(t){this.pattern=t}static isMultiMatch(t){return Ay(t,this.multiRegex)}static isSingleMatch(t){return Ay(t,this.singleRegex)}search(){}}function Ay(i,t){const e=i.match(t);return e?e[1]:null}class vU extends Rr{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const e=t===this.pattern;return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class xU extends Rr{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const r=t.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class bU extends Rr{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const e=t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}}class wU extends Rr{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const e=!t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class EU extends Rr{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const e=t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class TU extends Rr{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const e=!t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}}class Vx extends Rr{constructor(t,{location:e=ft.location,threshold:r=ft.threshold,distance:s=ft.distance,includeMatches:n=ft.includeMatches,findAllMatches:o=ft.findAllMatches,minMatchCharLength:a=ft.minMatchCharLength,isCaseSensitive:h=ft.isCaseSensitive,ignoreDiacritics:l=ft.ignoreDiacritics,ignoreLocation:u=ft.ignoreLocation}={}){super(t),this._bitapSearch=new zx(t,{location:e,threshold:r,distance:s,includeMatches:n,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:h,ignoreDiacritics:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Wx extends Rr{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let e=0,r;const s=[],n=this.pattern.length;for(;(r=t.indexOf(this.pattern,e))>-1;)e=r+n,s.push([r,e-1]);const o=!!s.length;return{isMatch:o,score:o?0:1,indices:s}}}const gd=[vU,Wx,bU,wU,TU,EU,xU,Vx],Sy=gd.length,AU=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,SU="|";function IU(i,t={}){return i.split(SU).map(e=>{let r=e.trim().split(AU).filter(n=>n&&!!n.trim()),s=[];for(let n=0,o=r.length;n<o;n+=1){const a=r[n];let h=!1,l=-1;for(;!h&&++l<Sy;){const u=gd[l];let d=u.isMultiMatch(a);d&&(s.push(new u(d,t)),h=!0)}if(!h)for(l=-1;++l<Sy;){const u=gd[l];let d=u.isSingleMatch(a);if(d){s.push(new u(d,t));break}}}return s})}const CU=new Set([Vx.type,Wx.type]);class RU{constructor(t,{isCaseSensitive:e=ft.isCaseSensitive,ignoreDiacritics:r=ft.ignoreDiacritics,includeMatches:s=ft.includeMatches,minMatchCharLength:n=ft.minMatchCharLength,ignoreLocation:o=ft.ignoreLocation,findAllMatches:a=ft.findAllMatches,location:h=ft.location,threshold:l=ft.threshold,distance:u=ft.distance}={}){this.query=null,this.options={isCaseSensitive:e,ignoreDiacritics:r,includeMatches:s,minMatchCharLength:n,findAllMatches:a,ignoreLocation:o,location:h,threshold:l,distance:u},t=e?t:t.toLowerCase(),t=r?Hh(t):t,this.pattern=t,this.query=IU(this.pattern,this.options)}static condition(t,e){return e.useExtendedSearch}searchIn(t){const e=this.query;if(!e)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:s,ignoreDiacritics:n}=this.options;t=s?t:t.toLowerCase(),t=n?Hh(t):t;let o=0,a=[],h=0;for(let l=0,u=e.length;l<u;l+=1){const d=e[l];a.length=0,o=0;for(let c=0,f=d.length;c<f;c+=1){const p=d[c],{isMatch:m,indices:g,score:y}=p.search(t);if(m){if(o+=1,h+=y,r){const _=p.constructor.type;CU.has(_)?a=[...a,...g]:a.push(g)}}else{h=0,o=0,a.length=0;break}}if(o){let c={isMatch:!0,score:h/o};return r&&(c.indices=a),c}}return{isMatch:!1,score:1}}}const yd=[];function MU(...i){yd.push(...i)}function _d(i,t){for(let e=0,r=yd.length;e<r;e+=1){let s=yd[e];if(s.condition(i,t))return new s(i,t)}return new zx(i,t)}const Xh={AND:"$and",OR:"$or"},vd={PATH:"$path",PATTERN:"$val"},xd=i=>!!(i[Xh.AND]||i[Xh.OR]),PU=i=>!!i[vd.PATH],NU=i=>!or(i)&&Gx(i)&&!xd(i),Iy=i=>({[Xh.AND]:Object.keys(i).map(t=>({[t]:i[t]}))});function jx(i,t,{auto:e=!0}={}){const r=s=>{let n=Object.keys(s);const o=PU(s);if(!o&&n.length>1&&!xd(s))return r(Iy(s));if(NU(s)){const h=o?s[vd.PATH]:n[0],l=o?s[vd.PATTERN]:s[h];if(!Ci(l))throw new Error(rU(h));const u={keyId:md(h),pattern:l};return e&&(u.searcher=_d(l,t)),u}let a={children:[],operator:n[0]};return n.forEach(h=>{const l=s[h];or(l)&&l.forEach(u=>{a.children.push(r(u))})}),a};return xd(i)||(i=Iy(i)),r(i)}function OU(i,{ignoreFieldNorm:t=ft.ignoreFieldNorm}){i.forEach(e=>{let r=1;e.matches.forEach(({key:s,norm:n,score:o})=>{const a=s?s.weight:null;r*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(t?1:n))}),e.score=r})}function BU(i,t){const e=i.matches;t.matches=[],Ve(e)&&e.forEach(r=>{if(!Ve(r.indices)||!r.indices.length)return;const{indices:s,value:n}=r;let o={indices:s,value:n};r.key&&(o.key=r.key.src),r.idx>-1&&(o.refIndex=r.idx),t.matches.push(o)})}function FU(i,t){t.score=i.score}function DU(i,t,{includeMatches:e=ft.includeMatches,includeScore:r=ft.includeScore}={}){const s=[];return e&&s.push(BU),r&&s.push(FU),i.map(n=>{const{idx:o}=n,a={item:t[o],refIndex:o};return s.length&&s.forEach(h=>{h(n,a)}),a})}class Tn{constructor(t,e={},r){this.options={...ft,...e},this.options.useExtendedSearch,this._keyStore=new aU(this.options.keys),this.setCollection(t,r)}setCollection(t,e){if(this._docs=t,e&&!(e instanceof wf))throw new Error(iU);this._myIndex=e||Xx(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){Ve(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const e=[];for(let r=0,s=this._docs.length;r<s;r+=1){const n=this._docs[r];t(n,r)&&(this.removeAt(r),r-=1,s-=1,e.push(n))}return e}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:e=-1}={}){const{includeMatches:r,includeScore:s,shouldSort:n,sortFn:o,ignoreFieldNorm:a}=this.options;let h=Ci(t)?Ci(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return OU(h,{ignoreFieldNorm:a}),n&&h.sort(o),Ux(e)&&e>-1&&(h=h.slice(0,e)),DU(h,this._docs,{includeMatches:r,includeScore:s})}_searchStringList(t){const e=_d(t,this.options),{records:r}=this._myIndex,s=[];return r.forEach(({v:n,i:o,n:a})=>{if(!Ve(n))return;const{isMatch:h,score:l,indices:u}=e.searchIn(n);h&&s.push({item:n,idx:o,matches:[{score:l,value:n,norm:a,indices:u}]})}),s}_searchLogical(t){const e=jx(t,this.options),r=(a,h,l)=>{if(!a.children){const{keyId:d,searcher:c}=a,f=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(h,d),searcher:c});return f&&f.length?[{idx:l,item:h,matches:f}]:[]}const u=[];for(let d=0,c=a.children.length;d<c;d+=1){const f=a.children[d],p=r(f,h,l);if(p.length)u.push(...p);else if(a.operator===Xh.AND)return[]}return u},s=this._myIndex.records,n={},o=[];return s.forEach(({$:a,i:h})=>{if(Ve(a)){let l=r(e,a,h);l.length&&(n[h]||(n[h]={idx:h,item:a,matches:[]},o.push(n[h])),l.forEach(({matches:u})=>{n[h].matches.push(...u)}))}}),o}_searchObjectList(t){const e=_d(t,this.options),{keys:r,records:s}=this._myIndex,n=[];return s.forEach(({$:o,i:a})=>{if(!Ve(o))return;let h=[];r.forEach((l,u)=>{h.push(...this._findMatches({key:l,value:o[u],searcher:e}))}),h.length&&n.push({idx:a,item:o,matches:h})}),n}_findMatches({key:t,value:e,searcher:r}){if(!Ve(e))return[];let s=[];if(or(e))e.forEach(({v:n,i:o,n:a})=>{if(!Ve(n))return;const{isMatch:h,score:l,indices:u}=r.searchIn(n);h&&s.push({score:l,key:t,value:n,idx:o,norm:a,indices:u})});else{const{v:n,n:o}=e,{isMatch:a,score:h,indices:l}=r.searchIn(n);a&&s.push({score:h,key:t,value:n,norm:o,indices:l})}return s}}Tn.version="7.1.0";Tn.createIndex=Xx;Tn.parseIndex=mU;Tn.config=ft;Tn.parseQuery=jx;MU(RU);async function LU({nodes:i,links:t},{containerSelector:e,nodeId:r="id",sourceId:s="source",targetId:n="target",nodeGroup:o,nodeGroups:a,nodeRadius:h,nodeTitle:l,nodeFill:u="0xFFFFFF",nodeStroke:d="0xFFFFFF",nodeStrokeWidth:c=4,nodeFillOpacity:f=1,nodeStrokeOpacity:p=1,nodeMinSize:m=6,linkStroke:g="0xFFFFFF",linkStrokeOpacity:y=.7,linkStrokeWidth:_=1.5,labelColor:v="white",labelScale:x=2,colors:b=HD,width:M=640,height:S=400,tooltipStyles:A={width:"300px",height:"auto",padding:"10px","background-color":"white",border:"1px solid black","z-index":10}}={}){console.log("received data",i,t);const R=0;let L=0,B={},P={},E=[],N=[],q=["NAME","Parameter Explanation","SUBMODULE_NAME","SEGMENT_NAME"],Y=[],et=0,ut,yt=!1,I=!1,C=!1,z=!0,ht=!1,ot=!0,pt=!1,vt=!0,Ct=1,Dt="Whole";const qt=_i(i,w=>w[r]).map(Ps),$t=_i(t,w=>w[s]).map(Ps),xt=_i(t,w=>w[n]).map(Ps);i=_i(i,(w,F)=>({id:qt[F],...w,type:"tier3"})),t=_i(t,(w,F)=>({source:$t[F],target:xt[F]}));const At=[...new Set(i.filter(w=>w.SUBMODULE>R).map(w=>w.SUBMODULE))].filter(w=>w).map(w=>{B["submodule-"+w]=0,P[w]=z?1:0;const F=i.find(V=>V.SUBMODULE===w);return{id:"submodule-"+w,NAME:F?F.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE_NAME:F?F.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE:w,type:"tier1"}}),Tt=[...new Set(i.filter(w=>w.SUBMODULE>R).map(w=>w.SUBMODULE+"_"+w.SEGMENT))].filter(w=>w!=="null_null").map(w=>{B["segment-"+w]=0,P[w]=z?0:1;const F=i.find(V=>V.SUBMODULE===+w.split("_")[0]&&V.SEGMENT===+w.split("_")[1]);return{id:"segment-"+w,NAME:F?F.SEGMENT_NAME.split(",")[0]:"",SUBMODULE_NAME:F?F.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE:+w.split("_")[0],SEGMENT_NAME:F?F.SEGMENT_NAME.split(",")[0]:"",SEGMENT:+w.split("_")[1],type:"tier2"}});for(let w=0;w<i.length;w++)B[i[w].id]=0;for(let w=0;w<t.length;w++){let F=t[w];const V=i.find(X=>X.id===F.source),D=i.find(X=>X.id===F.target);B[F.target]++,B["segment-"+D.SUBMODULE+"_"+D.SEGMENT]++,B["submodule-"+D.SUBMODULE]++,F.sourceSegment=V.SEGMENT,F.targetSegment=D.SEGMENT,F.sourceSubmodule=V.SUBMODULE,F.targetSubmodule=D.SUBMODULE}let Qt=Nr(i,t,!0,"SUBMODULE",R),T=Nr(i.concat(Tt),t,z,"SUBMODULE",R),$e=[...Qt.nodes],Se=[...Qt.links],Li=[...Qt.nodes,...Tt,...At];const Ef=GD().domain(h?OP(i,h):[0,YP(Object.values(B))]).range([m,m*5]).clamp(!0),Lo=re(e).append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden");for(const w in A)Lo.style(w,A[w]);const gi=re(e).append("div").attr("class","message");if(gi.append("h2").attr("class","clickedNodes-1"),gi.append("h2").attr("class","clickedNodes-2"),gi.append("h3").attr("class","shortestPath-status").style("color","white"),gi.append("h3").attr("class","clickedNodes-reset").attr("text-decoration","underline").attr("pointer-events","auto").style("cursor","pointer").style("color","white").html("RESET").on("click",function(){ws()}),window.location.href.includes("?state=%")){let w=window.location.href.split("?state=%")[1].split("-");w[0]=w[0].slice(2),w[w.length-1]=w[w.length-1].slice(0,-3),T.nodes=Li.filter(D=>Ns(w,D.NAME.toString())),T.links=Se.filter(D=>Ma(w,D));for(let D=0;D<T.nodes.length;D++)Sf(T.nodes[D]),If(T.nodes[D]),Cf(T.nodes[D]);const F=T.nodes.map(D=>D.id);let V=[];for(let D=0;D<T.links.length;D++)Ma(F,T.links[D])&&V.push(T.links[D]);T.links=V,At.map(D=>{P[D.SUBMODULE]=1}),Tt.map(D=>{P[D.SEGMENT]=0})}const Me=HF().force("link",BF().id(w=>w.id)).force("x",zF(w=>w.x)).force("y",VF(w=>w.y)).force("collide",NF().radius(w=>w.type==="tier1"||w.type==="tier2"?w.radius*2:w.radius).iterations(3)).force("cluster",Zx().strength(.45));Me.stop();const je=new k0({width:M,height:S,resolution:2,transparent:!0,antialias:!0,autoDensity:!0,autoStart:!0});document.querySelector(e).appendChild(je.view);const Pe=new SP({screenWidth:M,screenHeight:S,worldWidth:M,worldHeight:S,events:je.renderer.events});je.stage.eventMode="static",je.stage.hitArea=je.screen;const Tf=()=>{je.stage.off("pointermove"),Pe.pause=!1};je.stage.on("pointerup",Tf),je.stage.on("pointerupoutside",Tf),je.stage.addChild(Pe),Pe.drag().pinch().wheel().decelerate().clampZoom({minScale:.2,maxScale:5}),Pe.center=new Ot(0,0);const ko=new fh;ko.beginFill(u),ko.lineStyle(c,d,p),ko.drawCircle(0,0,44);const Yx=je.renderer.generateTexture(ko,{resolution:2}),Mr=new fh;let An=12;Mr.beginFill(16777215,1),Mr.lineStyle(0,16777215,1),Mr.moveTo(-An,0),Mr.lineTo(An,An),Mr.lineTo(An,-An),Mr.endFill();const qx=je.renderer.generateTexture(Mr,{resolution:2}),gl=new Ee;Pe.addChild(gl);const yl=new Ee;Pe.addChild(yl);const _l=new Ee;Pe.addChild(_l);let ki=new WeakMap,vl=new WeakMap,Pr=new WeakMap,hr=new WeakMap;bs(!0),Jx();function bs(w){const F=[],V=new Set;for(let U=0;U<T.links.length;U++){let k=T.links[U];if(Object.keys(k).length===0)continue;const K=`${Ne(k)}-${Ie(k)}`;!V.has(K)&&Ne(k)!==Ie(k)&&(V.add(K),F.push(k))}T.links=F,l===void 0?_i(T.nodes,U=>U.NAME).map(Ps):_i(T.nodes,l).map(Ps);const D=o==null?null:_i(T.nodes,o).map(Ps),X=typeof _!="function"?null:_i(T.links,_),st=typeof g!="function"?null:_i(T.links,g);D&&a===void 0&&(a=$P(D));const _t=o==null?null:Qv(a,b);for(let U=0;U<T.nodes.length;U++){let k=T.nodes[U];if(k.linkCnt=B[k.id]||0,k.color=D?_t(D[U]):u,k.radius=Ef(k.linkCnt),N.length>0){let K=N.find(mt=>mt.id===k.SUBMODULE+"_"+k.SEGMENT)||N.find(mt=>mt.id===k.SUBMODULE);K&&!k.x&&!k.y&&(k.x=K.x,k.y=K.y)}}for(let U=0;U<T.links.length;U++){let k=T.links[U];k.linkStroke=st?st[U]:g,k.linkStrokeWidth=X?X[U]:_}console.log("elements on screen",T);const St=Gn(T.nodes,T.links),$=()=>{const U=Pe.scale.x,K=[1,2,3,1/0].findIndex(mt=>U<=mt);for(let mt=0;mt<T.nodes.length;mt++){const Pt=Pr.get(T.nodes[mt]);Pt.visible=T.nodes[mt].type==="tier1"||T.nodes[mt].type==="tier2"?1:K>=3}},it=(U,k)=>{U.fx=k.x,U.fy=k.y,_e()},wt=U=>{Pe.pause=!0,je.stage.on("pointermove",function(k){it(U,Pe.toWorld(k.global))})},rt=U=>{console.log("double click on node"),U.type==="tier1"||P[U.SUBMODULE+"_"+U.SEGMENT]===1&&P[U.SUBMODULE]===0?(console.log("expand"),bl(U)):(console.log("collapse"),xl(U))};let Et=[];for(let U=0;U<Li.length;U++){let k=Li[U],K=ki.get(k),mt=Pr.get(k);if(T.nodes.findIndex(Pt=>Pt.id===k.id)===-1)K&&yl.removeChild(K),mt&&_l.removeChild(mt);else{if(!K){K=new Ee,K.name=k.id,K.cursor="pointer",K.hitArea=new So(0,0,k.radius+2),K.eventMode="static",K.visible=!Ns(E,k.id),K.on("pointerdown",function(se){et++;const ce=vl.get(se.currentTarget);et===1?pt?ut=setTimeout(function(){Af(ce,St),et=0},300):ot?ut=setTimeout(function(){Y=[ce],Qx(ce,St),et=0},300):(wt(ce),ut=setTimeout(function(){et=0},300)):et===2&&!pt&&!ot&&(clearTimeout(ut),rt(ce),et=0)}),K.on("mouseover",se=>Nf(vl.get(se.currentTarget))),K.on("mouseout",()=>Lo.style("visibility","hidden"));const Pt=new tr(Yx);Pt.name="CIRCLE",Pt.x=-k.radius,Pt.y=-k.radius,Pt.tint=k.color,Pt.alpha=f,Pt.width=k.radius*2,Pt.height=k.radius*2,K.addChild(Pt),yl.addChild(K)}if(!mt){mt=new Ee,mt.visible=k.type==="tier1"||k.type==="tier2";const Pt=new sr({fontFamily:"Lato",fontSize:k.radius*x,align:"left",fill:v,stroke:"black",strokeThickness:6}),se=new Md(k.NAME,Pt);se.name="LABEL";const ce=Wi.measureText(k.NAME,Pt);se.x=-ce.width/4,se.y=3,se.resolution=2,se.scale.set(.5),mt.addChild(se),_l.addChild(mt)}Et.push([k,K,mt])}}gl.removeChildren();let Lt=[];for(let U=0;U<T.links.length;U++){let k=T.links[U];const K=k.linkStrokeWidth,mt=T.nodes.find(Sn=>Sn.id===Ie(k)),Pt=new Ee;Pt.name=Ne(k)+"-"+Ie(k),Pt.pivot.set(0,K/2),Pt.alpha=T.links.length>200?.3:y;const se=new tr(Bt.WHITE);se.name="LINE",se.x=mt?mt.radius:0,se.y=-K/2,se.height=K,Pt.addChild(se);const ce=new tr(qx);ce.name="ARROW",ce.x=mt?mt.radius:0,ce.y=-3,ce.width=6,ce.height=6,ce.alpha=ht?1:0,Pt.addChild(ce),gl.addChild(Pt),Lt.push([k,Pt])}ki=new WeakMap(Et.map(([U,k,K])=>[U,k])),vl=new WeakMap(Et.map(([U,k,K])=>[k,U])),Pr=new WeakMap(Et.map(([U,k,K])=>[U,K])),new WeakMap(Et.map(([U,k,K])=>[K,U])),hr=new WeakMap(Lt.map(([U,k])=>[U,k])),new WeakMap(Lt.map(([U,k])=>[k,U])),Me.nodes(T.nodes).force("link").links(T.links),w?(console.log("run static graph layout"),Me.force("charge",XF().strength(z?-100:-250)),Me.alphaTarget(.1).restart(),Me.tick(Math.ceil(Math.log(Me.alphaMin())/Math.log(1-Me.alphaDecay()))),_e()):(console.log("reheat graph"),Me.stop(),Me.nodes([]).force("link").links([]),Me.nodes(T.nodes).force("link").links(T.links),Me.alphaTarget(.1).restart(),Me.tick(Math.ceil(Math.log(Me.alphaMin())/Math.log(1-Me.alphaDecay()))),_e()),N=T.nodes.filter(U=>U.type==="tier1"||U.type==="tier2").map(U=>({x:U.x,y:U.y,id:U.type==="tier1"?U.SUBMODULE:U.SUBMODULE+"_"+U.SEGMENT})),Pe.on("zoomed-end",()=>{if(Pe.dirty){if(I||yt||C)return;$(),Pe.dirty=!1}}),Kk(T.nodes,R),Of(T.nodes,pt,St),document.querySelector(".viewport").scrollTo(0,L),Tu(".list-label-2").on("click",function(U,k){if(I||yt||C)return;U.preventDefault(),U.stopPropagation(),L=document.querySelector(".viewport").scrollTop;let K=k.data;K.SUBMODULE=+K.id.split("-")[1].split("_")[0],K.SEGMENT=+K.id.split("-")[1].split("_")[1],re(this).select(".arrow").text()!==" "?(console.log("expand segment to variable nodes",K.type),bl(K)):(console.log("collapse variable nodes to segment"),K.type="tier3",xl(K));const mt=re(re(this).node().parentNode).select("ul");if(mt.size()){const Pt=mt.style("display")!=="none";re(this).select(".arrow").text(Pt?" ":" ")}}),Tu(".list-label-1").on("click",function(U,k){if(I||yt||C)return;U.preventDefault(),U.stopPropagation(),L=document.querySelector(".viewport").scrollTop;let K=k.data;K.SUBMODULE=+K.id.split("-")[1].split("_")[0],re(this).select(".arrow").text()!==" "?(console.log("expand submodule to segments",K.type),bl(K)):(console.log("collapse segments to submodules"),K.type="tier2",xl(K));const mt=re(re(this).node().parentNode).select("ul");if(mt.size()){const Pt=mt.style("display")!=="none";re(this).select(".arrow").text(Pt?" ":" ")}}),Tu(".list-label-3 input").on("change",function(U,k){U.preventDefault(),U.stopPropagation();const K=kU(re("#view"));if(console.log("checkbox click",K),K.length===0)return ws();let mt=[];if(ot&&(mt=Ou(St,K,Ct)),pt&&(Mf(K),mt=Cy(St,K),K.length===2&&(I=!0,document.querySelectorAll('input[type="checkbox"]').forEach(Pt=>Pt.disabled=!0))),!ot&&!pt){const Pt=K[K.length-1],se=T.nodes.find(ce=>ce.NAME===Pt);Pf(se),Rf(se.NAME)}mt&&mt.length>0&&Uo(mt)});function _e(){re(".animation-container").style("display","none");for(let U=0;U<T.nodes.length;U++){let k=T.nodes[U];const K=ki.get(k),mt=Pr.get(k);K.x=k.x,K.y=k.y,mt.x=k.x,mt.y=k.y}for(let U=0;U<T.links.length;U++){let k=T.links[U];const K=T.nodes.find(Sn=>Sn.id===Ie(k)),mt=T.nodes.find(Sn=>Sn.id===Ne(k)),Pt=hr.get(k);Pt.x=K.x,Pt.y=K.y,Pt.rotation=Math.atan2(mt.y-K.y,mt.x-K.x);const se=Pt.getChildByName("LINE"),ce=Math.max(Math.sqrt((mt.x-K.x)**2+(mt.y-K.y)**2)-K.radius-mt.radius,0);se.width=ce}}}function Kx(w){let F=0,V=0,D=0;for(const X of w){let st=Ef(X.linkCnt)**2;F+=X.x*st,V+=X.y*st,D+=st}return{x:F/D,y:V/D}}function Zx(){var w=.8;let F;function V(D){const X=kP(F,Kx,o),st=D*w;for(const _t of F){const{x:St,y:$}=X.get(_t.SUBMODULE);_t.vx-=(_t.x-St)*st,_t.vy-=(_t.y-$)*st}}return V.initialize=D=>F=D,V.strength=function(D){return arguments.length?(w=+D,V):w},V}function Af(w,F){if(Y.length<2&&(Y.indexOf(w.id)===-1?Y.push(w.id):Y.splice(w.id,1)),Mf(Y),Y.length===2){const V=Cy(F,Y);I=!0,V?(console.log("highlight connections"),Uo(V)):re(".shortestPath-status").html("No shortest path found. Would you like to try again?"),document.querySelectorAll('input[type="checkbox"]').forEach(D=>D.disabled=!0)}}function Qx(w,F){Nf(w);const V=Ou(F,[w],Ct);Uo(V),gi.style("visibility","visible"),C=!0}function Nr(w,F,V,D,X,st){let _t=w.filter(it=>it[D]>X);V&&(_t=_t.filter(it=>it.type!=="tier1"&&it.type!=="tier2"));const St=_t.map(it=>it.id),$=F.filter(it=>Ma(St,it));if(V===!1){const it=_t.filter(rt=>st==="Quilt"?rt.type==="tier1":rt.type==="tier2"),wt=[];return $.forEach(rt=>{if(st==="Quilt"){const Et=wt.map(_e=>_e.sourceSubmodule+"_"+_e.targetSubmodule),Lt=rt.sourceSubmodule+"_"+rt.targetSubmodule;Et.indexOf(Lt)===-1&&rt.sourceSubmodule!==null&&rt.targetSubmodule!==null&&wt.push({source:"submodule-"+rt.sourceSubmodule,target:"submodule-"+rt.targetSubmodule,sourceSegment:rt.sourceSubmodule,targetSegment:rt.targetSubmodule,sourceSubmodule:rt.sourceSubmodule,targetSubmodule:rt.targetSubmodule,type:"tier1"})}else{const Et=wt.map(_e=>_e.sourceSubmodule+"_"+_e.sourceSegment+"_"+_e.targetSubmodule+"_"+_e.targetSegment),Lt=rt.sourceSubmodule+"_"+rt.sourceSegment+"_"+rt.targetSubmodule+"_"+rt.targetSegment;Et.indexOf(Lt)===-1&&rt.sourceSubmodule!==null&&rt.sourceSegment!==null&&rt.targetSubmodule!==null&&rt.targetSegment!==null&&wt.push({source:"segment-"+rt.sourceSubmodule+"_"+rt.sourceSegment,target:"segment-"+rt.targetSubmodule+"_"+rt.targetSegment,sourceSegment:rt.sourceSegment,targetSegment:rt.targetSegment,sourceSubmodule:rt.sourceSubmodule,targetSubmodule:rt.targetSubmodule,type:"tier2"})}}),{nodes:it,links:wt}}return{nodes:_t,links:$}}function xl(w){if(w.type!=="tier1"){if(w.type==="tier2"){const F="submodule-"+w.SUBMODULE;T.nodes=T.nodes.filter(D=>D.SUBMODULE!==w.SUBMODULE),T.links=T.links.filter(D=>D.source.SUBMODULE!==w.SUBMODULE&&D.target.SUBMODULE!==w.SUBMODULE);const V=At.find(D=>D.id===F);T.nodes.push(V),Sf(w),P[w.SUBMODULE]=0}if(w.type==="tier3"){const F=$e.filter($=>$.SUBMODULE===w.SUBMODULE&&$.SEGMENT===w.SEGMENT).map($=>$.id),V=T.nodes.map($=>$.id);let D=[];T.links.forEach($=>{F.indexOf(Ne($))!==-1&&D.push($),F.indexOf(Ie($))!==-1&&D.push($),V.indexOf(Ne($))===-1&&D.push($),V.indexOf(Ie($))===-1&&D.push($)}),T.nodes=T.nodes.filter($=>F.indexOf($.id)===-1),T.links=T.links.filter($=>D.indexOf($)===-1);const X=Se.filter($=>$.sourceSubmodule===w.SUBMODULE&&$.sourceSegment===w.SEGMENT),st=Se.filter($=>$.targetSubmodule===w.SUBMODULE&&$.targetSegment===w.SEGMENT),_t="segment-"+w.SUBMODULE+"_"+w.SEGMENT,St=Tt.find($=>$.id===_t);T.nodes.push(St),st.forEach($=>{const it="segment-"+$.sourceSubmodule+"_"+$.sourceSegment,wt="submodule-"+$.sourceSubmodule,rt=Ne($);let Et={};T.nodes.findIndex(Lt=>Lt.id===rt)!==-1?Et={source:rt,target:_t}:T.nodes.findIndex(Lt=>Lt.id===it)!==-1?Et={source:it,target:_t}:T.nodes.findIndex(Lt=>Lt.id===wt)!==-1&&(Et={source:wt,target:_t}),T.links.push(Et)}),X.forEach($=>{const it="segment-"+$.targetSubmodule+"_"+$.targetSegment,wt="submodule-"+$.targetSubmodule,rt=Ie($);let Et={};T.nodes.findIndex(Lt=>Lt.id===rt)!==-1?Et={source:_t,target:rt}:T.nodes.findIndex(Lt=>Lt.id===it)!==-1?Et={source:_t,target:it}:T.nodes.findIndex(Lt=>Lt.id===wt)!==-1&&(Et={source:_t,target:wt}),T.links.push(Et)}),P[w.SUBMODULE+"_"+w.SEGMENT]=1,P[w.SUBMODULE]=1}Bu(T.nodes.map(F=>F.NAME).join("-")),re(".animation-container").style("display","flex"),bs()}}function Sf(w){const F="submodule-"+w.SUBMODULE,V=Se.filter(X=>X.sourceSubmodule===w.SUBMODULE);Se.filter(X=>X.targetSubmodule===w.SUBMODULE).forEach(X=>{const st="segment-"+X.sourceSubmodule+"_"+X.sourceSegment,_t="submodule-"+X.sourceSubmodule,St=Ne(X);let $={};T.nodes.findIndex(it=>it.id===St)!==-1?$={source:St,target:F}:T.nodes.findIndex(it=>it.id===st)!==-1?$={source:st,target:F}:T.nodes.findIndex(it=>it.id===_t)!==-1&&($={source:_t,target:F}),T.links.push($)}),V.forEach(X=>{const st="segment-"+X.targetSubmodule+"_"+X.targetSegment,_t="submodule-"+X.targetSubmodule,St=Ie(X);let $={};T.nodes.findIndex(it=>it.id===St)!==-1?$={source:F,target:St}:T.nodes.findIndex(it=>it.id===st)!==-1?$={source:F,target:st}:T.nodes.findIndex(it=>it.id===_t)!==-1&&($={source:F,target:_t}),T.links.push($)})}function bl(w){if(w.type!=="tier3"){if(w.type==="tier1"){P[w.SUBMODULE]=0;const F=Tt.filter(V=>V.SUBMODULE===w.SUBMODULE);F.forEach(V=>{P[V.SUBMODULE+"_"+V.SEGMENT]=1}),T.nodes=T.nodes.concat(F),T.nodes=T.nodes.filter(V=>V.id!=="submodule-"+w.SUBMODULE),T.links=T.links.filter(V=>Ne(V)!=="submodule-"+w.SUBMODULE&&Ie(V)!=="submodule-"+w.SUBMODULE),If(w)}if(w.type==="tier2"){const F=w.id;P[w.SUBMODULE+"_"+w.SEGMENT]=0,T.nodes=T.nodes.filter(st=>st.id!==F&&st.id!=="submodule-"+w.SUBMODULE),T.links=T.links.filter(st=>Ne(st)!==F&&Ie(st)!==F);const V=$e.filter(st=>st.SUBMODULE===w.SUBMODULE&&st.SEGMENT===w.SEGMENT&&st.type!=="tier1"&&st.type!=="tier2"),X=Se.filter(st=>st.sourceSubmodule===w.SUBMODULE&&st.targetSubmodule===w.SUBMODULE&&st.targetSegment===w.SEGMENT&&st.sourceSegment===w.SEGMENT);T.nodes=T.nodes.concat(V),T.links=T.links.concat(X),Cf(w)}Bu(T.nodes.map(F=>F.NAME).join("-")),bs()}}function If(w){const F=Se.filter(X=>X.sourceSubmodule===w.SUBMODULE&&X.targetSubmodule!==w.SUBMODULE),V=Se.filter(X=>X.targetSubmodule===w.SUBMODULE&&X.sourceSubmodule!==w.SUBMODULE);Se.filter(X=>X.targetSubmodule===w.SUBMODULE&&X.sourceSubmodule===w.SUBMODULE).forEach(X=>{T.links.push({source:"segment-"+w.SUBMODULE+"_"+X.sourceSegment,target:"segment-"+w.SUBMODULE+"_"+X.targetSegment})}),F.forEach(X=>{const st="segment-"+w.SUBMODULE+"_"+X.sourceSegment,_t="segment-"+X.targetSubmodule+"_"+X.targetSegment,St="submodule-"+X.targetSubmodule,$=Ie(X);let it={};T.nodes.findIndex(wt=>wt.id===_t)!==-1?it={source:st,target:_t}:T.nodes.findIndex(wt=>wt.id===St)!==-1?it={source:st,target:St}:T.nodes.findIndex(wt=>wt.id===$)!==-1&&(it={source:st,target:$}),T.links.push(it)}),V.forEach(X=>{const st="segment-"+w.SUBMODULE+"_"+X.targetSegment,_t="segment-"+X.sourceSubmodule+"_"+X.sourceSegment,St="submodule-"+X.sourceSubmodule,$=Ne(X);let it={};T.nodes.findIndex(wt=>wt.id===_t)!==-1?it={source:_t,target:st}:T.nodes.findIndex(wt=>wt.id===St)!==-1?it={source:St,target:st}:T.nodes.findIndex(wt=>wt.id===$)!==-1&&(it={source:$,target:st}),T.links.push(it)})}function Cf(w){const F=Se.filter(D=>D.sourceSubmodule===w.SUBMODULE&&D.sourceSegment===w.SEGMENT),V=Se.filter(D=>D.targetSubmodule===w.SUBMODULE&&D.targetSegment===w.SEGMENT);F.forEach(D=>{const X=Ne(D),st="segment-"+D.targetSubmodule+"_"+D.targetSegment,_t="submodule-"+D.targetSubmodule,St=Ie(D);let $={};T.nodes.findIndex(it=>it.id===st)!==-1?$={source:X,target:st}:T.nodes.findIndex(it=>it.id===_t)!==-1?$={source:X,target:_t}:T.nodes.findIndex(it=>it.id===X)!==-1&&T.nodes.findIndex(it=>it.id===St)!==-1&&($=D),T.links.push($)}),V.forEach(D=>{const X=Ie(D),st="segment-"+D.sourceSubmodule+"_"+D.sourceSegment,_t="submodule-"+D.sourceSubmodule,St=Ne(D);let $={};T.nodes.findIndex(it=>it.id===st)!==-1?$={source:st,target:X}:T.nodes.findIndex(it=>it.id==_t)!==-1?$={source:_t,target:X}:T.nodes.findIndex(it=>it.id===St)!==-1&&T.nodes.findIndex(it=>it.id===X)!==-1&&($=D),T.links.push($)})}function Uo(w){T.nodes.forEach(F=>{const V=ki.get(F);V.visible=!!Ns(w,F.id);const D=Pr.get(F);D.visible=!!Ns(w,F.id)}),T.links.forEach(F=>{const V=hr.get(F);V.alpha=Ma(w,F)?.7:0}),Bu(w.map(F=>F).join("-"))}function Rf(w){T.nodes.forEach(F=>{const V=ki.get(F);V.visible=!0,V.alpha=F.NAME===w?1:.2;const D=Pr.get(F);D.visible=F.NAME===w}),T.links.forEach(F=>{const V=hr.get(F);V.alpha=.1})}function Mf(w){const F=T.nodes.find(D=>D.id===w[0]),V=T.nodes.find(D=>D.id===w[1]);w[0]&&re(".clickedNodes-1").html("Start node: "+(F?F.NAME:"")),w[1]&&re(".clickedNodes-2").html("End node: "+(V?V.NAME:"")),w.length>0&&re(".message").style("visibility","visible")}function ws(){T.nodes.forEach(w=>{const F=ki.get(w);F.alpha=1,F.visible=!Ns(E,w.id);const V=Pr.get(w);V.visible=w.type==="tier1"||w.type==="tier2"}),T.links.forEach(w=>{const F=hr.get(w);F.alpha=T.links.length>200?.3:y}),yt&&(Pe.animate({position:new Ot(0,0),scaleX:1,scaleY:1,time:1e3}),document.getElementById("search-input").value="",document.getElementById("suggestions-container").innerHTML="",document.getElementById("reset-search").style.display="none",gi.select(".shortestPath-status").html(""),yt=!1),C=!1,I=!1,Y=[],gi.select(".clickedNodes-1").html(""),gi.select(".clickedNodes-2").html(""),gi.select(".shortestPath-status").html(""),gi.style("visibility","hidden"),Lo.style("visibility","hidden").attr("pointer-events","none"),document.querySelectorAll('input[type="checkbox"]').forEach(w=>w.checked=!1),document.querySelectorAll('input[type="checkbox"]').forEach(w=>w.disabled=!1)}function Pf(w){Pe.animate({position:new Ot(w.x,w.y),scaleX:2,scaleY:2,time:800}),yt=!0}function Nf(w){let F=[];F.push(`<div><h3 style='text-align: center'>${w.NAME}</h3></div>`);const V=Li.find(X=>X.NAME===w.NAME);q.forEach(X=>{F.push(`<div><b>${X}: </b><span>${V[X]}</span></div>`)});let D="";F.map(X=>D+=X),Lo.html(`${D}`).style("top","150px").style("left","5px").style("visibility","visible")}function Jx(){function w(rt,Et,Lt){const _e=document.createElement("button");return _e.textContent=rt,Lt!==6?_e.classList.add("button"):_e.classList.add("button1"),_e.addEventListener("click",Et),_e}function F(rt){switch(rt.target.getAttribute("data-button-id")){case"button1":ht=!ht,ht?(rt.target.classList.add("clicked"),T.links.forEach(U=>{const k=hr.get(U);k.getChildByName("ARROW").alpha=1})):(rt.target.classList.remove("clicked"),T.links.forEach(U=>{const k=hr.get(U);k.getChildByName("ARROW").alpha=0}));break;case"button2":pt=!pt,pt?rt.target.classList.add("clicked"):(rt.target.classList.remove("clicked"),ws()),ot=!1,C=!1,document.querySelector('.button[data-button-id="button3"]').classList.remove("clicked");const Lt=Gn(T.nodes,T.links);Of(T.nodes,pt,Lt);break;case"button3":if(I)return;ot=!ot,ot?rt.target.classList.add("clicked"):(rt.target.classList.remove("clicked"),ws()),pt=!1,document.querySelector('.button[data-button-id="button2"]').classList.remove("clicked");break;case"button4":if(I||yt||C)return;z=!z,P={},At.map(U=>{P[U.SUBMODULE]=z?1:0}),Tt.map(U=>{P[U.SUBMODULE+"_"+U.SEGMENT]=z?0:1}),z?(rt.target.classList.add("clicked"),T=Nr(i,t,!0,"SUBMODULE",R),bs(!0)):(rt.target.classList.remove("clicked"),T=Nr(i.concat(Tt),t,!1,"SUBMODULE",R),bs(!0));break;case"button5":if(I||yt||C)return;if(vt=!vt,vt)rt.target.classList.remove("clicked"),T.nodes.forEach(U=>{const k=ki.get(U);k.visible=!0}),E=[];else{rt.target.classList.add("clicked");const U=Gn(T.nodes,T.links);E=T.nodes.filter(k=>U.degreeWithoutSelfLoops(k.id)===0).map(k=>k.id),T.nodes.forEach(k=>{const K=ki.get(k);K.visible=!Ns(E,k.id)})}break;case"button6":ws(),document.querySelectorAll("button").forEach(function(U,k){k!==3&&U.classList.remove("clicked")}),T.links.forEach(U=>{const k=hr.get(U);k.getChildByName("ARROW").alpha=0}),T.nodes.forEach(U=>{const k=ki.get(U);k.visible=!0,k.alpha=1}),Y=[],I=!1,C=!1,z=!1,ht=!1,ot=!1,pt=!1,yt=!1,vt=!0,Dt==="Quilt"&&(T=Nr(i.concat(At),Se,!1,"SUBMODULE",R,"Quilt")),Dt==="Middle"&&(T=Nr(i.concat(Tt),Se,!1,"SUBMODULE",R)),Dt==="Whole"&&(T=Nr($e,Se,!0,"SUBMODULE",R)),bs();break}}const V=document.getElementById("buttonPanel"),D=document.createElement("div"),X=document.createElement("div");V.appendChild(D),V.appendChild(X),["Show directions","Show shortest path","Show neighbors"].forEach((rt,Et)=>{const Lt=w(rt,F,Et+1);Lt.setAttribute("data-button-id",`button${Et+1}`),ht&&Et===0&&Lt.classList.add("clicked"),pt&&Et===1&&Lt.classList.add("clicked"),ot&&Et===2&&Lt.classList.add("clicked"),vt&&Et===5&&Lt.classList.add("clicked"),D.appendChild(Lt)});const st=document.createElement("select");st.id="degreeSelection",D.appendChild(st);const _t=[1,2,3];for(var St=0;St<_t.length;St++){var $=document.createElement("option");$.value=_t[St],$.text=_t[St],st.appendChild($)}document.getElementById("degreeSelection").addEventListener("change",function(){Ct=document.getElementById("degreeSelection").value;const rt=Gn(T.nodes,T.links),Et=Ou(rt,Y,Ct);Et&&Et.length>0&&Uo(Et)}),["Expanded Graph","Hide Single Nodes","Reset"].forEach((rt,Et)=>{const Lt=w(rt,F,Et+4);Lt.setAttribute("data-button-id",`button${Et+4}`),X.appendChild(Lt)});const it=document.createElement("select");it.classList.add("default-dd"),it.id="resetSelection",X.appendChild(it);const wt=["Quilt","Middle","Whole"];for(var St=0;St<wt.length;St++){var $=document.createElement("option");$.value=wt[St],$.text=wt[St],$.value===Dt&&($.selected=!0),it.appendChild($)}document.getElementById("resetSelection").addEventListener("change",function(){Dt=document.getElementById("resetSelection").value})}function Of(w,F,V){V||(V=Gn(T.nodes,T.links));const D=document.getElementById("search-input"),X=document.getElementById("reset-search"),st=document.getElementById("suggestions-container");function _t($){const it={keys:["NAME","DEFINITION"],threshold:.4};return new Tn(w,it).search($).map(Et=>Et.item)}function St($){const it=_t($);st.innerHTML="",it.sort(function(wt,rt){return wt.NAME.toLowerCase().localeCompare(rt.NAME.toLowerCase())}),it.forEach(wt=>{const rt=document.createElement("div");rt.classList.add("suggestion"),rt.textContent=wt.DEFINITION?`${wt.NAME} - ${wt.DEFINITION}`:wt.NAME,rt.addEventListener("click",()=>{yt=!0,D.value=wt.NAME,st.style.display="none",X.style.display="block",T.nodes.find(Et=>Et.NAME===wt.NAME)?(F?Af(wt,V):Rf(wt.NAME),Pf(wt),document.querySelectorAll('input[type="checkbox"]').forEach(Et=>Et.disabled=!0)):(re(".message").style("visibility","visible"),re(".shortestPath-status").html("No such node found."))}),st.appendChild(rt)}),it.length>0?st.style.display="block":st.style.display="none"}D.addEventListener("input",()=>{Me.alpha(0);const $=D.value;St($)}),X.addEventListener("click",()=>{yt=!1,D.value="",st.innerHTML="",X.style.display="none",ws()}),document.addEventListener("click",$=>{st.contains($.target)||(st.style.display="none")})}}function Cy(i,t){return CL.bidirectional(i,t[0],t[1])}function Ou(i,t,e){let r=[];return t.forEach(s=>{yy(i,s.id?s.id:s,function(n,o,a){a<=e&&r.push(n)},{mode:"outbound"}),yy(i,s.id?s.id:s,function(n,o,a){a<=e&&r.push(n)},{mode:"inbound"})}),r}function Gn(i,t){const e=new jt;for(let r=0;r<i.length;r++)e.hasNode(i[r].id)||e.addNode(i[r].id);for(let r=0;r<t.length;r++){let s=Ne(t[r]),n=Ie(t[r]);e.hasNode(s)&&e.hasNode(n)&&(e.hasEdge(s,n)||e.addEdge(s,n))}return e}function Bu(i){const t=encodeURIComponent(JSON.stringify(i)),e=`${window.location.pathname}?state=${t}`;window.history.pushState({state:i},"",e)}function kU(i){return i.selectAll("input:checked").data().map(t=>t.id)}function Ps(i){return i!==null&&typeof i=="object"?i.valueOf():i}function Ne(i){return i.source&&(i.source.id?i.source.id:i.source)}function Ie(i){return i.target&&(i.target.id?i.target.id:i.target)}function Ma(i,t){return i.indexOf(Ne(t))!==-1&&i.indexOf(Ie(t))!==-1}function Ns(i,t){return i.indexOf(t)!==-1}async function UU(){try{const[i,t]=await Promise.all([fetch("/assets/nodes.json"),fetch("/assets/edges.json")]);if(!i.ok||!t.ok)throw new Error(`HTTP error! Status: ${i.status} ${t.status}`);const e=await i.json(),r=await t.json();if(e&&r){const s=["#418BFC","#46BCC8","#D6AB1B","#EB5E68","#B6BE1C","#F64D1A","#BA6DE4","#EA6BCB","#B9AAC8","#F08519"],n=e.map(o=>({NAME:o.NAME,DEFINITION:o.DEFINITION,SUBMODULE:o.SUBMODULE,SUBMODULE_NAME:o["SUBMODULE NAME"],SEGMENT:o.SEGMENT,SEGMENT_NAME:o["SEGMENT NAME"],UNITS:o.UNITS,ReportValue:o.ReportValue,...o}));LU({nodes:n,links:r},{containerSelector:"#app",nodeId:"NAME",sourceId:"UsesVariable",targetId:"Variable",nodeGroup:o=>o.SUBMODULE,nodeTitle:o=>o.NAME,linkStroke:"#fff",nodeStroke:"#000",linkStrokeWidth:.6,linkStroke:"#fff",labelColor:"#fff",labelScale:3,colors:s,width:window.innerWidth,height:window.innerHeight})}else throw new Error("Invalid response format")}catch(i){console.error("Error fetching data:",i)}}UU();
